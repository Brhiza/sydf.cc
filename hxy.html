<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒ¡æ¹˜æ€¡çš„å¤§é˜¿å¡çº³</title>
    <style>
        /* èƒŒæ™¯æ ·å¼ */
        body {
              font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #87CEFA;
            background: linear-gradient(to bottom right, #9370DB 0, #483D8B 100%);
            overflow: auto;
            position: relative;
            padding-top: 100px
        }

/* ç”µè„‘è®¾å¤‡ï¼ˆå±å¹•å®½åº¦å¤§äº 768pxï¼‰ */
@media (min-width: 769px) {
    body {
        padding-top: 50px; /* ç”µè„‘è®¾å¤‡ç•™ç™½ */
    }
}

/* æ‰‹æœºè®¾å¤‡ï¼ˆå±å¹•å®½åº¦å°äºç­‰äº 768pxï¼‰ */
@media (max-width: 768px) {
    body {
        padding-top: 50px; /* æ‰‹æœºè®¾å¤‡ç•™ç™½ */
    }
}

        
        /* èƒŒæ™¯æ°”æ³¡åŠ¨ç”» */
        .bg-bubbles {
            position: fixed; /* æ”¹ä¸º fixedï¼Œå›ºå®šåœ¨èƒŒæ™¯ä¸Š */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* èƒŒæ™¯æ°”æ³¡çš„ z-index è®¾ç½®ä¸º 0 */
        }

        .bg-bubbles li {
            position: absolute;
            list-style: none;
            display: block;
            width: 40px;
            height: 40px;
            background-color: hsla(0, 0%, 100%, .15);
            bottom: -160px;
            animation: square 25s infinite;
            transition-timing-function: linear;
        }

        .bg-bubbles li:nth-child(1) {
            left: 10%;
        }

        .bg-bubbles li:nth-child(2) {
            left: 20%;
            width: 80px;
            height: 80px;
            animation-delay: 2s;
            animation-duration: 17s;
        }

        .bg-bubbles li:nth-child(3) {
            left: 25%;
            animation-delay: 4s;
        }

        .bg-bubbles li:nth-child(4) {
            left: 40%;
            width: 60px;
            height: 60px;
            animation-duration: 22s;
            background-color: hsla(0, 0%, 100%, .25);
        }

        .bg-bubbles li:nth-child(5) {
            left: 70%;
        }

        .bg-bubbles li:nth-child(6) {
            left: 80%;
            width: 120px;
            height: 120px;
            animation-delay: 3s;
            background-color: hsla(0, 0%, 100%, .2);
        }

        .bg-bubbles li:nth-child(7) {
            left: 32%;
            width: 160px;
            height: 160px;
            animation-delay: 7s;
        }

        .bg-bubbles li:nth-child(8) {
            left: 55%;
            width: 20px;
            height: 20px;
            animation-delay: 15s;
            animation-duration: 40s;
        }

        .bg-bubbles li:nth-child(9) {
            left: 25%;
            width: 10px;
            height: 10px;
            animation-delay: 2s;
            animation-duration: 40s;
            background-color: hsla(0, 0%, 100%, .3);
        }

        .bg-bubbles li:nth-child(10) {
            left: 90%;
            width: 160px;
            height: 160px;
            animation-delay: 11s;
        }

        @keyframes square {
            0% {
                transform: translateY(0);
            }
            to {
                transform: translateY(-700px) rotate(600deg);
            }
        }

        /* å†…å®¹æ¡†æ ·å¼ */
        .content-box {
            width: 90%;
            max-width: 1200px;
            min-width: 300px;
                padding: 20px; /* å‡å°‘ padding */
    box-sizing: border-box; /* ç¡®ä¿ padding ä¸ä¼šå¢åŠ å®½åº¦ */
            border-radius: 20px; /* åœ†è§’çŸ©å½¢ */
            background: rgba(255, 255, 255, 0.2); /* æ¯›ç»ç’ƒèƒŒæ™¯ */
            backdrop-filter: blur(10px); /* æ¯›ç»ç’ƒæ•ˆæœ */
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2); /* é˜´å½± */
            z-index: 2; /* ç¡®ä¿å†…å®¹æ¡†åœ¨èƒŒæ™¯æ°”æ³¡ä¹‹ä¸Š */
            position: relative; /* ç›¸å¯¹å®šä½ */
        }

    .card-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0;
      overflow: visible;
    }

    .card-row {
      display: flex;
      justify-content: center;
      gap: -1rem;
      flex-wrap: wrap;
    }

    .card {
      width: 6rem;
      height: 9rem;
      border: 1px solid #ccc;
      margin: 0.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      position: relative;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: opacity 0.5s ease-in-out, transform 0.3s ease-in-out;
      border-radius: 5px;
    }

    @media (max-width: 768px) {
      .card {
        width: 2.5rem;
        height: 4rem;
      }

      .card-row {
        gap: 0rem;
      }

      .input-container input {
        width: 90%;
        max-width: 100%;
      }
    }

    @media (min-width: 769px) {
      .card {
        width: 6rem;
        height: 9rem;
      }
    }

    .card.hidden {
      opacity: 0;
    }

        .result-container {
            width: 90%;
            max-width: 1200px;
            overflow: auto; /* è¶…å‡ºéƒ¨åˆ†æ»šåŠ¨ */
            box-sizing: border-box; /* åŒ…å« padding å’Œ border */
            display: flex;
            flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */
            gap: 10px; /* å­å…ƒç´ é—´è· */
            align-items: center;
            justify-content: center;
            margin-top: 2rem;
        }
        .result-container img {
            max-width: 100%; /* å›¾ç‰‡å®½åº¦ä¸è¶…è¿‡å®¹å™¨ */
            height: auto; /* é«˜åº¦è‡ªé€‚åº” */
        }
        .result-container p {
            word-wrap: break-word; /* å…è®¸é•¿å•è¯æ¢è¡Œ */
            margin: 0;
        }

    .reset-button,
    .copy-button,
    .ai-button {
        padding: 12px 24px;
        border: none;
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin: 5px;
    }

    .reset-button:hover,
    .copy-button:hover,
    .ai-button:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .reset-button:active,
    .copy-button:active,
    .ai-button:active {
        background: rgba(138, 43, 226, 0.6);
        border-color: rgba(138, 43, 226, 0.8);
        box-shadow: 0 0 15px rgba(138, 43, 226, 0.3);
    }

    @media (max-width: 768px) {
        .content-box {
          background: rgba(255, 255, 255, 0.2); /* æ¯›ç»ç’ƒèƒŒæ™¯ */
          backdrop-filter: blur(10px);
            -webkit-backdrop-filter: none;
        }
        
        .reset-button,
        .copy-button,
        .ai-button {
            padding: 8px 16px;
            font-size: 0.9rem;
            margin: 3px;
        }
    }

    .centered {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }


h1 {
  font-size: 48px; /* é»˜è®¤å­—ä½“å¤§å° */
  color: #fff;
  margin-bottom: 30px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  flex-direction: column;
  align-items: center;
  text-align: center;
}

/* é’ˆå¯¹æ‰‹æœºè®¾å¤‡çš„æ ·å¼ */
@media (max-width: 768px) {
  h1 {
    font-size: 32px; /* æ‰‹æœºç«¯å­—ä½“å¤§å° */
  }
}
        
    .input-container {
            font-size: 24px;
            color: #fff;
            margin-bottom: 30px;
                  flex-direction: column;
      align-items: center;
      text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .input-container input {
      width: 90%;
      max-width: 100%;
      padding: 1rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
            
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
      margin-top: 0.5rem;
    }

    .input-container input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
    }

    .output-text {
      margin-top: 2rem;
      font-size: 1.2rem;
      font-weight: bold;
      color: #F5F5F5;
      padding: 1rem;
      border-radius: 5px;
    }

    .output-text strong {
      font-size: 1.4rem;
      font-weight: bold;
      color: #F5F5F5;
    }

    .output-text em {
      font-size: 1.1rem;
      font-style: italic;
      color: #F5F5F5;
    }

    .button-container {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }

    .loading-animation {
      display: none;
      margin-top: 2rem;
      font-size: 1.2rem;
      font-weight: bold;
      color: #FFF;
      text-align: center;
            background: rgba(255, 255, 255, 0.2); /* æ¯›ç»ç’ƒèƒŒæ™¯ */
            backdrop-filter: blur(10px);
      padding: 1rem;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .loading-animation::after {
      content: 'AIç–¯ç‹‚æ€è€ƒä¸­...';
      animation: loading 1s infinite;
    }

    @keyframes loading {
      0% {
        content: 'AIç–¯ç‹‚æ€è€ƒä¸­.';
      }

      33% {
        content: 'AIç–¯ç‹‚æ€è€ƒä¸­..';
      }

      66% {
        content: 'AIç–¯ç‹‚æ€è€ƒä¸­...';
      }

      100% {
        content: 'AIç–¯ç‹‚æ€è€ƒä¸­.';
      }
    }

    #outputText .highlight {
      background-color: #fff3cd;
      padding: 2px 4px;
      border-radius: 4px;
    }

    #outputText blockquote {
      border-left: 4px solid #6c757d;
      padding-left: 1em;
      margin-left: 0;
      color: #6c757d;
    }
    </style>
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <!-- èƒŒæ™¯æ°”æ³¡åŠ¨ç”» -->
    <ul class="bg-bubbles">
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>

    <!-- å†…å®¹æ¡† -->
    <h1>èƒ¡æ¹˜æ€¡çš„å¤§é˜¿å¡çº³</h1>
    <div class="content-box">
    <div class="input-container">

      1.å†™ä¸‹æ‚¨çš„é—®é¢˜
      <br><br>
      <input type="text" id="inputText" placeholder="åªèƒ½æé—®èƒ½ç”¨Yes/Noå›ç­”çš„é—®é¢˜å“¦" value="ä»Šæ—¥è¿åŠ¿" autofocus>
      <br><br>
      2.å¤´è„‘ä¸­æƒ³ç€æ‚¨çš„é—®é¢˜ï¼Œå¹¶æŠ½å– 3 å¼ å¡”ç½—ç‰Œ
      <br>
    </div>
  </header>
  <main class="centered">
    <div class="card-container" id="cardContainer"></div>
    <div class="result-container" id="resultContainer"></div>
    <div class="button-container">
      <button class="copy-button centered" id="copyButton" onclick="copyResult()" style="display: none;">å¤åˆ¶ç»“æœ</button>
      <button class="reset-button centered" id="resetButton" onclick="resetCards()" style="display: none;">é‡æ–°æŠ½ç‰Œ</button>
      <button class="ai-button centered" id="aiButton" onclick="aiInterpretation()" style="display: none;">AIè§£è¯»</button>
    </div>
    <div class="output-text" id="outputText"></div>
    <div class="loading-animation" id="loadingAnimation"></div>
  </main>
    </div>

    <script>
const majorArcanaCardNames = ["æ„šäºº", "é­”æœ¯å¸ˆ", "å¥³ç¥­å¸", "çš‡å", "çš‡å¸", "æ•™çš‡", "æ‹äºº", "æˆ˜è½¦", "åŠ›é‡", "éšå£«", "å‘½è¿ä¹‹è½®", "æ­£ä¹‰", "å€’åŠäºº", "æ­»äº¡", "èŠ‚åˆ¶", "æ¶é­”", "é«˜å¡”", "æ˜Ÿæ˜Ÿ", "æœˆäº®", "å¤ªé˜³", "å®¡åˆ¤", "ä¸–ç•Œ"];
    const cardDescriptions = [{
        upright: "å¼€ç«¯ã€è‡ªç”±ã€çº¯çœŸã€ç‹¬åˆ›æ€§ã€å†’é™©ã€ç†æƒ³ä¸»ä¹‰ã€è‡ªå‘æ€§",
        reversed: "é²è½ã€ç²—å¿ƒã€åˆ†å¿ƒã€å¹¼ç¨šã€æ„šè ¢ã€å®¹æ˜“ä¸Šå½“ã€é™ˆæ—§ã€è¿Ÿé’"
      },
      {
        upright: "æ„å¿—åŠ›ã€æ¬²æœ›ã€è¶³æ™ºå¤šè°‹ã€æŠ€èƒ½ã€èƒ½åŠ›ã€ä¸“æ³¨ã€è¡¨ç°",
        reversed: "æ“çºµã€ç‹¡çŒ¾ã€è¯¡è®¡ã€æµªè´¹å¤©èµ‹ã€é”™è§‰ã€æ¬ºéª—"
      },
      {
        upright: "æ— æ„è¯†ã€ç›´è§‰ã€ç¥ç§˜ã€çµæ€§ã€æ›´é«˜çš„åŠ›é‡ã€å†…åœ¨çš„å£°éŸ³",
        reversed: "è¢«å‹æŠ‘çš„ç›´è§‰ã€éšè—çš„åŠ¨æœºã€è‚¤æµ…ã€å›°æƒ‘ã€è®¤çŸ¥å¤±è°ƒ"
      },
      {
        upright: "ç¥åœ£çš„å¥³æ€§ã€æ€§æ„Ÿã€ç”Ÿè‚²åŠ›ã€åŸ¹è‚²ã€åˆ›é€ åŠ›ã€ç¾ä¸½ã€ä¸°å¯Œã€è‡ªç„¶",
        reversed: "ä¸å®‰å…¨ã€ä¸“æ¨ªã€ç–å¿½ã€çª’æ¯ã€ç¼ºä¹æˆé•¿ã€ç¼ºä¹è¿›æ­¥"
      },
      {
        upright: "ç¨³å®šæ€§ã€ç»“æ„ã€ä¿æŠ¤ã€æƒå¨ã€æ§åˆ¶ã€å®ç”¨æ€§ã€é‡ç‚¹ã€çºªå¾‹",
        reversed: "æš´å›ã€éœ¸é“ã€æ­»æ¿ã€å›ºæ‰§ã€ç¼ºä¹çºªå¾‹ã€é²è½"
      },
      {
        upright: "ä¼ ç»Ÿã€ç¤¾ä¼šç¾¤ä½“ã€çº¦å®šä¿—æˆã€ä»ä¼—ã€æ•™è‚²ã€çŸ¥è¯†ã€ä¿¡ä»°",
        reversed: "å›é€†ã€éå¸¸è§„ã€ä¸å¾ªè§„è¹ˆçŸ©ã€æ–°æ–¹æ³•ã€æ— çŸ¥"
      },
      {
        upright: "çˆ±ã€å·¥ä¼šã€ä¼™ä¼´å…³ç³»ã€å…³ç³»ã€é€‰æ‹©ã€æµªæ¼«ã€å¹³è¡¡ã€å›¢ç»“",
        reversed: "ä¸å’Œè°ã€ä¸å¹³è¡¡ã€å†²çªã€è¶…è„±ã€é”™è¯¯çš„é€‰æ‹©ã€ä¼˜æŸ”å¯¡æ–­"
      },
      {
        upright: "æˆåŠŸã€é›„å¿ƒã€å†³å¿ƒã€æ„å¿—åŠ›ã€æ§åˆ¶åŠ›ã€è‡ªå¾‹ã€ä¸“æ³¨",
        reversed: "æœ‰åŠ›ã€æ²¡æœ‰æ–¹å‘ã€æ²¡æœ‰æ§åˆ¶ã€æ— åŠ›ã€ä¾µç•¥ã€éšœç¢"
      },
      {
        upright: "å‹‡æ°”ã€å‹‡æ•¢ã€è‡ªä¿¡ã€åŒæƒ…ã€è‡ªä¿¡ã€å†…åœ¨åŠ›é‡",
        reversed: "è‡ªæˆ‘æ€€ç–‘ã€è½¯å¼±ã€ä½ä¿¡å¿ƒã€ä¸è¶³ã€æ€¯æ‡¦ã€å¼ºç¡¬"
      },
      {
        upright: "è‡ªæˆ‘åçœã€å†…çœã€æ²‰æ€ã€é€€ç¼©ã€å­¤ç‹¬ã€å¯»æ‰¾è‡ªæˆ‘",
        reversed: "å­¤ç‹¬ã€å­¤ç«‹ã€éšå±…ã€åç¤¾ä¼šã€æ‹’ç»ã€å›å½’ç¤¾ä¼š"
      },
      {
        upright: "å˜åŒ–ã€å‘¨æœŸã€å‘½è¿ã€å†³å®šæ€§æ—¶åˆ»ã€è¿æ°”ã€è´¢å¯Œã€çªå‘äº‹ä»¶",
        reversed: "è¿æ°”ä¸å¥½ã€ç¼ºä¹æ§åˆ¶ã€æ‰§ç€äºæ§åˆ¶ã€ä¸å—æ¬¢è¿çš„å˜åŒ–ã€å»¶è¯¯"
      },
      {
        upright: "æ­£ä¹‰ã€ä¸šåŠ›ã€åæœã€è´£ä»»ã€æ³•å¾‹ã€çœŸç›¸ã€è¯šå®ã€æ­£ç›´ã€å› æœ",
        reversed: "ä¸å…¬æ­£ã€æŠ¥å¤ã€ä¸è¯šå®ã€è…è´¥ã€ä¸è¯šå®ã€ä¸å…¬å¹³ã€é€ƒé¿è´£ä»»"
      },
      {
        upright: "ç‰ºç‰²ã€ç­‰å¾…ã€ä¸ç¡®å®šã€ç¼ºä¹æ–¹å‘ã€è§†è§’ã€æ²‰æ€",
        reversed: "æ‹–å»¶ã€æ¼ ä¸å…³å¿ƒã€åœæ»ä¸å‰ã€é¿å…ç‰ºç‰²ã€å†·æ¼ "
      },
      {
        upright: "è½¬å˜ã€ç»“å±€ã€æ”¹å˜ã€è¿‡æ¸¡ã€æ”¾æ‰‹ã€é‡Šæ”¾",
        reversed: "å®³æ€•æ”¹å˜ã€é‡å¤æ¶ˆæçš„æ¨¡å¼ã€æŠµåˆ¶æ”¹å˜ã€åœæ»ä¸å‰ã€è…æœ½"
      },
      {
        upright: "å¹³è¡¡ã€å’Œå¹³ã€è€å¿ƒã€é€‚åº¦ã€å¹³é™ã€å®‰å®ã€å’Œè°ã€å®é™",
        reversed: "ä¸å¹³è¡¡ã€è¿‡åº¦ã€æç«¯ã€ä¸å’Œè°ã€é²è½ã€ä»“ä¿ƒ"
      },
      {
        upright: "å‹è¿«ã€æˆç˜¾ã€ç—´è¿·ã€ä¾èµ–ã€è¿‡åº¦ã€æ— åŠ›ã€å±€é™",
        reversed: "ç‹¬ç«‹ã€è‡ªç”±ã€å¯ç¤ºã€é‡Šæ”¾ã€æ”¶å›æƒåŠ›ã€æ”¶å›æ§åˆ¶"
      },
      {
        upright: "ç¾éš¾ã€ç ´åã€å‰§å˜ã€åˆ›ä¼¤ã€çªå˜ã€æ··ä¹±",
        reversed: "é¿å…ç¾éš¾ã€å»¶è¿Ÿä¸å¯é¿å…çš„ã€æŠµåˆ¶å˜åŒ–"
      },
      {
        upright: "å¸Œæœ›ã€çµæ„Ÿã€ç§¯ææ€§ã€ä¿¡å¿µã€æ›´æ–°ã€æ²»æ„ˆã€å¤å…´",
        reversed: "ç»æœ›ã€ç»æœ›ã€æ¶ˆæã€ç¼ºä¹ä¿¡å¿ƒã€æ²®ä¸§"
      },
      {
        upright: "é”™è§‰ã€ç›´è§‰ã€ä¸ç¡®å®šæ€§ã€å›°æƒ‘ã€å¤æ‚æ€§ã€ç§˜å¯†ã€æ— æ„è¯†",
        reversed: "ææƒ§ã€æ¬ºéª—ã€ç„¦è™‘ã€è¯¯è§£ã€æ›²è§£ã€æ¸…æ™°ã€ç†è§£"
      },
      {
        upright: "å¹¸ç¦ã€æˆåŠŸã€ä¹è§‚ã€æ´»åŠ›ã€å–œæ‚¦ã€è‡ªä¿¡ã€çœŸç†",
        reversed: "å¹¸ç¦å—é˜»ã€è¿‡åº¦çƒ­æƒ…ã€æ‚²è§‚ã€ä¸åˆ‡å®é™…çš„æœŸæœ›ã€è‡ªè´Ÿ"
      },
      {
        upright: "è‡ªæˆ‘è¯„ä»·ã€è§‰é†’ã€æ›´æ–°ã€ç›®çš„ã€åæ€ã€æ¸…ç®—",
        reversed: "è‡ªæˆ‘æ€€ç–‘ã€ç¼ºä¹è‡ªæˆ‘æ„è¯†ã€æœªèƒ½å¸å–æ•™è®­ã€è‡ªæˆ‘åŒæ¶"
      },
      {
        upright: "å®Œæˆã€æˆå°±ã€æˆå°±æ„Ÿã€å½’å±æ„Ÿã€æ•´ä½“æ€§ã€å’Œè°",
        reversed: "ç¼ºä¹å°é—­æ„Ÿã€ç¼ºä¹æˆå°±æ„Ÿã€æ„Ÿè§‰ä¸å®Œæ•´ã€ç©ºè™š"
      }
    ];
        const cdnBaseUrl = "./img/mx/";
        const defaultCardImage = `${cdnBaseUrl}00.jpg`;
        let cards = [];
        let drawnCards = [];
        let drawCount = 0;
        let isCardClickable = true;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initCards() {
            console.log("initCards called"); // è°ƒè¯•
            cards = shuffleArray(Array.from({ length: 22 }, (_, i) => i));
        }

        function createCardElement(cardNumber) {
            const cardElement = document.createElement('div');
            cardElement.classList.add('card');
            cardElement.dataset.number = cardNumber;
            cardElement.style.backgroundImage = `url(${defaultCardImage})`;
            cardElement.addEventListener('click', drawCard);
            return cardElement;
        }

        function displayCards() {
            console.log("displayCards called"); // è°ƒè¯•
            const cardContainer = document.getElementById('cardContainer');
            cardContainer.innerHTML = '';
            const row1 = document.createElement('div');
            row1.classList.add('card-row');
            const row2 = document.createElement('div');
            row2.classList.add('card-row');
            cards.forEach((cardNumber, index) => {
                const cardElement = createCardElement(cardNumber);
                if (index < 11) {
                    row1.appendChild(cardElement);
                } else {
                    row2.appendChild(cardElement);
                }
            });
            cardContainer.appendChild(row1);
            cardContainer.appendChild(row2);
        }

    function generateResultContent(card) {
      const imgPath = `${cdnBaseUrl}${Number(card.number) + 1}.jpg`;
      const transformStyle = card.reversed ? "rotate(180deg)" : "none";
      const cardWidth = window.innerWidth <= 768 ? '3.5rem' : '7rem';
      const cardHeight = window.innerWidth <= 768 ? '5.5rem' : '10rem';
      const cardName = `${card.reversed ? "é€†ä½" : ""}${majorArcanaCardNames[card.number]}`;
      return `<div style="display: flex; flex-direction: column; align-items: center; margin: 0.5rem;">
        <img src='${imgPath}' style='width: ${cardWidth}; height: ${cardHeight}; transform:${transformStyle}; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);' alt='${cardName}'>
        <p style="margin-top: 0.5rem; font-size: ${window.innerWidth <= 768 ? '0.8rem' : '1rem'};">${cardName}</p>
      </div>`;
    }

    function drawCard() {
      if (!isCardClickable) return;
      isCardClickable = false;
      const inputText = document.getElementById('inputText').value;
      if (!inputText.trim()) {
        alert("ä½ è¿˜æ²¡æœ‰å†™ä¸‹é—®é¢˜å‘¢");
        isCardClickable = true;
        return;
      }
      const cardNumber = this.dataset.number;
      const isReversed = Math.random() < 0.5;
      const cardImagePath = `${cdnBaseUrl}${Number(cardNumber) + 1}.jpg`;
      if (!this.classList.contains('flipped')) {
        this.style.backgroundImage = `url(${cardImagePath})`;
        this.style.transform = isReversed ? "rotate(180deg)" : "none";
      }
      drawnCards.push({
        number: cardNumber,
        reversed: isReversed,
        description: isReversed ? cardDescriptions[cardNumber].reversed : cardDescriptions[cardNumber].upright
      });
      drawCount++;
      this.classList.add('flipped');
      const resultContainer = document.getElementById('resultContainer');
      resultContainer.innerHTML += generateResultContent({
        number: cardNumber,
        reversed: isReversed
      });
      this.classList.add('hidden');
      this.removeEventListener('click', drawCard);
      setTimeout(() => {
        isCardClickable = true;
      }, 500);
      if (drawCount === 3) {
        const resetButton = document.getElementById('resetButton');
        resetButton.style.display = 'block';
        const copyButton = document.getElementById('copyButton');
        copyButton.style.display = 'block';
        const aiButton = document.getElementById('aiButton');
        aiButton.style.display = 'block';
        const cardElements = document.querySelectorAll('.card');
        cardElements.forEach(card => card.removeEventListener('click', drawCard));
        const outputText = document.getElementById('outputText');
        const cardNames = drawnCards.map(card => `<strong>${card.reversed ? "é€†ä½" : ""}${majorArcanaCardNames[card.number]}</strong>`).join('ã€');
        const cardDescriptionsText = drawnCards.map(card => `<em>${card.reversed ? "é€†ä½" : ""}${majorArcanaCardNames[card.number]}ï¼Œä»£è¡¨${card.description}</em>`).join('<br>');
        const resultText = `${cardNames}<br>${inputText}<br><br><strong>ç‰Œæ„ç®€ä»‹</strong><br>${cardDescriptionsText}`;
        outputText.innerHTML = resultText;
        setTimeout(() => {
          window.scrollTo({
            top: document.documentElement.scrollHeight,
            behavior: 'smooth'
          });
        }, 100);
      }
    }

    function resetCards() {
      drawnCards = [];
      drawCount = 0;
      isCardClickable = true;
      const cardElements = document.querySelectorAll('.card');
      cardElements.forEach(card => {
        card.classList.remove('flipped');
        card.classList.remove('hidden');
        card.style.backgroundImage = `url(${defaultCardImage})`;
        card.style.transform = 'none';
        card.addEventListener('click', drawCard);
      });
      const resultContainer = document.getElementById('resultContainer');
      resultContainer.innerHTML = '';
      const resetButton = document.getElementById('resetButton');
      resetButton.style.display = 'none';
      const copyButton = document.getElementById('copyButton');
      copyButton.style.display = 'none';
      const aiButton = document.getElementById('aiButton');
      aiButton.style.display = 'none';
      const outputText = document.getElementById('outputText');
      outputText.textContent = '';
      const inputText = document.getElementById('inputText');
      inputText.value = '';
      initCards();
      displayCards();
    }

    function copyResult() {
      const outputText = document.getElementById('outputText').innerText;
      navigator.clipboard.writeText(outputText).then(() => {
        alert("ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");
      }).catch(err => {
        alert("å¤åˆ¶å¤±è´¥: " + err);
      });
    }

async function aiInterpretation() {
    let inputText = document.getElementById('inputText').value;
    // å¦‚æœæ˜¯é»˜è®¤é—®é¢˜ï¼Œå»æ‰ï¼ˆé»˜è®¤ï¼‰åç¼€
    inputText = inputText.replace('ï¼ˆé»˜è®¤ï¼‰', '');

    const cardNames = drawnCards.map(card =>
        `${card.reversed ? "é€†ä½" : ""}${majorArcanaCardNames[card.number]}`
    ).join('ã€');
    const cardDescriptionsText = drawnCards.map(card =>
        `${card.reversed ? "é€†ä½" : ""}${majorArcanaCardNames[card.number]}ï¼š${card.description}`
    ).join('\n');

    const prompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å¡”ç½—å¸ˆï¼Œä½ ä¼šæ ¹æ®æˆ‘çš„é—®é¢˜å’ŒæŠ½çš„ç‰Œç»™æˆ‘è§£å†³é—®é¢˜ï¼Œ\n é—®é¢˜ï¼š${inputText}\n\næŠ½å–çš„å¡ç‰Œï¼š\n${cardDescriptionsText}\n`;

    const outputText = document.getElementById('outputText');
    const aiButton = document.getElementById('aiButton');
    outputText.style.display = 'none';
    aiButton.classList.add('loading');
    aiButton.textContent = '';

    try {
        // åˆ›å»º AbortController å®ä¾‹
        const controller = new AbortController();
        window.currentAIRequest = controller;

        const response = await fetch('https://flow.onlyikun.com/ai', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                prompt: prompt,
                model: "Pro/deepseek-ai/DeepSeek-R1"
            }),
            signal: controller.signal // æ·»åŠ  signal
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
        }

        if (!response.body) {
            throw new Error('Response body is null');
        }

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let accumulatedText = '';

        while (true) {
            const { done, value } = await reader.read();
            if (done) break;

            const chunk = decoder.decode(value);
            const lines = chunk.split('\n').filter(line => line.trim() !== '');

            for (const line of lines) {
                if (line.startsWith('data: ')) {
                    try {
                        const jsonData = JSON.parse(line.slice(6));
                        if (jsonData.choices && jsonData.choices[0].delta && jsonData.choices[0].delta.content) {
                            const content = jsonData.choices[0].delta.content;
                            accumulatedText += content;
                            outputText.style.display = 'block';
                            outputText.innerHTML = marked.parse(accumulatedText);

                            const scrollTarget = document.documentElement.scrollHeight;
                            window.scrollTo({
                                top: scrollTarget,
                                behavior: 'smooth'
                            });
                        }
                    } catch (e) {
                        console.debug('è·³è¿‡é JSON æ•°æ®:', line, e); // æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œæ–¹ä¾¿è°ƒè¯•
                    }
                } else {
                    console.debug('è·³è¿‡é data: å¼€å¤´çš„è¡Œ:', line); // æ‰“å°é data: å¼€å¤´çš„è¡Œï¼Œæ–¹ä¾¿è°ƒè¯•
                }
            }
        }

        // åªåœ¨æ²¡æœ‰æ”¶åˆ°ä»»ä½•å†…å®¹æ—¶æŠ›å‡ºé”™è¯¯
        if (accumulatedText.trim() === '') {
            throw new Error('AIæœªè¿”å›æœ‰æ•ˆçš„è§£è¯»ç»“æœ');
        }

    } catch (error) {
        // å¦‚æœæ˜¯ä¸­æ­¢è¯·æ±‚å¯¼è‡´çš„é”™è¯¯ï¼Œå°±ä¸æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        if (error.name === 'AbortError') {
            return;
        }

        console.error("AIè§£è¯»å¤±è´¥: ", error);
        outputText.style.display = 'block';
        outputText.innerHTML = `<div style="color: #ff4081; padding: 10px; border: 1px solid #ff4081; border-radius: 5px; margin: 10px 0;">
      <p>ğŸ˜” AIè§£è¯»é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼š</p>
      <p>${error.message}</p>
      <p>æ‚¨å¯ä»¥ï¼š</p>
      <ul>
        <li>æ£€æŸ¥ç½‘ç»œè¿æ¥</li>
        <li>ç¨ç­‰ç‰‡åˆ»åé‡è¯•</li>
        <li>å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·åˆ·æ–°é¡µé¢</li>
      </ul>
    </div>`;
    } finally {
        // æ¸…é™¤å½“å‰è¯·æ±‚å¼•ç”¨
        if (window.currentAIRequest) {
            window.currentAIRequest = null;
        }
        aiButton.classList.remove('loading');
        aiButton.textContent = 'AIè§£è¯»';
    }
}


    function typeWriter(text, element, minSpeed = 10, maxSpeed = 40) {
      let i = 0;
      element.innerHTML = '';
      
      function type() {
        if (i < text.length) {
          const currentText = text.substring(0, i + 1);
          element.innerHTML = marked.parse(currentText);
          
          // ä¿®æ”¹æ»šåŠ¨é€»è¾‘ï¼Œç¡®ä¿æ¯æ¬¡æ‰“å­—éƒ½æ»šåŠ¨åˆ°åº•éƒ¨
          const scrollTarget = document.documentElement.scrollHeight;
          if (window.innerHeight + window.scrollY < scrollTarget) {
            window.scrollTo({
              top: scrollTarget,
              behavior: 'smooth'
            });
          }
          
          i++;
          const randomSpeed = Math.floor(Math.random() * (maxSpeed - minSpeed + 1)) + minSpeed;
          setTimeout(type, randomSpeed);
        }
      }
      
      type();
    }

        document.addEventListener('DOMContentLoaded', () => {
            initCards();
            displayCards();
            
            // æ·»åŠ è¾“å…¥æ¡†äº‹ä»¶å¤„ç†
            const inputText = document.getElementById('inputText');
            
            inputText.addEventListener('click', function() {
                if (this.value === 'ä»Šæ—¥è¿åŠ¿') {
                    this.value = '';
                }
            });
            
            inputText.addEventListener('blur', function() {
                if (this.value === '') {
                    this.value = 'ä»Šæ—¥è¿åŠ¿';
                }
            });
        });
    </script>
</body>
</html>