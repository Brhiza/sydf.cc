const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-0-cv0d-P.js","assets/index-Dr4hdcIp.css"])))=>i.map(i=>d[i]);
import{d as q,f as m,w as B,o as L,c as a,b as e,t as v,l as I,p as O,C as P,j as T,F as $,r as J,G as z,u as F,H as K,I as M,J as w,s as k,e as r,_ as j}from"./index-0-cv0d-P.js";import{a as S}from"./divination-config-DPDDIOby.js";const G={class:"page-container"},Q={key:0,class:"content-card"},U={class:"detail-header"},W={class:"header-left"},X={class:"section-title"},Y={class:"detail-date"},Z={class:"detail-content"},ee={class:"detail-question"},te={class:"content-text"},se={class:"detail-result"},oe={class:"form-actions"},ne={key:1,class:"content-card"},ie={class:"history-content"},ae={key:0,class:"empty-message"},re={key:1,class:"history-list"},le=["onClick"],ce={class:"item-header"},de={class:"item-type"},ue={class:"item-date"},ve={class:"item-question"},fe={key:0,class:"form-actions"},pe=q({__name:"HistoryView",props:{selectedRecordId:{type:String,default:null},showDetail:{type:Boolean,default:!1}},setup(g){const p=g,y=F(),l=m([]),n=m(null),_=m(!1);function D(){if(l.value=z(),p.selectedRecordId){const s=l.value.find(t=>t.id===p.selectedRecordId);s?n.value=s:y.push("/history")}}function b(s){y.push(`/history/${s.id}`)}function A(){confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")&&(K(),l.value=[])}function x(s){confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")&&(M(s),R())}function R(){y.push("/history")}function C(s){return new Date(s).toLocaleDateString("zh-CN")}function E(s){return new Date(s).toLocaleString("zh-CN")}function H(s){return s.result.aiResponse?["æŠ±æ­‰","æš‚æ—¶ä¸å¯ç”¨","è¯·ç¨åé‡è¯•","å‡ºå°å·®","è¯·æ±‚è¿‡äºé¢‘ç¹","æœåŠ¡å™¨æš‚æ—¶ç¹å¿™"].some(i=>{var d;return(d=s.result.aiResponse)==null?void 0:d.includes(i)})?s.result.aiResponse:null:"AIè§£è¯»æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•"}async function N(s){if(!_.value){_.value=!0;try{const{getAIService:t}=await w(async()=>{const{getAIService:c}=await import("./index-0-cv0d-P.js").then(u=>u.Q);return{getAIService:c}},__vite__mapDeps([0,1])),{DivinationService:o}=await w(async()=>{const{DivinationService:c}=await import("./index-0-cv0d-P.js").then(u=>u.R);return{DivinationService:c}},__vite__mapDeps([0,1])),i=t(),h=o.getInstance().generatePrompt(s.type,s.question,s.result.data),f=await i.generateResponse(h);if(f!=null&&f.content){s.result.aiResponse=f.content;const c=k.getRecords(),u=c.findIndex(V=>V.id===s.id);u!==-1&&(c[u]=s,localStorage.setItem("sydf-history",JSON.stringify(c))),console.log("å†å²è®°å½•AIè§£è¯»é‡è¯•æˆåŠŸ")}else throw new Error("AIæœåŠ¡è¿”å›ç©ºå“åº”")}catch(t){console.error("é‡è¯•AIè§£è¯»å¤±è´¥:",t);const o=t instanceof Error?t.message:"é‡æ–°ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";s.result.aiResponse=o;const i=k.getRecords(),d=i.findIndex(h=>h.id===s.id);d!==-1&&(i[d]=s,localStorage.setItem("sydf-history",JSON.stringify(i)))}finally{_.value=!1}}}return B(()=>p.selectedRecordId,s=>{if(s){const t=l.value.find(o=>o.id===s);t&&(n.value=t)}else n.value=null}),L(()=>{D()}),(s,t)=>(r(),a("div",G,[g.showDetail&&n.value?(r(),a("div",Q,[e("div",U,[e("div",W,[e("h2",X,v(I(S)(n.value.type)),1),e("p",Y,v(E(n.value.timestamp)),1)]),e("div",{class:"header-actions"},[e("button",{class:"btn-secondary",onClick:R},t[2]||(t[2]=[e("span",{class:"back-icon"},"â†",-1),e("span",{class:"back-text"},"è¿”å›",-1)]))])]),e("div",Z,[e("div",ee,[t[3]||(t[3]=e("h3",{class:"section-subtitle"},"é—®é¢˜",-1)),e("p",te,v(n.value.question),1)]),e("div",se,[t[4]||(t[4]=e("h3",{class:"section-subtitle"},"ç»“æœ",-1)),O(P,{type:n.value.type,result:n.value.result,error:H(n.value),onRetry:t[0]||(t[0]=o=>N(n.value))},null,8,["type","result","error"])])]),e("div",oe,[e("button",{onClick:t[1]||(t[1]=o=>x(n.value.id)),class:"btn-danger"},t[5]||(t[5]=[e("span",{class:"delete-icon"},"ğŸ—‘ï¸",-1),e("span",{class:"delete-text"},"åˆ é™¤è®°å½•",-1)]))])])):(r(),a("div",ne,[t[7]||(t[7]=e("div",{class:"card-header"},[e("h2",{class:"page-title"},"å†å²è®°å½•"),e("p",{class:"content-text"},"è¿™é‡Œä¿å­˜äº†æ‚¨æœ€è¿‘çš„å åœè®°å½•ï¼Œä»…ä¿å­˜åœ¨æœ¬åœ°å“¦ã€‚")],-1)),e("div",ie,[l.value.length===0?(r(),a("div",ae,t[6]||(t[6]=[e("div",{class:"empty-icon"},"ğŸ“œ",-1),e("p",null,"æš‚æ— å†å²è®°å½•",-1),e("p",{class:"empty-hint"},"æ‚¨çš„å åœè®°å½•å°†ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ",-1)]))):(r(),a("div",re,[(r(!0),a($,null,J(l.value,o=>(r(),a("div",{key:o.id,class:"history-item"},[e("button",{onClick:i=>b(o),class:"history-item-button"},[e("div",ce,[e("span",de,v(I(S)(o.type)),1),e("span",ue,v(C(o.timestamp)),1)]),e("div",ve,v(o.question),1)],8,le)]))),128))]))]),l.value.length>0?(r(),a("div",fe,[e("button",{onClick:A,class:"btn-danger"},"æ¸…ç©ºå†å²è®°å½•")])):T("",!0)]))]))}}),he=j(pe,[["__scopeId","data-v-ee45ae00"]]);export{he as default};
