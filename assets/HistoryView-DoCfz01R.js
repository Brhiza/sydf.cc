const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-0-cv0d-P.js","assets/index-Dr4hdcIp.css"])))=>i.map(i=>d[i]);
import{d as q,f as m,w as B,o as L,c as a,b as e,t as v,l as I,p as O,C as P,j as T,F as $,r as J,G as z,u as F,H as K,I as M,J as w,s as k,e as r,_ as j}from"./index-0-cv0d-P.js";import{a as S}from"./divination-config-DPDDIOby.js";const G={class:"page-container"},Q={key:0,class:"content-card"},U={class:"detail-header"},W={class:"header-left"},X={class:"section-title"},Y={class:"detail-date"},Z={class:"detail-content"},ee={class:"detail-question"},te={class:"content-text"},se={class:"detail-result"},oe={class:"form-actions"},ne={key:1,class:"content-card"},ie={class:"history-content"},ae={key:0,class:"empty-message"},re={key:1,class:"history-list"},le=["onClick"],ce={class:"item-header"},de={class:"item-type"},ue={class:"item-date"},ve={class:"item-question"},fe={key:0,class:"form-actions"},pe=q({__name:"HistoryView",props:{selectedRecordId:{type:String,default:null},showDetail:{type:Boolean,default:!1}},setup(g){const p=g,y=F(),l=m([]),n=m(null),_=m(!1);function D(){if(l.value=z(),p.selectedRecordId){const s=l.value.find(t=>t.id===p.selectedRecordId);s?n.value=s:y.push("/history")}}function b(s){y.push(`/history/${s.id}`)}function A(){confirm("确定要清空所有历史记录吗？此操作不可撤销。")&&(K(),l.value=[])}function x(s){confirm("确定要删除这条记录吗？此操作不可撤销。")&&(M(s),R())}function R(){y.push("/history")}function C(s){return new Date(s).toLocaleDateString("zh-CN")}function E(s){return new Date(s).toLocaleString("zh-CN")}function H(s){return s.result.aiResponse?["抱歉","暂时不可用","请稍后重试","出小差","请求过于频繁","服务器暂时繁忙"].some(i=>{var d;return(d=s.result.aiResponse)==null?void 0:d.includes(i)})?s.result.aiResponse:null:"AI解读暂时不可用，请稍后重试"}async function N(s){if(!_.value){_.value=!0;try{const{getAIService:t}=await w(async()=>{const{getAIService:c}=await import("./index-0-cv0d-P.js").then(u=>u.Q);return{getAIService:c}},__vite__mapDeps([0,1])),{DivinationService:o}=await w(async()=>{const{DivinationService:c}=await import("./index-0-cv0d-P.js").then(u=>u.R);return{DivinationService:c}},__vite__mapDeps([0,1])),i=t(),h=o.getInstance().generatePrompt(s.type,s.question,s.result.data),f=await i.generateResponse(h);if(f!=null&&f.content){s.result.aiResponse=f.content;const c=k.getRecords(),u=c.findIndex(V=>V.id===s.id);u!==-1&&(c[u]=s,localStorage.setItem("sydf-history",JSON.stringify(c))),console.log("历史记录AI解读重试成功")}else throw new Error("AI服务返回空响应")}catch(t){console.error("重试AI解读失败:",t);const o=t instanceof Error?t.message:"重新生成失败，请稍后重试";s.result.aiResponse=o;const i=k.getRecords(),d=i.findIndex(h=>h.id===s.id);d!==-1&&(i[d]=s,localStorage.setItem("sydf-history",JSON.stringify(i)))}finally{_.value=!1}}}return B(()=>p.selectedRecordId,s=>{if(s){const t=l.value.find(o=>o.id===s);t&&(n.value=t)}else n.value=null}),L(()=>{D()}),(s,t)=>(r(),a("div",G,[g.showDetail&&n.value?(r(),a("div",Q,[e("div",U,[e("div",W,[e("h2",X,v(I(S)(n.value.type)),1),e("p",Y,v(E(n.value.timestamp)),1)]),e("div",{class:"header-actions"},[e("button",{class:"btn-secondary",onClick:R},t[2]||(t[2]=[e("span",{class:"back-icon"},"←",-1),e("span",{class:"back-text"},"返回",-1)]))])]),e("div",Z,[e("div",ee,[t[3]||(t[3]=e("h3",{class:"section-subtitle"},"问题",-1)),e("p",te,v(n.value.question),1)]),e("div",se,[t[4]||(t[4]=e("h3",{class:"section-subtitle"},"结果",-1)),O(P,{type:n.value.type,result:n.value.result,error:H(n.value),onRetry:t[0]||(t[0]=o=>N(n.value))},null,8,["type","result","error"])])]),e("div",oe,[e("button",{onClick:t[1]||(t[1]=o=>x(n.value.id)),class:"btn-danger"},t[5]||(t[5]=[e("span",{class:"delete-icon"},"🗑️",-1),e("span",{class:"delete-text"},"删除记录",-1)]))])])):(r(),a("div",ne,[t[7]||(t[7]=e("div",{class:"card-header"},[e("h2",{class:"page-title"},"历史记录"),e("p",{class:"content-text"},"这里保存了您最近的占卜记录，仅保存在本地哦。")],-1)),e("div",ie,[l.value.length===0?(r(),a("div",ae,t[6]||(t[6]=[e("div",{class:"empty-icon"},"📜",-1),e("p",null,"暂无历史记录",-1),e("p",{class:"empty-hint"},"您的占卜记录将会显示在这里",-1)]))):(r(),a("div",re,[(r(!0),a($,null,J(l.value,o=>(r(),a("div",{key:o.id,class:"history-item"},[e("button",{onClick:i=>b(o),class:"history-item-button"},[e("div",ce,[e("span",de,v(I(S)(o.type)),1),e("span",ue,v(C(o.timestamp)),1)]),e("div",ve,v(o.question),1)],8,le)]))),128))]))]),l.value.length>0?(r(),a("div",fe,[e("button",{onClick:A,class:"btn-danger"},"清空历史记录")])):T("",!0)]))]))}}),he=j(pe,[["__scopeId","data-v-ee45ae00"]]);export{he as default};
