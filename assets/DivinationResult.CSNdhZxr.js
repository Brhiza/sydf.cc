import{d as a,i as e,r as s,p as t,c as n,b as l,g as i,e as r,M as o,y as d,t as c,n as u,N as p,m,G as g,q as v,h as y,F as h,l as f,u as k,O as x,j as w,P as b}from"./vendor.BUyyYNCK.js";import{d as A}from"./markdown.CaxBdgEJ.js";import{_,L as $}from"./index.B8UD4Q2h.js";import{D as I}from"./DailyResult.beaeZfvF.js";const T={class:"markdown-content streaming-markdown-content"},H=["innerHTML"],C=["innerHTML"],z=_(a({__name:"StreamingMarkdown",props:{content:{},isComplete:{type:Boolean,default:!1}},setup(a){const o=a,d=e(()=>"string"==typeof o.content?o.content:o.content.value),c=s(""),u=s(""),p=s(!1);A.setOptions({breaks:!0,gfm:!0});const m=["think","thinking","reason","analyze","reflect"],g={think:"查看AI的思考过程",thinking:"查看AI的详细思考",reason:"查看AI的推理过程",analyze:"查看AI的分析过程",reflect:"查看AI的反思过程"},v={think:"AI正在思考...",thinking:"AI正在详细思考...",reason:"AI正在推理...",analyze:"AI正在分析...",reflect:"AI正在反思..."};return t([d,()=>o.isComplete],async([a,e],[s,t])=>{let n="",l="",i=!1;const r=m.map(a=>`<${a}>|</${a}>`).join("|"),o=a.split(new RegExp(`(${r})`,"g"));let d="";for(const c of o){const a=c.match(/^<(\w+)>$/),s=c.match(/^<\/(\w+)>$/);if(a&&m.includes(a[1]))i=!0,d=a[1],l="";else if(s&&m.includes(s[1])){if(i&&d===s[1]){const a=await A.parse(l);n+=e?`<details class="thinking-${d}"><summary>${g[d]}</summary><div class="thinking-content">${a}</div></details>`:`<details open class="thinking-${d}"><summary>${v[d]}</summary><div class="thinking-content">${a}</div></details>`,i=!1,d=""}else if(!i){l=n,n="";const a=await A.parse(l),e=s[1];n+=`<details class="thinking-${e}"><summary>${g[e]||"查看AI的思考过程"}</summary><div class="thinking-content">${a}</div></details>`,l=""}}else c&&(i?l+=c:n+=await A.parse(c))}i?(c.value=n,u.value=await A.parse(l),p.value=!0):(c.value=n,u.value="",p.value=!1)},{immediate:!0}),(a,e)=>(r(),n("div",T,[l("div",{innerHTML:c.value},null,8,H),p.value?(r(),n("div",{key:0,class:"thinking-bubble",innerHTML:u.value},null,8,C)):i("",!0)]))}}),[["__scopeId","data-v-e289a1d9"]]);function L(a){return{formatSolarTime:e(()=>{const e=a.value.timestamp;if(!e){if("timeInfo"in a.value&&a.value.timeInfo&&"object"==typeof a.value.timeInfo&&"solar"in a.value.timeInfo){const e=a.value.timeInfo.solar;if(e)return`${e.year}年${e.month}月${e.day}日${e.hour}时${e.minute}分`}return""}const s=new Date(e);return`${s.getFullYear()}年${s.getMonth()+1}月${s.getDate()}日${s.getHours()}时${s.getMinutes()}分`}),formatGanZhi:e(()=>{if(!a.value.ganzhi)return"";const{year:e,month:s,day:t,hour:n}=a.value.ganzhi;return`${e}年 ${s}月 ${t}日 ${n}时`})}}function Y(a){return{reversedYaosDetail:e(()=>a.value.yaosDetail?[...a.value.yaosDetail].reverse():[])}}const j={class:"result-header"},N={key:0,class:"info-line"},G={class:"info-value"},D={key:1,class:"info-line"},R={class:"info-value"},S=_(a({__name:"ResultHeader",props:{solarTime:{},ganzhiTime:{}},setup:a=>(e,s)=>(r(),n("div",j,[a.solarTime?(r(),n("div",N,[s[0]||(s[0]=l("span",{class:"info-label"},"公历时间：",-1)),l("span",G,c(a.solarTime),1)])):i("",!0),a.ganzhiTime?(r(),n("div",D,[s[1]||(s[1]=l("span",{class:"info-label"},"干支：",-1)),l("span",R,c(a.ganzhiTime),1)])):i("",!0),d(e.$slots,"default",{},void 0)]))}),[["__scopeId","data-v-6322c7c2"]]),B={key:0,class:"yang-line"},M={key:1,class:"yin-line"},F=_(a({__name:"YaoSymbol",props:{yaoType:{},isMain:{type:Boolean,default:!0}},setup:a=>(e,s)=>(r(),n("div",{class:u(["yao-symbol",{"main-yao":a.isMain,"changed-yao":!a.isMain}])},["阳"===a.yaoType?(r(),n("div",B)):"阴"===a.yaoType?(r(),n("div",M,[...s[0]||(s[0]=[l("div",{class:"yin-segment"},null,-1),l("div",{class:"yin-gap"},null,-1),l("div",{class:"yin-segment"},null,-1)])])):i("",!0)],2))}),[["__scopeId","data-v-c5effd2c"]]),q={class:"base-result-layout"},E=_(a({__name:"BaseResultLayout",setup:a=>(a,e)=>(r(),n("div",q,[d(a.$slots,"default",{},void 0)]))}),[["__scopeId","data-v-bb8ae905"]]),Z={class:"hexagram-info"},P={class:"hexagram-line"},U={class:"hexagram-value"},V={class:"hexagram-line"},O={class:"hexagram-value"},Q={key:0,class:"hexagram-line"},W={class:"hexagram-value"},J={key:1,class:"hexagram-line"},K={class:"hexagram-value"},X={key:2,class:"hexagram-line"},aa={class:"hexagram-value"},ea={class:"paipan-section"},sa={class:"hexagram-container"},ta={class:"main-hexagram"},na={class:"six-god"},la={class:"change-mark"},ia={key:0},ra={class:"yao-info"},oa={class:"void-mark"},da={class:"world-response"},ca={class:"changed-hexagram"},ua={class:"yao-info"},pa=_(a({__name:"LiuyaoResult",props:{data:{}},setup(a){const e=a,{formatSolarTime:s,formatGanZhi:t}=L(p(e,"data")),{reversedYaosDetail:o}=Y(p(e,"data"));return(e,d)=>(r(),m(E,null,{default:g(()=>[v(S,{"solar-time":k(s),"ganzhi-time":k(t)},{default:g(()=>[l("div",Z,[l("div",P,[d[0]||(d[0]=l("span",{class:"hexagram-label"},"主卦：",-1)),l("span",U,[y(c(a.data.originalName)+" ",1),a.data.palace?.name?(r(),n(h,{key:0},[y("（"+c(a.data.palace.name)+"宫）",1)],64)):i("",!0)])]),l("div",V,[d[1]||(d[1]=l("span",{class:"hexagram-label"},"变卦：",-1)),l("span",O,c(a.data.changedName),1)]),a.data.voidBranches&&a.data.voidBranches.length>0?(r(),n("div",Q,[d[2]||(d[2]=l("span",{class:"hexagram-label"},"旬空：",-1)),l("span",W,c(a.data.voidBranches.join("、")),1)])):i("",!0),a.data.interName?(r(),n("div",J,[d[3]||(d[3]=l("span",{class:"hexagram-label"},"互卦：",-1)),l("span",K,c(a.data.interName),1)])):i("",!0),a.data.changingYaos&&a.data.changingYaos.length>0?(r(),n("div",X,[d[4]||(d[4]=l("span",{class:"hexagram-label"},"动爻：",-1)),l("span",aa,[(r(!0),n(h,null,f(a.data.changingYaos,(e,s)=>(r(),n("span",{key:e.position,class:"changing-item"},"第"+c(e.position)+"爻（"+c(e.type)+"）"+c(s<a.data.changingYaos.length-1?"、":""),1))),128))])])):i("",!0)])]),_:1},8,["solar-time","ganzhi-time"]),l("div",ea,[l("div",sa,[l("div",ta,[(r(!0),n(h,null,f(k(o),(a,e)=>(r(),n("div",{key:e,class:"yao-line"},["sixGod"in a?(r(),n(h,{key:0},[l("span",na,c(a.sixGod),1),v(F,{"yao-type":a.yaoType,"is-main":!0},null,8,["yao-type"]),l("span",la,[a.isChanging?(r(),n("span",ia,c(6===a.rawValue?"×":"●"),1)):i("",!0)]),l("span",ra,c(a.sixRelative)+c(a.najiaDizhi)+c(a.wuxing),1),l("span",oa,c(a.isVoid?"空":""),1),l("span",da,c(a.isWorld?"世":a.isResponse?"应":""),1)],64)):i("",!0)]))),128))]),l("div",ca,[(r(!0),n(h,null,f(k(o),(a,e)=>(r(),n("div",{key:e,class:"yao-line"},[v(F,{"yao-type":a.isChanging?k($).getChangedYaoType(a.yaoType):a.yaoType,"is-main":!1},null,8,["yao-type"]),l("span",ua,["sixGod"in a?(r(),n(h,{key:0},[y(c(k($).getChangedYaoInfo(a)),1)],64)):i("",!0)])]))),128))])])])]),_:1}))}}),[["__scopeId","data-v-716a0edd"]]),ma={class:"hexagram-info"},ga={class:"hexagram-line"},va={class:"hexagram-value"},ya={class:"hexagram-line"},ha={class:"hexagram-value"},fa={key:0,class:"hexagram-line"},ka={class:"hexagram-value"},xa={key:1,class:"hexagram-line"},wa={class:"hexagram-value"},ba={key:2,class:"hexagram-line"},Aa={class:"hexagram-value"},_a={class:"paipan-section"},$a={class:"hexagram-container"},Ia={class:"main-hexagram"},Ta={class:"yao-position"},Ha={class:"change-mark"},Ca={key:0},za={class:"trigram-info"},La={key:0,class:"inter-hexagram"},Ya={class:"inter-trigram-info"},ja={class:"changed-hexagram"},Na={class:"changed-trigram-info"},Ga={key:0,class:"calculation-section"},Da={class:"calculation-details"},Ra=_(a({__name:"MeihuaResult",props:{data:{}},setup(a){const e=s(!1),t=a,{formatSolarTime:o,formatGanZhi:d}=L(p(t,"data")),{reversedYaosDetail:u}=Y(p(t,"data")),x=a=>{if(!t.data.interHexagram)return"阳";const e=t.data.yaosDetail;if(!e||e.length<6)return"阳";const s=[2,3,4,3,4,5][a-1]-1;return e[s]?.yaoType||"阳"};return(s,p)=>(r(),m(E,null,{default:g(()=>[v(S,{"solar-time":k(o),"ganzhi-time":k(d)},{default:g(()=>[l("div",ma,[l("div",ga,[p[0]||(p[0]=l("span",{class:"hexagram-label"},"主卦：",-1)),l("span",va,[y(c(a.data.originalName)+" ",1),a.data.mainHexagram?.upper&&a.data.mainHexagram?.lower?(r(),n(h,{key:0},[y(" （"+c(a.data.mainHexagram.upper)+"-"+c(a.data.mainHexagram.lower)+"） ",1)],64)):i("",!0)])]),l("div",ya,[p[1]||(p[1]=l("span",{class:"hexagram-label"},"变卦：",-1)),l("span",ha,[y(c(a.data.changedName)+" ",1),a.data.changedHexagram?.upper&&a.data.changedHexagram?.lower?(r(),n(h,{key:0},[y(" （"+c(a.data.changedHexagram.upper)+"-"+c(a.data.changedHexagram.lower)+"） ",1)],64)):i("",!0)])]),a.data.interName?(r(),n("div",fa,[p[2]||(p[2]=l("span",{class:"hexagram-label"},"互卦：",-1)),l("span",ka,[y(c(a.data.interName)+" ",1),a.data.interHexagram?.upper&&a.data.interHexagram?.lower?(r(),n(h,{key:0},[y(" （"+c(a.data.interHexagram.upper)+"-"+c(a.data.interHexagram.lower)+"） ",1)],64)):i("",!0)])])):i("",!0),a.data.movingYao?(r(),n("div",xa,[p[3]||(p[3]=l("span",{class:"hexagram-label"},"动爻：",-1)),l("span",wa,c(a.data.movingYao.yaoName)+"（"+c(a.data.movingYao.description)+"）",1)])):i("",!0),a.data.tiGua&&a.data.yongGua&&a.data.analysis?(r(),n("div",ba,[p[4]||(p[4]=l("span",{class:"hexagram-label"},"体用：",-1)),l("span",Aa,c(a.data.tiGua.name)+c(a.data.tiGua.element)+" (体) - "+c(a.data.yongGua.name)+c(a.data.yongGua.element)+" (用)（"+c(a.data.analysis.tiYongRelation)+"） ",1)])):i("",!0)])]),_:1},8,["solar-time","ganzhi-time"]),l("div",_a,[l("div",$a,[l("div",Ia,[(r(!0),n(h,null,f(k(u),(a,e)=>{return r(),n("div",{key:e,class:"yao-line"},[l("span",Ta,c((s=a.position,["初","二","三","四","五","上"][s-1]||"未知")),1),v(F,{"yao-type":a.yaoType,"is-main":!0},null,8,["yao-type"]),l("span",Ha,[a.isChanging?(r(),n("span",Ca,"●")):i("",!0)]),l("span",za,["tiYong"in a?(r(),n(h,{key:0},[y(c(a.tiYong),1)],64)):i("",!0)])]);var s}),128))]),a.data.interName?(r(),n("div",La,[(r(!0),n(h,null,f(k(u),(a,e)=>{return r(),n("div",{key:e,class:"yao-line"},[v(F,{"yao-type":x(a.position),"is-main":!1},null,8,["yao-type"]),l("span",Ya,c((s=a.position,t.data.interHexagram?s<=3?t.data.interHexagram.lower:t.data.interHexagram.upper:"")),1)]);var s}),128))])):i("",!0),l("div",ja,[(r(!0),n(h,null,f(k(u),(a,e)=>{return r(),n("div",{key:e,class:"yao-line"},[v(F,{"yao-type":a.isChanging?k($).getChangedYaoType(a.yaoType):a.yaoType,"is-main":!1},null,8,["yao-type"]),l("span",Na,c((s=a.position,t.data.changedHexagram?s<=3?t.data.changedHexagram.lower:t.data.changedHexagram.upper:"")),1)]);var s}),128))])])]),a.data.calculation&&e.value?(r(),n("div",Ga,[p[6]||(p[6]=l("div",{class:"calculation-title"},"起卦数据",-1)),l("div",Da,[l("span",null,"年支"+c(a.data.calculation.yearZhi)+"("+c(a.data.calculation.yearZhiIndex)+")",1),l("span",null,"月"+c(a.data.calculation.month),1),l("span",null,"日"+c(a.data.calculation.day),1),l("span",null,"时支"+c(a.data.calculation.timeZhi)+"("+c(a.data.calculation.timeZhiIndex)+")",1),p[5]||(p[5]=l("span",null,"→",-1)),l("span",null,"上卦"+c(a.data.calculation.upperTrigramIndex),1),l("span",null,"下卦"+c(a.data.calculation.lowerTrigramIndex),1),l("span",null,"动爻"+c(a.data.calculation.movingYaoIndex),1)])])):i("",!0)]),_:1}))}}),[["__scopeId","data-v-8e7be647"]]);function Sa(a){return a?a.formatted?a.formatted:`${a.year}年 ${a.month}月 ${a.day}日 ${a.hour}时`:""}function Ba(a,e){if(!a&&!e)return"";if(e){return new Date(e).toLocaleString("zh-CN")}if(a){return`${a.year||""}年${a.month||""}月${a.day||""}日 ${a.hour||""}时${a.minute||""}分`}return""}function Ma(a){if(!a)return"";return new Date(a).toLocaleString("zh-CN")}const Fa={class:"qimen-result"},qa={class:"basic-info"},Ea={class:"info-line"},Za={class:"info-value"},Pa={class:"info-line"},Ua={class:"info-value"},Va={class:"info-line"},Oa={class:"info-value"},Qa={class:"info-line"},Wa={class:"info-value"},Ja={class:"paipan-section"},Ka={class:"jiugong-container"},Xa={class:"jiugong-grid"},ae={class:"gong-header"},ee={class:"gong-name"},se={class:"gong-direction"},te={class:"gong-content"},ne={class:"tian-pan"},le={class:"star"},ie={class:"stem"},re={key:0,class:"ren-pan"},oe={class:"door"},de={class:"di-pan"},ce={class:"stem"},ue={key:1,class:"shen-pan"},pe={class:"god"},me={key:2,class:"zhong-gong"},ge=_(a({__name:"QimenResult",props:{data:{}},setup(a){const s=a,t=e(()=>{if(!s.data.jiuGongGe)return[];const a=s.data.jiuGongGe;return[3,8,1,2,4,6,7,0,5].map(e=>a[e]).filter(Boolean)});function o(a){return["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right"][a]||""}return(e,s)=>(r(),n("div",Fa,[l("div",qa,[l("div",Ea,[s[0]||(s[0]=l("span",{class:"info-label"},"起卦时间：",-1)),l("span",Za,c(k(Ba)(a.data.timeInfo)),1)]),l("div",Pa,[s[1]||(s[1]=l("span",{class:"info-label"},"干支信息：",-1)),l("span",Ua,c(k(Sa)(a.data.ganzhi)),1)]),l("div",Va,[s[2]||(s[2]=l("span",{class:"info-label"},"遁甲局数：",-1)),l("span",Oa,c(a.data.isYangDun?"阳遁":"阴遁")+c(a.data.juShu)+"局",1)]),l("div",Qa,[s[3]||(s[3]=l("span",{class:"info-label"},"值符值使：",-1)),l("span",Wa,c(a.data.zhiFu)+" "+c(a.data.zhiShi),1)])]),l("div",Ja,[l("div",Ka,[l("div",Xa,[(r(!0),n(h,null,f(t.value,(a,e)=>(r(),n("div",{key:e,class:u(["gong-cell",o(e)])},[l("div",ae,[l("span",ee,c(a.name),1),l("span",se,c(a.direction),1)]),l("div",te,[l("div",ne,[l("span",le,c(a.tianPan.star),1),l("span",ie,c(a.tianPan.stem),1)]),a.name.includes("中五宫")?i("",!0):(r(),n("div",re,[l("span",oe,c(a.renPan.door),1)])),l("div",de,[l("span",ce,c(a.diPan.stem),1)]),a.name.includes("中五宫")?i("",!0):(r(),n("div",ue,[l("span",pe,c(a.shenPan.god),1)])),a.name.includes("中五宫")?(r(),n("div",me,[...s[4]||(s[4]=[l("span",{class:"zhong-text"},"中宫",-1)])])):i("",!0)])],2))),128))])])])]))}}),[["__scopeId","data-v-b32312d7"]]),ve={key:0,class:"ssgw-info"},ye={class:"info-item"},he={class:"value"},fe={class:"info-item"},ke={class:"value"},xe={class:"info-item poem"},we={class:"poem-content"},be={key:0,class:"info-item story"},Ae={class:"story-content"},_e={key:1,class:"details-grid"},$e={class:"detail-key"},Ie={class:"detail-value"},Te=_(a({__name:"SsgwResult",props:{data:{}},setup:a=>(e,s)=>a.data?(r(),n("div",ve,[l("div",ye,[s[0]||(s[0]=l("span",{class:"label"},"签号：",-1)),l("span",he,"第"+c(a.data.number)+"签",1)]),l("div",fe,[s[1]||(s[1]=l("span",{class:"label"},"签名：",-1)),l("span",ke,c(a.data.title),1)]),l("div",xe,[l("div",we,c(a.data.poem),1)]),a.data.story?(r(),n("div",be,[s[2]||(s[2]=l("span",{class:"label"},"签文故事：",-1)),l("div",Ae,c(a.data.story),1)])):i("",!0),a.data.details?(r(),n("div",_e,[(r(!0),n(h,null,f(a.data.details,(a,e)=>(r(),n("div",{key:e,class:"detail-item"},[l("div",$e,c(e),1),l("div",Ie,c(a),1)]))),128))])):i("",!0)])):i("",!0)}),[["__scopeId","data-v-327106ee"]]),He={class:"tarot-result"},Ce={key:0,class:"spread-header"},ze={class:"spread-title"},Le={class:"spread-info"},Ye={class:"card-image"},je=["src","alt"],Ne={class:"card-position"},Ge={key:0,class:"card-reversed"},De={class:"card-info"},Re={class:"card-name"},Se={class:"card-keywords"},Be={key:1,class:"spread-explanation"},Me={class:"explanation-grid"},Fe={class:"position-number"},qe={class:"position-name"},Ee={class:"card-summary"},Ze=_(a({__name:"TarotResult",props:{cards:{},type:{},spreadType:{},spreadName:{},timestamp:{},showExplanation:{type:Boolean}},setup(a){const s=a,t=e(()=>{const a=s.cards.length;switch(s.spreadType){case"single":return"layout-single";case"three":return"layout-three";case"love":return"layout-love";case"career":return"layout-career";case"decision":return"layout-decision";case"celtic":return"layout-celtic";case"chakra":return"layout-chakra";case"year":return"layout-year";case"mindBodySpirit":return"layout-mind-body-spirit";case"horseshoe":return"layout-horseshoe";default:return 1===a?"layout-single":3===a?"layout-three":a<=6?"layout-grid":a<=10?"layout-complex":"layout-large-complex"}});function o(a){return"celtic"===s.spreadType?`celtic-position-${a}`:""}function d(a){switch(s.spreadType){case"celtic":return[{gridArea:"2 / 2"},{gridArea:"2 / 2",transform:"rotate(90deg)",zIndex:2},{gridArea:"3 / 2"},{gridArea:"1 / 2"},{gridArea:"2 / 1"},{gridArea:"2 / 3"},{gridArea:"1 / 4"},{gridArea:"2 / 4"},{gridArea:"3 / 4"},{gridArea:"4 / 4"}][a]||{};case"love":return[{gridArea:"2 / 2"},{gridArea:"2 / 3"},{gridArea:"1 / 2 / 1 / 4"},{gridArea:"3 / 1"},{gridArea:"3 / 4"}][a]||{};case"decision":return[{gridArea:"2 / 2"},{gridArea:"1 / 1"},{gridArea:"3 / 1"},{gridArea:"1 / 3"},{gridArea:"3 / 3"},{gridArea:"4 / 2"}][a]||{};case"chakra":return{order:7-a};case"horseshoe":return[{gridArea:"3 / 1"},{gridArea:"2 / 1"},{gridArea:"1 / 1"},{gridArea:"1 / 2"},{gridArea:"1 / 3"},{gridArea:"2 / 3"},{gridArea:"3 / 3"}][a]||{};default:return{}}}function p(a){a.target.src="/static/tarot/card-back.jpg"}return(e,s)=>(r(),n("div",He,[a.spreadName?(r(),n("div",Ce,[l("h3",ze,c(a.spreadName),1),l("p",Le,c(a.cards.length)+"张牌 · "+c(a.timestamp?k(Ma)(a.timestamp):""),1)])):i("",!0),l("div",{class:u(["cards-layout",t.value])},[(r(!0),n(h,null,f(a.cards,(a,e)=>(r(),n("div",{key:e,class:u(["tarot-card",o(e)]),style:x(d(e))},[l("div",Ye,[l("img",{src:`/static/tarot/${a.id}.jpg`,alt:a.name,class:u({reversed:a.reversed}),onError:p},null,42,je),l("div",Ne,c(a.position),1),a.reversed?(r(),n("div",Ge,"逆位")):i("",!0)]),l("div",De,[l("h4",Re,c(a.name),1),l("p",Se,c(a.keywords),1)])],6))),128))],2),a.showExplanation&&a.cards.length>1?(r(),n("div",Be,[s[0]||(s[0]=l("h4",null,"牌阵解读说明",-1)),l("div",Me,[(r(!0),n(h,null,f(a.cards,(a,e)=>(r(),n("div",{key:e,class:"explanation-item"},[l("span",Fe,c(e+1),1),l("span",qe,c(a.position),1),l("span",Ee,c(a.name)+c(a.reversed?"(逆位)":""),1)]))),128))])])):i("",!0)]))}}),[["__scopeId","data-v-7ed0fd81"]]),Pe={class:"content-card"},Ue={class:"result-header"},Ve={class:"section-title"},Oe={key:0,class:"result-content"},Qe={key:1,class:"ai-content"},We={class:"ai-header"},Je={class:"ai-title"},Ke={class:"ai-response-content"},Xe={key:0,class:"conversation-history"},as={key:0,class:"loading-dots"},es={key:1,class:"markdown-container"},ss={key:2,class:"copy-button-wrapper"},ts=["title","disabled","onClick"],ns={key:0,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ls={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},is={key:0,class:"disclaimer"},rs={key:2,class:"error-state"},os={class:"error-content"},ds={class:"error-line-2"},cs={class:"error-line-3"},us={class:"result-actions"},ps=_(a({__name:"DivinationResult",props:{type:{},result:{},title:{default:""},isAiLoading:{type:Boolean,default:!1},error:{default:null},question:{default:""},conversationHistory:{default:()=>[]},isFollowUpLoading:{type:Boolean,default:!1}},emits:["retry"],setup(a,{emit:t}){const p=a,{copy:g,copied:y}=function(){const a=s(!1),e=s(null),t=s=>{const t=document.createElement("textarea");t.value=s,t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")?(a.value=!0,e.value=null,setTimeout(()=>{a.value=!1},2e3)):e.value=new Error("Fallback copy: document.execCommand failed")}catch(n){e.value=n}document.body.removeChild(t)};return{copy:s=>{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(s).then(()=>{a.value=!0,e.value=null,setTimeout(()=>{a.value=!1},2e3)}).catch(a=>{e.value=a,t(s)}):t(s)},copied:o(a),error:o(e)}}(),x=s(null),A=e(()=>p.conversationHistory.filter(a=>"assistant"===a.role)),_=e(()=>A.value.length>0?A.value[A.value.length-1]:null);const $=e(()=>{const a=p.conversationHistory.filter(a=>"assistant"===a.role),e=a[a.length-1];return(p.isAiLoading||p.isFollowUpLoading)&&e&&!k(e.content)?"AI正在思考...":"AI深度解读"}),T=e(()=>{if(p.title)return p.title;const{type:a,result:e}=p;if("tarot"===a||"tarot_single"===a){const a=e.data,s=a.spreadName;if(s)return`塔罗牌·${s}结果`;const t=a.cards?.length||0;return 1===t?"塔罗牌·单牌指引结果":3===t?"塔罗牌·时间流牌阵结果":"塔罗牌占卜结果"}const s={liuyao:"六爻占卜结果",meihua:"梅花易数结果",qimen:"奇门遁甲结果",ssgw:"三山国王灵签结果",daily:"今日运势结果"};return a in s?s[a]:"占卜结果"}),H=e(()=>"liuyao"===p.type),C=e(()=>"meihua"===p.type),L=e(()=>"qimen"===p.type),Y=e(()=>["tarot","tarot_single"].includes(p.type)),j=e(()=>"ssgw"===p.type),N=e(()=>"daily"===p.type),G=e(()=>Y.value?p.result.data:null),D=e(()=>H.value?p.result.data:null),R=e(()=>C.value?p.result.data:null),S=e(()=>L.value?p.result.data:null),B=e(()=>j.value?p.result.data:null),M=e(()=>N.value?p.result.data:null),F=e(()=>Y.value?p.type:null);function q(a,e){if("daily"===p.type){if(p.conversationHistory.filter(a=>"system"!==a.role),0===e&&"user"===a.role)return!1;if(1===e&&"assistant"===a.role)return!1}return!0}return(e,s)=>(r(),n("div",Pe,[l("div",Ue,[l("h2",Ve,c(T.value),1)]),a.result.data?(r(),n("div",Oe,[H.value&&D.value?(r(),m(k(pa),{key:0,data:D.value},null,8,["data"])):i("",!0),C.value&&R.value?(r(),m(k(Ra),{key:1,data:R.value},null,8,["data"])):i("",!0),L.value&&S.value?(r(),m(k(ge),{key:2,data:S.value},null,8,["data"])):i("",!0),Y.value&&G.value&&F.value?(r(),m(k(Ze),{key:3,cards:G.value.cards||[],type:F.value,"spread-type":G.value.spreadType,"spread-name":G.value.spreadName,timestamp:G.value.timestamp,"show-explanation":!0},null,8,["cards","type","spread-type","spread-name","timestamp"])):i("",!0),j.value&&B.value?(r(),m(k(Te),{key:4,data:B.value},null,8,["data"])):i("",!0),N.value&&M.value?(r(),m(k(I),{key:5,"fortune-data":M.value,"ai-response":a.result.aiResponse||""},null,8,["fortune-data","ai-response"])):i("",!0)])):i("",!0),a.conversationHistory.length>0||a.isAiLoading?(r(),n("div",Qe,[l("div",We,[l("h3",Je,c($.value),1)]),l("div",Ke,[a.conversationHistory.length>0?(r(),n("div",Xe,[(r(!0),n(h,null,f(a.conversationHistory.filter(a=>"system"!==a.role),(e,t)=>w((r(),n("div",{key:e.id||t,class:u(["chat-message",`message-${e.role}`])},["assistant"!==e.role||k(e.content)||!a.isAiLoading&&!a.isFollowUpLoading?(r(),n("div",es,[v(z,{content:e.content,"is-complete":!(a.isAiLoading||a.isFollowUpLoading)},null,8,["content","is-complete"])])):(r(),n("div",as,[...s[1]||(s[1]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1)])])),"assistant"===e.role&&k(e.content)?(r(),n("div",ss,[l("button",{class:"copy-button",title:x.value===e.id?"已复制":"复制",disabled:e.id===_.value?.id&&(a.isAiLoading||a.isFollowUpLoading),onClick:a=>function(a,e){const s=e.currentTarget.closest(".chat-message");if(!s)return;const t=s.querySelector(".markdown-container");if(!t)return;const n=t.cloneNode(!0);n.querySelectorAll("details").forEach(a=>a.remove());const l=(n.textContent||"").trim();g(l);const i=watch(y,e=>{e&&(x.value=a.id||null,setTimeout(()=>{x.value=null},2e3),i())})}(e,a)},[x.value===e.id?(r(),n("svg",ns,[...s[2]||(s[2]=[l("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(r(),n("svg",ls,[...s[3]||(s[3]=[l("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"},null,-1),l("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"},null,-1)])]))],8,ts)])):i("",!0)],2)),[[b,q(e,t)]])),128))])):i("",!0)]),a.conversationHistory.length>0&&!a.error?(r(),n("div",is,[...s[4]||(s[4]=[l("div",{class:"disclaimer-content"},[l("div",{class:"disclaimer-icon"},"⚠️"),l("div",{class:"disclaimer-text"}," 请注意：内容完全基于 AI 模型的胡言乱语，旨在利用国产前沿大数据算法提供一种思考和决策的辅助视角，不构成任何形式的建议。请结合您的实际情况，理性参考，自主决策，命运终究掌握在自己手中。 ")],-1)])])):i("",!0)])):i("",!0),a.error?(r(),n("div",rs,[l("div",os,[s[5]||(s[5]=l("div",{class:"error-line-1"},"哈哈，AI开小差咯",-1)),l("div",ds,c(a.error),1),l("div",cs,[d(e.$slots,"error-actions",{},()=>[l("button",{class:"retry-button",onClick:s[0]||(s[0]=a=>e.$emit("retry"))},"重新生成解读")])])])])):i("",!0),l("div",us,[d(e.$slots,"actions",{},void 0)])]))}}),[["__scopeId","data-v-bd379380"]]);export{ps as D};
