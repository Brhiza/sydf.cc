import{d as e,i as a,r as l,c as n,a as t,g as s,F as i,l as o,n as u,t as c,o as r,e as p,f as d,q as v,u as m,G as y,T as g,s as k,p as f,m as h,j as b,v as C,I as w,h as T,J as q,k as I,x as R,K as _,w as x}from"./vendor-DpgQG9eY.js";import{g as S,t as $,_ as A,a as H,b as L,p as U,h as E,c as V,e as j,E as D}from"./index-BEymrLkf.js";import{D as N}from"./DivinationResult-hvITWcRL.js";import{d as O}from"./markdown-BrxPKiid.js";import"./utils-B-ODjm7Z.js";const F={class:"inspiration-card"},M={class:"inspiration-tabs"},Y=["onClick"],B={class:"category-heading"},J={class:"questions-wrapper"},P=["onClick"],G={class:"questions-wrapper"},K={class:"questions-wrapper"},z={class:"questions-wrapper"},Q={class:"questions-wrapper"},W={class:"questions-wrapper"},X={class:"questions-wrapper"},Z={class:"questions-wrapper"},ee={class:"questions-wrapper"},ae={class:"questions-wrapper"},le={class:"questions-wrapper"},ne={class:"questions-wrapper"},te={class:"questions-wrapper"},se={class:"questions-wrapper"},ie={class:"questions-wrapper"},oe={class:"questions-wrapper"},ue=A(e({__name:"InspirationPanel",props:{spreadType:{}},emits:["select","submit"],setup(e,{emit:p}){const d=e,v=p,m=a(()=>d.spreadType?S(d.spreadType):[]),y=a(()=>{var e;return d.spreadType&&(null==(e=$[d.spreadType])?void 0:e.name)||""}),g=a(()=>{const e=[{id:"ganqing",name:"感情"},{id:"shiye",name:"事业"},{id:"caifu",name:"财富"},{id:"renji",name:"人际"},{id:"rensheng",name:"成长"}];return d.spreadType&&m.value.length>0?[{id:"spread",name:"牌阵"},...e]:e}),k=l(d.spreadType&&S(d.spreadType).length>0?"spread":"ganqing");function f(e){document.querySelectorAll(".questions-wrapper p").forEach(a=>{a.textContent===e&&(a.classList.add("clicked"),setTimeout(()=>{a.classList.remove("clicked")},300))}),v("submit",e)}return(e,a)=>(r(),n("div",F,[a[104]||(a[104]=t("h3",{class:"inspiration-title"},"问题灵感",-1)),t("div",M,[(r(!0),n(i,null,o(g.value,e=>(r(),n("button",{key:e.id,class:u(["tab-btn",{active:k.value===e.id}]),onClick:a=>k.value=e.id},c(e.name),11,Y))),128))]),e.spreadType&&m.value.length>0?(r(),n("div",{key:0,id:"spread",class:u(["tab-pane",{active:"spread"===k.value}])},[t("h4",B,c(y.value)+"专属问题",1),t("div",J,[(r(!0),n(i,null,o(m.value,e=>(r(),n("p",{key:e,onClick:a=>f(e)},c(e),9,P))),128))])],2)):s("",!0),t("div",{id:"ganqing",class:u(["tab-pane",{active:"ganqing"===k.value}])},[a[89]||(a[89]=t("h4",{class:"category-heading"},"情感发展",-1)),t("div",G,[t("p",{onClick:a[0]||(a[0]=e=>f("我近期的桃花运怎么样？"))},"我近期的桃花运怎么样？"),t("p",{onClick:a[1]||(a[1]=e=>f("我们目前的感情走向如何？"))},"我们目前的感情走向如何？"),t("p",{onClick:a[2]||(a[2]=e=>f("他/她对我的真实情感是什么？"))}," 他/她对我的真实情感是什么？ "),t("p",{onClick:a[3]||(a[3]=e=>f("我们之间有未来吗？"))},"我们之间有未来吗？"),t("p",{onClick:a[4]||(a[4]=e=>f("如何改善我们目前的关系？"))},"如何改善我们目前的关系？"),t("p",{onClick:a[5]||(a[5]=e=>f("这段感情对我的影响？"))},"这段感情对我的影响？")]),a[90]||(a[90]=t("h4",{class:"category-heading"},"正缘婚姻",-1)),t("div",K,[t("p",{onClick:a[6]||(a[6]=e=>f("我的正缘什么时候出现？"))},"我的正缘什么时候出现？"),t("p",{onClick:a[7]||(a[7]=e=>f("我的另一半是什么样的人？"))},"我的另一半是什么样的人？"),t("p",{onClick:a[8]||(a[8]=e=>f("我何时会结婚？"))},"我何时会结婚？"),t("p",{onClick:a[9]||(a[9]=e=>f("我适合和现在的对象结婚吗？"))}," 我适合和现在的对象结婚吗？ "),t("p",{onClick:a[10]||(a[10]=e=>f("我的婚姻生活会幸福吗？"))},"我的婚姻生活会幸福吗？"),t("p",{onClick:a[11]||(a[11]=e=>f("如何吸引我的正缘桃花？"))},"如何吸引我的正缘桃花？")]),a[91]||(a[91]=t("h4",{class:"category-heading"},"关系难题",-1)),t("div",z,[t("p",{onClick:a[12]||(a[12]=e=>f("我们之间出了什么问题？"))},"我们之间出了什么问题？"),t("p",{onClick:a[13]||(a[13]=e=>f("如何解决现在的感情危机？"))},"如何解决现在的感情危机？"),t("p",{onClick:a[14]||(a[14]=e=>f("我们有机会复合吗？"))},"我们有机会复合吗？"),t("p",{onClick:a[15]||(a[15]=e=>f("我应该放弃这段感情吗？"))},"我应该放弃这段感情吗？"),t("p",{onClick:a[16]||(a[16]=e=>f("我和Ta的缘分有多深？"))},"我和Ta的缘分有多深？"),t("p",{onClick:a[17]||(a[17]=e=>f("我的灵魂伴侣有什么特征？"))},"我的灵魂伴侣有什么特征？")])],2),t("div",{id:"shiye",class:u(["tab-pane",{active:"shiye"===k.value}])},[a[92]||(a[92]=t("h4",{class:"category-heading"},"事业发展",-1)),t("div",Q,[t("p",{onClick:a[18]||(a[18]=e=>f("我适合现在的工作/行业吗？"))}," 我适合现在的工作/行业吗？ "),t("p",{onClick:a[19]||(a[19]=e=>f("我的事业什么时候能成功？"))},"我的事业什么时候能成功？"),t("p",{onClick:a[20]||(a[20]=e=>f("我适合跳槽还是继续坚守？"))},"我适合跳槽还是继续坚守？"),t("p",{onClick:a[21]||(a[21]=e=>f("我事业上的贵人会是谁？"))},"我事业上的贵人会是谁？"),t("p",{onClick:a[22]||(a[22]=e=>f("我未来的事业走向怎么样？"))},"我未来的事业走向怎么样？"),t("p",{onClick:a[23]||(a[23]=e=>f("我什么时候能找到满意的工作？"))}," 我什么时候能找到满意的工作？ ")]),a[93]||(a[93]=t("h4",{class:"category-heading"},"职场机遇",-1)),t("div",W,[t("p",{onClick:a[24]||(a[24]=e=>f("我今年有机会升职加薪吗？"))},"我今年有机会升职加薪吗？"),t("p",{onClick:a[25]||(a[25]=e=>f("如何得到领导的赏识和重用？"))}," 如何得到领导的赏识和重用？ "),t("p",{onClick:a[26]||(a[26]=e=>f("我在公司的发展前景如何？"))},"我在公司的发展前景如何？"),t("p",{onClick:a[27]||(a[27]=e=>f("如何改善当前的工作状态？"))},"如何改善当前的工作状态？"),t("p",{onClick:a[28]||(a[28]=e=>f("我最近的职场人际运如何？"))},"我最近的职场人际运如何？")]),a[94]||(a[94]=t("h4",{class:"category-heading"},"创业之路",-1)),t("div",X,[t("p",{onClick:a[29]||(a[29]=e=>f("我适合创业吗？"))},"我适合创业吗？"),t("p",{onClick:a[30]||(a[30]=e=>f("我的创业最佳时机是什么时候？"))}," 我的创业最佳时机是什么时候？ "),t("p",{onClick:a[31]||(a[31]=e=>f("我该和什么样的人合伙？"))},"我该和什么样的人合伙？"),t("p",{onClick:a[32]||(a[32]=e=>f("我的创业项目前景如何？"))},"我的创业项目前景如何？"),t("p",{onClick:a[33]||(a[33]=e=>f("创业过程中需要注意哪些风险？"))}," 创业过程中需要注意哪些风险？ "),t("p",{onClick:a[34]||(a[34]=e=>f("我的创业会成功吗？"))},"我的创业会成功吗？")])],2),t("div",{id:"caifu",class:u(["tab-pane",{active:"caifu"===k.value}])},[a[95]||(a[95]=t("h4",{class:"category-heading"},"财运趋势",-1)),t("div",Z,[t("p",{onClick:a[35]||(a[35]=e=>f("我近期的财运怎么样？"))},"我近期的财运怎么样？"),t("p",{onClick:a[36]||(a[36]=e=>f("我这辈子财运的整体趋势？"))},"我这辈子财运的整体趋势？"),t("p",{onClick:a[37]||(a[37]=e=>f("我什么时候能发财？"))},"我什么时候能发财？"),t("p",{onClick:a[38]||(a[38]=e=>f("我适合靠什么方式赚钱？"))},"我适合靠什么方式赚钱？"),t("p",{onClick:a[39]||(a[39]=e=>f("如何有效提升我的财运？"))},"如何有效提升我的财运？"),t("p",{onClick:a[40]||(a[40]=e=>f("我近期会有意外之财吗？"))},"我近期会有意外之财吗？")]),a[96]||(a[96]=t("h4",{class:"category-heading"},"投资理财",-1)),t("div",ee,[t("p",{onClick:a[41]||(a[41]=e=>f("我适合做投资吗？"))},"我适合做投资吗？"),t("p",{onClick:a[42]||(a[42]=e=>f("我应该选择什么样的投资方向？"))}," 我应该选择什么样的投资方向？ "),t("p",{onClick:a[43]||(a[43]=e=>f("这个投资项目能赚钱吗？"))},"这个投资项目能赚钱吗？"),t("p",{onClick:a[44]||(a[44]=e=>f("如何才能守住我的财富？"))},"如何才能守住我的财富？"),t("p",{onClick:a[45]||(a[45]=e=>f("我的投资风险大吗？"))},"我的投资风险大吗？"),t("p",{onClick:a[46]||(a[46]=e=>f("如何更好地管理我的财富？"))},"如何更好地管理我的财富？")]),a[97]||(a[97]=t("h4",{class:"category-heading"},"财务状况",-1)),t("div",ae,[t("p",{onClick:a[47]||(a[47]=e=>f("我为什么总是存不住钱？"))},"我为什么总是存不住钱？"),t("p",{onClick:a[48]||(a[48]=e=>f("是什么原因导致我财务紧张？"))}," 是什么原因导致我财务紧张？ "),t("p",{onClick:a[49]||(a[49]=e=>f("我最近会有破财风险吗？"))},"我最近会有破财风险吗？"),t("p",{onClick:a[50]||(a[50]=e=>f("如何避免不必要的财务损失？"))}," 如何避免不必要的财务损失？ "),t("p",{onClick:a[51]||(a[51]=e=>f("我需要注意哪些年份的破财？"))}," 我需要注意哪些年份的破财？ "),t("p",{onClick:a[52]||(a[52]=e=>f("我该如何处理我的债务问题？"))}," 我该如何处理我的债务问题？ ")])],2),t("div",{id:"renji",class:u(["tab-pane",{active:"renji"===k.value}])},[a[98]||(a[98]=t("h4",{class:"category-heading"},"社交模式",-1)),t("div",le,[t("p",{onClick:a[53]||(a[53]=e=>f("我的人际交往模式有何优缺点？"))}," 我的人际交往模式有何优缺点？ "),t("p",{onClick:a[54]||(a[54]=e=>f("如何拓展我的高质量社交圈？"))}," 如何拓展我的高质量社交圈？ "),t("p",{onClick:a[55]||(a[55]=e=>f("我目前的人际关系状态如何？"))}," 我目前的人际关系状态如何？ "),t("p",{onClick:a[56]||(a[56]=e=>f("我会吸引哪些人进入我的生活？"))}," 我会吸引哪些人进入我的生活？ "),t("p",{onClick:a[57]||(a[57]=e=>f("如何获得他人的信任与支持？"))}," 如何获得他人的信任与支持？ "),t("p",{onClick:a[58]||(a[58]=e=>f("如何处理与朋友的矛盾？"))},"如何处理与朋友的矛盾？")]),a[99]||(a[99]=t("h4",{class:"category-heading"},"贵人善缘",-1)),t("div",ne,[t("p",{onClick:a[59]||(a[59]=e=>f("什么样的朋友是我的贵人？"))},"什么样的朋友是我的贵人？"),t("p",{onClick:a[60]||(a[60]=e=>f("我应该远离什么样的朋友？"))},"我应该远离什么样的朋友？"),t("p",{onClick:a[61]||(a[61]=e=>f("如何结交更多志同道合的朋友？"))}," 如何结交更多志同道合的朋友？ "),t("p",{onClick:a[62]||(a[62]=e=>f("我该如何维系重要的友谊？"))},"我该如何维系重要的友谊？"),t("p",{onClick:a[63]||(a[63]=e=>f("我该信任我身边的朋友吗？"))},"我该信任我身边的朋友吗？"),t("p",{onClick:a[64]||(a[64]=e=>f("如何获得领导或长辈的赏识？"))}," 如何获得领导或长辈的赏识？ ")]),a[100]||(a[100]=t("h4",{class:"category-heading"},"家庭关系",-1)),t("div",te,[t("p",{onClick:a[65]||(a[65]=e=>f("我和家人的关系怎么样？"))},"我和家人的关系怎么样？"),t("p",{onClick:a[66]||(a[66]=e=>f("我的家庭对我有什么样的影响？"))}," 我的家庭对我有什么样的影响？ "),t("p",{onClick:a[67]||(a[67]=e=>f("如何改善我与家人的关系？"))},"如何改善我与家人的关系？"),t("p",{onClick:a[68]||(a[68]=e=>f("我该如何处理家庭矛盾？"))},"我该如何处理家庭矛盾？"),t("p",{onClick:a[69]||(a[69]=e=>f("我与家人的缘分有多深？"))},"我与家人的缘分有多深？"),t("p",{onClick:a[70]||(a[70]=e=>f("如何更好地与家人沟通？"))},"如何更好地与家人沟通？")])],2),t("div",{id:"rensheng",class:u(["tab-pane",{active:"rensheng"===k.value}])},[a[101]||(a[101]=t("h4",{class:"category-heading"},"学业规划",-1)),t("div",se,[t("p",{onClick:a[71]||(a[71]=e=>f("我的学业运势如何？"))},"我的学业运势如何？"),t("p",{onClick:a[72]||(a[72]=e=>f("我适合考研/考公吗？"))},"我适合考研/考公吗？"),t("p",{onClick:a[73]||(a[73]=e=>f("我适合继续深造还是工作？"))},"我适合继续深造还是工作？"),t("p",{onClick:a[74]||(a[74]=e=>f("如何提升我的学习效率？"))},"如何提升我的学习效率？"),t("p",{onClick:a[75]||(a[75]=e=>f("我该选择哪个专业/学校？"))},"我该选择哪个专业/学校？"),t("p",{onClick:a[76]||(a[76]=e=>f("我这次考试能通过吗？"))},"我这次考试能通过吗？")]),a[102]||(a[102]=t("h4",{class:"category-heading"},"个人成长",-1)),t("div",ie,[t("p",{onClick:a[77]||(a[77]=e=>f("我的性格优势和劣势是什么？"))}," 我的性格优势和劣势是什么？ "),t("p",{onClick:a[78]||(a[78]=e=>f("我的人生主要课题是什么？"))},"我的人生主要课题是什么？"),t("p",{onClick:a[79]||(a[79]=e=>f("如何找到我的人生方向？"))},"如何找到我的人生方向？"),t("p",{onClick:a[80]||(a[80]=e=>f("如何克服我性格中的弱点？"))},"如何克服我性格中的弱点？"),t("p",{onClick:a[81]||(a[81]=e=>f("如何有效提升自己的能量状态？"))}," 如何有效提升自己的能量状态？ "),t("p",{onClick:a[82]||(a[82]=e=>f("我的人生转折点在何时？"))},"我的人生转折点在何时？")]),a[103]||(a[103]=t("h4",{class:"category-heading"},"人生机遇",-1)),t("div",oe,[t("p",{onClick:a[83]||(a[83]=e=>f("我未来十年的人生大运怎么样？"))}," 我未来十年的人生大运怎么样？ "),t("p",{onClick:a[84]||(a[84]=e=>f("我该如何实现我的人生目标？"))}," 我该如何实现我的人生目标？ "),t("p",{onClick:a[85]||(a[85]=e=>f("我的人生会有什么重大机遇？"))}," 我的人生会有什么重大机遇？ "),t("p",{onClick:a[86]||(a[86]=e=>f("我应该注意哪些健康问题？"))},"我应该注意哪些健康问题？"),t("p",{onClick:a[87]||(a[87]=e=>f("如何才能活出更精彩的人生？"))}," 如何才能活出更精彩的人生？ "),t("p",{onClick:a[88]||(a[88]=e=>f("未来的人生之路走向如何？"))},"未来的人生之路走向如何？")])],2)]))}}),[["__scopeId","data-v-73cc7223"]]),ce={class:"spread-bubbles-container"},re={class:"spread-bubbles"},pe=["onClick"],de={class:"bubble-icon"},ve={class:"bubble-text"},me={key:0,class:"all-spreads-panel"},ye={class:"panel-content"},ge=["onClick"],ke={class:"item-icon"},fe={class:"item-content"},he={class:"item-title"},be={class:"item-description"},Ce={class:"item-meta"},we={class:"item-count"},Te=A(e({__name:"TarotSpreadSelector",props:{selectedSpread:{}},emits:["update:selectedSpread"],setup(e,{emit:k}){const f=k,h=l(!1),b=l(null),C=Object.keys($),w=a(()=>C.slice(0,4));function T(e){f("update:selectedSpread",e)}function q(){h.value=!h.value}function I(){h.value=!1}function R(e){return{single:"🔮",three:"🃏",love:"💕",career:"💼",decision:"⚖️",celtic:"✨",chakra:"🧘",year:"📅",mindBodySpirit:"🌿",horseshoe:"🐴"}[e]||"🎴"}function _(e){b.value&&!b.value.contains(e.target)&&I()}return p(()=>{document.addEventListener("click",_)}),d(()=>{document.removeEventListener("click",_)}),(e,a)=>(r(),n("div",{class:"tarot-spread-selector",ref_key:"selectorRef",ref:b},[t("div",ce,[t("div",re,[(r(!0),n(i,null,o(w.value,a=>(r(),n("button",{key:a,class:u(["spread-bubble",{active:e.selectedSpread===a}]),onClick:e=>T(a)},[t("span",de,c(R(a)),1),t("span",ve,c(m($)[a].name),1)],10,pe))),128)),t("button",{class:"spread-bubble expand-button",onClick:q},[...a[0]||(a[0]=[t("span",{class:"bubble-icon"},"⋯",-1),t("span",{class:"bubble-text"},"全部",-1)])])])]),v(g,{name:"slide-fade"},{default:y(()=>[h.value?(r(),n("div",me,[t("div",{class:"panel-header"},[a[1]||(a[1]=t("h3",{class:"panel-title"},"选择一个牌阵",-1)),t("button",{class:"close-button",onClick:I},"×")]),t("div",ye,[(r(!0),n(i,null,o(m(C),a=>(r(),n("div",{key:a,class:u(["spread-item",{active:e.selectedSpread===a}]),onClick:e=>function(e){T(e),I()}(a)},[t("div",ke,c(R(a)),1),t("div",fe,[t("div",he,c(m($)[a].name),1),t("div",be,c(m($)[a].description),1)]),t("div",Ce,[t("span",we,c(m($)[a].cardCount)+"张",1)])],10,ge))),128))])])):s("",!0)]),_:1})],512))}}),[["__scopeId","data-v-252a8102"]]),qe={key:0,src:"/static/ssgw.jpg",alt:"三山国王",class:"card-image"},Ie={class:"card-title"},Re={class:"card-description"},_e={class:"input-container"},xe=["placeholder","disabled"],Se=["disabled"],$e={key:0},Ae={key:1,class:"loading-text"},He={class:"supplementary-info"},Le={key:0,class:"info-form"},Ue={class:"form-group"},Ee={class:"radio-group"},Ve={class:"form-group"},je={class:"form-group"},De=["value"],Ne={key:2,class:"ssgw-process"},Oe={key:0,class:"shaking-animation"},Fe={class:"shaking-text"},Me={class:"shaking-visual"},Ye={class:"sign-container"},Be={key:1,class:"tossing-section"},Je={class:"result-section"},Pe={key:0,class:"result-section"},Ge=["innerHTML"],Ke={key:1,class:"bei-container"},ze=["src","alt"],Qe={key:2,class:"button-wrapper"},We=["disabled"],Xe=A(e({__name:"DivinationInput",props:{title:{},description:{},placeholder:{default:"请输入您的问题"},buttonText:{default:"询问赛博大师"},loadingText:{default:"AI思考中"},loading:{type:Boolean,default:!1},modelValue:{default:""},examples:{default:()=>[]},showInspiration:{type:Boolean,default:!0},hideAfterSubmit:{type:Boolean,default:!0},divinationType:{default:""}},emits:["update:modelValue","submit","typeChange","clear"],setup(e,{emit:m}){const _=e,x=m,S=k();R();const A=l(_.modelValue),L=l(se()),U=l("single"),E=l(!1),V=l(!1),j=l(),D=l(),N=l("sydf-v1-250520"),O=["sydf-v1-250520","sydf-v2","deepseek-v3.1","glm-4.5","qwen3-max","kimi-k2-0905","gemini-2.5-pro","gpt-oss-120b","llama-v4-maverick"],F=a(()=>j.value||D.value?"已补充信息":"补充信息"),M=l(!1),Y=l(""),B=l(0),J=l(!1),P=l(!1),G=l(0),K=l([]),z=l(""),Q=l(0),W=l(!1),X=l("");function Z(e){U.value=e,x("typeChange",`tarot_${e}`),A.value=""}const ee=a(()=>"ssgw"===_.divinationType?"可输入您的问题，也可直接求签":_.placeholder),ae=a(()=>"ssgw"!==_.divinationType&&!S.path.includes("/divination/ssgw")&&_.showInspiration),le=a(()=>S.path.includes("/divination/tarot")),ne=a(()=>{if(le.value){const e=$[U.value];return e?`塔罗牌·${e.name}`:_.title}return _.title}),te=a(()=>{if(le.value){const e=$[U.value];return e?e.description:_.description}return _.description});function se(){const e=S.path;return e.includes("/divination/tarot_single")?"tarot_single":(e.includes("/divination/tarot"),"tarot")}function ie(){A.value="",E.value=!1}function oe(){if("ssgw"===_.divinationType||S.path.includes("/ssgw")){const e=A.value.trim()||"心中所想之事";return E.value=!0,x("clear"),void ce(e)}if(!A.value.trim()||_.loading)return;E.value=!0;const e={};j.value&&(e.gender=j.value),D.value&&(e.birthYear=D.value),N.value&&(e.model=N.value),x("submit",{question:A.value.trim(),supplementaryInfo:Object.keys(e).length>0?e:void 0})}function ce(e){X.value=e,M.value=!0,Y.value="请静心默念，准备摇签...",B.value=0,setTimeout(()=>{Y.value="正在摇签中...";const e=setInterval(()=>{B.value++,B.value>=5&&(clearInterval(e),setTimeout(()=>{G.value=Math.floor(61*Math.random())+1,M.value=!1,P.value=!0,Q.value=0,W.value=!1,K.value=[],z.value=""},1e3))},400)},2e3)}function re(){if(J.value)return;J.value=!0,K.value=[],z.value="";const e=H();setTimeout(()=>{K.value=[e.bei1,e.bei2];const a=e.result;"圣杯"===a&&(W.value=!0),"圣杯"===a?(z.value="<strong>圣杯</strong> (一平一凸) - 神明同意此签。",setTimeout(()=>{z.value+="<p>正在为您解读签文...</p>",setTimeout(()=>{const e={};j.value&&(e.gender=j.value),D.value&&(e.birthYear=D.value),N.value&&(e.model=N.value),x("submit",{question:X.value,signNumber:G.value,supplementaryInfo:Object.keys(e).length>0?e:void 0})},2e3)},1e3)):(Q.value++,z.value="笑杯"===a?"<strong>笑杯</strong> (两平) - 神明笑而不语，可能问题不明或时机未到。":"<strong>阴杯</strong> (两凸) - 神明不同意此签。",Q.value>=3?(z.value+="<p>您已连续三次未能获得圣杯，看来今日不宜再问此事，请改日再来。</p>",J.value=!1):(z.value+="<p>请重新为您摇签...</p>",setTimeout(()=>{P.value=!1,K.value=[],z.value="",ce(X.value)},2e3))),J.value=!1},1300)}function pe(e){if(_.loading)return;A.value=e;const a=document.getElementById("userInput");a&&a.focus()}function de(e){if(_.loading)return;if(!e||!e.trim())return;A.value=e,E.value=!0;const a={};j.value&&(a.gender=j.value),D.value&&(a.birthYear=D.value),N.value&&(a.model=N.value),x("submit",{question:e,supplementaryInfo:Object.keys(a).length>0?a:void 0})}function ve(){j.value=void 0,D.value=void 0,N.value="sydf-v1-250520"}return f(()=>_.modelValue,e=>{A.value=e}),f(A,e=>{x("update:modelValue",e)}),f(()=>_.divinationType,(e,a)=>{a&&e!==a&&ie()}),f(()=>S.path,()=>{le.value&&(L.value=se()),ie()}),p(()=>{le.value&&x("typeChange",`tarot_${U.value}`);const e=localStorage.getItem("supplementaryInfo");if(e){const{gender:a,birthYear:l,model:n}=JSON.parse(e);j.value=a,D.value=l,n&&(N.value=n)}}),f([j,D,N],([e,a,l])=>{const n={gender:e,birthYear:a,model:l};localStorage.setItem("supplementaryInfo",JSON.stringify(n))}),d(()=>{}),(e,a)=>(r(),n(i,null,[t("div",{class:u(["input-card",{loading:e.loading}])},["ssgw"===e.divinationType?(r(),n("img",qe)):s("",!0),t("h2",Ie,c(ne.value),1),t("p",Re,c(te.value),1),le.value?(r(),h(Te,{key:1,"selected-spread":U.value,"onUpdate:selectedSpread":Z},null,8,["selected-spread"])):s("",!0),t("div",_e,[b(t("input",{id:"userInput","onUpdate:modelValue":a[0]||(a[0]=e=>A.value=e),type:"text",placeholder:ee.value,disabled:e.loading,class:"question-input",onKeyup:w(oe,["enter"])},null,40,xe),[[C,A.value]]),a[6]||(a[6]=t("div",{class:"input-focus-border"},null,-1))]),t("div",{class:u(["button-wrapper",{"ai-thinking":e.loading}])},[t("button",{id:"submitButton",disabled:e.loading||"ssgw"!==e.divinationType&&!A.value.trim(),class:"submit-button",onClick:oe},[e.loading?(r(),n("span",Ae,[T(c(e.loadingText)+" ",1),a[7]||(a[7]=t("span",{class:"loading-dots"},[t("span",{class:"dot"}),t("span",{class:"dot"}),t("span",{class:"dot"})],-1))])):(r(),n("span",$e,c(e.buttonText),1))],8,Se)],2),t("div",He,[t("a",{class:"toggle-info",onClick:a[1]||(a[1]=e=>V.value=!V.value)},[T(c(V.value?"收起":F.value)+" ",1),t("span",{class:u(["arrow",{down:!V.value,up:V.value}])},null,2)]),v(g,{name:"fade"},{default:y(()=>[V.value?(r(),n("div",Le,[t("div",Ue,[a[10]||(a[10]=t("label",{class:"form-label"},"性别:",-1)),t("div",Ee,[t("label",{class:u(["radio-label",{selected:"男"===j.value}])},[b(t("input",{type:"radio","onUpdate:modelValue":a[2]||(a[2]=e=>j.value=e),value:"男"},null,512),[[q,j.value]]),a[8]||(a[8]=t("span",null,"男",-1))],2),t("label",{class:u(["radio-label",{selected:"女"===j.value}])},[b(t("input",{type:"radio","onUpdate:modelValue":a[3]||(a[3]=e=>j.value=e),value:"女"},null,512),[[q,j.value]]),a[9]||(a[9]=t("span",null,"女",-1))],2)])]),t("div",Ve,[a[11]||(a[11]=t("label",{for:"birthYear",class:"form-label"},"出生年份:",-1)),b(t("input",{type:"number",id:"birthYear","onUpdate:modelValue":a[4]||(a[4]=e=>D.value=e),placeholder:"例如: 1990",class:"year-input"},null,512),[[C,D.value,void 0,{number:!0}]])]),t("div",je,[a[12]||(a[12]=t("label",{for:"model",class:"form-label"},"选择模型:",-1)),b(t("select",{id:"model","onUpdate:modelValue":a[5]||(a[5]=e=>N.value=e),class:"year-input"},[(r(),n(i,null,o(O,e=>t("option",{key:e,value:e},c(e),9,De)),64))],512),[[I,N.value]])]),t("div",{class:"form-group form-actions"},[t("button",{class:"reset-button",onClick:ve},"重置")])])):s("",!0)]),_:1})]),"ssgw"===e.divinationType&&(M.value||J.value||P.value)?(r(),n("div",Ne,[M.value?(r(),n("div",Oe,[t("p",Fe,c(Y.value),1),t("div",Me,[t("div",Ye,[(r(),n(i,null,o(5,e=>t("div",{key:e,class:u(["sign-stick",{active:e<=B.value}])},null,2)),64))])])])):s("",!0),J.value||P.value?(r(),n("div",Be,[t("div",Je,[t("p",null,[a[13]||(a[13]=T(" 求得第 ",-1)),t("strong",null,c(G.value),1),a[14]||(a[14]=T(" 签。 ",-1))]),a[15]||(a[15]=t("p",null,"请投掷圣杯，询问三山国王是否同意此签...",-1))]),z.value?(r(),n("div",Pe,[t("p",{innerHTML:z.value},null,8,Ge)])):s("",!0),K.value.length>0?(r(),n("div",Ke,[(r(!0),n(i,null,o(K.value,(e,a)=>(r(),n("img",{key:a,src:`/static/${e}.png`,alt:e,class:"bei-image"},null,8,ze))),128))])):s("",!0),!W.value&&Q.value<3?(r(),n("div",Qe,[t("button",{disabled:J.value,class:"toss-button",onClick:re},c(J.value?"投掷中...":"投掷圣杯"),9,We)])):s("",!0)])):s("",!0)])):s("",!0)],2),ae.value?(r(),h(ue,{key:0,"spread-type":le.value?U.value:null,onSelect:pe,onSubmit:de},null,8,["spread-type"])):s("",!0)],64))}}),[["__scopeId","data-v-61335be8"]]),Ze=new Map,ea=new Map;function aa(e){if(e.size>50){const a=e.keys().next().value;void 0!==a&&e.delete(a)}}function la(e){const n=k(),t=R(),s=a(()=>e.divinationType),i=l(""),o=l(!1),u=l(null),c=l(""),r=l(null),p=l(!1),d=l(!1),v=l(!1),m=l(null),y=l(!1),g=l([]),f=l(""),h=l(!1),b=a(()=>null!==u.value),C=a(()=>""!==c.value);function w(e){d.value=!0;const a=E.getRecord(e);if(a){i.value=a.question;const e=JSON.parse(JSON.stringify(a.result));u.value=e,c.value=a.result.aiResponse||"",a.conversationHistory&&a.conversationHistory.length>0?g.value=a.conversationHistory.map(e=>{var a;return{...e,content:"string"==typeof e.content?e.content:(null==(a=e.content)?void 0:a.value)||e.content}}):g.value=[{id:`hist-sys-${a.id}`,role:"system",content:"你是精通周易、梅花易数、奇门遁甲、塔罗牌等术数的AI助手。请根据占卜结果，为用户提供解读。"},{id:`hist-user-${a.id}`,role:"user",content:a.question},{id:`hist-asst-${a.id}`,role:"assistant",content:a.result.aiResponse||""}]}else t.push(`/divination/${s.value}`)}const T=function(e,a){let l;return(...n)=>{clearTimeout(l),l=setTimeout(()=>e(...n),a)}}(()=>{if(!c.value)return;const e=function(e){if(!e)return"";const a=`strip_${e.length}_${e.slice(0,50)}`;if(ea.has(a))return ea.get(a);const l=O.parse(e),n=((new DOMParser).parseFromString(l,"text/html").body.textContent||"").replace(/"/g,'"').replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/'/g,"'").replace(/\n{3,}/g,"\n\n").trim();return ea.set(a,n),aa(ea),n}(c.value);navigator.clipboard.writeText(e).then(()=>{v.value=!0,setTimeout(()=>{v.value=!1},2e3)})},300);function q(){if(u.value&&"id"in u.value&&u.value.id)try{const e=E.getRecords(),a=e.findIndex(e=>{var a;return"id"in e.result&&e.result.id===(null==(a=u.value)?void 0:a.id)});if(-1!==a){const l=g.value.map(e=>({...e,content:e.content}));e[a].conversationHistory=l,localStorage.setItem("sydf-history",JSON.stringify(e))}}catch(e){}}return{question:i,isLoading:o,result:u,aiResponse:c,error:r,isAiLoading:p,viewingHistory:d,isCopied:v,isCancelled:y,conversationHistory:g,followUpQuestion:f,isFollowUpLoading:h,hasResult:b,hasAiResponse:C,startDivination:async function(e={}){if(d.value)return;const{signNumber:a,spreadType:l,supplementaryInfo:n}=e;if(!o.value&&i.value.trim()){o.value=!0,p.value=!0,r.value=null,u.value=null,c.value="",y.value=!1,m.value=new AbortController,g.value=[];try{const e={role:"system",content:"你是精通周易、梅花易数、奇门遁甲、塔罗牌等术数的AI助手。请根据占卜结果，为用户提供解读。"},t={id:`msg-${Date.now()}`,role:"user",content:i.value},d={id:`msg-${Date.now()+1}`,role:"assistant",content:""};g.value=[e,t,d],u.value={id:crypto.randomUUID(),type:s.value,data:{originalName:"",ganzhi:{year:"",month:"",day:"",hour:""},timestamp:Date.now()},aiResponse:""},o.value=!1,U({type:s.value,question:i.value.trim(),...void 0!==a?{signNumber:a}:{},...void 0!==l?{spreadType:l}:{},...n?{supplementaryInfo:n}:{},signal:m.value.signal},e=>{c.value+=e,d.content+=e},e=>{r.value=e,d.content=e},e=>{p.value=!1,u.value&&e.id&&(u.value.id=e.id,u.value.data=e.data,c.value&&(u.value.aiResponse=c.value),q())}).then(e=>{u.value&&e.id&&(u.value.id=e.id,u.value.data=e.data)}).catch(e=>{r.value=e instanceof Error?e.message:"占卜失败，请稍后重试",o.value=!1,p.value=!1})}catch(t){r.value=t instanceof Error?t.message:"占卜失败，请稍后重试",o.value=!1}}},clearResult:function(){u.value=null,c.value="",r.value=null,i.value="",d.value=!1,g.value=[],f.value=""},loadResultFromHistory:w,regenerateAI:async function(){if(!u.value||p.value)return;p.value=!0,r.value=null,c.value="",y.value=!1,m.value=new AbortController;const e={id:`msg-${Date.now()}`,role:"assistant",content:""};g.value.push(e);try{if("qimen"===s.value&&u.value.data){const a=await U({type:s.value,question:i.value,signal:m.value.signal},a=>{c.value+=a,e.content+=a},a=>{r.value=a,e.content=a},()=>{p.value=!1,u.value&&c.value&&(u.value.aiResponse=c.value)});if(a.aiResponse){const l=a.aiResponse||"";e.content=l;const n=`ai_${i.value}_${s.value}`;Ze.set(n,l),aa(Ze)}u.value&&a.aiResponse&&(u.value.aiResponse=a.aiResponse)}else{const a=await U({type:s.value,question:i.value,signal:m.value.signal},a=>{c.value+=a,e.content+=a},a=>{r.value=a,e.content=a},()=>{p.value=!1,u.value&&c.value&&(u.value.aiResponse=c.value)});if(a.aiResponse){const l=a.aiResponse||"";e.content=l;const n=`ai_${i.value}_${s.value}`;Ze.set(n,l),aa(Ze)}u.value&&a.aiResponse&&(u.value.aiResponse=a.aiResponse)}}catch(a){r.value="重新生成失败，请稍后重试"}},handleHistoryParam:function(){const e=n.query.historyId;e&&w(e)},clearHistoryParam:function(){if(n.query.historyId){const e={...n.query};delete e.historyId,t.replace({path:n.path,query:e})}},shareResult:function(){T()},cancelGeneration:function(){m.value&&(m.value.abort(),y.value=!0,p.value=!1)},handleSendFollowUp:function(){if(!f.value.trim()||h.value)return;const e={id:`msg-${Date.now()}`,role:"user",content:f.value.trim()};g.value.push(e);const a={id:`msg-${Date.now()+1}`,role:"assistant",content:""};g.value.push(a),f.value="",h.value=!0;const l=`基于以下占卜结果和用户问题，请回答用户的追问：\n\n用户原始问题：${i.value}\n\n占卜结果：${c.value}\n\n用户追问：${e.content}\n\n请直接回答用户的追问，不要重复之前的内容。`;L(l,e=>{c.value+=e,a.content+=e},e=>{h.value=!1,u.value&&e&&(u.value.aiResponse=e,q())},e=>{h.value=!1,a.content=e})}}}const na={key:1,class:"result-header-actions"},ta={key:3,class:"ai-actions"},sa={key:4,class:"content-card error-card"},ia={class:"content-text"},oa={key:5,class:"content-card follow-up-card"},ua={class:"follow-up-input"},ca=["disabled"],ra=["disabled"],pa={key:0},da={key:1},va=A(e({__name:"UnifiedDivinationView",props:{divinationType:{}},setup(e){const i=e,o=k(),u=a(()=>V(i.divinationType)),{question:d,isLoading:v,result:y,aiResponse:g,error:T,isAiLoading:q,hasResult:I,hasAiResponse:R,viewingHistory:S,isCopied:$,isCancelled:A,startDivination:H,clearResult:L,shareResult:U,regenerateAI:E,handleHistoryParam:O,clearHistoryParam:F,cancelGeneration:M,conversationHistory:Y,followUpQuestion:B,isFollowUpLoading:J,handleSendFollowUp:P}=la(i),G=a(()=>y.value?{data:y.value.data,aiResponse:g.value}:{data:{},aiResponse:""}),K=l("single");function z(e){if(e.startsWith("tarot_")){const a=e.replace("tarot_","");K.value=a}}function Q(e){e.question&&(d.value=e.question);const a={};"tarot"===i.divinationType?a.spreadType=K.value:"ssgw"===i.divinationType&&void 0!==e.signNumber&&(a.signNumber=e.signNumber),e.supplementaryInfo&&(a.supplementaryInfo=e.supplementaryInfo),H(a)}function W(){L(),F()}function X(){T.value=null}function Z(){E()}return f(()=>i.divinationType,(e,a)=>{!S.value&&a&&e!==a&&(L(),F(),d.value="",B.value="",Y.value=[],T.value=null,A.value=!1,window.scrollTo(0,0),requestAnimationFrame(()=>{document.querySelectorAll(".page-container, .sidebar, main, .app-container, .main-wrapper, .content-wrapper, .main-content, .input-card, .inspiration-card, .questions-wrapper, .result-header-actions, .ai-actions, .follow-up-card, .error-card").forEach(e=>{e instanceof HTMLElement&&(e.scrollTop=0,e.scrollLeft=0)}),document.documentElement.scrollTop=0,document.body.scrollTop=0,document.documentElement.scrollLeft=0,document.body.scrollLeft=0,requestAnimationFrame(()=>{window.scrollTo(0,0),document.documentElement.scrollTop=0,document.body.scrollTop=0})}),j.emit(D.HISTORY_SELECTION_RESET))},{immediate:!1}),f(u,()=>{}),f(()=>o.query.historyId,(e,a)=>{e&&"string"==typeof e?O():a&&!e&&L()},{immediate:!0}),p(()=>{O()}),(e,a)=>{var l,i,p,y,g;return r(),n("div",{class:"page-container",key:e.divinationType},[m(I)||m(v)?s("",!0):(r(),h(Xe,{key:0,modelValue:m(d),"onUpdate:modelValue":a[0]||(a[0]=e=>_(d)?d.value=e:null),title:(null==(l=u.value)?void 0:l.title)||"",description:(null==(i=u.value)?void 0:i.description)||"","button-text":(null==(p=u.value)?void 0:p.buttonText)||"开始占卜",loading:m(v),placeholder:(null==(y=u.value)?void 0:y.placeholder)||"",examples:(null==(g=u.value)?void 0:g.examples)||[],"divination-type":e.divinationType,"hide-after-submit":!1,onSubmit:Q,onTypeChange:z,onClear:m(L)},null,8,["modelValue","title","description","button-text","loading","placeholder","examples","divination-type","onClear"])),m(I)&&!m(o).query.historyId?(r(),n("div",na,[t("button",{class:"btn-secondary",onClick:W},"← 返回"),m(R)&&!m(q)?(r(),n("button",{key:0,class:"btn-secondary",onClick:a[1]||(a[1]=(...e)=>m(U)&&m(U)(...e))},c(m($)?"已复制!":"分享"),1)):s("",!0)])):s("",!0),m(I)?(r(),h(N,{key:2,type:e.divinationType,result:G.value,"is-ai-loading":m(q)||m(J),error:m(T),question:m(d),"conversation-history":m(Y),"is-follow-up-loading":m(J),onRetry:Z},null,8,["type","result","is-ai-loading","error","question","conversation-history","is-follow-up-loading"])):s("",!0),m(I)?(r(),n("div",ta,[m(q)?(r(),n("button",{key:0,class:"btn-secondary",onClick:a[2]||(a[2]=(...e)=>m(M)&&m(M)(...e))},"取消生成")):s("",!0),m(q)||!m(T)&&!m(A)?s("",!0):(r(),n("button",{key:1,class:"btn-primary",onClick:Z}," 重新生成 "))])):s("",!0),m(T)&&!m(I)?(r(),n("div",sa,[t("p",ia,c(m(T)),1),t("div",{class:"form-actions"},[t("button",{class:"btn-primary",onClick:X},"重试")])])):s("",!0),m(R)&&!m(q)?(r(),n("div",oa,[t("div",ua,[b(t("textarea",{"onUpdate:modelValue":a[3]||(a[3]=e=>_(B)?B.value=e:null),placeholder:"对AI的解读进行追问...",disabled:m(J),onKeydown:a[4]||(a[4]=w(x((...e)=>m(P)&&m(P)(...e),["prevent"]),["enter"]))},null,40,ca),[[C,m(B)]]),t("button",{disabled:m(J),onClick:a[5]||(a[5]=(...e)=>m(P)&&m(P)(...e))},[m(J)?(r(),n("span",da,"发送中...")):(r(),n("span",pa,"发送"))],8,ra)])])):s("",!0)])}}}),[["__scopeId","data-v-5c4c9ad2"]]);export{va as default};
