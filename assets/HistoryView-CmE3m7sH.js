const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-mtMa_ncQ.js","assets/vendor-DTFIXZ-L.js","assets/utils-B-ODjm7Z.js","assets/index-CCul71YF.css"])))=>i.map(i=>d[i]);
import{h as e,c as t,d as s,_ as a}from"./index-mtMa_ncQ.js";import{D as i}from"./DivinationResult-QecQfxkb.js";import{d as n,r as l,p as o,e as c,c as r,a as d,t as u,q as v,g as p,F as y,l as f,x as m,o as h}from"./vendor-DTFIXZ-L.js";import"./utils-B-ODjm7Z.js";import"./markdown-BrxPKiid.js";const g={class:"page-container"},R={key:0,class:"content-card"},I={class:"detail-header"},_={class:"header-left"},k={class:"section-title"},w={class:"detail-date"},S={class:"detail-content"},b={class:"detail-question"},D={class:"content-text"},x={class:"detail-result"},j={class:"form-actions"},A={key:1,class:"content-card"},C={class:"history-content"},q={key:0,class:"empty-message"},E={key:1,class:"history-list"},L=["onClick"],N={class:"item-header"},O={class:"item-type"},P={class:"item-date"},V={class:"item-question"},z={key:0,class:"form-actions"},J=a(n({__name:"HistoryView",props:{selectedRecordId:{type:String,default:null},showDetail:{type:Boolean,default:!1}},setup(a){const n=a,J=m(),T=l([]),$=l(null),B=l(!1);function F(){confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")&&(e.clearRecords(),T.value=[])}function H(){J.push("/history")}function G(e){return new Date(e).toLocaleDateString("zh-CN")}function K(e){const s=t(e);return s?s.title:"æœªçŸ¥å åœ"}function M(e){if(!e.result.aiResponse)return"AIè§£è¯»æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•";return["æŠ±æ­‰","æš‚æ—¶ä¸å¯ç”¨","è¯·ç¨åé‡è¯•","å‡ºå°å·®","è¯·æ±‚è¿‡äºé¢‘ç¹","æœåŠ¡å™¨æš‚æ—¶ç¹å¿™"].some(t=>{var s;return null==(s=e.result.aiResponse)?void 0:s.includes(t)})?e.result.aiResponse:null}return o(()=>n.selectedRecordId,e=>{if(e){const t=T.value.find(t=>t.id===e);t&&($.value=t)}else $.value=null}),c(()=>{!function(){if(T.value=e.getRecords(),n.selectedRecordId){const e=T.value.find(e=>e.id===n.selectedRecordId);e?$.value=e:J.push("/history")}}()}),(t,n)=>{return h(),r("div",g,[a.showDetail&&$.value?(h(),r("div",R,[d("div",I,[d("div",_,[d("h2",k,u(K($.value.type)),1),d("p",w,u((l=$.value.timestamp,new Date(l).toLocaleString("zh-CN"))),1)]),d("div",{class:"header-actions"},[d("button",{class:"btn-secondary",onClick:H},[...n[2]||(n[2]=[d("span",{class:"back-icon"},"â†",-1),d("span",{class:"back-text"},"è¿”å›",-1)])])])]),d("div",S,[d("div",b,[n[3]||(n[3]=d("h3",{class:"section-subtitle"},"é—®é¢˜",-1)),d("p",D,u($.value.question),1)]),d("div",x,[n[4]||(n[4]=d("h3",{class:"section-subtitle"},"ç»“æœ",-1)),v(i,{type:$.value.type,result:$.value.result,error:M($.value),onRetry:n[0]||(n[0]=t=>async function(t){if(!B.value){B.value=!0;try{const{AIService:a}=await s(async()=>{const{AIService:e}=await import("./index-mtMa_ncQ.js").then(e=>e.f);return{AIService:e}},__vite__mapDeps([0,1,2,3])),{DivinationService:i}=await s(async()=>{const{DivinationService:e}=await import("./index-mtMa_ncQ.js").then(e=>e.i);return{DivinationService:e}},__vite__mapDeps([0,1,2,3])),n=a,l=i.getInstance().generatePrompt(t.type,t.question,t.result.data),o=await n.generateResponse(l);if(!(null==o?void 0:o.content))throw new Error("AIæœåŠ¡è¿”å›ç©ºå“åº”");{t.result.aiResponse=o.content;const s=e.getRecords(),a=s.findIndex(e=>e.id===t.id);-1!==a&&(s[a]=t,localStorage.setItem("sydf-history",JSON.stringify(s)))}}catch(a){const s=a instanceof Error?a.message:"é‡æ–°ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";t.result.aiResponse=s;const i=e.getRecords(),n=i.findIndex(e=>e.id===t.id);-1!==n&&(i[n]=t,localStorage.setItem("sydf-history",JSON.stringify(i)))}finally{B.value=!1}}}($.value))},null,8,["type","result","error"])])]),d("div",j,[d("button",{class:"btn-danger",onClick:n[1]||(n[1]=t=>{return s=$.value.id,void(confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")&&(e.deleteRecord(s),H()));var s})},[...n[5]||(n[5]=[d("span",{class:"delete-icon"},"ğŸ—‘ï¸",-1),d("span",{class:"delete-text"},"åˆ é™¤è®°å½•",-1)])])])])):(h(),r("div",A,[n[7]||(n[7]=d("div",{class:"card-header"},[d("h2",{class:"page-title"},"å†å²è®°å½•"),d("p",{class:"content-text"},"è¿™é‡Œä¿å­˜äº†æ‚¨æœ€è¿‘çš„å åœè®°å½•ï¼Œä»…ä¿å­˜åœ¨æœ¬åœ°å“¦ã€‚")],-1)),d("div",C,[0===T.value.length?(h(),r("div",q,[...n[6]||(n[6]=[d("div",{class:"empty-icon"},"ğŸ“œ",-1),d("p",null,"æš‚æ— å†å²è®°å½•",-1),d("p",{class:"empty-hint"},"æ‚¨çš„å åœè®°å½•å°†ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ",-1)])])):(h(),r("div",E,[(h(!0),r(y,null,f(T.value,e=>(h(),r("div",{key:e.id,class:"history-item"},[d("button",{class:"history-item-button",onClick:t=>function(e){J.push(`/divination/${e.type}?historyId=${e.id}`)}(e)},[d("div",N,[d("span",O,u(K(e.type)),1),d("span",P,u(G(e.timestamp)),1)]),d("div",V,u(e.question),1)],8,L)]))),128))]))]),T.value.length>0?(h(),r("div",z,[d("button",{class:"btn-danger",onClick:F},"æ¸…ç©ºå†å²è®°å½•")])):p("",!0)]))]);var l}}}),[["__scopeId","data-v-18647059"]]);export{J as default};
