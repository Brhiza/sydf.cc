const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B9uMmlVc.js","assets/index-g5TWyNd5.css"])))=>i.map(i=>d[i]);
import{d as e,j as t,B as s,o as a,c as n,z as i,b as c,t as o,f as l,x as r,F as d,r as u,l as p,u as v,J as y,L as f,e as h,_ as m}from"./index-B9uMmlVc.js";import{D as g}from"./DivinationResult-DxDAMqKE.js";const R={class:"page-container"},I={key:0,class:"content-card"},b={class:"detail-header"},_={class:"header-left"},k={class:"section-title"},S={class:"detail-date"},w={class:"detail-content"},D={class:"detail-question"},x={class:"content-text"},A={class:"detail-result"},C={class:"form-actions"},E={key:1,class:"content-card"},j={class:"history-content"},q={key:0,class:"empty-message"},L={key:1,class:"history-list"},N=["onClick"],O={class:"item-header"},z={class:"item-type"},J={class:"item-date"},P={class:"item-question"},T={key:0,class:"form-actions"},V=m(e({__name:"HistoryView",props:{selectedRecordId:{type:String,default:null},showDetail:{type:Boolean,default:!1}},setup(e){const m=e,V=v(),B=t([]),$=t(null),F=t(!1);function H(){confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")&&(p.clearRecords(),B.value=[])}function U(){V.push("/history")}function G(e){return new Date(e).toLocaleDateString("zh-CN")}function K(e){const t=y(e);return t?t.title:"æœªçŸ¥å åœ"}function M(e){if(!e.result.aiResponse)return"AIè§£è¯»æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•";return["æŠ±æ­‰","æš‚æ—¶ä¸å¯ç”¨","è¯·ç¨åé‡è¯•","å‡ºå°å·®","è¯·æ±‚è¿‡äºé¢‘ç¹","æœåŠ¡å™¨æš‚æ—¶ç¹å¿™"].some(t=>{var s;return null==(s=e.result.aiResponse)?void 0:s.includes(t)})?e.result.aiResponse:null}return s(()=>m.selectedRecordId,e=>{if(e){const t=B.value.find(t=>t.id===e);t&&($.value=t)}else $.value=null}),a(()=>{!function(){if(B.value=p.getRecords(),m.selectedRecordId){const e=B.value.find(e=>e.id===m.selectedRecordId);e?$.value=e:V.push("/history")}}()}),(t,s)=>{return h(),n("div",R,[e.showDetail&&i($)?(h(),n("div",I,[c("div",b,[c("div",_,[c("h2",k,o(K(i($).type)),1),c("p",S,o((a=i($).timestamp,new Date(a).toLocaleString("zh-CN"))),1)]),c("div",{class:"header-actions"},[c("button",{class:"btn-secondary",onClick:U},s[2]||(s[2]=[c("span",{class:"back-icon"},"â†",-1),c("span",{class:"back-text"},"è¿”å›",-1)]))])]),c("div",w,[c("div",D,[s[3]||(s[3]=c("h3",{class:"section-subtitle"},"é—®é¢˜",-1)),c("p",x,o(i($).question),1)]),c("div",A,[s[4]||(s[4]=c("h3",{class:"section-subtitle"},"ç»“æœ",-1)),l(g,{type:i($).type,result:i($).result,error:M(i($)),onRetry:s[0]||(s[0]=e=>async function(e){if(!F.value){F.value=!0;try{const{AIService:t}=await f(async()=>{const{AIService:e}=await import("./index-B9uMmlVc.js").then(e=>e.T);return{AIService:e}},__vite__mapDeps([0,1])),{DivinationService:s}=await f(async()=>{const{DivinationService:e}=await import("./index-B9uMmlVc.js").then(e=>e.U);return{DivinationService:e}},__vite__mapDeps([0,1])),a=t,n=s.getInstance().generatePrompt(e.type,e.question,e.result.data),i=await a.generateResponse(n);if(!(null==i?void 0:i.content))throw new Error("AIæœåŠ¡è¿”å›ç©ºå“åº”");{e.result.aiResponse=i.content;const t=p.getRecords(),s=t.findIndex(t=>t.id===e.id);-1!==s&&(t[s]=e,localStorage.setItem("sydf-history",JSON.stringify(t)))}}catch(t){const s=t instanceof Error?t.message:"é‡æ–°ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";e.result.aiResponse=s;const a=p.getRecords(),n=a.findIndex(t=>t.id===e.id);-1!==n&&(a[n]=e,localStorage.setItem("sydf-history",JSON.stringify(a)))}finally{F.value=!1}}}(i($)))},null,8,["type","result","error"])])]),c("div",C,[c("button",{class:"btn-danger",onClick:s[1]||(s[1]=e=>{return t=i($).id,void(confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")&&(p.deleteRecord(t),U()));var t})},s[5]||(s[5]=[c("span",{class:"delete-icon"},"ğŸ—‘ï¸",-1),c("span",{class:"delete-text"},"åˆ é™¤è®°å½•",-1)]))])])):(h(),n("div",E,[s[7]||(s[7]=c("div",{class:"card-header"},[c("h2",{class:"page-title"},"å†å²è®°å½•"),c("p",{class:"content-text"},"è¿™é‡Œä¿å­˜äº†æ‚¨æœ€è¿‘çš„å åœè®°å½•ï¼Œä»…ä¿å­˜åœ¨æœ¬åœ°å“¦ã€‚")],-1)),c("div",j,[0===i(B).length?(h(),n("div",q,s[6]||(s[6]=[c("div",{class:"empty-icon"},"ğŸ“œ",-1),c("p",null,"æš‚æ— å†å²è®°å½•",-1),c("p",{class:"empty-hint"},"æ‚¨çš„å åœè®°å½•å°†ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ",-1)]))):(h(),n("div",L,[(h(!0),n(d,null,u(i(B),e=>(h(),n("div",{key:e.id,class:"history-item"},[c("button",{class:"history-item-button",onClick:t=>function(e){V.push(`/divination/${e.type}?historyId=${e.id}`)}(e)},[c("div",O,[c("span",z,o(K(e.type)),1),c("span",J,o(G(e.timestamp)),1)]),c("div",P,o(e.question),1)],8,N)]))),128))]))]),i(B).length>0?(h(),n("div",T,[c("button",{class:"btn-danger",onClick:H},"æ¸…ç©ºå†å²è®°å½•")])):r("",!0)]))]);var a}}}),[["__scopeId","data-v-ebd95e8d"]]);export{V as default};
