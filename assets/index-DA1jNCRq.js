const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./views-Ctfqxawa.js","./vendor-DHUK-ldg.js","./views-rR460fFU.css"])))=>i.map(i=>d[i]);
import{a as ne,r as p,c as oe,w as B,h as ie,i as N,b as r,n as b,u as n,e as o,t as L,F as X,g as Z,f as k,m as ve,p as Be,D as fe,J as Ne,j as ge,x as Ye,o as a,E as me,L as Ue,l as he,k as We,K as Fe,M as Ke,N as je,O as Qe,P as Je}from"./vendor-DHUK-ldg.js";import{h as D,e as ee,E as te,d as se,_ as _e,a as $,i as Ge}from"./views-Ctfqxawa.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))y(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const g of d.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&y(g)}).observe(document,{childList:!0,subtree:!0});function l(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function y(c){if(c.ep)return;c.ep=!0;const d=l(c);fetch(c.href,d)}})();const Xe=""+new URL("../static/favicon.png",import.meta.url).href,Ze={class:"sidebar-header"},et={class:"logo-section"},tt=["title"],ot={class:"theme-icon-compact"},st={class:"sidebar-nav"},nt={class:"nav-section"},it={class:"nav-list"},lt={class:"nav-item"},at=["onClick"],rt={class:"nav-icon"},ct={class:"nav-text"},ut={class:"history-section"},dt={class:"section-header"},pt={key:0,class:"action-dropdown"},vt={class:"history-controls"},ft=["value"],mt={class:"history-list"},ht={key:0,class:"empty-history"},yt={key:1},gt=["data-record-id","onClick","onMouseenter","onTouchstart"],_t=["onClick"],wt={key:0,class:"checkbox-checked"},bt={class:"history-icon"},kt={key:0},xt={key:1},Et={key:2},Rt={key:3},Ct={key:4},Lt={key:5},St={class:"history-content"},$t={class:"history-title"},Tt=["onClick"],It={key:0,class:"record-action-dropdown"},Mt=["onClick"],Pt=["onClick"],Ot=["onClick"],Dt={key:2,class:"load-more-container"},Ht={key:3,class:"selection-actions"},At={class:"selection-info"},qt={class:"selection-buttons"},zt=["disabled"],Vt={class:"sidebar-footer"},Bt={class:"footer-list"},Nt={class:"footer-item"},Yt={class:"footer-item"},Ut={class:"footer-item"},Wt=ne({__name:"Sidebar",setup(i,{expose:m}){const l=p(!0),y=p([]),c=p(0),d=p(null),g=p(""),S=p(""),v=p(!1),h=p(!1),f=p(new Set),x=p(null),w=p(null),E=p(!0),ae=p(!1),_=ge(),Y=Ye(),U=p(null),R=p("auto"),re=oe(()=>{switch(R.value){case"auto":return{icon:"🌓",text:"自动切换"};case"light":return{icon:"☀️",text:"亮色模式"};case"dark":return{icon:"🌙",text:"暗色模式"};default:return{icon:"🌓",text:"自动切换"}}}),be=p(1),H=p(0),W=p(!1),A=oe(()=>{c.value;let t=D.getRecords();return g.value&&(t=t.filter(e=>e.question.toLowerCase().includes(g.value.toLowerCase()))),S.value&&(t=t.filter(e=>e.type===S.value)),t});function ke(){return window.innerWidth<=768?8:20}function T(t=!0){const e=A.value;H.value=e.length;const s=ke();if(t)be.value=1,y.value=e.slice(0,s);else{const u=y.value.length,Q=e.slice(u,u+s);y.value.push(...Q)}W.value=y.value.length<H.value,console.log(`加载历史记录 (${window.innerWidth<=768?"移动端":"电脑端"}):`,y.value.length,"/",H.value,"条记录")}function xe(){W.value&&T(!1)}function Ee(t){t.stopPropagation(),v.value=!v.value}function Re(t){t.stopPropagation(),confirm("确定要清空所有历史记录吗？此操作不可撤销。")&&(D.clearRecords(),y.value=[],v.value=!1)}function q(){const t=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${t}px`)}function F(){const t=E.value,e=window.innerWidth<=768;E.value=e,e?l.value=!0:l.value=!1,q(),t!==e&&(console.log(`设备类型变化: ${t?"移动端":"电脑端"} -> ${e?"移动端":"电脑端"}`),T(!0))}function Ce(t){t!==void 0?l.value=t:l.value=!l.value}B(A,()=>{T(!0)},{deep:!0}),B(()=>_.params.id,t=>{t&&typeof t=="string"?d.value=t:d.value=null});function Le(t){return`/divination/${t.type}?historyId=${t.id}`}function Se(t){h.value?ue(t.id):$e(t)}function $e(t){d.value=t.id;const e=Le(t);Y.push(e)}function ce(){if(h.value=!h.value,h.value)d.value=null;else{f.value.clear();const t=_.query.historyId;d.value=t||null}v.value=!1}function ue(t){f.value.has(t)?f.value.delete(t):f.value.add(t)}function Te(t){w.value===t?w.value=null:(w.value=t,Ue(()=>{Ie(t)}))}function Ie(t){const e=document.querySelector(`[data-record-id="${t}"] .record-action-dropdown`),s=document.querySelector(`[data-record-id="${t}"]`);if(!e||!s)return;const u=s.getBoundingClientRect(),Q=140,V=120,J=window.innerWidth,de=window.innerHeight,I=de-u.bottom,M=u.top,qe=J-u.right,ze=u.left;if(console.log("菜单定位调试:",{recordId:t,rect:{left:u.left,right:u.right,top:u.top,bottom:u.bottom},viewport:{width:J,height:de},spaces:{left:ze,right:qe,above:M,below:I},isMobile:E.value}),e.style.top="",e.style.bottom="",e.style.left="",e.style.right="",e.style.transform="",E.value)e.style.right="0",e.style.left="auto",I>=V&&I>=M?(e.style.top="100%",e.style.bottom="auto",e.style.transform="translateY(4px)"):M>=V||M>I?(e.style.top="auto",e.style.bottom="100%",e.style.transform="translateY(-4px)"):(e.style.top="100%",e.style.bottom="auto",e.style.transform="translateY(4px)");else{const G=document.querySelector(".sidebar"),C=G==null?void 0:G.getBoundingClientRect(),pe=u.left-((C==null?void 0:C.left)||0),Ve=((C==null?void 0:C.right)||J)-u.right;console.log("侧边栏空间计算:",{sidebarSpaceLeft:pe,sidebarSpaceRight:Ve,sidebarRect:C?{left:C.left,right:C.right}:null}),I>=V&&I>=M?(e.style.top="100%",e.style.bottom="auto",e.style.right="0",e.style.left="auto",e.style.transform="translateY(4px)"):M>=V?(e.style.top="auto",e.style.bottom="100%",e.style.right="0",e.style.left="auto",e.style.transform="translateY(-4px)"):pe>=Q?(e.style.top="50%",e.style.bottom="auto",e.style.right="100%",e.style.left="auto",e.style.transform="translate(-4px, -50%)"):M>I?(e.style.top="auto",e.style.bottom="100%",e.style.right="0",e.style.left="auto",e.style.transform="translateY(-4px)"):(e.style.top="100%",e.style.bottom="auto",e.style.right="0",e.style.left="auto",e.style.transform="translateY(4px)")}}function Me(t){console.log("置顶记录:",t),w.value=null}function Pe(t){const e=y.value.find(s=>s.id===t);if(e){const s=prompt("请输入新的标签:",e.question);s&&s.trim()!==""&&(e.question=s.trim(),localStorage.setItem("sydf-history",JSON.stringify(D.getRecords())),T())}w.value=null}function Oe(t){confirm("确定要删除这条历史记录吗？此操作不可撤销。")&&(D.deleteRecord(t),T()),w.value=null}function De(){if(f.value.size===0)return;const t=f.value.size;confirm(`确定要删除选中的 ${t} 条历史记录吗？此操作不可撤销。`)&&(f.value.forEach(e=>{D.deleteRecord(e)}),f.value.clear(),T(),h.value=!1)}function P(t){console.log("导航到路径:",t,"当前路径:",_.path,"当前查询:",_.query),_.path===t&&Object.keys(_.query).length>0?(console.log("清除查询参数并导航"),Y.replace({path:t,query:{}})):_.path!==t?(console.log("导航到新路径"),Y.push(t)):console.log("已经在目标页面，无需导航")}function O(t){return _.query.historyId?!1:(_.name==="divination",_.path===t)}function K(){console.log("收到历史记录更新事件，刷新侧边栏"),c.value++}const z=t=>{const e=t.target;v.value&&U.value&&(U.value.contains(e)||(v.value=!1)),w.value&&(e.closest(".history-actions")||e.closest(".record-action-dropdown")||e.classList.contains("action-menu-btn")||(w.value=null,E.value&&(x.value=null)))};B(_,t=>{if(h.value)return;const e=t.query.historyId;e?d.value=e:d.value=null},{immediate:!0}),ie(()=>{F(),q(),window.addEventListener("resize",F),window.addEventListener("orientationchange",q),T(),setTimeout(()=>{ae.value=!0},100),Ae(),ee.on(te.HISTORY_UPDATED,K),document.addEventListener("click",z),document.addEventListener("touchstart",z)}),N(()=>{document.removeEventListener("click",z),document.removeEventListener("touchstart",z),ee.off(te.HISTORY_UPDATED,K)});function He(){const t=["auto","light","dark"],s=(t.indexOf(R.value)+1)%t.length;R.value=t[s],j(),localStorage.setItem("theme",R.value)}function j(){const t=document.documentElement;R.value==="dark"?t.classList.add("dark"):R.value==="light"?t.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?t.classList.add("dark"):t.classList.remove("dark")}function Ae(){const t=localStorage.getItem("theme");t&&["auto","light","dark"].includes(t)?R.value=t:R.value="auto",j(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{R.value==="auto"&&j()})}return N(()=>{window.removeEventListener("resize",F),window.removeEventListener("orientationchange",q),ee.off(te.HISTORY_UPDATED,K)}),m({toggleSidebar:Ce,isCollapsed:l}),(t,e)=>(a(),r("aside",{class:b(["sidebar",{"sidebar-collapsed":n(l),"sidebar-initialized":n(ae)}])},[o("div",Ze,[o("div",et,[e[8]||(e[8]=o("span",{class:"logo-text"},"时月东方",-1)),e[9]||(e[9]=o("img",{src:Xe,alt:"网站Logo",class:"website-logo"},null,-1)),o("div",{class:"theme-toggle-compact",title:n(re).text,onClick:He},[o("span",ot,L(n(re).icon),1)],8,tt)])]),o("nav",st,[o("div",nt,[o("ul",it,[o("li",lt,[o("div",{class:b([{"nav-link-active":O("/")},"nav-link-content"]),onClick:e[0]||(e[0]=s=>P("/"))},e[10]||(e[10]=[o("span",{class:"nav-icon"},"🏠",-1),o("span",{class:"nav-text"},"首页",-1)]),2)]),(a(!0),r(X,null,Z(n(se),s=>(a(),r("li",{key:s.type,class:"nav-item"},[o("div",{class:b([{"nav-link-active":O(`/divination/${s.type}`)},"nav-link-content"]),onClick:u=>P(`/divination/${s.type}`)},[o("span",rt,L(s.icon),1),o("span",ct,L(s.title),1)],10,at)]))),128))])])]),o("div",ut,[o("div",dt,[e[14]||(e[14]=o("div",{class:"header-left"},[o("h3",{class:"section-title"},"最近")],-1)),n(y).length>0?(a(),r("div",{key:0,ref_key:"menuRef",ref:U,class:"header-right"},[o("button",{class:"menu-btn",onClick:Ee},e[11]||(e[11]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[o("circle",{cx:"2",cy:"8",r:"1.5"}),o("circle",{cx:"8",cy:"8",r:"1.5"}),o("circle",{cx:"14",cy:"8",r:"1.5"})],-1)])),n(v)?(a(),r("div",pt,[n(h)?k("",!0):(a(),r("div",{key:0,class:"dropdown-item",onClick:ce},e[12]||(e[12]=[o("span",{class:"dropdown-icon"},"☑️",-1),o("span",{class:"dropdown-text"},"选择删除",-1)]))),n(h)?k("",!0):(a(),r("div",{key:1,class:"dropdown-item",onClick:Re},e[13]||(e[13]=[o("span",{class:"dropdown-icon"},"🗑️",-1),o("span",{class:"dropdown-text"},"清除所有对话",-1)])))])):k("",!0)],512)):k("",!0)]),o("div",vt,[ve(o("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>fe(g)?g.value=s:null),type:"text",placeholder:"搜索历史...",class:"search-input"},null,512),[[Be,n(g)]]),ve(o("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>fe(S)?S.value=s:null),class:"type-select"},[e[15]||(e[15]=o("option",{value:""},"所有类型",-1)),(a(!0),r(X,null,Z(n(se),s=>(a(),r("option",{key:s.type,value:s.type},L(s.title),9,ft))),128))],512),[[Ne,n(S)]])]),o("div",mt,[n(A).length===0?(a(),r("div",ht,e[16]||(e[16]=[o("p",null,"暂无匹配的历史记录",-1)]))):(a(),r("div",yt,[(a(!0),r(X,null,Z(n(A),s=>(a(),r("div",{key:s.id,class:b(["history-item",{active:n(d)===s.id&&!n(h),selected:n(f).has(s.id),"has-active-menu":n(w)===s.id}]),"data-record-id":s.id,onClick:u=>Se(s),onMouseenter:u=>!n(E)&&(x.value=s.id),onMouseleave:e[4]||(e[4]=u=>!n(E)&&(x.value=null)),onTouchstart:u=>n(E)&&(x.value=s.id)},[n(h)?(a(),r("div",{key:0,class:"select-checkbox",onClick:me(u=>ue(s.id),["stop"])},[n(f).has(s.id)?(a(),r("span",wt,"✓")):k("",!0)],8,_t)):k("",!0),o("div",bt,[s.type==="liuyao"?(a(),r("span",kt,"☰")):s.type==="meihua"?(a(),r("span",xt,"🌸")):s.type==="qimen"?(a(),r("span",Et,"⚡")):s.type==="tarot"||s.type==="tarot_single"?(a(),r("span",Rt,"🔮")):s.type==="ssgw"?(a(),r("span",Ct,"🏛️")):(a(),r("span",Lt,"📜"))]),o("div",St,[o("div",$t,L(s.question),1)]),(n(x)===s.id||n(E))&&!n(h)?(a(),r("div",{key:1,class:"history-actions",onClick:e[3]||(e[3]=me(()=>{},["stop"]))},[o("button",{class:b(["action-menu-btn",{active:n(w)===s.id}]),onClick:u=>Te(s.id)},e[17]||(e[17]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[o("circle",{cx:"2",cy:"8",r:"1.5"}),o("circle",{cx:"8",cy:"8",r:"1.5"}),o("circle",{cx:"14",cy:"8",r:"1.5"})],-1)]),10,Tt),n(w)===s.id?(a(),r("div",It,[o("div",{class:"dropdown-item",onClick:u=>Me(s.id)},e[18]||(e[18]=[o("span",{class:"dropdown-icon"},"📌",-1),o("span",{class:"dropdown-text"},"置顶",-1)]),8,Mt),o("div",{class:"dropdown-item",onClick:u=>Pe(s.id)},e[19]||(e[19]=[o("span",{class:"dropdown-icon"},"✏️",-1),o("span",{class:"dropdown-text"},"修改标签",-1)]),8,Pt),o("div",{class:"dropdown-item delete-item",onClick:u=>Oe(s.id)},e[20]||(e[20]=[o("span",{class:"dropdown-icon"},"🗑️",-1),o("span",{class:"dropdown-text"},"删除",-1)]),8,Ot)])):k("",!0)])):k("",!0)],42,gt))),128))])),n(W)&&!n(h)?(a(),r("div",Dt,[o("button",{class:"load-more-btn",onClick:xe}," 加载更多 ("+L(n(y).length)+"/"+L(n(H))+") ",1)])):k("",!0),n(h)?(a(),r("div",Ht,[o("div",At,"已选择 "+L(n(f).size)+" 项",1),o("div",qt,[o("button",{class:"selection-btn cancel-btn",onClick:ce},"取消选择"),o("button",{class:"selection-btn delete-selected-btn",disabled:n(f).size===0,onClick:De}," 删除选中 ("+L(n(f).size)+") ",9,zt)])])):k("",!0)])]),o("div",Vt,[o("ul",Bt,[o("li",Nt,[o("div",{class:b([{"footer-link-active":O("/settings")},"footer-link"]),onClick:e[5]||(e[5]=s=>P("/settings"))},e[21]||(e[21]=[o("span",{class:"footer-text"},"配置 Key",-1)]),2)]),o("li",Yt,[o("div",{class:b([{"footer-link-active":O("/rengong")},"footer-link"]),onClick:e[6]||(e[6]=s=>P("/rengong"))},e[22]||(e[22]=[o("span",{class:"footer-text"},"转人工",-1)]),2)]),o("li",Ut,[o("div",{class:b([{"footer-link-active":O("/about")},"footer-link"]),onClick:e[7]||(e[7]=s=>P("/about"))},e[23]||(e[23]=[o("span",{class:"footer-text"},"关于本站",-1)]),2)])])])],2))}}),Ft=_e(Wt,[["__scopeId","data-v-a3974693"]]),Kt={class:"top-bar"},jt={class:"top-bar-content"},Qt=ne({__name:"TopBar",props:{sidebarCollapsed:{type:Boolean}},emits:["toggle-sidebar"],setup(i){return(m,l)=>(a(),r("header",Kt,[o("div",jt,[o("button",{class:b(["menu-toggle",{"menu-active":!m.sidebarCollapsed}]),onClick:l[0]||(l[0]=y=>m.$emit("toggle-sidebar"))},l[1]||(l[1]=[o("span",{class:"hamburger-line"},null,-1),o("span",{class:"hamburger-line"},null,-1),o("span",{class:"hamburger-line"},null,-1)]),2),l[2]||(l[2]=o("div",{class:"top-bar-title"},[o("h1",null,"时月东方")],-1)),l[3]||(l[3]=o("div",{class:"top-bar-actions"},null,-1))])]))}}),Jt=_e(Qt,[["__scopeId","data-v-84bff781"]]),ye=768;function Gt(){const i=p(window.innerWidth<=ye);function m(){i.value=window.innerWidth<=ye}return ie(()=>{window.addEventListener("resize",m)}),N(()=>{window.removeEventListener("resize",m)}),{isMobile:i}}const Xt={class:"app-container"},Zt={class:"content-wrapper"},eo=ne({__name:"App",setup(i){const m=p(),l=ge(),{isMobile:y}=Gt(),c=oe(()=>{var v;return((v=m.value)==null?void 0:v.isCollapsed)||!1});function d(){var v;(v=m.value)==null||v.toggleSidebar()}function g(){var v;(v=m.value)==null||v.toggleSidebar(!0)}function S(v){if(!y.value||c.value)return;const h=v.target,f=document.querySelector(".sidebar"),x=document.querySelector(".menu-toggle");f!=null&&f.contains(h)||x!=null&&x.contains(h)||g()}return B(()=>l==null?void 0:l.path,()=>{y.value&&g()},{immediate:!1}),ie(()=>{console.log("时月东方，启动！"),document.addEventListener("click",S)}),N(()=>{document.removeEventListener("click",S)}),(v,h)=>{const f=Fe("router-view");return a(),r("div",Xt,[he(Ft,{ref_key:"sidebarRef",ref:m},null,512),he(Jt,{"sidebar-collapsed":c.value,class:b({"sidebar-collapsed":c.value}),onToggleSidebar:d},null,8,["sidebar-collapsed","class"]),o("main",{class:b(["main-content",{"sidebar-collapsed":c.value}])},[o("div",Zt,[(a(),We(f,{key:n(l).path}))])],2)])}}}),to=se.map(i=>i.type),oo=[{path:"/divination/:type",name:"divination",component:()=>$(()=>import("./views-Ctfqxawa.js").then(i=>i.U),__vite__mapDeps([0,1,2]),import.meta.url),props:i=>({divinationType:i.params.type}),beforeEnter:(i,m,l)=>{to.includes(i.params.type)?l():l({name:"not-found"})}},{path:"/ssgw",redirect:"/divination/ssgw"}],so=[{path:"/history",name:"history",component:()=>$(()=>import("./views-Ctfqxawa.js").then(i=>i.H),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/history/:id",name:"history-detail",component:()=>$(()=>import("./views-Ctfqxawa.js").then(i=>i.H),__vite__mapDeps([0,1,2]),import.meta.url),props:i=>({showDetail:!0,selectedRecordId:i.params.id})}],no=[{path:"/settings",name:"settings",component:()=>$(()=>import("./views-Ctfqxawa.js").then(i=>i.A),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/api-key",redirect:"/settings"},{path:"/api-config",redirect:"/settings"}],we=Ke({history:je("./"),routes:[{path:"/",name:"home",component:()=>$(()=>import("./views-Ctfqxawa.js").then(i=>i.b),__vite__mapDeps([0,1,2]),import.meta.url)},...oo,...so,...no,{path:"/rengong",name:"rengong",component:()=>$(()=>import("./views-Ctfqxawa.js").then(i=>i.R),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/about",name:"about",component:()=>$(()=>import("./views-Ctfqxawa.js").then(i=>i.c),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/:pathMatch(.*)*",name:"not-found",component:()=>$(()=>import("./views-Ctfqxawa.js").then(i=>i.N),__vite__mapDeps([0,1,2]),import.meta.url)}]});we.beforeEach((i,m,l)=>{l()});const io=Qe();function lo(i){i.use(io)}const le=Je(eo);lo(le);Ge();le.use(we);le.mount("#app");
