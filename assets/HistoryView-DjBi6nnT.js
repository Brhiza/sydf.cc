const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-6SmUqXy-.js","assets/index-rozYI_sE.css"])))=>i.map(i=>d[i]);
import{d as E,e as h,w as q,i as H,c as l,a as e,t as u,l as m,p as N,C as V,j as B,F as L,r as $,G as J,u as O,H as T,I as z,J as F,s as g,o as r,_ as K}from"./index-6SmUqXy-.js";import{a as R}from"./divination-config-DPDDIOby.js";const M={class:"history-view"},P={class:"history-container"},j={key:0,class:"history-detail-card"},G={class:"detail-header"},Q={class:"header-left"},U={class:"detail-title"},W={class:"detail-date"},X={class:"detail-content"},Y={class:"detail-question"},Z={class:"question-text"},ee={class:"detail-result"},te={class:"detail-footer"},se={key:1,class:"history-card"},oe={class:"history-content"},ie={key:0,class:"empty-message"},ae={key:1,class:"history-list"},ne=["onClick"],le={class:"item-header"},re={class:"item-type"},ce={class:"item-date"},de={class:"item-question"},ue={key:0,class:"card-footer"},ve=E({__name:"HistoryView",props:{selectedRecordId:{type:String,default:null},showDetail:{type:Boolean,default:!1}},setup(p){const v=p,y=O(),c=h([]),i=h(null),f=h(!1);function I(){if(c.value=J(),v.selectedRecordId){const s=c.value.find(t=>t.id===v.selectedRecordId);s?i.value=s:y.push("/history")}}function k(s){y.push(`/history/${s.id}`)}function w(){confirm("确定要清空所有历史记录吗？此操作不可撤销。")&&(T(),c.value=[])}function b(s){confirm("确定要删除这条记录吗？此操作不可撤销。")&&(z(s),_())}function _(){y.push("/history")}function S(s){return new Date(s).toLocaleDateString("zh-CN")}function D(s){return new Date(s).toLocaleString("zh-CN")}function A(s){return s.result.aiResponse?["抱歉","暂时不可用","请稍后重试","出小差","请求过于频繁","服务器暂时繁忙"].some(a=>{var n;return(n=s.result.aiResponse)==null?void 0:n.includes(a)})?s.result.aiResponse:null:"AI解读暂时不可用，请稍后重试"}async function x(s){if(!f.value){f.value=!0;try{const{getAIService:t}=await F(async()=>{const{getAIService:n}=await import("./index-6SmUqXy-.js").then(d=>d.Q);return{getAIService:n}},__vite__mapDeps([0,1])),a=await t().generateResponse(s.type,s.question,s.result.data);if(a!=null&&a.content){s.result.aiResponse=a.content;const n=g.getRecords(),d=n.findIndex(C=>C.id===s.id);d!==-1&&(n[d]=s,localStorage.setItem("sydf-history",JSON.stringify(n))),console.log("历史记录AI解读重试成功")}else throw new Error("AI服务返回空响应")}catch(t){console.error("重试AI解读失败:",t);const o=t instanceof Error?t.message:"重新生成失败，请稍后重试";s.result.aiResponse=o;const a=g.getRecords(),n=a.findIndex(d=>d.id===s.id);n!==-1&&(a[n]=s,localStorage.setItem("sydf-history",JSON.stringify(a)))}finally{f.value=!1}}}return q(()=>v.selectedRecordId,s=>{if(s){const t=c.value.find(o=>o.id===s);t&&(i.value=t)}else i.value=null}),H(()=>{I()}),(s,t)=>(r(),l("div",M,[e("div",P,[p.showDetail&&i.value?(r(),l("div",j,[e("div",G,[e("div",Q,[e("h2",U,u(m(R)(i.value.type)),1),e("p",W,u(D(i.value.timestamp)),1)]),e("div",{class:"header-actions"},[e("button",{class:"back-button",onClick:_},t[2]||(t[2]=[e("span",{class:"back-icon"},"←",-1),e("span",{class:"back-text"},"返回",-1)]))])]),e("div",X,[e("div",Y,[t[3]||(t[3]=e("h3",{class:"question-label"},"问题",-1)),e("p",Z,u(i.value.question),1)]),e("div",ee,[t[4]||(t[4]=e("h3",{class:"result-label"},"结果",-1)),N(V,{type:i.value.type,result:i.value.result,error:A(i.value),onRetry:t[0]||(t[0]=o=>x(i.value))},null,8,["type","result","error"])])]),e("div",te,[e("button",{onClick:t[1]||(t[1]=o=>b(i.value.id)),class:"delete-button"},t[5]||(t[5]=[e("span",{class:"delete-icon"},"🗑️",-1),e("span",{class:"delete-text"},"删除记录",-1)]))])])):(r(),l("div",se,[t[7]||(t[7]=e("div",{class:"card-header"},[e("h2",{class:"card-title"},"历史记录"),e("p",{class:"card-description"},"这里保存了您最近的占卜记录，仅保存在本地哦。")],-1)),e("div",oe,[c.value.length===0?(r(),l("div",ie,t[6]||(t[6]=[e("div",{class:"empty-icon"},"📜",-1),e("p",null,"暂无历史记录",-1),e("p",{class:"empty-hint"},"您的占卜记录将会显示在这里",-1)]))):(r(),l("div",ae,[(r(!0),l(L,null,$(c.value,o=>(r(),l("div",{key:o.id,class:"history-item"},[e("button",{onClick:a=>k(o),class:"history-item-button"},[e("div",le,[e("span",re,u(m(R)(o.type)),1),e("span",ce,u(S(o.timestamp)),1)]),e("div",de,u(o.question),1)],8,ne)]))),128))]))]),c.value.length>0?(r(),l("div",ue,[e("button",{onClick:w,class:"clear-button"},"清空历史记录")])):B("",!0)]))])]))}}),he=K(ve,[["__scopeId","data-v-1e798ca1"]]);export{he as default};
