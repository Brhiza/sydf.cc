import{d as e,i as a,r as n,c as l,a as i,g as t,F as s,l as o,n as u,t as c,o as r,s as v,p,e as d,f as g,m,u as y,j as k,v as h,I as C,h as f,x as b,J as w,w as T}from"./vendor-RKAyd5D7.js";import{g as q,t as R,_ as x,a as I,b as _,p as $,h as L,c as E,e as A,E as H}from"./index-3fJUXraF.js";import{D as S}from"./DivinationResult-DZLBID63.js";import{d as D}from"./markdown-BrxPKiid.js";import"./utils-B-ODjm7Z.js";const U={class:"inspiration-card"},N={class:"inspiration-tabs"},V=["onClick"],j={class:"category-heading"},M={class:"questions-wrapper"},F=["onClick"],O={class:"questions-wrapper"},B={class:"questions-wrapper"},P={class:"questions-wrapper"},z={class:"questions-wrapper"},J={class:"questions-wrapper"},G={class:"questions-wrapper"},K={class:"questions-wrapper"},Q={class:"questions-wrapper"},W={class:"questions-wrapper"},Y={class:"questions-wrapper"},X={class:"questions-wrapper"},Z={class:"questions-wrapper"},ee={class:"questions-wrapper"},ae={class:"questions-wrapper"},ne={class:"questions-wrapper"},le=x(e({__name:"InspirationPanel",props:{spreadType:{}},emits:["select","submit"],setup(e,{emit:v}){const p=e,d=v,g=a(()=>p.spreadType?q(p.spreadType):[]),m=a(()=>{var e;return p.spreadType&&(null==(e=R[p.spreadType])?void 0:e.name)||""}),y=a(()=>{const e=[{id:"ganqing",name:"感情"},{id:"shiye",name:"事业"},{id:"caifu",name:"财富"},{id:"renji",name:"人际"},{id:"rensheng",name:"成长"}];return p.spreadType&&g.value.length>0?[{id:"spread",name:"牌阵"},...e]:e}),k=n(p.spreadType&&q(p.spreadType).length>0?"spread":"ganqing");function h(e){document.querySelectorAll(".questions-wrapper p").forEach(a=>{a.textContent===e&&(a.classList.add("clicked"),setTimeout(()=>{a.classList.remove("clicked")},300))}),d("submit",e)}return(e,a)=>(r(),l("div",U,[a[104]||(a[104]=i("h3",{class:"inspiration-title"},"问题灵感",-1)),i("div",N,[(r(!0),l(s,null,o(y.value,e=>(r(),l("button",{key:e.id,class:u(["tab-btn",{active:k.value===e.id}]),onClick:a=>k.value=e.id},c(e.name),11,V))),128))]),e.spreadType&&g.value.length>0?(r(),l("div",{key:0,id:"spread",class:u(["tab-pane",{active:"spread"===k.value}])},[i("h4",j,c(m.value)+"专属问题",1),i("div",M,[(r(!0),l(s,null,o(g.value,e=>(r(),l("p",{key:e,onClick:a=>h(e)},c(e),9,F))),128))])],2)):t("",!0),i("div",{id:"ganqing",class:u(["tab-pane",{active:"ganqing"===k.value}])},[a[89]||(a[89]=i("h4",{class:"category-heading"},"情感发展",-1)),i("div",O,[i("p",{onClick:a[0]||(a[0]=e=>h("我近期的桃花运怎么样？"))},"我近期的桃花运怎么样？"),i("p",{onClick:a[1]||(a[1]=e=>h("我们目前的感情走向如何？"))},"我们目前的感情走向如何？"),i("p",{onClick:a[2]||(a[2]=e=>h("他/她对我的真实情感是什么？"))}," 他/她对我的真实情感是什么？ "),i("p",{onClick:a[3]||(a[3]=e=>h("我们之间有未来吗？"))},"我们之间有未来吗？"),i("p",{onClick:a[4]||(a[4]=e=>h("如何改善我们目前的关系？"))},"如何改善我们目前的关系？"),i("p",{onClick:a[5]||(a[5]=e=>h("这段感情对我的影响？"))},"这段感情对我的影响？")]),a[90]||(a[90]=i("h4",{class:"category-heading"},"正缘婚姻",-1)),i("div",B,[i("p",{onClick:a[6]||(a[6]=e=>h("我的正缘什么时候出现？"))},"我的正缘什么时候出现？"),i("p",{onClick:a[7]||(a[7]=e=>h("我的另一半是什么样的人？"))},"我的另一半是什么样的人？"),i("p",{onClick:a[8]||(a[8]=e=>h("我何时会结婚？"))},"我何时会结婚？"),i("p",{onClick:a[9]||(a[9]=e=>h("我适合和现在的对象结婚吗？"))}," 我适合和现在的对象结婚吗？ "),i("p",{onClick:a[10]||(a[10]=e=>h("我的婚姻生活会幸福吗？"))},"我的婚姻生活会幸福吗？"),i("p",{onClick:a[11]||(a[11]=e=>h("如何吸引我的正缘桃花？"))},"如何吸引我的正缘桃花？")]),a[91]||(a[91]=i("h4",{class:"category-heading"},"关系难题",-1)),i("div",P,[i("p",{onClick:a[12]||(a[12]=e=>h("我们之间出了什么问题？"))},"我们之间出了什么问题？"),i("p",{onClick:a[13]||(a[13]=e=>h("如何解决现在的感情危机？"))},"如何解决现在的感情危机？"),i("p",{onClick:a[14]||(a[14]=e=>h("我们有机会复合吗？"))},"我们有机会复合吗？"),i("p",{onClick:a[15]||(a[15]=e=>h("我应该放弃这段感情吗？"))},"我应该放弃这段感情吗？"),i("p",{onClick:a[16]||(a[16]=e=>h("我和Ta的缘分有多深？"))},"我和Ta的缘分有多深？"),i("p",{onClick:a[17]||(a[17]=e=>h("我的灵魂伴侣有什么特征？"))},"我的灵魂伴侣有什么特征？")])],2),i("div",{id:"shiye",class:u(["tab-pane",{active:"shiye"===k.value}])},[a[92]||(a[92]=i("h4",{class:"category-heading"},"事业发展",-1)),i("div",z,[i("p",{onClick:a[18]||(a[18]=e=>h("我适合现在的工作/行业吗？"))}," 我适合现在的工作/行业吗？ "),i("p",{onClick:a[19]||(a[19]=e=>h("我的事业什么时候能成功？"))},"我的事业什么时候能成功？"),i("p",{onClick:a[20]||(a[20]=e=>h("我适合跳槽还是继续坚守？"))},"我适合跳槽还是继续坚守？"),i("p",{onClick:a[21]||(a[21]=e=>h("我事业上的贵人会是谁？"))},"我事业上的贵人会是谁？"),i("p",{onClick:a[22]||(a[22]=e=>h("我未来的事业走向怎么样？"))},"我未来的事业走向怎么样？"),i("p",{onClick:a[23]||(a[23]=e=>h("我什么时候能找到满意的工作？"))}," 我什么时候能找到满意的工作？ ")]),a[93]||(a[93]=i("h4",{class:"category-heading"},"职场机遇",-1)),i("div",J,[i("p",{onClick:a[24]||(a[24]=e=>h("我今年有机会升职加薪吗？"))},"我今年有机会升职加薪吗？"),i("p",{onClick:a[25]||(a[25]=e=>h("如何得到领导的赏识和重用？"))}," 如何得到领导的赏识和重用？ "),i("p",{onClick:a[26]||(a[26]=e=>h("我在公司的发展前景如何？"))},"我在公司的发展前景如何？"),i("p",{onClick:a[27]||(a[27]=e=>h("如何改善当前的工作状态？"))},"如何改善当前的工作状态？"),i("p",{onClick:a[28]||(a[28]=e=>h("我最近的职场人际运如何？"))},"我最近的职场人际运如何？")]),a[94]||(a[94]=i("h4",{class:"category-heading"},"创业之路",-1)),i("div",G,[i("p",{onClick:a[29]||(a[29]=e=>h("我适合创业吗？"))},"我适合创业吗？"),i("p",{onClick:a[30]||(a[30]=e=>h("我的创业最佳时机是什么时候？"))}," 我的创业最佳时机是什么时候？ "),i("p",{onClick:a[31]||(a[31]=e=>h("我该和什么样的人合伙？"))},"我该和什么样的人合伙？"),i("p",{onClick:a[32]||(a[32]=e=>h("我的创业项目前景如何？"))},"我的创业项目前景如何？"),i("p",{onClick:a[33]||(a[33]=e=>h("创业过程中需要注意哪些风险？"))}," 创业过程中需要注意哪些风险？ "),i("p",{onClick:a[34]||(a[34]=e=>h("我的创业会成功吗？"))},"我的创业会成功吗？")])],2),i("div",{id:"caifu",class:u(["tab-pane",{active:"caifu"===k.value}])},[a[95]||(a[95]=i("h4",{class:"category-heading"},"财运趋势",-1)),i("div",K,[i("p",{onClick:a[35]||(a[35]=e=>h("我近期的财运怎么样？"))},"我近期的财运怎么样？"),i("p",{onClick:a[36]||(a[36]=e=>h("我这辈子财运的整体趋势？"))},"我这辈子财运的整体趋势？"),i("p",{onClick:a[37]||(a[37]=e=>h("我什么时候能发财？"))},"我什么时候能发财？"),i("p",{onClick:a[38]||(a[38]=e=>h("我适合靠什么方式赚钱？"))},"我适合靠什么方式赚钱？"),i("p",{onClick:a[39]||(a[39]=e=>h("如何有效提升我的财运？"))},"如何有效提升我的财运？"),i("p",{onClick:a[40]||(a[40]=e=>h("我近期会有意外之财吗？"))},"我近期会有意外之财吗？")]),a[96]||(a[96]=i("h4",{class:"category-heading"},"投资理财",-1)),i("div",Q,[i("p",{onClick:a[41]||(a[41]=e=>h("我适合做投资吗？"))},"我适合做投资吗？"),i("p",{onClick:a[42]||(a[42]=e=>h("我应该选择什么样的投资方向？"))}," 我应该选择什么样的投资方向？ "),i("p",{onClick:a[43]||(a[43]=e=>h("这个投资项目能赚钱吗？"))},"这个投资项目能赚钱吗？"),i("p",{onClick:a[44]||(a[44]=e=>h("如何才能守住我的财富？"))},"如何才能守住我的财富？"),i("p",{onClick:a[45]||(a[45]=e=>h("我的投资风险大吗？"))},"我的投资风险大吗？"),i("p",{onClick:a[46]||(a[46]=e=>h("如何更好地管理我的财富？"))},"如何更好地管理我的财富？")]),a[97]||(a[97]=i("h4",{class:"category-heading"},"财务状况",-1)),i("div",W,[i("p",{onClick:a[47]||(a[47]=e=>h("我为什么总是存不住钱？"))},"我为什么总是存不住钱？"),i("p",{onClick:a[48]||(a[48]=e=>h("是什么原因导致我财务紧张？"))}," 是什么原因导致我财务紧张？ "),i("p",{onClick:a[49]||(a[49]=e=>h("我最近会有破财风险吗？"))},"我最近会有破财风险吗？"),i("p",{onClick:a[50]||(a[50]=e=>h("如何避免不必要的财务损失？"))}," 如何避免不必要的财务损失？ "),i("p",{onClick:a[51]||(a[51]=e=>h("我需要注意哪些年份的破财？"))}," 我需要注意哪些年份的破财？ "),i("p",{onClick:a[52]||(a[52]=e=>h("我该如何处理我的债务问题？"))}," 我该如何处理我的债务问题？ ")])],2),i("div",{id:"renji",class:u(["tab-pane",{active:"renji"===k.value}])},[a[98]||(a[98]=i("h4",{class:"category-heading"},"社交模式",-1)),i("div",Y,[i("p",{onClick:a[53]||(a[53]=e=>h("我的人际交往模式有何优缺点？"))}," 我的人际交往模式有何优缺点？ "),i("p",{onClick:a[54]||(a[54]=e=>h("如何拓展我的高质量社交圈？"))}," 如何拓展我的高质量社交圈？ "),i("p",{onClick:a[55]||(a[55]=e=>h("我目前的人际关系状态如何？"))}," 我目前的人际关系状态如何？ "),i("p",{onClick:a[56]||(a[56]=e=>h("我会吸引哪些人进入我的生活？"))}," 我会吸引哪些人进入我的生活？ "),i("p",{onClick:a[57]||(a[57]=e=>h("如何获得他人的信任与支持？"))}," 如何获得他人的信任与支持？ "),i("p",{onClick:a[58]||(a[58]=e=>h("如何处理与朋友的矛盾？"))},"如何处理与朋友的矛盾？")]),a[99]||(a[99]=i("h4",{class:"category-heading"},"贵人善缘",-1)),i("div",X,[i("p",{onClick:a[59]||(a[59]=e=>h("什么样的朋友是我的贵人？"))},"什么样的朋友是我的贵人？"),i("p",{onClick:a[60]||(a[60]=e=>h("我应该远离什么样的朋友？"))},"我应该远离什么样的朋友？"),i("p",{onClick:a[61]||(a[61]=e=>h("如何结交更多志同道合的朋友？"))}," 如何结交更多志同道合的朋友？ "),i("p",{onClick:a[62]||(a[62]=e=>h("我该如何维系重要的友谊？"))},"我该如何维系重要的友谊？"),i("p",{onClick:a[63]||(a[63]=e=>h("我该信任我身边的朋友吗？"))},"我该信任我身边的朋友吗？"),i("p",{onClick:a[64]||(a[64]=e=>h("如何获得领导或长辈的赏识？"))}," 如何获得领导或长辈的赏识？ ")]),a[100]||(a[100]=i("h4",{class:"category-heading"},"家庭关系",-1)),i("div",Z,[i("p",{onClick:a[65]||(a[65]=e=>h("我和家人的关系怎么样？"))},"我和家人的关系怎么样？"),i("p",{onClick:a[66]||(a[66]=e=>h("我的家庭对我有什么样的影响？"))}," 我的家庭对我有什么样的影响？ "),i("p",{onClick:a[67]||(a[67]=e=>h("如何改善我与家人的关系？"))},"如何改善我与家人的关系？"),i("p",{onClick:a[68]||(a[68]=e=>h("我该如何处理家庭矛盾？"))},"我该如何处理家庭矛盾？"),i("p",{onClick:a[69]||(a[69]=e=>h("我与家人的缘分有多深？"))},"我与家人的缘分有多深？"),i("p",{onClick:a[70]||(a[70]=e=>h("如何更好地与家人沟通？"))},"如何更好地与家人沟通？")])],2),i("div",{id:"rensheng",class:u(["tab-pane",{active:"rensheng"===k.value}])},[a[101]||(a[101]=i("h4",{class:"category-heading"},"学业规划",-1)),i("div",ee,[i("p",{onClick:a[71]||(a[71]=e=>h("我的学业运势如何？"))},"我的学业运势如何？"),i("p",{onClick:a[72]||(a[72]=e=>h("我适合考研/考公吗？"))},"我适合考研/考公吗？"),i("p",{onClick:a[73]||(a[73]=e=>h("我适合继续深造还是工作？"))},"我适合继续深造还是工作？"),i("p",{onClick:a[74]||(a[74]=e=>h("如何提升我的学习效率？"))},"如何提升我的学习效率？"),i("p",{onClick:a[75]||(a[75]=e=>h("我该选择哪个专业/学校？"))},"我该选择哪个专业/学校？"),i("p",{onClick:a[76]||(a[76]=e=>h("我这次考试能通过吗？"))},"我这次考试能通过吗？")]),a[102]||(a[102]=i("h4",{class:"category-heading"},"个人成长",-1)),i("div",ae,[i("p",{onClick:a[77]||(a[77]=e=>h("我的性格优势和劣势是什么？"))}," 我的性格优势和劣势是什么？ "),i("p",{onClick:a[78]||(a[78]=e=>h("我的人生主要课题是什么？"))},"我的人生主要课题是什么？"),i("p",{onClick:a[79]||(a[79]=e=>h("如何找到我的人生方向？"))},"如何找到我的人生方向？"),i("p",{onClick:a[80]||(a[80]=e=>h("如何克服我性格中的弱点？"))},"如何克服我性格中的弱点？"),i("p",{onClick:a[81]||(a[81]=e=>h("如何有效提升自己的能量状态？"))}," 如何有效提升自己的能量状态？ "),i("p",{onClick:a[82]||(a[82]=e=>h("我的人生转折点在何时？"))},"我的人生转折点在何时？")]),a[103]||(a[103]=i("h4",{class:"category-heading"},"人生机遇",-1)),i("div",ne,[i("p",{onClick:a[83]||(a[83]=e=>h("我未来十年的人生大运怎么样？"))}," 我未来十年的人生大运怎么样？ "),i("p",{onClick:a[84]||(a[84]=e=>h("我该如何实现我的人生目标？"))}," 我该如何实现我的人生目标？ "),i("p",{onClick:a[85]||(a[85]=e=>h("我的人生会有什么重大机遇？"))}," 我的人生会有什么重大机遇？ "),i("p",{onClick:a[86]||(a[86]=e=>h("我应该注意哪些健康问题？"))},"我应该注意哪些健康问题？"),i("p",{onClick:a[87]||(a[87]=e=>h("如何才能活出更精彩的人生？"))}," 如何才能活出更精彩的人生？ "),i("p",{onClick:a[88]||(a[88]=e=>h("未来的人生之路走向如何？"))},"未来的人生之路走向如何？")])],2)]))}}),[["__scopeId","data-v-73cc7223"]]),ie={key:0,src:"/static/ssgw.jpg",alt:"三山国王",class:"card-image"},te={class:"card-title"},se={class:"card-description"},oe={key:1,class:"tarot-spread-selector"},ue={class:"spread-bubbles-container"},ce={class:"spread-bubbles"},re=["onClick"],ve={class:"bubble-icon"},pe={class:"bubble-text"},de={key:0,class:"all-spreads-dropdown"},ge={class:"dropdown-content"},me=["onClick"],ye={class:"item-icon"},ke={class:"item-content"},he={class:"item-title"},Ce={class:"item-description"},fe={class:"item-meta"},be={class:"item-count"},we={class:"input-container"},Te=["placeholder","disabled"],qe=["disabled"],Re={key:0},xe={key:1,class:"loading-text"},Ie={key:2,class:"ssgw-process"},_e={key:0,class:"shaking-animation"},$e={class:"shaking-text"},Le={class:"shaking-visual"},Ee={class:"sign-container"},Ae={key:1,class:"tossing-section"},He={class:"result-section"},Se={key:0,class:"result-section"},De=["innerHTML"],Ue={key:1,class:"bei-container"},Ne=["src","alt"],Ve={key:2,class:"button-wrapper"},je=["disabled"],Me=x(e({__name:"DivinationInput",props:{title:{},description:{},placeholder:{default:"请输入您的问题"},buttonText:{default:"询问赛博大师"},loadingText:{default:"AI思考中"},loading:{type:Boolean,default:!1},modelValue:{default:""},examples:{default:()=>[]},showInspiration:{type:Boolean,default:!0},hideAfterSubmit:{type:Boolean,default:!0},divinationType:{default:""}},emits:["update:modelValue","submit","typeChange","clear"],setup(e,{emit:w}){const T=e,q=w,x=v();b();const _=n(T.modelValue),$=n(Pe()),L=n("single"),E=n(!1),A=n(!1),H=n(""),S=n(0),D=n(!1),U=n(!1),N=n(0),V=n([]),j=n(""),M=n(0),F=n(!1),O=n(""),B=n(!1),P=n(0),z=n(),J=["single","three","love","career","decision","celtic","chakra","year"],G=a(()=>{if(0===P.value)return 4;const e=P.value<=480,a=P.value<=768;let n=95,l=75,i=6,t=10;e?(n=75,l=60,i=4,t=8):a&&(n=85,l=65,i=5,t=8);const s=P.value;if(s<n)return 1;if(J.length*n+(J.length-1)*i<=s)return J.length;const o=s-l-i-t;let u=1,c=n;for(let v=1;v<J.length;v++){const e=c+i+n;if(!(e<=o))break;u=v+1,c=e}const r=Math.min(2,J.length);return Math.max(r,u)}),K=a(()=>{const e=G.value,a=J.indexOf(L.value);return e>=J.length?J:a<e?J.slice(0,e):[...J.slice(0,e-1),L.value]}),Q=a(()=>G.value<J.length);function W(e){L.value=e,q("typeChange",`tarot_${e}`),_.value=""}function Y(){B.value=!B.value}function X(){B.value=!1}function Z(e){return{single:"🔮",three:"🃏",love:"💕",career:"💼",decision:"⚖️",celtic:"✨",chakra:"🧘",year:"📅"}[e]||"🎴"}function ee(){if(z.value){const e=z.value.getBoundingClientRect();P.value=e.width}}function ae(e){z.value&&!z.value.contains(e.target)&&X()}const ne=a(()=>"ssgw"===T.divinationType?"可输入您的问题，也可直接求签":T.placeholder),Me=a(()=>"ssgw"!==T.divinationType&&!x.path.includes("/divination/ssgw")&&T.showInspiration),Fe=a(()=>x.path.includes("/divination/tarot")),Oe=a(()=>{if(Fe.value){const e=R[L.value];return e?`塔罗牌·${e.name}`:T.title}return T.title}),Be=a(()=>{if(Fe.value){const e=R[L.value];return e?e.description:T.description}return T.description});function Pe(){const e=x.path;return e.includes("/divination/tarot_single")?"tarot_single":(e.includes("/divination/tarot"),"tarot")}function ze(){_.value="",E.value=!1}function Je(){if("ssgw"===T.divinationType||x.path.includes("/ssgw")){const e=_.value.trim()||"心中所想之事";return E.value=!0,q("clear"),void Ge(e)}_.value.trim()&&!T.loading&&(E.value=!0,q("submit",{question:_.value.trim()}))}function Ge(e){O.value=e,A.value=!0,H.value="请静心默念，准备摇签...",S.value=0,setTimeout(()=>{H.value="正在摇签中...";const e=setInterval(()=>{S.value++,S.value>=5&&(clearInterval(e),setTimeout(()=>{N.value=Math.floor(61*Math.random())+1,A.value=!1,U.value=!0,M.value=0,F.value=!1,V.value=[],j.value=""},1e3))},400)},2e3)}function Ke(){if(D.value)return;D.value=!0,V.value=[],j.value="";const e=I();setTimeout(()=>{V.value=[e.bei1,e.bei2];const a=e.result;"圣杯"===a&&(F.value=!0),"圣杯"===a?(j.value="<strong>圣杯</strong> (一平一凸) - 神明同意此签。",setTimeout(()=>{j.value+="<p>正在为您解读签文...</p>",setTimeout(()=>{q("submit",{question:O.value,signNumber:N.value})},2e3)},1e3)):(M.value++,j.value="笑杯"===a?"<strong>笑杯</strong> (两平) - 神明笑而不语，可能问题不明或时机未到。":"<strong>阴杯</strong> (两凸) - 神明不同意此签。",M.value>=3?(j.value+="<p>您已连续三次未能获得圣杯，看来今日不宜再问此事，请改日再来。</p>",D.value=!1):(j.value+="<p>请重新为您摇签...</p>",setTimeout(()=>{U.value=!1,V.value=[],j.value="",Ge(O.value)},2e3))),D.value=!1},1300)}function Qe(e){if(T.loading)return;_.value=e;const a=document.getElementById("userInput");a&&a.focus()}function We(e){T.loading||e&&e.trim()&&(_.value=e,E.value=!0,q("submit",{question:e}))}return p(()=>T.modelValue,e=>{_.value=e}),p(_,e=>{q("update:modelValue",e)}),p(()=>T.divinationType,(e,a)=>{a&&e!==a&&ze()}),p(()=>x.path,()=>{Fe.value&&($.value=Pe()),ze()}),d(()=>{setTimeout(()=>{ee()},100),window.addEventListener("resize",ee),document.addEventListener("click",ae),Fe.value&&q("typeChange",`tarot_${L.value}`)}),g(()=>{window.removeEventListener("resize",ee),document.removeEventListener("click",ae)}),(e,a)=>(r(),l(s,null,[i("div",{class:u(["input-card",{loading:e.loading}])},["ssgw"===e.divinationType?(r(),l("img",ie)):t("",!0),i("h2",te,c(Oe.value),1),i("p",se,c(Be.value),1),Fe.value?(r(),l("div",oe,[i("div",ue,[i("div",ce,[(r(!0),l(s,null,o(K.value,e=>(r(),l("button",{key:e,class:u(["spread-bubble",{active:L.value===e}]),onClick:a=>W(e)},[i("span",ve,c(Z(e)),1),i("span",pe,c(y(R)[e].name),1)],10,re))),128)),Q.value?(r(),l("button",{key:0,class:"spread-bubble expand-button",onClick:Y},[...a[1]||(a[1]=[i("span",{class:"bubble-icon"},"⋯",-1),i("span",{class:"bubble-text"},"全部",-1)])])):t("",!0)])]),B.value?(r(),l("div",de,[i("div",ge,[(r(),l(s,null,o(J,e=>i("div",{key:e,class:u(["spread-item",{active:L.value===e}]),onClick:a=>function(e){W(e),X()}(e)},[i("div",ye,c(Z(e)),1),i("div",ke,[i("div",he,c(y(R)[e].name),1),i("div",Ce,c(y(R)[e].description),1)]),i("div",fe,[i("span",be,c(y(R)[e].cardCount)+"张",1)])],10,me)),64))])])):t("",!0)])):t("",!0),i("div",we,[k(i("input",{id:"userInput","onUpdate:modelValue":a[0]||(a[0]=e=>_.value=e),type:"text",placeholder:ne.value,disabled:e.loading,class:"question-input",onKeyup:C(Je,["enter"])},null,40,Te),[[h,_.value]]),a[2]||(a[2]=i("div",{class:"input-focus-border"},null,-1))]),i("div",{class:u(["button-wrapper",{"ai-thinking":e.loading}])},[i("button",{id:"submitButton",disabled:e.loading||"ssgw"!==e.divinationType&&!_.value.trim(),class:"submit-button",onClick:Je},[e.loading?(r(),l("span",xe,[f(c(e.loadingText)+" ",1),a[3]||(a[3]=i("span",{class:"loading-dots"},[i("span",{class:"dot"}),i("span",{class:"dot"}),i("span",{class:"dot"})],-1))])):(r(),l("span",Re,c(e.buttonText),1))],8,qe)],2),"ssgw"===e.divinationType&&(A.value||D.value||U.value)?(r(),l("div",Ie,[A.value?(r(),l("div",_e,[i("p",$e,c(H.value),1),i("div",Le,[i("div",Ee,[(r(),l(s,null,o(5,e=>i("div",{key:e,class:u(["sign-stick",{active:e<=S.value}])},null,2)),64))])])])):t("",!0),D.value||U.value?(r(),l("div",Ae,[i("div",He,[i("p",null,[a[4]||(a[4]=f(" 求得第 ",-1)),i("strong",null,c(N.value),1),a[5]||(a[5]=f(" 签。 ",-1))]),a[6]||(a[6]=i("p",null,"请投掷圣杯，询问三山国王是否同意此签...",-1))]),j.value?(r(),l("div",Se,[i("p",{innerHTML:j.value},null,8,De)])):t("",!0),V.value.length>0?(r(),l("div",Ue,[(r(!0),l(s,null,o(V.value,(e,a)=>(r(),l("img",{key:a,src:`/static/${e}.png`,alt:e,class:"bei-image"},null,8,Ne))),128))])):t("",!0),!F.value&&M.value<3?(r(),l("div",Ve,[i("button",{disabled:D.value,class:"toss-button",onClick:Ke},c(D.value?"投掷中...":"投掷圣杯"),9,je)])):t("",!0)])):t("",!0)])):t("",!0)],2),Me.value?(r(),m(le,{key:0,"spread-type":Fe.value?L.value:null,onSelect:Qe,onSubmit:We},null,8,["spread-type"])):t("",!0)],64))}}),[["__scopeId","data-v-0a21983b"]]),Fe=new Map,Oe=new Map;function Be(e){if(e.size>50){const a=e.keys().next().value;void 0!==a&&e.delete(a)}}function Pe(e){const l=v(),i=b(),t=a(()=>e.divinationType),s=n(""),o=n(!1),u=n(null),c=n(""),r=n(null),p=n(!1),d=n(!1),g=n(!1),m=n(null),y=n(!1),k=n([]),h=n(""),C=n(!1),f=a(()=>null!==u.value),w=a(()=>""!==c.value);function T(e){d.value=!0;const a=L.getRecord(e);if(a){s.value=a.question;const e=JSON.parse(JSON.stringify(a.result));u.value=e,c.value=a.result.aiResponse||"",a.conversationHistory&&a.conversationHistory.length>0?k.value=a.conversationHistory.map(e=>{var a;return{...e,content:"string"==typeof e.content?e.content:(null==(a=e.content)?void 0:a.value)||e.content}}):k.value=[{id:`hist-sys-${a.id}`,role:"system",content:"你是精通周易、梅花易数、奇门遁甲、塔罗牌等术数的AI助手。请根据占卜结果，为用户提供解读。"},{id:`hist-user-${a.id}`,role:"user",content:a.question},{id:`hist-asst-${a.id}`,role:"assistant",content:a.result.aiResponse||""}]}else i.push(`/divination/${t.value}`)}const q=function(e,a){let n;return(...l)=>{clearTimeout(n),n=setTimeout(()=>e(...l),a)}}(()=>{if(!c.value)return;const e=function(e){if(!e)return"";const a=`strip_${e.length}_${e.slice(0,50)}`;if(Oe.has(a))return Oe.get(a);const n=D.parse(e),l=((new DOMParser).parseFromString(n,"text/html").body.textContent||"").replace(/"/g,'"').replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/'/g,"'").replace(/\n{3,}/g,"\n\n").trim();return Oe.set(a,l),Be(Oe),l}(c.value);navigator.clipboard.writeText(e).then(()=>{g.value=!0,setTimeout(()=>{g.value=!1},2e3)})},300);function R(){if(u.value&&"id"in u.value&&u.value.id)try{const e=L.getRecords(),a=e.findIndex(e=>{var a;return"id"in e.result&&e.result.id===(null==(a=u.value)?void 0:a.id)});if(-1!==a){const n=k.value.map(e=>({...e,content:e.content}));e[a].conversationHistory=n,localStorage.setItem("sydf-history",JSON.stringify(e))}}catch(e){}}return{question:s,isLoading:o,result:u,aiResponse:c,error:r,isAiLoading:p,viewingHistory:d,isCopied:g,isCancelled:y,conversationHistory:k,followUpQuestion:h,isFollowUpLoading:C,hasResult:f,hasAiResponse:w,startDivination:async function(e={}){if(d.value)return;const{signNumber:a,spreadType:n}=e;if(!o.value&&s.value.trim()){o.value=!0,p.value=!0,r.value=null,u.value=null,c.value="",y.value=!1,m.value=new AbortController,k.value=[];try{const e={role:"system",content:"你是精通周易、梅花易数、奇门遁甲、塔罗牌等术数的AI助手。请根据占卜结果，为用户提供解读。"},l={id:`msg-${Date.now()}`,role:"user",content:s.value},i={id:`msg-${Date.now()+1}`,role:"assistant",content:""};k.value=[e,l,i],u.value={id:crypto.randomUUID(),type:t.value,data:{originalName:"",ganzhi:{year:"",month:"",day:"",hour:""},timestamp:Date.now()},aiResponse:""},o.value=!1,$({type:t.value,question:s.value.trim(),...void 0!==a?{signNumber:a}:{},...void 0!==n?{spreadType:n}:{},signal:m.value.signal},e=>{c.value+=e,i.content+=e},e=>{r.value=e,i.content=e},e=>{p.value=!1,u.value&&e.id&&(u.value.id=e.id,u.value.data=e.data,c.value&&(u.value.aiResponse=c.value),R())}).then(e=>{u.value&&e.id&&(u.value.id=e.id,u.value.data=e.data)}).catch(e=>{r.value=e instanceof Error?e.message:"占卜失败，请稍后重试",o.value=!1,p.value=!1})}catch(l){r.value=l instanceof Error?l.message:"占卜失败，请稍后重试",o.value=!1}}},clearResult:function(){u.value=null,c.value="",r.value=null,s.value="",d.value=!1,k.value=[],h.value=""},loadResultFromHistory:T,regenerateAI:async function(){if(!u.value||p.value)return;p.value=!0,r.value=null,c.value="",y.value=!1,m.value=new AbortController;const e={id:`msg-${Date.now()}`,role:"assistant",content:""};k.value.push(e);try{if("qimen"===t.value&&u.value.data){const a=await $({type:t.value,question:s.value,signal:m.value.signal},a=>{c.value+=a,e.content+=a},a=>{r.value=a,e.content=a},()=>{p.value=!1,u.value&&c.value&&(u.value.aiResponse=c.value)});if(a.aiResponse){const n=a.aiResponse||"";e.content=n;const l=`ai_${s.value}_${t.value}`;Fe.set(l,n),Be(Fe)}u.value&&a.aiResponse&&(u.value.aiResponse=a.aiResponse)}else{const a=await $({type:t.value,question:s.value,signal:m.value.signal},a=>{c.value+=a,e.content+=a},a=>{r.value=a,e.content=a},()=>{p.value=!1,u.value&&c.value&&(u.value.aiResponse=c.value)});if(a.aiResponse){const n=a.aiResponse||"";e.content=n;const l=`ai_${s.value}_${t.value}`;Fe.set(l,n),Be(Fe)}u.value&&a.aiResponse&&(u.value.aiResponse=a.aiResponse)}}catch(a){r.value="重新生成失败，请稍后重试"}},handleHistoryParam:function(){const e=l.query.historyId;e&&T(e)},clearHistoryParam:function(){if(l.query.historyId){const e={...l.query};delete e.historyId,i.replace({path:l.path,query:e})}},shareResult:function(){q()},cancelGeneration:function(){m.value&&(m.value.abort(),y.value=!0,p.value=!1)},handleSendFollowUp:function(){if(!h.value.trim()||C.value)return;const e={id:`msg-${Date.now()}`,role:"user",content:h.value.trim()};k.value.push(e);const a={id:`msg-${Date.now()+1}`,role:"assistant",content:""};k.value.push(a),h.value="",C.value=!0;const n=`基于以下占卜结果和用户问题，请回答用户的追问：\n\n用户原始问题：${s.value}\n\n占卜结果：${c.value}\n\n用户追问：${e.content}\n\n请直接回答用户的追问，不要重复之前的内容。`;_(n,e=>{c.value+=e,a.content+=e},e=>{C.value=!1,u.value&&e&&(u.value.aiResponse=e,R())},e=>{C.value=!1,a.content=e})}}}const ze={key:1,class:"result-header-actions"},Je={key:3,class:"ai-actions"},Ge={key:4,class:"content-card error-card"},Ke={class:"content-text"},Qe={key:5,class:"content-card follow-up-card"},We={class:"follow-up-input"},Ye=["disabled"],Xe=["disabled"],Ze={key:0},ea={key:1},aa=x(e({__name:"UnifiedDivinationView",props:{divinationType:{}},setup(e){const s=e,o=v(),u=a(()=>E(s.divinationType)),{question:g,isLoading:f,result:b,aiResponse:q,error:R,isAiLoading:x,hasResult:I,hasAiResponse:_,viewingHistory:$,isCopied:L,isCancelled:D,startDivination:U,clearResult:N,shareResult:V,regenerateAI:j,handleHistoryParam:M,clearHistoryParam:F,cancelGeneration:O,conversationHistory:B,followUpQuestion:P,isFollowUpLoading:z,handleSendFollowUp:J}=Pe(s),G=a(()=>b.value?{data:b.value.data,aiResponse:q.value}:{data:{},aiResponse:""}),K=n("single");function Q(e){if(e.startsWith("tarot_")){const a=e.replace("tarot_","");K.value=a}}function W(e){e.question&&(g.value=e.question);const a={};"tarot"===s.divinationType?a.spreadType=K.value:"ssgw"===s.divinationType&&void 0!==e.signNumber&&(a.signNumber=e.signNumber),U(a)}function Y(){N(),F()}function X(){R.value=null}function Z(){j()}return p(()=>s.divinationType,(e,a)=>{!$.value&&a&&e!==a&&(N(),F(),g.value="",P.value="",B.value=[],R.value=null,D.value=!1,window.scrollTo(0,0),requestAnimationFrame(()=>{document.querySelectorAll(".page-container, .sidebar, main, .app-container, .main-wrapper, .content-wrapper, .main-content, .input-card, .inspiration-card, .questions-wrapper, .result-header-actions, .ai-actions, .follow-up-card, .error-card").forEach(e=>{e instanceof HTMLElement&&(e.scrollTop=0,e.scrollLeft=0)}),document.documentElement.scrollTop=0,document.body.scrollTop=0,document.documentElement.scrollLeft=0,document.body.scrollLeft=0,requestAnimationFrame(()=>{window.scrollTo(0,0),document.documentElement.scrollTop=0,document.body.scrollTop=0})}),A.emit(H.HISTORY_SELECTION_RESET))},{immediate:!1}),p(u,()=>{}),p(()=>o.query.historyId,(e,a)=>{e&&"string"==typeof e?M():a&&!e&&N()},{immediate:!0}),d(()=>{M()}),(e,a)=>{var n,s,v,p,d;return r(),l("div",{class:"page-container",key:e.divinationType},[y(I)||y(f)?t("",!0):(r(),m(Me,{key:0,modelValue:y(g),"onUpdate:modelValue":a[0]||(a[0]=e=>w(g)?g.value=e:null),title:(null==(n=u.value)?void 0:n.title)||"",description:(null==(s=u.value)?void 0:s.description)||"","button-text":(null==(v=u.value)?void 0:v.buttonText)||"开始占卜",loading:y(f),placeholder:(null==(p=u.value)?void 0:p.placeholder)||"",examples:(null==(d=u.value)?void 0:d.examples)||[],"divination-type":e.divinationType,"hide-after-submit":!1,onSubmit:W,onTypeChange:Q,onClear:y(N)},null,8,["modelValue","title","description","button-text","loading","placeholder","examples","divination-type","onClear"])),y(I)&&!y(o).query.historyId?(r(),l("div",ze,[i("button",{class:"btn-secondary",onClick:Y},"← 返回"),y(_)&&!y(x)?(r(),l("button",{key:0,class:"btn-secondary",onClick:a[1]||(a[1]=(...e)=>y(V)&&y(V)(...e))},c(y(L)?"已复制!":"分享"),1)):t("",!0)])):t("",!0),y(I)?(r(),m(S,{key:2,type:e.divinationType,result:G.value,"is-ai-loading":y(x)||y(z),error:y(R),question:y(g),"conversation-history":y(B),"is-follow-up-loading":y(z),onRetry:Z},null,8,["type","result","is-ai-loading","error","question","conversation-history","is-follow-up-loading"])):t("",!0),y(I)?(r(),l("div",Je,[y(x)?(r(),l("button",{key:0,class:"btn-secondary",onClick:a[2]||(a[2]=(...e)=>y(O)&&y(O)(...e))},"取消生成")):t("",!0),y(x)||!y(R)&&!y(D)?t("",!0):(r(),l("button",{key:1,class:"btn-primary",onClick:Z}," 重新生成 "))])):t("",!0),y(R)&&!y(I)?(r(),l("div",Ge,[i("p",Ke,c(y(R)),1),i("div",{class:"form-actions"},[i("button",{class:"btn-primary",onClick:X},"重试")])])):t("",!0),y(_)&&!y(x)?(r(),l("div",Qe,[i("div",We,[k(i("textarea",{"onUpdate:modelValue":a[3]||(a[3]=e=>w(P)?P.value=e:null),placeholder:"对AI的解读进行追问...",disabled:y(z),onKeydown:a[4]||(a[4]=C(T((...e)=>y(J)&&y(J)(...e),["prevent"]),["enter"]))},null,40,Ye),[[h,y(P)]]),i("button",{disabled:y(z),onClick:a[5]||(a[5]=(...e)=>y(J)&&y(J)(...e))},[y(z)?(r(),l("span",ea,"发送中...")):(r(),l("span",Ze,"发送"))],8,Xe)])])):t("",!0)])}}}),[["__scopeId","data-v-6550973d"]]);export{aa as default};
