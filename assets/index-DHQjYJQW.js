const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./views-D0O5DlyN.js","./vendor-DHUK-ldg.js","./views-BNS3YjoV.css"])))=>i.map(i=>d[i]);
import{a as se,r as m,c as ue,w as B,h as he,i as te,b as r,n as k,u as n,e as t,t as L,F as G,g as X,f as b,m as pe,p as Ve,D as ve,J as ze,j as ye,x as Be,o as a,E as me,L as Ne,l as fe,k as We,K as Ye,M as Ue,N as Fe,O as je,P as Ke}from"./vendor-DHUK-ldg.js";import{h as O,e as Z,E as ee,d as oe,_ as ge,a as S,i as Qe}from"./views-D0O5DlyN.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))u(p);new MutationObserver(p=>{for(const c of p)if(c.type==="childList")for(const y of c.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&u(y)}).observe(document,{childList:!0,subtree:!0});function l(p){const c={};return p.integrity&&(c.integrity=p.integrity),p.referrerPolicy&&(c.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?c.credentials="include":p.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function u(p){if(p.ep)return;p.ep=!0;const c=l(p);fetch(p.href,c)}})();const Je=""+new URL("../static/favicon.png",import.meta.url).href,Ge={class:"sidebar-header"},Xe={class:"logo-section"},Ze=["title"],et={class:"theme-icon-compact"},tt={class:"sidebar-nav"},ot={class:"nav-section"},st={class:"nav-list"},nt={class:"nav-item"},it=["onClick"],lt={class:"nav-icon"},at={class:"nav-text"},rt={class:"history-section"},ct={class:"section-header"},dt={key:0,class:"action-dropdown"},ut={class:"history-controls"},pt=["value"],vt={class:"history-list"},mt={key:0,class:"empty-history"},ft={key:1},ht=["data-record-id","onClick","onMouseenter","onTouchstart"],yt=["onClick"],gt={key:0,class:"checkbox-checked"},_t={class:"history-icon"},wt={key:0},bt={key:1},kt={key:2},xt={key:3},Ct={key:4},Rt={key:5},Et={class:"history-content"},Lt={class:"history-title"},St=["onClick"],$t={key:0,class:"record-action-dropdown"},Tt=["onClick"],Mt=["onClick"],Pt=["onClick"],It={key:2,class:"load-more-container"},Dt={key:3,class:"selection-actions"},Ot={class:"selection-info"},Ht={class:"selection-buttons"},At=["disabled"],qt={class:"sidebar-footer"},Vt={class:"footer-list"},zt={class:"footer-item"},Bt={class:"footer-item"},Nt={class:"footer-item"},Wt=se({__name:"Sidebar",props:{isCollapsed:{type:Boolean}},setup(i,{expose:h}){const l=i,u=m([]),p=m(0),c=m(null),y=m(""),x=m(""),g=m(!1),v=m(!1),f=m(new Set),P=m(null),w=m(null),C=m(!0),ie=m(!1),_=ye(),N=Be(),W=m(null),R=m("auto"),le=ue(()=>{switch(R.value){case"auto":return{icon:"🌓",text:"自动切换"};case"light":return{icon:"☀️",text:"亮色模式"};case"dark":return{icon:"🌙",text:"暗色模式"};default:return{icon:"🌓",text:"自动切换"}}}),we=m(1),H=m(0),Y=m(!1),A=ue(()=>{p.value;let o=O.getRecords();return y.value&&(o=o.filter(e=>e.question.toLowerCase().includes(y.value.toLowerCase()))),x.value&&(o=o.filter(e=>e.type===x.value)),o});function be(){return window.innerWidth<=768?8:20}function $(o=!0){const e=A.value;H.value=e.length;const s=be();if(o)we.value=1,u.value=e.slice(0,s);else{const d=u.value.length,K=e.slice(d,d+s);u.value.push(...K)}Y.value=u.value.length<H.value,console.log(`加载历史记录 (${window.innerWidth<=768?"移动端":"电脑端"}):`,u.value.length,"/",H.value,"条记录")}function ke(){Y.value&&$(!1)}function xe(o){o.stopPropagation(),g.value=!g.value}function Ce(o){o.stopPropagation(),confirm("确定要清空所有历史记录吗？此操作不可撤销。")&&(O.clearRecords(),u.value=[],g.value=!1)}function q(){const o=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${o}px`)}function U(){const o=C.value,e=window.innerWidth<=768;C.value=e,q(),o!==e&&(console.log(`设备类型变化: ${o?"移动端":"电脑端"} -> ${e?"移动端":"电脑端"}`),$(!0))}B(A,()=>{$(!0)},{deep:!0}),B(()=>_.params.id,o=>{o&&typeof o=="string"?c.value=o:c.value=null});function Re(o){return`/divination/${o.type}?historyId=${o.id}`}function Ee(o){v.value?re(o.id):Le(o)}function Le(o){c.value=o.id;const e=Re(o);N.push(e)}function ae(){if(v.value=!v.value,v.value)c.value=null;else{f.value.clear();const o=_.query.historyId;c.value=o||null}g.value=!1}function re(o){f.value.has(o)?f.value.delete(o):f.value.add(o)}function Se(o){w.value===o?w.value=null:(w.value=o,Ne(()=>{$e(o)}))}function $e(o){const e=document.querySelector(`[data-record-id="${o}"] .record-action-dropdown`),s=document.querySelector(`[data-record-id="${o}"]`);if(!e||!s)return;const d=s.getBoundingClientRect(),K=140,z=120,Q=window.innerWidth,ce=window.innerHeight,T=ce-d.bottom,M=d.top,He=Q-d.right,Ae=d.left;if(console.log("菜单定位调试:",{recordId:o,rect:{left:d.left,right:d.right,top:d.top,bottom:d.bottom},viewport:{width:Q,height:ce},spaces:{left:Ae,right:He,above:M,below:T},isMobile:C.value}),e.style.top="",e.style.bottom="",e.style.left="",e.style.right="",e.style.transform="",C.value)e.style.right="0",e.style.left="auto",T>=z&&T>=M?(e.style.top="100%",e.style.bottom="auto",e.style.transform="translateY(4px)"):M>=z||M>T?(e.style.top="auto",e.style.bottom="100%",e.style.transform="translateY(-4px)"):(e.style.top="100%",e.style.bottom="auto",e.style.transform="translateY(4px)");else{const J=document.querySelector(".sidebar"),E=J==null?void 0:J.getBoundingClientRect(),de=d.left-((E==null?void 0:E.left)||0),qe=((E==null?void 0:E.right)||Q)-d.right;console.log("侧边栏空间计算:",{sidebarSpaceLeft:de,sidebarSpaceRight:qe,sidebarRect:E?{left:E.left,right:E.right}:null}),T>=z&&T>=M?(e.style.top="100%",e.style.bottom="auto",e.style.right="0",e.style.left="auto",e.style.transform="translateY(4px)"):M>=z?(e.style.top="auto",e.style.bottom="100%",e.style.right="0",e.style.left="auto",e.style.transform="translateY(-4px)"):de>=K?(e.style.top="50%",e.style.bottom="auto",e.style.right="100%",e.style.left="auto",e.style.transform="translate(-4px, -50%)"):M>T?(e.style.top="auto",e.style.bottom="100%",e.style.right="0",e.style.left="auto",e.style.transform="translateY(-4px)"):(e.style.top="100%",e.style.bottom="auto",e.style.right="0",e.style.left="auto",e.style.transform="translateY(4px)")}}function Te(o){console.log("置顶记录:",o),w.value=null}function Me(o){const e=u.value.find(s=>s.id===o);if(e){const s=prompt("请输入新的标签:",e.question);s&&s.trim()!==""&&(e.question=s.trim(),localStorage.setItem("sydf-history",JSON.stringify(O.getRecords())),$())}w.value=null}function Pe(o){confirm("确定要删除这条历史记录吗？此操作不可撤销。")&&(O.deleteRecord(o),$()),w.value=null}function Ie(){if(f.value.size===0)return;const o=f.value.size;confirm(`确定要删除选中的 ${o} 条历史记录吗？此操作不可撤销。`)&&(f.value.forEach(e=>{O.deleteRecord(e)}),f.value.clear(),$(),v.value=!1)}function I(o){console.log("导航到路径:",o,"当前路径:",_.path,"当前查询:",_.query),_.path===o&&Object.keys(_.query).length>0?(console.log("清除查询参数并导航"),N.replace({path:o,query:{}})):_.path!==o?(console.log("导航到新路径"),N.push(o)):console.log("已经在目标页面，无需导航")}function D(o){return _.query.historyId?!1:(_.name==="divination",_.path===o)}function F(){console.log("收到历史记录更新事件，刷新侧边栏"),p.value++}const V=o=>{const e=o.target;g.value&&W.value&&(W.value.contains(e)||(g.value=!1)),w.value&&(e.closest(".history-actions")||e.closest(".record-action-dropdown")||e.classList.contains("action-menu-btn")||(w.value=null,C.value&&(P.value=null)))};B(_,o=>{if(v.value)return;const e=o.query.historyId;e?c.value=e:c.value=null},{immediate:!0}),he(()=>{U(),q(),window.addEventListener("resize",U),window.addEventListener("orientationchange",q),$(),setTimeout(()=>{ie.value=!0},100),Oe(),Z.on(ee.HISTORY_UPDATED,F),document.addEventListener("click",V),document.addEventListener("touchstart",V)}),te(()=>{document.removeEventListener("click",V),document.removeEventListener("touchstart",V),Z.off(ee.HISTORY_UPDATED,F)});function De(){const o=["auto","light","dark"],s=(o.indexOf(R.value)+1)%o.length;R.value=o[s],j(),localStorage.setItem("theme",R.value)}function j(){const o=document.documentElement;R.value==="dark"?o.classList.add("dark"):R.value==="light"?o.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?o.classList.add("dark"):o.classList.remove("dark")}function Oe(){const o=localStorage.getItem("theme");o&&["auto","light","dark"].includes(o)?R.value=o:R.value="auto",j(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{R.value==="auto"&&j()})}return te(()=>{window.removeEventListener("resize",U),window.removeEventListener("orientationchange",q),Z.off(ee.HISTORY_UPDATED,F)}),h({}),(o,e)=>(a(),r("aside",{class:k(["sidebar",{"sidebar-collapsed":l.isCollapsed,"sidebar-initialized":n(ie)}])},[t("div",Ge,[t("div",Xe,[e[8]||(e[8]=t("span",{class:"logo-text"},"时月东方",-1)),e[9]||(e[9]=t("img",{src:Je,alt:"网站Logo",class:"website-logo"},null,-1)),t("div",{class:"theme-toggle-compact",title:n(le).text,onClick:De},[t("span",et,L(n(le).icon),1)],8,Ze)])]),t("nav",tt,[t("div",ot,[t("ul",st,[t("li",nt,[t("div",{class:k([{"nav-link-active":D("/")},"nav-link-content"]),onClick:e[0]||(e[0]=s=>I("/"))},e[10]||(e[10]=[t("span",{class:"nav-icon"},"🏠",-1),t("span",{class:"nav-text"},"首页",-1)]),2)]),(a(!0),r(G,null,X(n(oe),s=>(a(),r("li",{key:s.type,class:"nav-item"},[t("div",{class:k([{"nav-link-active":D(`/divination/${s.type}`)},"nav-link-content"]),onClick:d=>I(`/divination/${s.type}`)},[t("span",lt,L(s.icon),1),t("span",at,L(s.title),1)],10,it)]))),128))])])]),t("div",rt,[t("div",ct,[e[14]||(e[14]=t("div",{class:"header-left"},[t("h3",{class:"section-title"},"最近")],-1)),n(u).length>0?(a(),r("div",{key:0,ref_key:"menuRef",ref:W,class:"header-right"},[t("button",{class:"menu-btn",onClick:xe},e[11]||(e[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[t("circle",{cx:"2",cy:"8",r:"1.5"}),t("circle",{cx:"8",cy:"8",r:"1.5"}),t("circle",{cx:"14",cy:"8",r:"1.5"})],-1)])),n(g)?(a(),r("div",dt,[n(v)?b("",!0):(a(),r("div",{key:0,class:"dropdown-item",onClick:ae},e[12]||(e[12]=[t("span",{class:"dropdown-icon"},"☑️",-1),t("span",{class:"dropdown-text"},"选择删除",-1)]))),n(v)?b("",!0):(a(),r("div",{key:1,class:"dropdown-item",onClick:Ce},e[13]||(e[13]=[t("span",{class:"dropdown-icon"},"🗑️",-1),t("span",{class:"dropdown-text"},"清除所有对话",-1)])))])):b("",!0)],512)):b("",!0)]),t("div",ut,[pe(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>ve(y)?y.value=s:null),type:"text",placeholder:"搜索历史...",class:"search-input"},null,512),[[Ve,n(y)]]),pe(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>ve(x)?x.value=s:null),class:"type-select"},[e[15]||(e[15]=t("option",{value:""},"所有类型",-1)),(a(!0),r(G,null,X(n(oe),s=>(a(),r("option",{key:s.type,value:s.type},L(s.title),9,pt))),128))],512),[[ze,n(x)]])]),t("div",vt,[n(A).length===0?(a(),r("div",mt,e[16]||(e[16]=[t("p",null,"暂无匹配的历史记录",-1)]))):(a(),r("div",ft,[(a(!0),r(G,null,X(n(A),s=>(a(),r("div",{key:s.id,class:k(["history-item",{active:n(c)===s.id&&!n(v),selected:n(f).has(s.id),"has-active-menu":n(w)===s.id}]),"data-record-id":s.id,onClick:d=>Ee(s),onMouseenter:d=>!n(C)&&(P.value=s.id),onMouseleave:e[4]||(e[4]=d=>!n(C)&&(P.value=null)),onTouchstart:d=>n(C)&&(P.value=s.id)},[n(v)?(a(),r("div",{key:0,class:"select-checkbox",onClick:me(d=>re(s.id),["stop"])},[n(f).has(s.id)?(a(),r("span",gt,"✓")):b("",!0)],8,yt)):b("",!0),t("div",_t,[s.type==="liuyao"?(a(),r("span",wt,"☰")):s.type==="meihua"?(a(),r("span",bt,"🌸")):s.type==="qimen"?(a(),r("span",kt,"⚡")):s.type==="tarot"||s.type==="tarot_single"?(a(),r("span",xt,"🔮")):s.type==="ssgw"?(a(),r("span",Ct,"🏛️")):(a(),r("span",Rt,"📜"))]),t("div",Et,[t("div",Lt,L(s.question),1)]),(n(P)===s.id||n(C))&&!n(v)?(a(),r("div",{key:1,class:"history-actions",onClick:e[3]||(e[3]=me(()=>{},["stop"]))},[t("button",{class:k(["action-menu-btn",{active:n(w)===s.id}]),onClick:d=>Se(s.id)},e[17]||(e[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[t("circle",{cx:"2",cy:"8",r:"1.5"}),t("circle",{cx:"8",cy:"8",r:"1.5"}),t("circle",{cx:"14",cy:"8",r:"1.5"})],-1)]),10,St),n(w)===s.id?(a(),r("div",$t,[t("div",{class:"dropdown-item",onClick:d=>Te(s.id)},e[18]||(e[18]=[t("span",{class:"dropdown-icon"},"📌",-1),t("span",{class:"dropdown-text"},"置顶",-1)]),8,Tt),t("div",{class:"dropdown-item",onClick:d=>Me(s.id)},e[19]||(e[19]=[t("span",{class:"dropdown-icon"},"✏️",-1),t("span",{class:"dropdown-text"},"修改标签",-1)]),8,Mt),t("div",{class:"dropdown-item delete-item",onClick:d=>Pe(s.id)},e[20]||(e[20]=[t("span",{class:"dropdown-icon"},"🗑️",-1),t("span",{class:"dropdown-text"},"删除",-1)]),8,Pt)])):b("",!0)])):b("",!0)],42,ht))),128))])),n(Y)&&!n(v)?(a(),r("div",It,[t("button",{class:"load-more-btn",onClick:ke}," 加载更多 ("+L(n(u).length)+"/"+L(n(H))+") ",1)])):b("",!0),n(v)?(a(),r("div",Dt,[t("div",Ot,"已选择 "+L(n(f).size)+" 项",1),t("div",Ht,[t("button",{class:"selection-btn cancel-btn",onClick:ae},"取消选择"),t("button",{class:"selection-btn delete-selected-btn",disabled:n(f).size===0,onClick:Ie}," 删除选中 ("+L(n(f).size)+") ",9,At)])])):b("",!0)])]),t("div",qt,[t("ul",Vt,[t("li",zt,[t("div",{class:k([{"footer-link-active":D("/settings")},"footer-link"]),onClick:e[5]||(e[5]=s=>I("/settings"))},e[21]||(e[21]=[t("span",{class:"footer-text"},"配置 Key",-1)]),2)]),t("li",Bt,[t("div",{class:k([{"footer-link-active":D("/rengong")},"footer-link"]),onClick:e[6]||(e[6]=s=>I("/rengong"))},e[22]||(e[22]=[t("span",{class:"footer-text"},"转人工",-1)]),2)]),t("li",Nt,[t("div",{class:k([{"footer-link-active":D("/about")},"footer-link"]),onClick:e[7]||(e[7]=s=>I("/about"))},e[23]||(e[23]=[t("span",{class:"footer-text"},"关于本站",-1)]),2)])])])],2))}}),Yt=ge(Wt,[["__scopeId","data-v-87129d83"]]),Ut={class:"top-bar"},Ft={class:"top-bar-content"},jt=se({__name:"TopBar",props:{sidebarCollapsed:{type:Boolean}},emits:["toggle-sidebar"],setup(i){return(h,l)=>(a(),r("header",Ut,[t("div",Ft,[t("button",{class:k(["menu-toggle",{"menu-active":!h.sidebarCollapsed}]),onClick:l[0]||(l[0]=u=>h.$emit("toggle-sidebar"))},l[1]||(l[1]=[t("span",{class:"hamburger-line"},null,-1),t("span",{class:"hamburger-line"},null,-1),t("span",{class:"hamburger-line"},null,-1)]),2),l[2]||(l[2]=t("div",{class:"top-bar-title"},[t("h1",null,"时月东方")],-1)),l[3]||(l[3]=t("div",{class:"top-bar-actions"},null,-1))])]))}}),Kt=ge(jt,[["__scopeId","data-v-9cc50136"]]),Qt={class:"app-container"},Jt={class:"main-content"},Gt={class:"content-wrapper"},Xt=se({__name:"App",setup(i){const h=m(window.innerWidth<=768),l=m(window.innerWidth<=768),u=ye();function p(){l.value=!l.value}function c(){l.value=!0}function y(x){if(!h.value||l.value)return;const g=x.target,v=document.querySelector(".sidebar"),f=document.querySelector(".menu-toggle");v!=null&&v.contains(g)||f!=null&&f.contains(g)||c()}return B(()=>u==null?void 0:u.fullPath,(x,g)=>{h.value&&c()},{immediate:!1}),he(()=>{console.log("时月东方，启动！"),document.addEventListener("click",y)}),te(()=>{document.removeEventListener("click",y)}),(x,g)=>{const v=Ye("router-view");return a(),r("div",Qt,[fe(Yt,{"is-collapsed":l.value,ref:"sidebarRef"},null,8,["is-collapsed"]),t("div",{class:k(["main-wrapper",{"sidebar-collapsed":l.value}])},[fe(Kt,{"sidebar-collapsed":l.value,onToggleSidebar:p},null,8,["sidebar-collapsed"]),t("main",Jt,[t("div",Gt,[(a(),We(v,{key:n(u).path}))])])],2)])}}}),Zt=oe.map(i=>i.type),eo=[{path:"/divination/:type",name:"divination",component:()=>S(()=>import("./views-D0O5DlyN.js").then(i=>i.U),__vite__mapDeps([0,1,2]),import.meta.url),props:i=>({divinationType:i.params.type}),beforeEnter:(i,h,l)=>{Zt.includes(i.params.type)?l():l({name:"not-found"})}},{path:"/ssgw",redirect:"/divination/ssgw"}],to=[{path:"/history",name:"history",component:()=>S(()=>import("./views-D0O5DlyN.js").then(i=>i.H),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/history/:id",name:"history-detail",component:()=>S(()=>import("./views-D0O5DlyN.js").then(i=>i.H),__vite__mapDeps([0,1,2]),import.meta.url),props:i=>({showDetail:!0,selectedRecordId:i.params.id})}],oo=[{path:"/settings",name:"settings",component:()=>S(()=>import("./views-D0O5DlyN.js").then(i=>i.A),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/api-key",redirect:"/settings"},{path:"/api-config",redirect:"/settings"}],_e=Ue({history:Fe("./"),routes:[{path:"/",name:"home",component:()=>S(()=>import("./views-D0O5DlyN.js").then(i=>i.b),__vite__mapDeps([0,1,2]),import.meta.url)},...eo,...to,...oo,{path:"/rengong",name:"rengong",component:()=>S(()=>import("./views-D0O5DlyN.js").then(i=>i.R),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/about",name:"about",component:()=>S(()=>import("./views-D0O5DlyN.js").then(i=>i.c),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/:pathMatch(.*)*",name:"not-found",component:()=>S(()=>import("./views-D0O5DlyN.js").then(i=>i.N),__vite__mapDeps([0,1,2]),import.meta.url)}],scrollBehavior(i,h,l){return new Promise(u=>{setTimeout(()=>{if(l)return u(l);if(window.innerWidth<=768)u({top:0,left:0});else{const c=document.querySelector(".content-wrapper");c&&(c.scrollTop=0),u()}},100)})}});_e.beforeEach((i,h,l)=>{l()});const so=je();function no(i){i.use(so)}const ne=Ke(Xt);no(ne);Qe();ne.use(_e);ne.mount("#app");
