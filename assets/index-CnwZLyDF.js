const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./views-o6OAunx4.js","./vendor-C_iasj-i.js","./views-BqLlbUYT.css"])))=>i.map(i=>d[i]);
import{a as oe,r as v,c as ee,w as B,h as se,i as N,b as c,n as w,u as n,e as o,t as L,F as J,g as G,f as x,m as pe,p as Ve,D as ve,I as Be,j as ye,x as Ne,o as r,E as fe,K as Ye,l as me,k as Ue,J as We,L as Ke,M as je,N as Fe,O as Qe}from"./vendor-C_iasj-i.js";import{h as D,e as X,E as Z,d as te,_ as ge,a as S,i as Je}from"./views-o6OAunx4.js";(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))m(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const g of d.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&m(g)}).observe(document,{childList:!0,subtree:!0});function a(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function m(l){if(l.ep)return;l.ep=!0;const d=a(l);fetch(l.href,d)}})();const Ge=""+new URL("../static/favicon.png",import.meta.url).href,Xe={class:"sidebar-header"},Ze={class:"logo-section"},et=["title"],tt={class:"theme-icon-compact"},ot={class:"sidebar-nav"},st={class:"nav-section"},nt={class:"nav-list"},it={class:"nav-item"},lt=["onClick"],at={class:"nav-icon"},rt={class:"nav-text"},ct={class:"history-section"},ut={class:"section-header"},dt={key:0,class:"action-dropdown"},pt={class:"history-controls"},vt=["value"],ft={class:"history-list"},mt={key:0,class:"empty-history"},ht={key:1},yt=["data-record-id","onClick","onMouseenter","onTouchstart"],gt=["onClick"],_t={key:0,class:"checkbox-checked"},bt={class:"history-icon"},wt={key:0},kt={key:1},xt={key:2},Et={key:3},Rt={key:4},Ct={key:5},Lt={class:"history-content"},St={class:"history-title"},$t=["onClick"],It={key:0,class:"record-action-dropdown"},Tt=["onClick"],Mt=["onClick"],Pt=["onClick"],Ot={key:2,class:"load-more-container"},Dt={key:3,class:"selection-actions"},Ht={class:"selection-info"},At={class:"selection-buttons"},zt=["disabled"],qt={class:"sidebar-footer"},Vt={class:"footer-list"},Bt={class:"footer-item"},Nt={class:"footer-item"},Yt={class:"footer-item"},Ut=oe({__name:"Sidebar",setup(i,{expose:f}){const a=v(!0),m=v([]),l=v(null),d=v(""),g=v(""),k=v(!1),u=v(!1),h=v(new Set),b=v(null),y=v(null),E=v(!0),ie=v(!1),_=ye(),Y=Ne(),U=v(null),R=v("auto"),le=ee(()=>{switch(R.value){case"auto":return{icon:"🌓",text:"自动切换"};case"light":return{icon:"☀️",text:"亮色模式"};case"dark":return{icon:"🌙",text:"暗色模式"};default:return{icon:"🌓",text:"自动切换"}}}),be=v(1),H=v(0),A=v(!1),M=ee(()=>{let t=D.getRecords();return d.value&&(t=t.filter(e=>e.question.toLowerCase().includes(d.value.toLowerCase()))),g.value&&(t=t.filter(e=>e.type===g.value)),t});function ae(){return window.innerWidth<=768?8:20}function $(t=!0){const e=M.value;H.value=e.length;const s=ae();t&&(be.value=1,m.value=e.slice(0,s)),A.value=m.value.length<H.value,console.log(`加载历史记录 (${window.innerWidth<=768?"移动端":"电脑端"}):`,m.value.length,"/",H.value,"条记录")}function we(){if(A.value){const t=m.value.length,e=ae(),s=M.value.slice(t,t+e);m.value.push(...s),A.value=m.value.length<M.value.length}}function ke(t){t.stopPropagation(),k.value=!k.value}function xe(t){t.stopPropagation(),confirm("确定要清空所有历史记录吗？此操作不可撤销。")&&(D.clearRecords(),m.value=[],k.value=!1)}function z(){const t=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${t}px`)}function W(){const t=E.value,e=window.innerWidth<=768;E.value=e,e?a.value=!0:a.value=!1,z(),t!==e&&(console.log(`设备类型变化: ${t?"移动端":"电脑端"} -> ${e?"移动端":"电脑端"}`),$(!0))}function Ee(t){t!==void 0?a.value=t:a.value=!a.value}B([d,g],()=>{$(!0)},{deep:!0}),B(()=>_.params.id,t=>{t&&typeof t=="string"?l.value=t:l.value=null});function Re(t){return`/divination/${t.type}?historyId=${t.id}`}function Ce(t){u.value?ce(t.id):Le(t)}function Le(t){l.value=t.id;const e=Re(t);Y.push(e)}function re(){if(u.value=!u.value,u.value)l.value=null;else{h.value.clear();const t=_.query.historyId;l.value=t||null}k.value=!1}function ce(t){h.value.has(t)?h.value.delete(t):h.value.add(t)}function Se(t){y.value===t?y.value=null:(y.value=t,Ye(()=>{$e(t)}))}function $e(t){const e=document.querySelector(`[data-record-id="${t}"] .record-action-dropdown`),s=document.querySelector(`[data-record-id="${t}"]`);if(!e||!s)return;const p=s.getBoundingClientRect(),He=140,V=120,F=window.innerWidth,ue=window.innerHeight,I=ue-p.bottom,T=p.top,Ae=F-p.right,ze=p.left;if(console.log("菜单定位调试:",{recordId:t,rect:{left:p.left,right:p.right,top:p.top,bottom:p.bottom},viewport:{width:F,height:ue},spaces:{left:ze,right:Ae,above:T,below:I},isMobile:E.value}),e.style.top="",e.style.bottom="",e.style.left="",e.style.right="",e.style.transform="",E.value)e.style.right="0",e.style.left="auto",I>=V&&I>=T?(e.style.top="100%",e.style.bottom="auto",e.style.transform="translateY(4px)"):T>=V||T>I?(e.style.top="auto",e.style.bottom="100%",e.style.transform="translateY(-4px)"):(e.style.top="100%",e.style.bottom="auto",e.style.transform="translateY(4px)");else{const Q=document.querySelector(".sidebar"),C=Q==null?void 0:Q.getBoundingClientRect(),de=p.left-((C==null?void 0:C.left)||0),qe=((C==null?void 0:C.right)||F)-p.right;console.log("侧边栏空间计算:",{sidebarSpaceLeft:de,sidebarSpaceRight:qe,sidebarRect:C?{left:C.left,right:C.right}:null}),I>=V&&I>=T?(e.style.top="100%",e.style.bottom="auto",e.style.right="0",e.style.left="auto",e.style.transform="translateY(4px)"):T>=V?(e.style.top="auto",e.style.bottom="100%",e.style.right="0",e.style.left="auto",e.style.transform="translateY(-4px)"):de>=He?(e.style.top="50%",e.style.bottom="auto",e.style.right="100%",e.style.left="auto",e.style.transform="translate(-4px, -50%)"):T>I?(e.style.top="auto",e.style.bottom="100%",e.style.right="0",e.style.left="auto",e.style.transform="translateY(-4px)"):(e.style.top="100%",e.style.bottom="auto",e.style.right="0",e.style.left="auto",e.style.transform="translateY(4px)")}}function Ie(t){console.log("置顶记录:",t),y.value=null}function Te(t){const e=m.value.find(s=>s.id===t);if(e){const s=prompt("请输入新的标签:",e.question);s&&s.trim()!==""&&(e.question=s.trim(),localStorage.setItem("sydf-history",JSON.stringify(D.getRecords())),$())}y.value=null}function Me(t){confirm("确定要删除这条历史记录吗？此操作不可撤销。")&&(D.deleteRecord(t),$()),y.value=null}function Pe(){if(h.value.size===0)return;const t=h.value.size;confirm(`确定要删除选中的 ${t} 条历史记录吗？此操作不可撤销。`)&&(h.value.forEach(e=>{D.deleteRecord(e)}),h.value.clear(),$(),u.value=!1)}function P(t){console.log("导航到路径:",t,"当前路径:",_.path,"当前查询:",_.query),_.path===t&&Object.keys(_.query).length>0?(console.log("清除查询参数并导航"),Y.replace({path:t,query:{}})):_.path!==t?(console.log("导航到新路径"),Y.push(t)):console.log("已经在目标页面，无需导航")}function O(t){return _.query.historyId?!1:(_.name==="divination",_.path===t)}function K(){console.log("收到历史记录更新事件，刷新侧边栏"),$(!0)}const q=t=>{const e=t.target;k.value&&U.value&&(U.value.contains(e)||(k.value=!1)),y.value&&(e.closest(".history-actions")||e.closest(".record-action-dropdown")||e.classList.contains("action-menu-btn")||(y.value=null,E.value&&(b.value=null)))};B(_,t=>{if(u.value)return;const e=t.query.historyId;e?l.value=e:l.value=null},{immediate:!0}),se(()=>{W(),z(),window.addEventListener("resize",W),window.addEventListener("orientationchange",z),$(),setTimeout(()=>{ie.value=!0},100),De(),X.on(Z.HISTORY_UPDATED,K),document.addEventListener("click",q),document.addEventListener("touchstart",q)}),N(()=>{document.removeEventListener("click",q),document.removeEventListener("touchstart",q),X.off(Z.HISTORY_UPDATED,K)});function Oe(){const t=["auto","light","dark"],s=(t.indexOf(R.value)+1)%t.length;R.value=t[s],j(),localStorage.setItem("theme",R.value)}function j(){const t=document.documentElement;R.value==="dark"?t.classList.add("dark"):R.value==="light"?t.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?t.classList.add("dark"):t.classList.remove("dark")}function De(){const t=localStorage.getItem("theme");t&&["auto","light","dark"].includes(t)?R.value=t:R.value="auto",j(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{R.value==="auto"&&j()})}return N(()=>{window.removeEventListener("resize",W),window.removeEventListener("orientationchange",z),X.off(Z.HISTORY_UPDATED,K)}),f({toggleSidebar:Ee,isCollapsed:a}),(t,e)=>(r(),c("aside",{class:w(["sidebar",{"sidebar-collapsed":n(a),"sidebar-initialized":n(ie)}])},[o("div",Xe,[o("div",Ze,[e[8]||(e[8]=o("span",{class:"logo-text"},"时月东方",-1)),e[9]||(e[9]=o("img",{src:Ge,alt:"网站Logo",class:"website-logo"},null,-1)),o("div",{class:"theme-toggle-compact",title:n(le).text,onClick:Oe},[o("span",tt,L(n(le).icon),1)],8,et)])]),o("nav",ot,[o("div",st,[o("ul",nt,[o("li",it,[o("div",{class:w([{"nav-link-active":O("/")},"nav-link-content"]),onClick:e[0]||(e[0]=s=>P("/"))},e[10]||(e[10]=[o("span",{class:"nav-icon"},"🏠",-1),o("span",{class:"nav-text"},"首页",-1)]),2)]),(r(!0),c(J,null,G(n(te),s=>(r(),c("li",{key:s.type,class:"nav-item"},[o("div",{class:w([{"nav-link-active":O(`/divination/${s.type}`)},"nav-link-content"]),onClick:p=>P(`/divination/${s.type}`)},[o("span",at,L(s.icon),1),o("span",rt,L(s.title),1)],10,lt)]))),128))])])]),o("div",ct,[o("div",ut,[e[14]||(e[14]=o("div",{class:"header-left"},[o("h3",{class:"section-title"},"最近")],-1)),n(m).length>0?(r(),c("div",{key:0,ref_key:"menuRef",ref:U,class:"header-right"},[o("button",{class:"menu-btn",onClick:ke},e[11]||(e[11]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[o("circle",{cx:"2",cy:"8",r:"1.5"}),o("circle",{cx:"8",cy:"8",r:"1.5"}),o("circle",{cx:"14",cy:"8",r:"1.5"})],-1)])),n(k)?(r(),c("div",dt,[n(u)?x("",!0):(r(),c("div",{key:0,class:"dropdown-item",onClick:re},e[12]||(e[12]=[o("span",{class:"dropdown-icon"},"☑️",-1),o("span",{class:"dropdown-text"},"选择删除",-1)]))),n(u)?x("",!0):(r(),c("div",{key:1,class:"dropdown-item",onClick:xe},e[13]||(e[13]=[o("span",{class:"dropdown-icon"},"🗑️",-1),o("span",{class:"dropdown-text"},"清除所有对话",-1)])))])):x("",!0)],512)):x("",!0)]),o("div",pt,[pe(o("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>ve(d)?d.value=s:null),type:"text",placeholder:"搜索历史...",class:"search-input"},null,512),[[Ve,n(d)]]),pe(o("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>ve(g)?g.value=s:null),class:"type-select"},[e[15]||(e[15]=o("option",{value:""},"所有类型",-1)),(r(!0),c(J,null,G(n(te),s=>(r(),c("option",{key:s.type,value:s.type},L(s.title),9,vt))),128))],512),[[Be,n(g)]])]),o("div",ft,[n(M).length===0?(r(),c("div",mt,e[16]||(e[16]=[o("p",null,"暂无匹配的历史记录",-1)]))):(r(),c("div",ht,[(r(!0),c(J,null,G(n(M),s=>(r(),c("div",{key:s.id,class:w(["history-item",{active:n(l)===s.id&&!n(u),selected:n(h).has(s.id),"has-active-menu":n(y)===s.id}]),"data-record-id":s.id,onClick:p=>Ce(s),onMouseenter:p=>!n(E)&&(b.value=s.id),onMouseleave:e[4]||(e[4]=p=>!n(E)&&(b.value=null)),onTouchstart:p=>n(E)&&(b.value=s.id)},[n(u)?(r(),c("div",{key:0,class:"select-checkbox",onClick:fe(p=>ce(s.id),["stop"])},[n(h).has(s.id)?(r(),c("span",_t,"✓")):x("",!0)],8,gt)):x("",!0),o("div",bt,[s.type==="liuyao"?(r(),c("span",wt,"☰")):s.type==="meihua"?(r(),c("span",kt,"🌸")):s.type==="qimen"?(r(),c("span",xt,"⚡")):s.type==="tarot"||s.type==="tarot_single"?(r(),c("span",Et,"🔮")):s.type==="ssgw"?(r(),c("span",Rt,"🏛️")):(r(),c("span",Ct,"📜"))]),o("div",Lt,[o("div",St,L(s.question),1)]),(n(b)===s.id||n(E))&&!n(u)?(r(),c("div",{key:1,class:"history-actions",onClick:e[3]||(e[3]=fe(()=>{},["stop"]))},[o("button",{class:w(["action-menu-btn",{active:n(y)===s.id}]),onClick:p=>Se(s.id)},e[17]||(e[17]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[o("circle",{cx:"2",cy:"8",r:"1.5"}),o("circle",{cx:"8",cy:"8",r:"1.5"}),o("circle",{cx:"14",cy:"8",r:"1.5"})],-1)]),10,$t),n(y)===s.id?(r(),c("div",It,[o("div",{class:"dropdown-item",onClick:p=>Ie(s.id)},e[18]||(e[18]=[o("span",{class:"dropdown-icon"},"📌",-1),o("span",{class:"dropdown-text"},"置顶",-1)]),8,Tt),o("div",{class:"dropdown-item",onClick:p=>Te(s.id)},e[19]||(e[19]=[o("span",{class:"dropdown-icon"},"✏️",-1),o("span",{class:"dropdown-text"},"修改标签",-1)]),8,Mt),o("div",{class:"dropdown-item delete-item",onClick:p=>Me(s.id)},e[20]||(e[20]=[o("span",{class:"dropdown-icon"},"🗑️",-1),o("span",{class:"dropdown-text"},"删除",-1)]),8,Pt)])):x("",!0)])):x("",!0)],42,yt))),128))])),n(A)&&!n(u)?(r(),c("div",Ot,[o("button",{class:"load-more-btn",onClick:we}," 加载更多 ("+L(n(m).length)+"/"+L(n(H))+") ",1)])):x("",!0),n(u)?(r(),c("div",Dt,[o("div",Ht,"已选择 "+L(n(h).size)+" 项",1),o("div",At,[o("button",{class:"selection-btn cancel-btn",onClick:re},"取消选择"),o("button",{class:"selection-btn delete-selected-btn",disabled:n(h).size===0,onClick:Pe}," 删除选中 ("+L(n(h).size)+") ",9,zt)])])):x("",!0)])]),o("div",qt,[o("ul",Vt,[o("li",Bt,[o("div",{class:w([{"footer-link-active":O("/settings")},"footer-link"]),onClick:e[5]||(e[5]=s=>P("/settings"))},e[21]||(e[21]=[o("span",{class:"footer-text"},"配置 Key",-1)]),2)]),o("li",Nt,[o("div",{class:w([{"footer-link-active":O("/rengong")},"footer-link"]),onClick:e[6]||(e[6]=s=>P("/rengong"))},e[22]||(e[22]=[o("span",{class:"footer-text"},"转人工",-1)]),2)]),o("li",Yt,[o("div",{class:w([{"footer-link-active":O("/about")},"footer-link"]),onClick:e[7]||(e[7]=s=>P("/about"))},e[23]||(e[23]=[o("span",{class:"footer-text"},"关于本站",-1)]),2)])])])],2))}}),Wt=ge(Ut,[["__scopeId","data-v-ca495b35"]]),Kt={class:"top-bar"},jt={class:"top-bar-content"},Ft=oe({__name:"TopBar",props:{sidebarCollapsed:{type:Boolean}},emits:["toggle-sidebar"],setup(i){return(f,a)=>(r(),c("header",Kt,[o("div",jt,[o("button",{class:w(["menu-toggle",{"menu-active":!f.sidebarCollapsed}]),onClick:a[0]||(a[0]=m=>f.$emit("toggle-sidebar"))},a[1]||(a[1]=[o("span",{class:"hamburger-line"},null,-1),o("span",{class:"hamburger-line"},null,-1),o("span",{class:"hamburger-line"},null,-1)]),2),a[2]||(a[2]=o("div",{class:"top-bar-title"},[o("h1",null,"时月东方")],-1)),a[3]||(a[3]=o("div",{class:"top-bar-actions"},null,-1))])]))}}),Qt=ge(Ft,[["__scopeId","data-v-84bff781"]]),he=768;function Jt(){const i=v(window.innerWidth<=he);function f(){i.value=window.innerWidth<=he}return se(()=>{window.addEventListener("resize",f)}),N(()=>{window.removeEventListener("resize",f)}),{isMobile:i}}const Gt={class:"app-container"},Xt={class:"content-wrapper"},Zt=oe({__name:"App",setup(i){const f=v(),a=ye(),{isMobile:m}=Jt(),l=ee(()=>{var u;return((u=f.value)==null?void 0:u.isCollapsed)||!1});function d(){var u;(u=f.value)==null||u.toggleSidebar()}function g(){var u;(u=f.value)==null||u.toggleSidebar(!0)}function k(u){if(!m.value||l.value)return;const h=u.target,b=document.querySelector(".sidebar"),y=document.querySelector(".menu-toggle");b!=null&&b.contains(h)||y!=null&&y.contains(h)||g()}return B(()=>a==null?void 0:a.path,()=>{m.value&&g()},{immediate:!1}),se(()=>{console.log("时月东方，启动！"),document.addEventListener("click",k)}),N(()=>{document.removeEventListener("click",k)}),(u,h)=>{const b=We("router-view");return r(),c("div",Gt,[me(Wt,{ref_key:"sidebarRef",ref:f},null,512),me(Qt,{"sidebar-collapsed":l.value,class:w({"sidebar-collapsed":l.value}),onToggleSidebar:d},null,8,["sidebar-collapsed","class"]),o("main",{class:w(["main-content",{"sidebar-collapsed":l.value}])},[o("div",Xt,[(r(),Ue(b,{key:n(a).path}))])],2)])}}}),eo=te.map(i=>i.type),to=[{path:"/divination/:type",name:"divination",component:()=>S(()=>import("./views-o6OAunx4.js").then(i=>i.U),__vite__mapDeps([0,1,2]),import.meta.url),props:i=>({divinationType:i.params.type}),beforeEnter:(i,f,a)=>{eo.includes(i.params.type)?a():a({name:"not-found"})}},{path:"/ssgw",redirect:"/divination/ssgw"}],oo=[{path:"/history",name:"history",component:()=>S(()=>import("./views-o6OAunx4.js").then(i=>i.H),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/history/:id",name:"history-detail",component:()=>S(()=>import("./views-o6OAunx4.js").then(i=>i.H),__vite__mapDeps([0,1,2]),import.meta.url),props:i=>({showDetail:!0,selectedRecordId:i.params.id})}],so=[{path:"/settings",name:"settings",component:()=>S(()=>import("./views-o6OAunx4.js").then(i=>i.A),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/api-key",redirect:"/settings"},{path:"/api-config",redirect:"/settings"}],_e=Ke({history:je("./"),routes:[{path:"/",name:"home",component:()=>S(()=>import("./views-o6OAunx4.js").then(i=>i.b),__vite__mapDeps([0,1,2]),import.meta.url)},...to,...oo,...so,{path:"/rengong",name:"rengong",component:()=>S(()=>import("./views-o6OAunx4.js").then(i=>i.R),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/about",name:"about",component:()=>S(()=>import("./views-o6OAunx4.js").then(i=>i.c),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/:pathMatch(.*)*",name:"not-found",component:()=>S(()=>import("./views-o6OAunx4.js").then(i=>i.N),__vite__mapDeps([0,1,2]),import.meta.url)}]});_e.beforeEach((i,f,a)=>{a()});const no=Fe();function io(i){i.use(no)}const ne=Qe(Zt);io(ne);Je();ne.use(_e);ne.mount("#app");
