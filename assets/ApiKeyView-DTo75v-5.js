import{K as F,f as p,d as R,e as d,w as O,i as G,c as r,a as s,b as J,m as k,k as H,L as Q,n as E,v as B,N as W,F as X,r as Y,t as L,u as Z,o as v,_ as ee}from"./index-DjwX6woH.js";function te(){const l=F(),w=p(()=>l.settings.customApiKey),A=p(()=>l.settings.customApiEndpoint),y=p(()=>l.settings.useCustomApi),h=p(()=>l.settings.selectedModel),M=p(()=>l.settings.availableModels),S=p(()=>l.isLoadingModels),_=p(()=>l.error);function C(o){l.updateSettings({customApiKey:o})}function x(o){l.updateSettings({customApiEndpoint:o})}function K(o){l.updateSettings({useCustomApi:o})}function U(o){l.updateSettings({selectedModel:o})}async function V(o,n){return l.fetchAvailableModels(o||l.settings.customApiEndpoint,n||l.settings.customApiKey)}function $(){l.resetSettings()}return{customApiKey:w,customApiEndpoint:A,useCustomApi:y,selectedModel:h,availableModels:M,isLoadingModels:S,error:_,updateCustomApiKey:C,updateCustomApiEndpoint:x,updateUseCustomApi:K,updateSelectedModel:U,fetchAvailableModels:V,resetSettings:$}}const se={class:"api-key-view"},oe={class:"api-key-container"},ae={class:"form-section"},le={class:"form-group"},ne={class:"form-label"},ie=["disabled"],ue=["disabled"],de={class:"model-selection-wrapper"},re=["disabled"],ve=["value"],ce=["disabled"],pe={key:0},me={key:1},fe={class:"form-hint"},be={key:0,class:"error-text"},ge={key:1,class:"debug-text"},Ae={key:2},ye=R({__name:"ApiKeyView",setup(l){const w=Z(),{customApiKey:A,customApiEndpoint:y,useCustomApi:h,selectedModel:M,availableModels:S,isLoadingModels:_,error:C,updateCustomApiKey:x,updateCustomApiEndpoint:K,updateUseCustomApi:U,updateSelectedModel:V,resetSettings:$}=te(),o=d(A.value||""),n=d(y.value||""),i=d(h.value),u=d(M.value||""),I=d([...S.value]),m=d(_.value),c=d(C.value),f=d(null);O([A,y,h,M,S,_,C],([t,e,,a,b,g,P])=>{(o.value===""||o.value===(A.value||""))&&(o.value=t||""),(n.value===""||n.value===(y.value||""))&&(n.value=e||""),(u.value===""||u.value===(M.value||""))&&(u.value=a||""),I.value=[...b],m.value=g,c.value=P},{immediate:!0}),O(h,t=>{i.value===!1&&t===!0&&(i.value=t)},{immediate:!0}),G(()=>{console.log("ApiKeyView 已加载",{apiKey:o.value?"已设置":"未设置",apiEndpoint:n.value,useCustomApi:i.value,selectedModel:u.value,availableModels:I.value})});function N(t){const e=t.replace(/\/+$/,"");return e.includes("/chat/completions")?e.replace("/chat/completions","/models"):e.includes("/v1")?`${e.split("/v1")[0]}/v1/models`:`${e}/v1/models`}async function T(t,e){if(!t||!e)return["gpt-3.5-turbo","gpt-4","gpt-4-turbo"];try{const a=N(t);console.log("获取模型列表的URL:",a);const b=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!b.ok)throw new Error(`获取模型列表失败: ${b.status} ${b.statusText}`);const g=await b.json();if(!g.data||!Array.isArray(g.data))return console.warn("API响应格式不符合预期:",g),["sydf-v1-250520","gpt-3.5-turbo","gpt-4","gpt-4-turbo"];const P=g.data.map(q=>q.id).sort();return P.length===0?["sydf-v1-250520","gpt-3.5-turbo","gpt-4","gpt-4-turbo"]:P}catch(a){throw console.error("获取模型列表失败:",a),a}}async function z(){if(!o.value||!n.value){c.value="请先填写API密钥和端点";return}c.value=null,f.value=null,m.value=!0;try{console.log("正在获取模型列表..."),f.value=`正在从 ${n.value} 获取模型列表...`;const t=await T(n.value,o.value);console.log("获取到的模型列表:",t),t&&t.length>0?(I.value=t,f.value=`成功获取到 ${t.length} 个模型`,!t.includes(u.value)&&t.length>0&&(u.value=t[0])):(c.value="未找到可用模型，使用默认模型列表",I.value=["sydf-v1-250520","gpt-3.5-turbo","gpt-4","gpt-4-turbo"])}catch(t){console.error("获取模型列表失败:",t),c.value=t instanceof Error?t.message:"获取模型列表失败",f.value=`错误详情: ${JSON.stringify(t)}`}finally{m.value=!1}}function D(){try{x(o.value),K(n.value),U(i.value),V(u.value),alert("设置已保存"),w.push("/")}catch(t){console.error("保存设置失败:",t),alert(`保存设置失败: ${t instanceof Error?t.message:"未知错误"}`)}}function j(){$(),o.value="",n.value="",i.value=!1,u.value="sydf-v1-250520",alert("设置已重置")}return(t,e)=>(v(),r("div",se,[e[12]||(e[12]=s("h1",{class:"page-title"},"API 配置",-1)),s("div",oe,[s("div",ae,[s("div",le,[s("label",ne,[k(s("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),class:"form-checkbox"},null,512),[[Q,i.value]]),e[4]||(e[4]=H(" 启用自定义 API "))]),e[5]||(e[5]=s("div",{class:"form-hint"},"启用后将使用您自己的 API，否则使用内置 AI 服务",-1))]),s("div",{class:E(["form-group",{"form-disabled":!i.value}])},[e[6]||(e[6]=s("label",{class:"form-label"},"API 密钥",-1)),k(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>o.value=a),class:"form-input",placeholder:"输入您的 API Key",disabled:!i.value},null,8,ie),[[B,o.value]]),e[7]||(e[7]=s("div",{class:"form-hint"},"请输入与 OpenAI 格式兼容的 API 密钥",-1))],2),s("div",{class:E(["form-group",{"form-disabled":!i.value}])},[e[8]||(e[8]=s("label",{class:"form-label"},"API 端点",-1)),k(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>n.value=a),class:"form-input",placeholder:"https://api.example.com/v1",disabled:!i.value},null,8,ue),[[B,n.value]]),e[9]||(e[9]=s("div",{class:"form-hint"},"请输入基础API地址，系统会自动添加 /chat/completions 路径",-1))],2),s("div",{class:E(["form-group",{"form-disabled":!i.value}])},[e[10]||(e[10]=s("label",{class:"form-label"},"选择模型",-1)),s("div",de,[k(s("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>u.value=a),class:"form-select",disabled:!i.value},[(v(!0),r(X,null,Y(I.value,a=>(v(),r("option",{key:a,value:a},L(a),9,ve))),128))],8,re),[[W,u.value]]),s("button",{onClick:z,class:E(["fetch-models-button",{loading:m.value}]),disabled:!i.value||!o.value||!n.value||m.value},[m.value?(v(),r("span",pe,"加载中...")):(v(),r("span",me,"获取模型列表"))],10,ce)]),s("div",fe,[c.value?(v(),r("span",be,L(c.value),1)):f.value?(v(),r("span",ge,L(f.value),1)):(v(),r("span",Ae,"选择要使用的模型，或从您的API提供商获取可用模型列表"))])],2),s("div",{class:"form-actions"},[s("button",{onClick:D,class:"primary-button"},"保存设置"),s("button",{onClick:j,class:"secondary-button"},"重置")])]),e[11]||(e[11]=J('<div class="info-section" data-v-28ebd508><h2 class="info-title" data-v-28ebd508>使用说明</h2><div class="info-content" data-v-28ebd508><p data-v-28ebd508>您可以配置兼容 OpenAI 格式的 API，包括但不限于：</p><ul data-v-28ebd508><li data-v-28ebd508>OpenAI API</li><li data-v-28ebd508>Azure OpenAI</li><li data-v-28ebd508>自托管的开源模型 API</li><li data-v-28ebd508>其他兼容 OpenAI 格式的 API 服务</li></ul><p data-v-28ebd508><strong data-v-28ebd508>注意：</strong> API 密钥将安全地存储在您的浏览器本地，不会发送到我们的服务器。 </p><p data-v-28ebd508><strong data-v-28ebd508>模型获取：</strong> 点击&quot;获取模型列表&quot;按钮将从您配置的API端点获取可用的模型列表。 如果获取失败，将使用默认模型列表。 </p></div></div>',1))])]))}}),Me=ee(ye,[["__scopeId","data-v-28ebd508"]]);export{Me as default};
