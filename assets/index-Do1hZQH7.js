const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./views-Wo-Rtna-.js","./vendor-DHUK-ldg.js","./views-B1VDQwPq.css"])))=>i.map(i=>d[i]);
import{a as se,r as v,c as ue,w as B,h as he,i as te,b as a,n as b,u as n,e as t,t as E,F as G,g as X,f as k,m as pe,p as Ve,D as ve,J as ze,j as ye,x as Be,o as l,E as me,L as Ne,l as fe,k as Ye,K as Ue,M as We,N as Fe,O as je,P as Ke}from"./vendor-DHUK-ldg.js";import{h as O,e as Z,E as ee,d as oe,_ as ge,a as S,i as Qe}from"./views-Wo-Rtna-.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))m(u);new MutationObserver(u=>{for(const c of u)if(c.type==="childList")for(const y of c.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&m(y)}).observe(document,{childList:!0,subtree:!0});function r(u){const c={};return u.integrity&&(c.integrity=u.integrity),u.referrerPolicy&&(c.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?c.credentials="include":u.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function m(u){if(u.ep)return;u.ep=!0;const c=r(u);fetch(u.href,c)}})();const Je=""+new URL("../static/favicon.png",import.meta.url).href,Ge={class:"sidebar-header"},Xe={class:"logo-section"},Ze=["title"],et={class:"theme-icon-compact"},tt={class:"sidebar-nav"},ot={class:"nav-section"},st={class:"nav-list"},nt={class:"nav-item"},it=["onClick"],lt={class:"nav-icon"},at={class:"nav-text"},rt={class:"history-section"},ct={class:"section-header"},dt={key:0,class:"action-dropdown"},ut={class:"history-controls"},pt=["value"],vt={class:"history-list"},mt={key:0,class:"empty-history"},ft={key:1},ht=["data-record-id","onClick","onMouseenter","onTouchstart"],yt=["onClick"],gt={key:0,class:"checkbox-checked"},_t={class:"history-icon"},wt={key:0},kt={key:1},bt={key:2},xt={key:3},Ct={key:4},Rt={key:5},Et={class:"history-content"},Lt={class:"history-title"},St=["onClick"],$t={key:0,class:"record-action-dropdown"},Tt=["onClick"],It=["onClick"],Mt=["onClick"],Pt={key:2,class:"load-more-container"},Dt={key:3,class:"selection-actions"},Ot={class:"selection-info"},Ht={class:"selection-buttons"},At=["disabled"],qt={class:"sidebar-footer"},Vt={class:"footer-list"},zt={class:"footer-item"},Bt={class:"footer-item"},Nt={class:"footer-item"},Yt=se({__name:"Sidebar",props:{isCollapsed:{type:Boolean}},setup(i,{expose:h}){const r=i,m=v([]),u=v(0),c=v(null),y=v(""),L=v(""),_=v(!1),p=v(!1),f=v(new Set),M=v(null),w=v(null),x=v(!0),ie=v(!1),g=ye(),N=Be(),Y=v(null),C=v("auto"),le=ue(()=>{switch(C.value){case"auto":return{icon:"🌓",text:"自动切换"};case"light":return{icon:"☀️",text:"亮色模式"};case"dark":return{icon:"🌙",text:"暗色模式"};default:return{icon:"🌓",text:"自动切换"}}}),we=v(1),H=v(0),U=v(!1),A=ue(()=>{u.value;let o=O.getRecords();return y.value&&(o=o.filter(e=>e.question.toLowerCase().includes(y.value.toLowerCase()))),L.value&&(o=o.filter(e=>e.type===L.value)),o});function ke(){return window.innerWidth<=768?8:20}function $(o=!0){const e=A.value;H.value=e.length;const s=ke();if(o)we.value=1,m.value=e.slice(0,s);else{const d=m.value.length,K=e.slice(d,d+s);m.value.push(...K)}U.value=m.value.length<H.value,console.log(`加载历史记录 (${window.innerWidth<=768?"移动端":"电脑端"}):`,m.value.length,"/",H.value,"条记录")}function be(){U.value&&$(!1)}function xe(o){o.stopPropagation(),_.value=!_.value}function Ce(o){o.stopPropagation(),confirm("确定要清空所有历史记录吗？此操作不可撤销。")&&(O.clearRecords(),m.value=[],_.value=!1)}function q(){const o=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${o}px`)}function W(){const o=x.value,e=window.innerWidth<=768;x.value=e,q(),o!==e&&(console.log(`设备类型变化: ${o?"移动端":"电脑端"} -> ${e?"移动端":"电脑端"}`),$(!0))}B(A,()=>{$(!0)},{deep:!0}),B(()=>g.params.id,o=>{o&&typeof o=="string"?c.value=o:c.value=null});function Re(o){return`/divination/${o.type}?historyId=${o.id}`}function Ee(o){p.value?re(o.id):Le(o)}function Le(o){c.value=o.id;const e=Re(o);N.push(e)}function ae(){if(p.value=!p.value,p.value)c.value=null;else{f.value.clear();const o=g.query.historyId;c.value=o||null}_.value=!1}function re(o){f.value.has(o)?f.value.delete(o):f.value.add(o)}function Se(o){w.value===o?w.value=null:(w.value=o,Ne(()=>{$e(o)}))}function $e(o){const e=document.querySelector(`[data-record-id="${o}"] .record-action-dropdown`),s=document.querySelector(`[data-record-id="${o}"]`);if(!e||!s)return;const d=s.getBoundingClientRect(),K=140,z=120,Q=window.innerWidth,ce=window.innerHeight,T=ce-d.bottom,I=d.top,He=Q-d.right,Ae=d.left;if(console.log("菜单定位调试:",{recordId:o,rect:{left:d.left,right:d.right,top:d.top,bottom:d.bottom},viewport:{width:Q,height:ce},spaces:{left:Ae,right:He,above:I,below:T},isMobile:x.value}),e.style.top="",e.style.bottom="",e.style.left="",e.style.right="",e.style.transform="",x.value)e.style.right="0",e.style.left="auto",T>=z&&T>=I?(e.style.top="100%",e.style.bottom="auto",e.style.transform="translateY(4px)"):I>=z||I>T?(e.style.top="auto",e.style.bottom="100%",e.style.transform="translateY(-4px)"):(e.style.top="100%",e.style.bottom="auto",e.style.transform="translateY(4px)");else{const J=document.querySelector(".sidebar"),R=J==null?void 0:J.getBoundingClientRect(),de=d.left-((R==null?void 0:R.left)||0),qe=((R==null?void 0:R.right)||Q)-d.right;console.log("侧边栏空间计算:",{sidebarSpaceLeft:de,sidebarSpaceRight:qe,sidebarRect:R?{left:R.left,right:R.right}:null}),T>=z&&T>=I?(e.style.top="100%",e.style.bottom="auto",e.style.right="0",e.style.left="auto",e.style.transform="translateY(4px)"):I>=z?(e.style.top="auto",e.style.bottom="100%",e.style.right="0",e.style.left="auto",e.style.transform="translateY(-4px)"):de>=K?(e.style.top="50%",e.style.bottom="auto",e.style.right="100%",e.style.left="auto",e.style.transform="translate(-4px, -50%)"):I>T?(e.style.top="auto",e.style.bottom="100%",e.style.right="0",e.style.left="auto",e.style.transform="translateY(-4px)"):(e.style.top="100%",e.style.bottom="auto",e.style.right="0",e.style.left="auto",e.style.transform="translateY(4px)")}}function Te(o){console.log("置顶记录:",o),w.value=null}function Ie(o){const e=m.value.find(s=>s.id===o);if(e){const s=prompt("请输入新的标签:",e.question);s&&s.trim()!==""&&(e.question=s.trim(),localStorage.setItem("sydf-history",JSON.stringify(O.getRecords())),$())}w.value=null}function Me(o){confirm("确定要删除这条历史记录吗？此操作不可撤销。")&&(O.deleteRecord(o),$()),w.value=null}function Pe(){if(f.value.size===0)return;const o=f.value.size;confirm(`确定要删除选中的 ${o} 条历史记录吗？此操作不可撤销。`)&&(f.value.forEach(e=>{O.deleteRecord(e)}),f.value.clear(),$(),p.value=!1)}function P(o){console.log("导航到路径:",o,"当前路径:",g.path,"当前查询:",g.query),g.path===o&&Object.keys(g.query).length>0?(console.log("清除查询参数并导航"),N.replace({path:o,query:{}})):g.path!==o?(console.log("导航到新路径"),N.push(o)):console.log("已经在目标页面，无需导航")}function D(o){return g.query.historyId?!1:(g.name==="divination",g.path===o)}function F(){console.log("收到历史记录更新事件，刷新侧边栏"),u.value++}const V=o=>{const e=o.target;_.value&&Y.value&&(Y.value.contains(e)||(_.value=!1)),w.value&&(e.closest(".history-actions")||e.closest(".record-action-dropdown")||e.classList.contains("action-menu-btn")||(w.value=null,x.value&&(M.value=null)))};B(g,o=>{if(p.value)return;const e=o.query.historyId;e?c.value=e:c.value=null},{immediate:!0}),he(()=>{W(),q(),window.addEventListener("resize",W),window.addEventListener("orientationchange",q),$(),setTimeout(()=>{ie.value=!0},100),Oe(),Z.on(ee.HISTORY_UPDATED,F),document.addEventListener("click",V),document.addEventListener("touchstart",V)}),te(()=>{document.removeEventListener("click",V),document.removeEventListener("touchstart",V),Z.off(ee.HISTORY_UPDATED,F)});function De(){const o=["auto","light","dark"],s=(o.indexOf(C.value)+1)%o.length;C.value=o[s],j(),localStorage.setItem("theme",C.value)}function j(){const o=document.documentElement;C.value==="dark"?o.classList.add("dark"):C.value==="light"?o.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?o.classList.add("dark"):o.classList.remove("dark")}function Oe(){const o=localStorage.getItem("theme");o&&["auto","light","dark"].includes(o)?C.value=o:C.value="auto",j(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{C.value==="auto"&&j()})}return te(()=>{window.removeEventListener("resize",W),window.removeEventListener("orientationchange",q),Z.off(ee.HISTORY_UPDATED,F)}),h({}),(o,e)=>(l(),a("aside",{class:b(["sidebar",{"sidebar-collapsed":r.isCollapsed,"sidebar-initialized":n(ie)}])},[t("div",Ge,[t("div",Xe,[e[8]||(e[8]=t("span",{class:"logo-text"},"时月东方",-1)),e[9]||(e[9]=t("img",{src:Je,alt:"网站Logo",class:"website-logo"},null,-1)),t("div",{class:"theme-toggle-compact",title:n(le).text,onClick:De},[t("span",et,E(n(le).icon),1)],8,Ze)])]),t("nav",tt,[t("div",ot,[t("ul",st,[t("li",nt,[t("div",{class:b([{"nav-link-active":D("/")},"nav-link-content"]),onClick:e[0]||(e[0]=s=>P("/"))},e[10]||(e[10]=[t("span",{class:"nav-icon"},"🏠",-1),t("span",{class:"nav-text"},"首页",-1)]),2)]),(l(!0),a(G,null,X(n(oe),s=>(l(),a("li",{key:s.type,class:"nav-item"},[t("div",{class:b([{"nav-link-active":D(`/divination/${s.type}`)},"nav-link-content"]),onClick:d=>P(`/divination/${s.type}`)},[t("span",lt,E(s.icon),1),t("span",at,E(s.title),1)],10,it)]))),128))])])]),t("div",rt,[t("div",ct,[e[14]||(e[14]=t("div",{class:"header-left"},[t("h3",{class:"section-title"},"最近")],-1)),n(m).length>0?(l(),a("div",{key:0,ref_key:"menuRef",ref:Y,class:"header-right"},[t("button",{class:"menu-btn",onClick:xe},e[11]||(e[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[t("circle",{cx:"2",cy:"8",r:"1.5"}),t("circle",{cx:"8",cy:"8",r:"1.5"}),t("circle",{cx:"14",cy:"8",r:"1.5"})],-1)])),n(_)?(l(),a("div",dt,[n(p)?k("",!0):(l(),a("div",{key:0,class:"dropdown-item",onClick:ae},e[12]||(e[12]=[t("span",{class:"dropdown-icon"},"☑️",-1),t("span",{class:"dropdown-text"},"选择删除",-1)]))),n(p)?k("",!0):(l(),a("div",{key:1,class:"dropdown-item",onClick:Ce},e[13]||(e[13]=[t("span",{class:"dropdown-icon"},"🗑️",-1),t("span",{class:"dropdown-text"},"清除所有对话",-1)])))])):k("",!0)],512)):k("",!0)]),t("div",ut,[pe(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>ve(y)?y.value=s:null),type:"text",placeholder:"搜索历史...",class:"search-input"},null,512),[[Ve,n(y)]]),pe(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>ve(L)?L.value=s:null),class:"type-select"},[e[15]||(e[15]=t("option",{value:""},"所有类型",-1)),(l(!0),a(G,null,X(n(oe),s=>(l(),a("option",{key:s.type,value:s.type},E(s.title),9,pt))),128))],512),[[ze,n(L)]])]),t("div",vt,[n(A).length===0?(l(),a("div",mt,e[16]||(e[16]=[t("p",null,"暂无匹配的历史记录",-1)]))):(l(),a("div",ft,[(l(!0),a(G,null,X(n(A),s=>(l(),a("div",{key:s.id,class:b(["history-item",{active:n(c)===s.id&&!n(p),selected:n(f).has(s.id),"has-active-menu":n(w)===s.id}]),"data-record-id":s.id,onClick:d=>Ee(s),onMouseenter:d=>!n(x)&&(M.value=s.id),onMouseleave:e[4]||(e[4]=d=>!n(x)&&(M.value=null)),onTouchstart:d=>n(x)&&(M.value=s.id)},[n(p)?(l(),a("div",{key:0,class:"select-checkbox",onClick:me(d=>re(s.id),["stop"])},[n(f).has(s.id)?(l(),a("span",gt,"✓")):k("",!0)],8,yt)):k("",!0),t("div",_t,[s.type==="liuyao"?(l(),a("span",wt,"☰")):s.type==="meihua"?(l(),a("span",kt,"🌸")):s.type==="qimen"?(l(),a("span",bt,"⚡")):s.type==="tarot"||s.type==="tarot_single"?(l(),a("span",xt,"🔮")):s.type==="ssgw"?(l(),a("span",Ct,"🏛️")):(l(),a("span",Rt,"📜"))]),t("div",Et,[t("div",Lt,E(s.question),1)]),(n(M)===s.id||n(x))&&!n(p)?(l(),a("div",{key:1,class:"history-actions",onClick:e[3]||(e[3]=me(()=>{},["stop"]))},[t("button",{class:b(["action-menu-btn",{active:n(w)===s.id}]),onClick:d=>Se(s.id)},e[17]||(e[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[t("circle",{cx:"2",cy:"8",r:"1.5"}),t("circle",{cx:"8",cy:"8",r:"1.5"}),t("circle",{cx:"14",cy:"8",r:"1.5"})],-1)]),10,St),n(w)===s.id?(l(),a("div",$t,[t("div",{class:"dropdown-item",onClick:d=>Te(s.id)},e[18]||(e[18]=[t("span",{class:"dropdown-icon"},"📌",-1),t("span",{class:"dropdown-text"},"置顶",-1)]),8,Tt),t("div",{class:"dropdown-item",onClick:d=>Ie(s.id)},e[19]||(e[19]=[t("span",{class:"dropdown-icon"},"✏️",-1),t("span",{class:"dropdown-text"},"修改标签",-1)]),8,It),t("div",{class:"dropdown-item delete-item",onClick:d=>Me(s.id)},e[20]||(e[20]=[t("span",{class:"dropdown-icon"},"🗑️",-1),t("span",{class:"dropdown-text"},"删除",-1)]),8,Mt)])):k("",!0)])):k("",!0)],42,ht))),128))])),n(U)&&!n(p)?(l(),a("div",Pt,[t("button",{class:"load-more-btn",onClick:be}," 加载更多 ("+E(n(m).length)+"/"+E(n(H))+") ",1)])):k("",!0),n(p)?(l(),a("div",Dt,[t("div",Ot,"已选择 "+E(n(f).size)+" 项",1),t("div",Ht,[t("button",{class:"selection-btn cancel-btn",onClick:ae},"取消选择"),t("button",{class:"selection-btn delete-selected-btn",disabled:n(f).size===0,onClick:Pe}," 删除选中 ("+E(n(f).size)+") ",9,At)])])):k("",!0)])]),t("div",qt,[t("ul",Vt,[t("li",zt,[t("div",{class:b([{"footer-link-active":D("/settings")},"footer-link"]),onClick:e[5]||(e[5]=s=>P("/settings"))},e[21]||(e[21]=[t("span",{class:"footer-text"},"配置 Key",-1)]),2)]),t("li",Bt,[t("div",{class:b([{"footer-link-active":D("/rengong")},"footer-link"]),onClick:e[6]||(e[6]=s=>P("/rengong"))},e[22]||(e[22]=[t("span",{class:"footer-text"},"转人工",-1)]),2)]),t("li",Nt,[t("div",{class:b([{"footer-link-active":D("/about")},"footer-link"]),onClick:e[7]||(e[7]=s=>P("/about"))},e[23]||(e[23]=[t("span",{class:"footer-text"},"关于本站",-1)]),2)])])])],2))}}),Ut=ge(Yt,[["__scopeId","data-v-87129d83"]]),Wt={class:"top-bar"},Ft={class:"top-bar-content"},jt=se({__name:"TopBar",props:{sidebarCollapsed:{type:Boolean}},emits:["toggle-sidebar"],setup(i){return(h,r)=>(l(),a("header",Wt,[t("div",Ft,[t("button",{class:b(["menu-toggle",{"menu-active":!h.sidebarCollapsed}]),onClick:r[0]||(r[0]=m=>h.$emit("toggle-sidebar"))},r[1]||(r[1]=[t("span",{class:"hamburger-line"},null,-1),t("span",{class:"hamburger-line"},null,-1),t("span",{class:"hamburger-line"},null,-1)]),2),r[2]||(r[2]=t("div",{class:"top-bar-title"},[t("h1",null,"时月东方")],-1)),r[3]||(r[3]=t("div",{class:"top-bar-actions"},null,-1))])]))}}),Kt=ge(jt,[["__scopeId","data-v-9cc50136"]]),Qt={class:"app-container"},Jt={class:"main-content"},Gt={class:"content-wrapper"},Xt=se({__name:"App",setup(i){const h=v(window.innerWidth<=768),r=v(window.innerWidth<=768),m=ye();function u(){r.value=!r.value}function c(){r.value=!0}function y(L){if(!h.value||r.value)return;const _=L.target,p=document.querySelector(".sidebar"),f=document.querySelector(".menu-toggle");p!=null&&p.contains(_)||f!=null&&f.contains(_)||c()}return B(()=>m==null?void 0:m.fullPath,()=>{h.value&&c()},{immediate:!1}),he(()=>{console.log("时月东方，启动！"),document.addEventListener("click",y)}),te(()=>{document.removeEventListener("click",y)}),(L,_)=>{const p=Ue("router-view");return l(),a("div",Qt,[fe(Ut,{"is-collapsed":r.value,ref:"sidebarRef"},null,8,["is-collapsed"]),t("div",{class:b(["main-wrapper",{"sidebar-collapsed":r.value}])},[fe(Kt,{"sidebar-collapsed":r.value,onToggleSidebar:u},null,8,["sidebar-collapsed"]),t("main",Jt,[t("div",Gt,[(l(),Ye(p,{key:n(m).path}))])])],2)])}}}),Zt=oe.map(i=>i.type),eo=[{path:"/divination/:type",name:"divination",component:()=>S(()=>import("./views-Wo-Rtna-.js").then(i=>i.U),__vite__mapDeps([0,1,2]),import.meta.url),props:i=>({divinationType:i.params.type}),beforeEnter:(i,h,r)=>{Zt.includes(i.params.type)?r():r({name:"not-found"})}},{path:"/ssgw",redirect:"/divination/ssgw"}],to=[{path:"/history",name:"history",component:()=>S(()=>import("./views-Wo-Rtna-.js").then(i=>i.H),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/history/:id",name:"history-detail",component:()=>S(()=>import("./views-Wo-Rtna-.js").then(i=>i.H),__vite__mapDeps([0,1,2]),import.meta.url),props:i=>({showDetail:!0,selectedRecordId:i.params.id})}],oo=[{path:"/settings",name:"settings",component:()=>S(()=>import("./views-Wo-Rtna-.js").then(i=>i.A),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/api-key",redirect:"/settings"},{path:"/api-config",redirect:"/settings"}],_e=We({history:Fe("./"),routes:[{path:"/",name:"home",component:()=>S(()=>import("./views-Wo-Rtna-.js").then(i=>i.b),__vite__mapDeps([0,1,2]),import.meta.url)},...eo,...to,...oo,{path:"/rengong",name:"rengong",component:()=>S(()=>import("./views-Wo-Rtna-.js").then(i=>i.R),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/about",name:"about",component:()=>S(()=>import("./views-Wo-Rtna-.js").then(i=>i.c),__vite__mapDeps([0,1,2]),import.meta.url)},{path:"/:pathMatch(.*)*",name:"not-found",component:()=>S(()=>import("./views-Wo-Rtna-.js").then(i=>i.N),__vite__mapDeps([0,1,2]),import.meta.url)}]});_e.beforeEach((i,h,r)=>{r()});const so=je();function no(i){i.use(so)}const ne=Ke(Xt);no(ne);Qe();ne.use(_e);ne.mount("#app");
