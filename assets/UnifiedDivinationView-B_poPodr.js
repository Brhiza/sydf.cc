import{d as Z,i as B,j as le,k as h,l as d,c as u,b as t,m as T,F as O,r as X,n as j,t as R,e as a,_ as K,o as te,p as ce,q as z,s as l,v as ne,x as ee,f as ge,y as re,z as de,A as ve,h as _,B as fe,u as pe,C as me,D as ae,E as ke,G as $e,H as ue,I as ye}from"./index-xHaJBDbl.js";import{d as Ce,D as be}from"./DivinationResult-B2G56S14.js";const we="/static/ssgw.jpg",Te={class:"inspiration-card"},Se={class:"inspiration-tabs"},qe=["onClick"],Re={class:"category-heading"},Ie={class:"questions-wrapper"},De=["onClick"],Ve={class:"questions-wrapper"},Ae={class:"questions-wrapper"},xe={class:"questions-wrapper"},Be={class:"questions-wrapper"},Me={class:"questions-wrapper"},Ue={class:"questions-wrapper"},Le={class:"questions-wrapper"},Pe={class:"questions-wrapper"},Ee={class:"questions-wrapper"},Fe={class:"questions-wrapper"},He={class:"questions-wrapper"},je={class:"questions-wrapper"},Qe={class:"questions-wrapper"},We={class:"questions-wrapper"},Ne={class:"questions-wrapper"},Ge=Z({__name:"InspirationPanel",props:{spreadType:{}},emits:["select","submit"],setup(H,{emit:I}){const p=H,C=I,c=B(()=>p.spreadType?le(p.spreadType):[]),$=B(()=>{var v;return p.spreadType&&((v=h[p.spreadType])==null?void 0:v.name)||""}),g=B(()=>{const v=[{id:"ganqing",name:"感情"},{id:"shiye",name:"事业"},{id:"caifu",name:"财富"},{id:"renji",name:"人际"},{id:"rensheng",name:"成长"}];return p.spreadType&&c.value.length>0?[{id:"spread",name:"牌阵"},...v]:v}),r=d(p.spreadType&&le(p.spreadType).length>0?"spread":"ganqing");function n(v){console.log("InspirationPanel selectAndSubmitQuestion 被调用，问题:",v),document.querySelectorAll(".questions-wrapper p").forEach(s=>{s.textContent===v&&(s.classList.add("clicked"),setTimeout(()=>{s.classList.remove("clicked")},300))}),console.log("InspirationPanel 即将触发submit事件，问题:",v),C("submit",v)}return(v,e)=>(a(),u("div",Te,[e[104]||(e[104]=t("h3",{class:"inspiration-title"},"问题灵感",-1)),t("div",Se,[(a(!0),u(O,null,X(g.value,s=>(a(),u("button",{key:s.id,class:j(["tab-btn",{active:r.value===s.id}]),onClick:w=>r.value=s.id},R(s.name),11,qe))),128))]),v.spreadType&&c.value.length>0?(a(),u("div",{key:0,id:"spread",class:j(["tab-pane",{active:r.value==="spread"}])},[t("h4",Re,R($.value)+"专属问题",1),t("div",Ie,[(a(!0),u(O,null,X(c.value,s=>(a(),u("p",{key:s,onClick:w=>n(s)},R(s),9,De))),128))])],2)):T("",!0),t("div",{id:"ganqing",class:j(["tab-pane",{active:r.value==="ganqing"}])},[e[89]||(e[89]=t("h4",{class:"category-heading"},"情感发展",-1)),t("div",Ve,[t("p",{onClick:e[0]||(e[0]=s=>n("我近期的桃花运怎么样？"))},"我近期的桃花运怎么样？"),t("p",{onClick:e[1]||(e[1]=s=>n("我们目前的感情走向如何？"))},"我们目前的感情走向如何？"),t("p",{onClick:e[2]||(e[2]=s=>n("他/她对我的真实情感是什么？"))}," 他/她对我的真实情感是什么？ "),t("p",{onClick:e[3]||(e[3]=s=>n("我们之间有未来吗？"))},"我们之间有未来吗？"),t("p",{onClick:e[4]||(e[4]=s=>n("如何改善我们目前的关系？"))},"如何改善我们目前的关系？"),t("p",{onClick:e[5]||(e[5]=s=>n("这段感情对我的影响？"))},"这段感情对我的影响？")]),e[90]||(e[90]=t("h4",{class:"category-heading"},"正缘婚姻",-1)),t("div",Ae,[t("p",{onClick:e[6]||(e[6]=s=>n("我的正缘什么时候出现？"))},"我的正缘什么时候出现？"),t("p",{onClick:e[7]||(e[7]=s=>n("我的另一半是什么样的人？"))},"我的另一半是什么样的人？"),t("p",{onClick:e[8]||(e[8]=s=>n("我何时会结婚？"))},"我何时会结婚？"),t("p",{onClick:e[9]||(e[9]=s=>n("我适合和现在的对象结婚吗？"))}," 我适合和现在的对象结婚吗？ "),t("p",{onClick:e[10]||(e[10]=s=>n("我的婚姻生活会幸福吗？"))},"我的婚姻生活会幸福吗？"),t("p",{onClick:e[11]||(e[11]=s=>n("如何吸引我的正缘桃花？"))},"如何吸引我的正缘桃花？")]),e[91]||(e[91]=t("h4",{class:"category-heading"},"关系难题",-1)),t("div",xe,[t("p",{onClick:e[12]||(e[12]=s=>n("我们之间出了什么问题？"))},"我们之间出了什么问题？"),t("p",{onClick:e[13]||(e[13]=s=>n("如何解决现在的感情危机？"))},"如何解决现在的感情危机？"),t("p",{onClick:e[14]||(e[14]=s=>n("我们有机会复合吗？"))},"我们有机会复合吗？"),t("p",{onClick:e[15]||(e[15]=s=>n("我应该放弃这段感情吗？"))},"我应该放弃这段感情吗？"),t("p",{onClick:e[16]||(e[16]=s=>n("我和Ta的缘分有多深？"))},"我和Ta的缘分有多深？"),t("p",{onClick:e[17]||(e[17]=s=>n("我的灵魂伴侣有什么特征？"))},"我的灵魂伴侣有什么特征？")])],2),t("div",{id:"shiye",class:j(["tab-pane",{active:r.value==="shiye"}])},[e[92]||(e[92]=t("h4",{class:"category-heading"},"事业发展",-1)),t("div",Be,[t("p",{onClick:e[18]||(e[18]=s=>n("我适合现在的工作/行业吗？"))}," 我适合现在的工作/行业吗？ "),t("p",{onClick:e[19]||(e[19]=s=>n("我的事业什么时候能成功？"))},"我的事业什么时候能成功？"),t("p",{onClick:e[20]||(e[20]=s=>n("我适合跳槽还是继续坚守？"))},"我适合跳槽还是继续坚守？"),t("p",{onClick:e[21]||(e[21]=s=>n("我事业上的贵人会是谁？"))},"我事业上的贵人会是谁？"),t("p",{onClick:e[22]||(e[22]=s=>n("我未来的事业走向怎么样？"))},"我未来的事业走向怎么样？"),t("p",{onClick:e[23]||(e[23]=s=>n("我什么时候能找到满意的工作？"))}," 我什么时候能找到满意的工作？ ")]),e[93]||(e[93]=t("h4",{class:"category-heading"},"职场机遇",-1)),t("div",Me,[t("p",{onClick:e[24]||(e[24]=s=>n("我今年有机会升职加薪吗？"))},"我今年有机会升职加薪吗？"),t("p",{onClick:e[25]||(e[25]=s=>n("如何得到领导的赏识和重用？"))}," 如何得到领导的赏识和重用？ "),t("p",{onClick:e[26]||(e[26]=s=>n("我在公司的发展前景如何？"))},"我在公司的发展前景如何？"),t("p",{onClick:e[27]||(e[27]=s=>n("如何改善当前的工作状态？"))},"如何改善当前的工作状态？"),t("p",{onClick:e[28]||(e[28]=s=>n("我最近的职场人际运如何？"))},"我最近的职场人际运如何？")]),e[94]||(e[94]=t("h4",{class:"category-heading"},"创业之路",-1)),t("div",Ue,[t("p",{onClick:e[29]||(e[29]=s=>n("我适合创业吗？"))},"我适合创业吗？"),t("p",{onClick:e[30]||(e[30]=s=>n("我的创业最佳时机是什么时候？"))}," 我的创业最佳时机是什么时候？ "),t("p",{onClick:e[31]||(e[31]=s=>n("我该和什么样的人合伙？"))},"我该和什么样的人合伙？"),t("p",{onClick:e[32]||(e[32]=s=>n("我的创业项目前景如何？"))},"我的创业项目前景如何？"),t("p",{onClick:e[33]||(e[33]=s=>n("创业过程中需要注意哪些风险？"))}," 创业过程中需要注意哪些风险？ "),t("p",{onClick:e[34]||(e[34]=s=>n("我的创业会成功吗？"))},"我的创业会成功吗？")])],2),t("div",{id:"caifu",class:j(["tab-pane",{active:r.value==="caifu"}])},[e[95]||(e[95]=t("h4",{class:"category-heading"},"财运趋势",-1)),t("div",Le,[t("p",{onClick:e[35]||(e[35]=s=>n("我近期的财运怎么样？"))},"我近期的财运怎么样？"),t("p",{onClick:e[36]||(e[36]=s=>n("我这辈子财运的整体趋势？"))},"我这辈子财运的整体趋势？"),t("p",{onClick:e[37]||(e[37]=s=>n("我什么时候能发财？"))},"我什么时候能发财？"),t("p",{onClick:e[38]||(e[38]=s=>n("我适合靠什么方式赚钱？"))},"我适合靠什么方式赚钱？"),t("p",{onClick:e[39]||(e[39]=s=>n("如何有效提升我的财运？"))},"如何有效提升我的财运？"),t("p",{onClick:e[40]||(e[40]=s=>n("我近期会有意外之财吗？"))},"我近期会有意外之财吗？")]),e[96]||(e[96]=t("h4",{class:"category-heading"},"投资理财",-1)),t("div",Pe,[t("p",{onClick:e[41]||(e[41]=s=>n("我适合做投资吗？"))},"我适合做投资吗？"),t("p",{onClick:e[42]||(e[42]=s=>n("我应该选择什么样的投资方向？"))}," 我应该选择什么样的投资方向？ "),t("p",{onClick:e[43]||(e[43]=s=>n("这个投资项目能赚钱吗？"))},"这个投资项目能赚钱吗？"),t("p",{onClick:e[44]||(e[44]=s=>n("如何才能守住我的财富？"))},"如何才能守住我的财富？"),t("p",{onClick:e[45]||(e[45]=s=>n("我的投资风险大吗？"))},"我的投资风险大吗？"),t("p",{onClick:e[46]||(e[46]=s=>n("如何更好地管理我的财富？"))},"如何更好地管理我的财富？")]),e[97]||(e[97]=t("h4",{class:"category-heading"},"财务状况",-1)),t("div",Ee,[t("p",{onClick:e[47]||(e[47]=s=>n("我为什么总是存不住钱？"))},"我为什么总是存不住钱？"),t("p",{onClick:e[48]||(e[48]=s=>n("是什么原因导致我财务紧张？"))}," 是什么原因导致我财务紧张？ "),t("p",{onClick:e[49]||(e[49]=s=>n("我最近会有破财风险吗？"))},"我最近会有破财风险吗？"),t("p",{onClick:e[50]||(e[50]=s=>n("如何避免不必要的财务损失？"))}," 如何避免不必要的财务损失？ "),t("p",{onClick:e[51]||(e[51]=s=>n("我需要注意哪些年份的破财？"))}," 我需要注意哪些年份的破财？ "),t("p",{onClick:e[52]||(e[52]=s=>n("我该如何处理我的债务问题？"))}," 我该如何处理我的债务问题？ ")])],2),t("div",{id:"renji",class:j(["tab-pane",{active:r.value==="renji"}])},[e[98]||(e[98]=t("h4",{class:"category-heading"},"社交模式",-1)),t("div",Fe,[t("p",{onClick:e[53]||(e[53]=s=>n("我的人际交往模式有何优缺点？"))}," 我的人际交往模式有何优缺点？ "),t("p",{onClick:e[54]||(e[54]=s=>n("如何拓展我的高质量社交圈？"))}," 如何拓展我的高质量社交圈？ "),t("p",{onClick:e[55]||(e[55]=s=>n("我目前的人际关系状态如何？"))}," 我目前的人际关系状态如何？ "),t("p",{onClick:e[56]||(e[56]=s=>n("我会吸引哪些人进入我的生活？"))}," 我会吸引哪些人进入我的生活？ "),t("p",{onClick:e[57]||(e[57]=s=>n("如何获得他人的信任与支持？"))}," 如何获得他人的信任与支持？ "),t("p",{onClick:e[58]||(e[58]=s=>n("如何处理与朋友的矛盾？"))},"如何处理与朋友的矛盾？")]),e[99]||(e[99]=t("h4",{class:"category-heading"},"贵人善缘",-1)),t("div",He,[t("p",{onClick:e[59]||(e[59]=s=>n("什么样的朋友是我的贵人？"))},"什么样的朋友是我的贵人？"),t("p",{onClick:e[60]||(e[60]=s=>n("我应该远离什么样的朋友？"))},"我应该远离什么样的朋友？"),t("p",{onClick:e[61]||(e[61]=s=>n("如何结交更多志同道合的朋友？"))}," 如何结交更多志同道合的朋友？ "),t("p",{onClick:e[62]||(e[62]=s=>n("我该如何维系重要的友谊？"))},"我该如何维系重要的友谊？"),t("p",{onClick:e[63]||(e[63]=s=>n("我该信任我身边的朋友吗？"))},"我该信任我身边的朋友吗？"),t("p",{onClick:e[64]||(e[64]=s=>n("如何获得领导或长辈的赏识？"))}," 如何获得领导或长辈的赏识？ ")]),e[100]||(e[100]=t("h4",{class:"category-heading"},"家庭关系",-1)),t("div",je,[t("p",{onClick:e[65]||(e[65]=s=>n("我和家人的关系怎么样？"))},"我和家人的关系怎么样？"),t("p",{onClick:e[66]||(e[66]=s=>n("我的家庭对我有什么样的影响？"))}," 我的家庭对我有什么样的影响？ "),t("p",{onClick:e[67]||(e[67]=s=>n("如何改善我与家人的关系？"))},"如何改善我与家人的关系？"),t("p",{onClick:e[68]||(e[68]=s=>n("我该如何处理家庭矛盾？"))},"我该如何处理家庭矛盾？"),t("p",{onClick:e[69]||(e[69]=s=>n("我与家人的缘分有多深？"))},"我与家人的缘分有多深？"),t("p",{onClick:e[70]||(e[70]=s=>n("如何更好地与家人沟通？"))},"如何更好地与家人沟通？")])],2),t("div",{id:"rensheng",class:j(["tab-pane",{active:r.value==="rensheng"}])},[e[101]||(e[101]=t("h4",{class:"category-heading"},"学业规划",-1)),t("div",Qe,[t("p",{onClick:e[71]||(e[71]=s=>n("我的学业运势如何？"))},"我的学业运势如何？"),t("p",{onClick:e[72]||(e[72]=s=>n("我适合考研/考公吗？"))},"我适合考研/考公吗？"),t("p",{onClick:e[73]||(e[73]=s=>n("我适合继续深造还是工作？"))},"我适合继续深造还是工作？"),t("p",{onClick:e[74]||(e[74]=s=>n("如何提升我的学习效率？"))},"如何提升我的学习效率？"),t("p",{onClick:e[75]||(e[75]=s=>n("我该选择哪个专业/学校？"))},"我该选择哪个专业/学校？"),t("p",{onClick:e[76]||(e[76]=s=>n("我这次考试能通过吗？"))},"我这次考试能通过吗？")]),e[102]||(e[102]=t("h4",{class:"category-heading"},"个人成长",-1)),t("div",We,[t("p",{onClick:e[77]||(e[77]=s=>n("我的性格优势和劣势是什么？"))}," 我的性格优势和劣势是什么？ "),t("p",{onClick:e[78]||(e[78]=s=>n("我的人生主要课题是什么？"))},"我的人生主要课题是什么？"),t("p",{onClick:e[79]||(e[79]=s=>n("如何找到我的人生方向？"))},"如何找到我的人生方向？"),t("p",{onClick:e[80]||(e[80]=s=>n("如何克服我性格中的弱点？"))},"如何克服我性格中的弱点？"),t("p",{onClick:e[81]||(e[81]=s=>n("如何有效提升自己的能量状态？"))}," 如何有效提升自己的能量状态？ "),t("p",{onClick:e[82]||(e[82]=s=>n("我的人生转折点在何时？"))},"我的人生转折点在何时？")]),e[103]||(e[103]=t("h4",{class:"category-heading"},"人生机遇",-1)),t("div",Ne,[t("p",{onClick:e[83]||(e[83]=s=>n("我未来十年的人生大运怎么样？"))}," 我未来十年的人生大运怎么样？ "),t("p",{onClick:e[84]||(e[84]=s=>n("我该如何实现我的人生目标？"))}," 我该如何实现我的人生目标？ "),t("p",{onClick:e[85]||(e[85]=s=>n("我的人生会有什么重大机遇？"))}," 我的人生会有什么重大机遇？ "),t("p",{onClick:e[86]||(e[86]=s=>n("我应该注意哪些健康问题？"))},"我应该注意哪些健康问题？"),t("p",{onClick:e[87]||(e[87]=s=>n("如何才能活出更精彩的人生？"))}," 如何才能活出更精彩的人生？ "),t("p",{onClick:e[88]||(e[88]=s=>n("未来的人生之路走向如何？"))},"未来的人生之路走向如何？")])],2)]))}}),he=K(Ge,[["__scopeId","data-v-597f1530"]]),ze={class:"spread-bubbles-container"},Oe={class:"spread-bubbles"},Je=["onClick"],Xe={class:"bubble-icon"},Ye={class:"bubble-text"},Ze={key:0,class:"all-spreads-dropdown"},Ke={class:"dropdown-content"},_e=["onClick"],et={class:"item-icon"},tt={class:"item-content"},nt={class:"item-title"},st={class:"item-description"},ot={class:"item-meta"},it={class:"item-count"},lt={key:1,class:"positions-detail"},at={class:"positions-grid"},ut=Z({__name:"TarotSpreadSelector",props:{modelValue:{default:"single"},showPositions:{type:Boolean,default:!1},maxVisibleSpreads:{default:4}},emits:["update:modelValue","change"],setup(H,{emit:I}){const p=H,C=I,c=d(p.modelValue),$=d(!1),g=d(0),r=d(),n=["single","three","love","career","decision","celtic","chakra","year"],v=B(()=>{if(g.value===0)return p.maxVisibleSpreads;const f=g.value<=480,A=g.value<=768;let y=95,S=75,L=6,P=10;f?(y=75,S=60,L=4,P=8):A&&(y=85,S=65,L=5,P=8);const E=g.value;if(E<y)return 1;if(n.length*y+(n.length-1)*L<=E)return n.length;const N=E-S-L-P;let m=1,k=y;for(let F=1;F<n.length;F++){const G=k+L+y;if(G<=N)m=F+1,k=G;else break}const q=Math.min(2,n.length);return Math.max(q,m)}),e=B(()=>{const f=v.value,A=n.indexOf(c.value);return f>=n.length?n:A<f?n.slice(0,f):[...n.slice(0,f-1),c.value]}),s=B(()=>v.value<n.length);function w(f){c.value=f,C("update:modelValue",f),C("change",f)}function M(f){w(f),V()}function D(){$.value=!$.value}function V(){$.value=!1}function b(f){return{single:"🔮",three:"🃏",love:"💕",career:"💼",decision:"⚖️",celtic:"✨",chakra:"🧘",year:"📅"}[f]||"🎴"}function U(){if(r.value){const f=r.value.getBoundingClientRect();g.value=f.width}}function W(f){r.value&&!r.value.contains(f.target)&&V()}return te(()=>{setTimeout(()=>{U()},100),window.addEventListener("resize",U),document.addEventListener("click",W)}),ce(()=>{window.removeEventListener("resize",U),document.removeEventListener("click",W)}),z(()=>p.modelValue,f=>{f&&f!==c.value&&(c.value=f)}),(f,A)=>(a(),u("div",{ref_key:"selectorRef",ref:r,class:"tarot-spread-selector"},[t("div",ze,[t("div",Oe,[(a(!0),u(O,null,X(e.value,y=>(a(),u("button",{key:y,class:j(["spread-bubble",{active:c.value===y}]),onClick:S=>w(y)},[t("span",Xe,R(b(y)),1),t("span",Ye,R(l(h)[y].name),1)],10,Je))),128)),s.value?(a(),u("button",{key:0,class:"spread-bubble expand-button",onClick:D},A[0]||(A[0]=[t("span",{class:"bubble-icon"},"⋯",-1),t("span",{class:"bubble-text"},"全部",-1)]))):T("",!0)])]),$.value?(a(),u("div",Ze,[t("div",Ke,[(a(),u(O,null,X(n,y=>t("div",{key:y,class:j(["spread-item",{active:c.value===y}]),onClick:S=>M(y)},[t("div",et,R(b(y)),1),t("div",tt,[t("div",nt,R(l(h)[y].name),1),t("div",st,R(l(h)[y].description),1)]),t("div",ot,[t("span",it,R(l(h)[y].cardCount)+"张",1)])],10,_e)),64))])])):T("",!0),f.showPositions&&c.value?(a(),u("div",lt,[A[1]||(A[1]=t("h4",null,"牌位说明",-1)),t("div",at,[(a(!0),u(O,null,X(l(h)[c.value].positions,(y,S)=>(a(),u("span",{key:S,class:"position-item"},R(S+1)+". "+R(y),1))),128))])])):T("",!0)],512))}}),rt=K(ut,[["__scopeId","data-v-ad63d20b"]]),dt={key:0,src:we,alt:"三山国王",class:"card-image"},vt={class:"card-title"},pt={class:"card-description"},ct={key:1,class:"tarot-spread-container"},gt={class:"input-container"},ft=["placeholder","disabled"],mt=["disabled"],kt={key:0},$t={key:1,class:"loading-text"},yt={key:2,class:"ssgw-process"},Ct={key:0,class:"shaking-animation"},bt={class:"shaking-text"},wt={class:"shaking-visual"},Tt={class:"sign-container"},St={key:1,class:"tossing-section"},qt={class:"result-section"},Rt={key:0,class:"result-section"},It=["innerHTML"],Dt={key:1,class:"bei-container"},Vt=["src","alt"],At={key:2,class:"button-wrapper"},xt=["disabled"],Bt=Z({__name:"DivinationInput",props:{title:{},description:{},placeholder:{default:"请输入您的问题"},buttonText:{default:"询问赛博大师"},loadingText:{default:"AI思考中"},loading:{type:Boolean,default:!1},modelValue:{default:""},examples:{default:()=>[]},showInspiration:{type:Boolean,default:!0},hideAfterSubmit:{type:Boolean,default:!0},divinationType:{default:""}},emits:["update:modelValue","submit","typeChange","clear"],setup(H,{emit:I}){const p=H,C=I,c=ne();pe();const $=d(p.modelValue),g=d(E()),r=d("single"),n=d(!1),v=d(!1),e=d(""),s=d(0),w=d(!1),M=d(!1),D=d(0),V=d([]),b=d(""),U=d(0),W=d(!1),f=d(""),A=B(()=>p.divinationType==="ssgw"?"可输入您的问题，也可直接求签":p.placeholder),y=B(()=>p.divinationType==="ssgw"||c.path.includes("/divination/ssgw")?!1:p.showInspiration),S=B(()=>c.path.includes("/divination/tarot")),L=B(()=>{if(S.value){const o=h[r.value];return o?`塔罗牌·${o.name}`:p.title}return p.title}),P=B(()=>{if(S.value){const o=h[r.value];return o?o.description:p.description}return p.description});function E(){const o=c.path;return o.includes("/divination/tarot_single")?"tarot_single":(o.includes("/divination/tarot"),"tarot")}z(()=>p.modelValue,o=>{$.value=o}),z($,o=>{C("update:modelValue",o)});function J(){$.value="",n.value=!1}z(()=>p.divinationType,(o,i)=>{i&&o!==i&&(console.log("DivinationInput: 占卜类型变化:",i,"->",o),J())}),z(()=>c.path,()=>{S.value&&(g.value=E()),J()});function N(){if(p.divinationType==="ssgw"||c.path.includes("/ssgw")){const o=$.value.trim()||"心中所想之事";n.value=!0,C("clear"),m(o);return}!$.value.trim()||p.loading||(n.value=!0,C("submit",{question:$.value.trim()}))}function m(o){f.value=o,v.value=!0,e.value="请静心默念，准备摇签...",s.value=0,setTimeout(()=>{e.value="正在摇签中...";const i=setInterval(()=>{s.value++,s.value>=5&&(clearInterval(i),setTimeout(()=>{D.value=Math.floor(Math.random()*61)+1,v.value=!1,M.value=!0,U.value=0,W.value=!1,V.value=[],b.value=""},1e3))},400)},2e3)}function k(){if(w.value)return;w.value=!0,V.value=[],b.value="";const o=fe();setTimeout(()=>{V.value=[o.bei1,o.bei2];const i=o.result;i==="圣杯"&&(W.value=!0),i==="圣杯"?(b.value="<strong>圣杯</strong> (一平一凸) - 神明同意此签。",setTimeout(()=>{b.value+="<p>正在为您解读签文...</p>",setTimeout(()=>{C("submit",{question:f.value,signNumber:D.value})},2e3)},1e3)):(U.value++,i==="笑杯"?b.value="<strong>笑杯</strong> (两平) - 神明笑而不语，可能问题不明或时机未到。":b.value="<strong>阴杯</strong> (两凸) - 神明不同意此签。",U.value>=3?(b.value+="<p>您已连续三次未能获得圣杯，看来今日不宜再问此事，请改日再来。</p>",w.value=!1):(b.value+="<p>请重新为您摇签...</p>",setTimeout(()=>{M.value=!1,V.value=[],b.value="",m(f.value)},2e3))),w.value=!1},1300)}function q(o){if(p.loading)return;$.value=o;const i=document.getElementById("userInput");i&&i.focus()}function F(o){if(p.loading){console.log("正在加载中，忽略提交");return}if(!o||!o.trim()){console.error("问题为空，无法提交");return}console.log("handleDirectSubmit 被调用，问题:",o),$.value=o,n.value=!0,console.log("即将触发submit事件，问题:",o),C("submit",{question:o})}function G(o){r.value=o,C("typeChange",`tarot_${o}`),$.value=""}return te(()=>{S.value&&C("typeChange",`tarot_${r.value}`)}),(o,i)=>(a(),u(O,null,[t("div",{class:j(["input-card",{loading:o.loading}])},[o.divinationType==="ssgw"?(a(),u("img",dt)):T("",!0),t("h2",vt,R(L.value),1),t("p",pt,R(P.value),1),S.value?(a(),u("div",ct,[ge(rt,{modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=x=>r.value=x),onChange:G},null,8,["modelValue"])])):T("",!0),t("div",gt,[re(t("input",{id:"userInput","onUpdate:modelValue":i[1]||(i[1]=x=>$.value=x),type:"text",placeholder:A.value,disabled:o.loading,class:"question-input",onKeyup:ve(N,["enter"])},null,40,ft),[[de,$.value]]),i[2]||(i[2]=t("div",{class:"input-focus-border"},null,-1))]),t("div",{class:j(["button-wrapper",{"ai-thinking":o.loading}])},[t("button",{id:"submitButton",disabled:o.loading||o.divinationType!=="ssgw"&&!$.value.trim(),class:"submit-button",onClick:N},[o.loading?(a(),u("span",$t,[_(R(o.loadingText)+" ",1),i[3]||(i[3]=t("span",{class:"loading-dots"},[t("span",{class:"dot"}),t("span",{class:"dot"}),t("span",{class:"dot"})],-1))])):(a(),u("span",kt,R(o.buttonText),1))],8,mt)],2),o.divinationType==="ssgw"&&(v.value||w.value||M.value)?(a(),u("div",yt,[v.value?(a(),u("div",Ct,[t("p",bt,R(e.value),1),t("div",wt,[t("div",Tt,[(a(),u(O,null,X(5,x=>t("div",{key:x,class:j(["sign-stick",{active:x<=s.value}])},null,2)),64))])])])):T("",!0),w.value||M.value?(a(),u("div",St,[t("div",qt,[t("p",null,[i[4]||(i[4]=_(" 求得第 ")),t("strong",null,R(D.value),1),i[5]||(i[5]=_(" 签。 "))]),i[6]||(i[6]=t("p",null,"请投掷圣杯，询问三山国王是否同意此签...",-1))]),b.value?(a(),u("div",Rt,[t("p",{innerHTML:b.value},null,8,It)])):T("",!0),V.value.length>0?(a(),u("div",Dt,[(a(!0),u(O,null,X(V.value,(x,Y)=>(a(),u("img",{key:Y,src:`/static/${x}.png`,alt:x,class:"bei-image"},null,8,Vt))),128))])):T("",!0),!W.value&&U.value<3?(a(),u("div",At,[t("button",{disabled:w.value,class:"toss-button",onClick:k},R(w.value?"投掷中...":"投掷圣杯"),9,xt)])):T("",!0)])):T("",!0)])):T("",!0)],2),y.value?(a(),ee(he,{key:0,"spread-type":S.value?r.value:null,onSelect:q,onSubmit:F},null,8,["spread-type"])):T("",!0)],64))}}),Mt=K(Bt,[["__scopeId","data-v-a4205aea"]]);function Ut(H){if(!H)return"";const I=Ce.parse(H);return(new DOMParser().parseFromString(I,"text/html").body.textContent||"").replace(/"/g,'"').replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/'/g,"'").replace(/\n{3,}/g,`

`).trim()}function Lt(H){const I=ne(),p=pe(),C=B(()=>H.divinationType),c=d(""),$=d(!1),g=d(null),r=d(""),n=d(null),v=d(!1),e=d(!1),s=d(!1),w=d(null),M=d(!1),D=d([]),V=d(""),b=d(!1),U=B(()=>g.value!==null),W=B(()=>r.value!=="");function f(){w.value&&(w.value.abort(),M.value=!0,v.value=!1)}async function A(m={}){if(e.value)return;const{signNumber:k,spreadType:q}=m;if(!($.value||!c.value.trim())){$.value=!0,v.value=!0,n.value=null,g.value=null,r.value="",M.value=!1,w.value=new AbortController,D.value=[];try{const F={role:"system",content:"你是精通周易、梅花易数、奇门遁甲、塔罗牌等术数的AI助手。请根据占卜结果，为用户提供解读。"},G={id:`msg-${Date.now()}`,role:"user",content:c.value},o={id:`msg-${Date.now()+1}`,role:"assistant",content:d("")};D.value=[F,G,o],g.value={id:"",type:C.value,data:{},aiResponse:""},$.value=!1,ae({type:C.value,question:c.value.trim(),signNumber:k,spreadType:q,signal:w.value.signal},i=>{r.value+=i,typeof o.content=="object"&&"value"in o.content&&(o.content.value+=i)},i=>{n.value=i,typeof o.content=="object"&&"value"in o.content&&(o.content.value=i)},i=>{v.value=!1,g.value&&(g.value.id=i.id,g.value.data=i.data,g.value.aiResponse=r.value)}).then(i=>{g.value&&(g.value.id=i.id,g.value.data=i.data)}).catch(i=>{console.error("占卜数据生成失败:",i),n.value=i instanceof Error?i.message:"占卜失败，请稍后重试",$.value=!1,v.value=!1})}catch(F){console.error("占卜失败:",F),n.value=F instanceof Error?F.message:"占卜失败，请稍后重试",$.value=!1}}}function y(){g.value=null,r.value="",n.value=null,c.value="",e.value=!1,D.value=[],V.value=""}function S(m){e.value=!0;const k=ke.getRecord(m);k?(console.log("加载历史记录:",k),c.value=k.question,g.value=k.result,r.value=k.result.aiResponse||"",D.value=[{id:`hist-sys-${k.id}`,role:"system",content:"你是精通周易、梅花易数、奇门遁甲、塔罗牌等术数的AI助手。请根据占卜结果，为用户提供解读。"},{id:`hist-user-${k.id}`,role:"user",content:k.question},{id:`hist-asst-${k.id}`,role:"assistant",content:k.result.aiResponse||""}]):(console.error("未找到历史记录:",m),p.push(`/divination/${C.value}`))}async function L(){if(!g.value||v.value)return;v.value=!0,n.value=null,r.value="",M.value=!1,w.value=new AbortController;const m={id:`msg-${Date.now()}`,role:"assistant",content:d("")};D.value.push(m);try{const k=await ae({type:C.value,question:c.value,signal:w.value.signal},q=>{r.value+=q,typeof m.content=="object"&&"value"in m.content&&(m.content.value+=q)},q=>{n.value=q,typeof m.content=="object"&&"value"in m.content&&(m.content.value=q)},()=>{v.value=!1,g.value&&(g.value.aiResponse=r.value)});k.aiResponse&&typeof m.content=="object"&&"value"in m.content&&(m.content.value=k.aiResponse),g.value&&(g.value.aiResponse=k.aiResponse||"")}catch(k){console.error("重新生成AI解读失败:",k),n.value="重新生成失败，请稍后重试"}}function P(){const m=I.query.historyId;m&&S(m)}function E(){if(I.query.historyId){const m={...I.query};delete m.historyId,p.replace({path:I.path,query:m})}}function J(){if(!r.value)return;const m=Ut(r.value);navigator.clipboard.writeText(m).then(()=>{s.value=!0,setTimeout(()=>{s.value=!1},2e3)})}function N(){if(!V.value.trim()||b.value)return;const m={id:`msg-${Date.now()}`,role:"user",content:V.value.trim()};D.value.push(m);const k={id:`msg-${Date.now()+1}`,role:"assistant",content:d("")};D.value.push(k),V.value="",b.value=!0,me(D.value,q=>{r.value+=q,typeof k.content=="object"&&"value"in k.content&&(k.content.value+=q)},q=>{b.value=!1,g.value&&(g.value.aiResponse=q)},q=>{b.value=!1,typeof k.content=="object"&&"value"in k.content&&(k.content.value=q)})}return{question:c,isLoading:$,result:g,aiResponse:r,error:n,isAiLoading:v,viewingHistory:e,isCopied:s,isCancelled:M,conversationHistory:D,followUpQuestion:V,isFollowUpLoading:b,hasResult:U,hasAiResponse:W,startDivination:A,clearResult:y,loadResultFromHistory:S,regenerateAI:L,handleHistoryParam:P,clearHistoryParam:E,shareResult:J,cancelGeneration:f,handleSendFollowUp:N}}const Pt={class:"page-container"},Et={key:1,class:"result-header-actions"},Ft={key:3,class:"ai-actions"},Ht={key:4,class:"content-card error-card"},jt={class:"content-text"},Qt={key:5,class:"content-card follow-up-card"},Wt={class:"follow-up-input"},Nt=["disabled"],Gt=["disabled"],ht={key:0},zt={key:1},Ot=Z({__name:"UnifiedDivinationView",props:{divinationType:{}},setup(H){const I=H,p=ne(),C=B(()=>$e(I.divinationType)),{question:c,isLoading:$,result:g,aiResponse:r,error:n,isAiLoading:v,hasResult:e,hasAiResponse:s,viewingHistory:w,isCopied:M,isCancelled:D,startDivination:V,clearResult:b,shareResult:U,regenerateAI:W,handleHistoryParam:f,clearHistoryParam:A,cancelGeneration:y,conversationHistory:S,followUpQuestion:L,isFollowUpLoading:P,handleSendFollowUp:E}=Lt(I),J=B(()=>g.value?{data:g.value.data,aiResponse:r.value}:{data:{},aiResponse:""}),N=d("single");function m(o){if(console.log("类型变化:",o),o.startsWith("tarot_")){const i=o.replace("tarot_","");N.value=i,console.log("牌阵类型更新为:",i)}}function k(o){const i=o.question||c.value;console.log("UnifiedDivinationView handleSubmit:",i),o.question&&(c.value=o.question);const x={};I.divinationType==="tarot"?x.spreadType=N.value:I.divinationType==="ssgw"&&(x.signNumber=o.signNumber),V(x)}function q(){b(),A()}function F(){n.value=null}function G(){W()}return z(()=>I.divinationType,(o,i)=>{!w.value&&i&&o!==i&&(console.log("占卜类型变化:",i,"->",o),console.log("新配置:",C.value),b(),A())}),z(C,o=>{console.log("配置更新:",o)}),z(()=>p.query.historyId,(o,i)=>{console.log("路由查询参数变化:",{oldId:i,newId:o}),o&&typeof o=="string"?(console.log("检测到历史记录参数:",o),f()):i&&!o&&(console.log("从历史记录模式切换到新建模式"),b())},{immediate:!0}),te(()=>{console.log("UnifiedDivinationView mounted, type:",I.divinationType),f()}),(o,i)=>{var x,Y,se,oe,ie;return a(),u("div",Pt,[!l(e)&&!l($)?(a(),ee(Mt,{key:0,modelValue:l(c),"onUpdate:modelValue":i[0]||(i[0]=Q=>ue(c)?c.value=Q:null),title:((x=C.value)==null?void 0:x.title)||"",description:((Y=C.value)==null?void 0:Y.description)||"","button-text":((se=C.value)==null?void 0:se.buttonText)||"开始占卜",loading:l($),placeholder:((oe=C.value)==null?void 0:oe.placeholder)||"",examples:((ie=C.value)==null?void 0:ie.examples)||[],"divination-type":o.divinationType,"hide-after-submit":!1,onSubmit:k,onTypeChange:m,onClear:l(b)},null,8,["modelValue","title","description","button-text","loading","placeholder","examples","divination-type","onClear"])):T("",!0),l(e)&&!l(p).query.historyId?(a(),u("div",Et,[t("button",{class:"btn-secondary",onClick:q},"← 返回"),l(s)&&!l(v)?(a(),u("button",{key:0,class:"btn-secondary",onClick:i[1]||(i[1]=(...Q)=>l(U)&&l(U)(...Q))},R(l(M)?"已复制!":"分享"),1)):T("",!0)])):T("",!0),l(e)?(a(),ee(be,{key:2,type:o.divinationType,result:J.value,"is-ai-loading":l(v)||l(P),error:l(n),question:l(c),"conversation-history":l(S),"is-follow-up-loading":l(P),onRetry:G},null,8,["type","result","is-ai-loading","error","question","conversation-history","is-follow-up-loading"])):T("",!0),l(e)?(a(),u("div",Ft,[l(v)?(a(),u("button",{key:0,class:"btn-secondary",onClick:i[2]||(i[2]=(...Q)=>l(y)&&l(y)(...Q))},"取消生成")):T("",!0),!l(v)&&(l(n)||l(D))?(a(),u("button",{key:1,class:"btn-primary",onClick:G}," 重新生成 ")):T("",!0)])):T("",!0),l(n)&&!l(e)?(a(),u("div",Ht,[t("p",jt,R(l(n)),1),t("div",{class:"form-actions"},[t("button",{class:"btn-primary",onClick:F},"重试")])])):T("",!0),l(s)&&!l(v)?(a(),u("div",Qt,[t("div",Wt,[re(t("textarea",{"onUpdate:modelValue":i[3]||(i[3]=Q=>ue(L)?L.value=Q:null),placeholder:"对AI的解读进行追问...",disabled:l(P),onKeydown:i[4]||(i[4]=ve(ye((...Q)=>l(E)&&l(E)(...Q),["prevent"]),["enter"]))},null,40,Nt),[[de,l(L)]]),t("button",{onClick:i[5]||(i[5]=(...Q)=>l(E)&&l(E)(...Q)),disabled:l(P)},[l(P)?(a(),u("span",zt,"发送中...")):(a(),u("span",ht,"发送"))],8,Gt)])])):T("",!0)])}}}),Yt=K(Ot,[["__scopeId","data-v-ff258a76"]]);export{Yt as default};
