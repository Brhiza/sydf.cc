import{O as e,r as s,d as a,P as t,c as l,b as o,i,g as n,Q as u,u as c,n as d,v as r,j as p,F as m,k as v,t as A,s as b,e as f}from"./vendor-cAEEXcX9.js";import{s as y,_ as g}from"./index-CqUvQr7Y.js";import"./utils-CwRxlNlL.js";const h={customApiKey:"",customApiEndpoint:"",useCustomApi:!1,selectedModel:"",availableModels:[]},M="sydf-settings",C=e("settings",()=>{const e=s({...h}),a=s(null),t=s(!1);function l(){try{const s=y.getItem(M);e.value=s?{...h,...s}:{...h}}catch(s){e.value={...h}}}function o(s){try{const a={customApiKey:s.customApiKey??e.value.customApiKey,customApiEndpoint:s.customApiEndpoint??e.value.customApiEndpoint,useCustomApi:s.useCustomApi??e.value.useCustomApi,selectedModel:s.selectedModel??e.value.selectedModel,availableModels:s.availableModels??e.value.availableModels};!1===s.useCustomApi&&(a.availableModels=[],a.selectedModel=""),y.setItem(M,a),e.value=a}catch(t){a.value=t instanceof Error?t.message:"更新设置失败"}}return l(),{settings:e,error:a,isLoadingModels:t,loadSettings:l,updateSettings:o,resetSettings:function(){e.value={...h},y.removeItem(M)},fetchAvailableModels:async function(s,l){if(!s||!l)return h.availableModels;t.value=!0,a.value=null;try{const a=`${s.replace(/\/v1(\/chat\/completions)?\/?$/,"")}/v1/models`,t=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});if(!t.ok){const e=await t.json().catch(()=>null),s=e?.error?.message||`HTTP error! status: ${t.status}`;throw new Error(`获取模型列表失败: ${s}`)}const i=await t.json();if(!i.data||!Array.isArray(i.data))throw new Error("API响应格式不符合预期");const n=["embedding","reranker","BAAI","bge"],u=i.data.map(e=>e.id).filter(e=>!n.some(s=>e.toLowerCase().includes(s.toLowerCase()))).sort((e,s)=>{const a=e=>e.split(/[-/]/)[0],t=a(e),l=a(s);return t!==l?t.localeCompare(l):e.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"})});return u.length>0&&o({availableModels:u}),u.length>0?u:e.value.availableModels}catch(i){return a.value=i instanceof Error?i.message:"获取模型列表失败",e.value.availableModels}finally{t.value=!1}}}}),I={class:"page-container"},E={class:"content-card"},P={class:"form-group"},k={class:"form-label"},w=["disabled"],K=["disabled"],x={class:"model-selection-wrapper"},$=["disabled"],j=["value"],S=["disabled"],V={key:0},_={key:1},L={class:"form-hint"},T={key:0,class:"error-text"},U={key:1,class:"debug-text"},O={key:2},B=g(a({__name:"ApiKeyView",setup(e){const a=b(),y=C(),{fetchAvailableModels:g,updateSettings:h,resetSettings:M}=y,{settings:B,isLoadingModels:z,error:F}=t(y),G=s(null);async function H(){if(!B.value.customApiKey||!B.value.customApiEndpoint)return void(F.value="请先填写API密钥和端点");G.value=`正在从 ${B.value.customApiEndpoint} 获取模型列表...`;const e=await g(B.value.customApiEndpoint,B.value.customApiKey);e&&e.length>0?(G.value=`成功获取到 ${e.length} 个模型`,e.includes(B.value.selectedModel)||(B.value.selectedModel=e[0])):G.value="获取模型列表失败或列表为空。"}function Q(){try{h(B.value),alert("设置已保存"),a.push("/")}catch(e){alert(`保存设置失败: ${e instanceof Error?e.message:"未知错误"}`)}}function q(){M(),alert("设置已重置")}return(e,s)=>(f(),l("div",I,[s[12]||(s[12]=o("h1",{class:"page-title"},"配置 Key ⚙️",-1)),o("div",E,[s[11]||(s[11]=o("h2",{class:"section-title"},"API 配置",-1)),o("div",P,[o("label",k,[i(o("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>c(B).useCustomApi=e),type:"checkbox",class:"form-checkbox"},null,512),[[u,c(B).useCustomApi]]),s[4]||(s[4]=n(" 启用自定义 API ",-1))]),s[5]||(s[5]=o("div",{class:"form-hint"},"启用后将使用您自己的 API，否则使用内置 AI 服务",-1))]),o("div",{class:d(["form-group",{"form-disabled":!c(B).useCustomApi}])},[s[6]||(s[6]=o("label",{class:"form-label"},"API 密钥",-1)),i(o("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>c(B).customApiKey=e),type:"text",class:"form-input",placeholder:"输入您的 API Key",disabled:!c(B).useCustomApi},null,8,w),[[r,c(B).customApiKey]]),s[7]||(s[7]=o("div",{class:"form-hint"},"请输入与 OpenAI 格式兼容的 API 密钥",-1))],2),o("div",{class:d(["form-group",{"form-disabled":!c(B).useCustomApi}])},[s[8]||(s[8]=o("label",{class:"form-label"},"API 端点",-1)),i(o("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>c(B).customApiEndpoint=e),type:"text",class:"form-input",placeholder:"https://api.example.com/v1",disabled:!c(B).useCustomApi},null,8,K),[[r,c(B).customApiEndpoint]]),s[9]||(s[9]=o("div",{class:"form-hint"},"请输入基础API地址，系统会自动添加 /chat/completions 路径",-1))],2),o("div",{class:d(["form-group",{"form-disabled":!c(B).useCustomApi}])},[s[10]||(s[10]=o("label",{class:"form-label"},"选择模型",-1)),o("div",x,[i(o("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>c(B).selectedModel=e),class:"form-select",disabled:!c(B).useCustomApi},[(f(!0),l(m,null,v(c(B).availableModels,e=>(f(),l("option",{key:e,value:e},A(e),9,j))),128))],8,$),[[p,c(B).selectedModel]]),o("button",{class:d(["btn-primary fetch-models-button",{loading:c(z)}]),disabled:!c(B).useCustomApi||!c(B).customApiKey||!c(B).customApiEndpoint||c(z),onClick:H},[c(z)?(f(),l("span",V,"加载中...")):(f(),l("span",_,"获取模型列表"))],10,S)]),o("div",L,[c(F)?(f(),l("span",T,A(c(F)),1)):G.value?(f(),l("span",U,A(G.value),1)):(f(),l("span",O,"选择要使用的模型，或从您的API提供商获取可用模型列表"))])],2),o("div",{class:"form-actions"},[o("button",{class:"btn-primary",onClick:Q},"保存设置"),o("button",{class:"btn-secondary",onClick:q},"重置")])]),s[13]||(s[13]=o("div",{class:"content-card"},[o("h2",{class:"section-title"},"使用说明"),o("div",{class:"info-content"},[o("p",null,"您可以配置所有兼容 OpenAI 格式的 API"),o("p",null,[o("strong",null,"注意："),n(" API 密钥将安全地存储在您的浏览器本地，不会发送到我们的服务器。 ")]),o("p",null,[o("strong",null,"模型获取："),n(' 点击"获取模型列表"按钮将从您配置的API端点获取可用的模型列表。 如果获取失败，将使用默认模型列表。 ')])])],-1))]))}}),[["__scopeId","data-v-84951bd4"]]);export{B as default};
