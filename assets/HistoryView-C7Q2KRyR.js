import{d as q,e as v,w as N,i as A,c as a,a as e,t as r,l as m,p as H,B as x,j as B,F as E,r as V,G as J,u as $,H as L,I as O,J as z,s as p,o as n,_ as F}from"./index-CWlmWX8O.js";import{a as R}from"./divination-config-DPDDIOby.js";const K={class:"history-view"},T={class:"history-container"},j={key:0,class:"history-detail-card"},G={class:"detail-header"},M={class:"header-left"},P={class:"detail-title"},Q={class:"detail-date"},U={class:"detail-content"},W={class:"detail-question"},X={class:"question-text"},Y={class:"detail-result"},Z={class:"detail-footer"},ee={key:1,class:"history-card"},se={class:"history-content"},te={key:0,class:"empty-message"},oe={key:1,class:"history-list"},ie=["onClick"],ae={class:"item-header"},ne={class:"item-type"},le={class:"item-date"},re={class:"item-question"},ce={key:0,class:"card-footer"},de=q({__name:"HistoryView",props:{selectedRecordId:{type:String,default:null},showDetail:{type:Boolean,default:!1}},setup(f){const d=f,u=$(),l=v([]),i=v(null),y=v(!1);function g(){if(l.value=J(),d.selectedRecordId){const t=l.value.find(s=>s.id===d.selectedRecordId);t?i.value=t:u.push("/history")}}function k(t){u.push(`/history/${t.id}`)}function I(){confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")&&(L(),l.value=[])}function b(t){confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")&&(O(t),h())}function h(){u.push("/history")}function w(t){return new Date(t).toLocaleDateString("zh-CN")}function D(t){return new Date(t).toLocaleString("zh-CN")}function S(t){return t.result.aiResponse?["æŠ±æ­‰","æš‚æ—¶ä¸å¯ç”¨","è¯·ç¨åé‡è¯•","å‡ºå°å·®","è¯·æ±‚è¿‡äºé¢‘ç¹","æœåŠ¡å™¨æš‚æ—¶ç¹å¿™"].some(c=>{var _;return(_=t.result.aiResponse)==null?void 0:_.includes(c)})?t.result.aiResponse:null:"AIè§£è¯»æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•"}async function C(t){if(!y.value){y.value=!0;try{const s=await z.performDivination({type:t.type,question:t.question},void 0,o=>{t.result.aiResponse=o;const c=p.getRecords();localStorage.setItem("sydf-history",JSON.stringify(c))});if(s.aiResponse){t.result.aiResponse=s.aiResponse;const o=p.getRecords();localStorage.setItem("sydf-history",JSON.stringify(o)),console.log("å†å²è®°å½•AIè§£è¯»é‡è¯•æˆåŠŸ")}}catch(s){console.error("é‡è¯•AIè§£è¯»å¤±è´¥:",s),t.result.aiResponse=s instanceof Error?s.message:"é‡æ–°ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";const o=p.getRecords();localStorage.setItem("sydf-history",JSON.stringify(o))}finally{y.value=!1}}}return N(()=>d.selectedRecordId,t=>{if(t){const s=l.value.find(o=>o.id===t);s&&(i.value=s)}else i.value=null}),A(()=>{g()}),(t,s)=>(n(),a("div",K,[e("div",T,[f.showDetail&&i.value?(n(),a("div",j,[e("div",G,[e("div",M,[e("h2",P,r(m(R)(i.value.type)),1),e("p",Q,r(D(i.value.timestamp)),1)]),e("div",{class:"header-actions"},[e("button",{class:"back-button",onClick:h},s[2]||(s[2]=[e("span",{class:"back-icon"},"â†",-1),e("span",{class:"back-text"},"è¿”å›",-1)]))])]),e("div",U,[e("div",W,[s[3]||(s[3]=e("h3",{class:"question-label"},"é—®é¢˜",-1)),e("p",X,r(i.value.question),1)]),e("div",Y,[s[4]||(s[4]=e("h3",{class:"result-label"},"ç»“æœ",-1)),H(x,{type:i.value.type,result:i.value.result,error:S(i.value),onRetry:s[0]||(s[0]=o=>C(i.value))},null,8,["type","result","error"])])]),e("div",Z,[e("button",{onClick:s[1]||(s[1]=o=>b(i.value.id)),class:"delete-button"},s[5]||(s[5]=[e("span",{class:"delete-icon"},"ğŸ—‘ï¸",-1),e("span",{class:"delete-text"},"åˆ é™¤è®°å½•",-1)]))])])):(n(),a("div",ee,[s[7]||(s[7]=e("div",{class:"card-header"},[e("h2",{class:"card-title"},"å†å²è®°å½•"),e("p",{class:"card-description"},"è¿™é‡Œä¿å­˜äº†æ‚¨æœ€è¿‘çš„å åœè®°å½•ï¼Œä»…ä¿å­˜åœ¨æœ¬åœ°å“¦ã€‚")],-1)),e("div",se,[l.value.length===0?(n(),a("div",te,s[6]||(s[6]=[e("div",{class:"empty-icon"},"ğŸ“œ",-1),e("p",null,"æš‚æ— å†å²è®°å½•",-1),e("p",{class:"empty-hint"},"æ‚¨çš„å åœè®°å½•å°†ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ",-1)]))):(n(),a("div",oe,[(n(!0),a(E,null,V(l.value,o=>(n(),a("div",{key:o.id,class:"history-item"},[e("button",{onClick:c=>k(o),class:"history-item-button"},[e("div",ae,[e("span",ne,r(m(R)(o.type)),1),e("span",le,r(w(o.timestamp)),1)]),e("div",re,r(o.question),1)],8,ie)]))),128))]))]),l.value.length>0?(n(),a("div",ce,[e("button",{onClick:I,class:"clear-button"},"æ¸…ç©ºå†å²è®°å½•")])):B("",!0)]))])]))}}),ve=F(de,[["__scopeId","data-v-dac8d211"]]);export{ve as default};
