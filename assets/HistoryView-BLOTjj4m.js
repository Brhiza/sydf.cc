const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bu6BSF8d.js","assets/index-CKQptoJn.css"])))=>i.map(i=>d[i]);
import{d as e,l as t,q as s,o as a,c as n,b as i,t as l,f as c,m as o,F as r,r as d,E as u,u as v,G as p,J as y,e as f,_ as h}from"./index-Bu6BSF8d.js";import{D as m}from"./DivinationResult-Cettjz6L.js";const g={class:"page-container"},R={key:0,class:"content-card"},I={class:"detail-header"},_={class:"header-left"},b={class:"section-title"},S={class:"detail-date"},k={class:"detail-content"},w={class:"detail-question"},D={class:"content-text"},x={class:"detail-result"},A={class:"form-actions"},C={key:1,class:"content-card"},E={class:"history-content"},q={key:0,class:"empty-message"},j={key:1,class:"history-list"},L=["onClick"],N={class:"item-header"},O={class:"item-type"},J={class:"item-date"},P={class:"item-question"},T={key:0,class:"form-actions"},V=h(e({__name:"HistoryView",props:{selectedRecordId:{type:String,default:null},showDetail:{type:Boolean,default:!1}},setup(e){const h=e,V=v(),z=t([]),$=t(null),B=t(!1);function F(){confirm("确定要清空所有历史记录吗？此操作不可撤销。")&&(u.clearRecords(),z.value=[])}function G(){V.push("/history")}function H(e){return new Date(e).toLocaleDateString("zh-CN")}function K(e){const t=p(e);return t?t.title:"未知占卜"}function M(e){if(!e.result.aiResponse)return"AI解读暂时不可用，请稍后重试";return["抱歉","暂时不可用","请稍后重试","出小差","请求过于频繁","服务器暂时繁忙"].some(t=>{var s;return null==(s=e.result.aiResponse)?void 0:s.includes(t)})?e.result.aiResponse:null}return s(()=>h.selectedRecordId,e=>{if(e){const t=z.value.find(t=>t.id===e);t&&($.value=t)}else $.value=null}),a(()=>{!function(){if(z.value=u.getRecords(),h.selectedRecordId){const e=z.value.find(e=>e.id===h.selectedRecordId);e?$.value=e:V.push("/history")}}()}),(t,s)=>{return f(),n("div",g,[e.showDetail&&$.value?(f(),n("div",R,[i("div",I,[i("div",_,[i("h2",b,l(K($.value.type)),1),i("p",S,l((a=$.value.timestamp,new Date(a).toLocaleString("zh-CN"))),1)]),i("div",{class:"header-actions"},[i("button",{class:"btn-secondary",onClick:G},[...s[2]||(s[2]=[i("span",{class:"back-icon"},"←",-1),i("span",{class:"back-text"},"返回",-1)])])])]),i("div",k,[i("div",w,[s[3]||(s[3]=i("h3",{class:"section-subtitle"},"问题",-1)),i("p",D,l($.value.question),1)]),i("div",x,[s[4]||(s[4]=i("h3",{class:"section-subtitle"},"结果",-1)),c(m,{type:$.value.type,result:$.value.result,error:M($.value),onRetry:s[0]||(s[0]=e=>async function(e){if(!B.value){B.value=!0;try{const{AIService:t}=await y(async()=>{const{AIService:e}=await import("./index-Bu6BSF8d.js").then(e=>e.S);return{AIService:e}},__vite__mapDeps([0,1])),{DivinationService:s}=await y(async()=>{const{DivinationService:e}=await import("./index-Bu6BSF8d.js").then(e=>e.T);return{DivinationService:e}},__vite__mapDeps([0,1])),a=t,n=s.getInstance().generatePrompt(e.type,e.question,e.result.data),i=await a.generateResponse(n);if(!(null==i?void 0:i.content))throw new Error("AI服务返回空响应");{e.result.aiResponse=i.content;const t=u.getRecords(),s=t.findIndex(t=>t.id===e.id);-1!==s&&(t[s]=e,localStorage.setItem("sydf-history",JSON.stringify(t)))}}catch(t){const s=t instanceof Error?t.message:"重新生成失败，请稍后重试";e.result.aiResponse=s;const a=u.getRecords(),n=a.findIndex(t=>t.id===e.id);-1!==n&&(a[n]=e,localStorage.setItem("sydf-history",JSON.stringify(a)))}finally{B.value=!1}}}($.value))},null,8,["type","result","error"])])]),i("div",A,[i("button",{class:"btn-danger",onClick:s[1]||(s[1]=e=>{return t=$.value.id,void(confirm("确定要删除这条记录吗？此操作不可撤销。")&&(u.deleteRecord(t),G()));var t})},[...s[5]||(s[5]=[i("span",{class:"delete-icon"},"🗑️",-1),i("span",{class:"delete-text"},"删除记录",-1)])])])])):(f(),n("div",C,[s[7]||(s[7]=i("div",{class:"card-header"},[i("h2",{class:"page-title"},"历史记录"),i("p",{class:"content-text"},"这里保存了您最近的占卜记录，仅保存在本地哦。")],-1)),i("div",E,[0===z.value.length?(f(),n("div",q,[...s[6]||(s[6]=[i("div",{class:"empty-icon"},"📜",-1),i("p",null,"暂无历史记录",-1),i("p",{class:"empty-hint"},"您的占卜记录将会显示在这里",-1)])])):(f(),n("div",j,[(f(!0),n(r,null,d(z.value,e=>(f(),n("div",{key:e.id,class:"history-item"},[i("button",{class:"history-item-button",onClick:t=>function(e){V.push(`/divination/${e.type}?historyId=${e.id}`)}(e)},[i("div",N,[i("span",O,l(K(e.type)),1),i("span",J,l(H(e.timestamp)),1)]),i("div",P,l(e.question),1)],8,L)]))),128))]))]),z.value.length>0?(f(),n("div",T,[i("button",{class:"btn-danger",onClick:F},"清空历史记录")])):o("",!0)]))]);var a}}}),[["__scopeId","data-v-c8d355e3"]]);export{V as default};
