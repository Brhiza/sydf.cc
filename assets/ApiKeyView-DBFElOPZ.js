import{K as q,g as m,d as F,f as d,w as O,o as G,c as r,b as s,a as H,m as w,k as J,L as R,n as k,v as B,N as W,F as Q,r as X,t as T,u as Y,e as v,_ as Z}from"./index-0-cv0d-P.js";function ee(){const o=q(),x=m(()=>o.settings.customApiKey),b=m(()=>o.settings.customApiEndpoint),y=m(()=>o.settings.useCustomApi),M=m(()=>o.settings.selectedModel),I=m(()=>o.settings.availableModels),S=m(()=>o.isLoadingModels),C=m(()=>o.error);function E(a){o.updateSettings({customApiKey:a})}function K(a){o.updateSettings({customApiEndpoint:a})}function V(a){o.updateSettings({useCustomApi:a})}function U(a){o.updateSettings({selectedModel:a})}async function $(a,l){return o.fetchAvailableModels(a||o.settings.customApiEndpoint,l||o.settings.customApiKey)}function L(){o.resetSettings()}return{customApiKey:x,customApiEndpoint:b,useCustomApi:y,selectedModel:M,availableModels:I,isLoadingModels:S,error:C,updateCustomApiKey:E,updateCustomApiEndpoint:K,updateUseCustomApi:V,updateSelectedModel:U,fetchAvailableModels:$,resetSettings:L}}const te={class:"page-container"},se={class:"content-card"},ae={class:"form-group"},oe={class:"form-label"},le=["disabled"],ne=["disabled"],ie={class:"model-selection-wrapper"},ue=["disabled"],de=["value"],re=["disabled"],ve={key:0},ce={key:1},pe={class:"form-hint"},me={key:0,class:"error-text"},fe={key:1,class:"debug-text"},ge={key:2},Ae=F({__name:"ApiKeyView",setup(o){const x=Y(),{customApiKey:b,customApiEndpoint:y,useCustomApi:M,selectedModel:I,availableModels:S,isLoadingModels:C,error:E,updateCustomApiKey:K,updateCustomApiEndpoint:V,updateUseCustomApi:U,updateSelectedModel:$,resetSettings:L}=ee(),a=d(b.value||""),l=d(y.value||""),n=d(M.value),u=d(I.value||""),h=d([...S.value]),f=d(C.value),c=d(E.value),g=d(null);O([b,y,M,I,S,C,E],([t,e,,i,P,p,A])=>{(a.value===""||a.value===(b.value||""))&&(a.value=t||""),(l.value===""||l.value===(y.value||""))&&(l.value=e||""),(u.value===""||u.value===(I.value||""))&&(u.value=i||""),h.value=[...P],f.value=p,c.value=A},{immediate:!0}),O(M,t=>{n.value===!1&&t===!0&&(n.value=t)},{immediate:!0}),G(()=>{console.log("ApiKeyView 已加载",{apiKey:a.value?"已设置":"未设置",apiEndpoint:l.value,useCustomApi:n.value,selectedModel:u.value,availableModels:h.value})});async function N(t,e){if(!t||!e)throw new Error("API端点和密钥不能为空");const P=`${t.endsWith("/v1")?t:`${t}/v1`}/models`;console.log("正在请求模型列表:",P);const p=await fetch(P,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!p.ok){const _=await p.text();throw console.error("获取模型列表失败:",p.status,_),new Error(`HTTP ${p.status}: ${_}`)}const A=await p.json();if(console.log("模型列表响应:",A),!A.data||!Array.isArray(A.data))throw new Error("响应格式不正确，缺少 data 数组");return A.data.map(_=>_.id).filter(Boolean)}async function z(){if(!a.value||!l.value){c.value="请先填写API密钥和端点";return}f.value=!0,c.value="",g.value=null;try{console.log("正在获取模型列表..."),g.value=`正在从 ${l.value} 获取模型列表...`;const t=await N(l.value,a.value);console.log("获取到的模型列表:",t),t&&t.length>0?(h.value=t,g.value=`成功获取到 ${t.length} 个模型`,!t.includes(u.value)&&t.length>0&&(u.value=t[0])):(c.value="未找到可用模型，使用默认模型列表",h.value=["sydf-v1-250520","gpt-3.5-turbo","gpt-4","gpt-4-turbo"])}catch(t){console.error("获取模型列表失败:",t),c.value=t instanceof Error?t.message:"获取模型列表失败",g.value=`错误详情: ${JSON.stringify(t)}`}finally{f.value=!1}}function D(){try{K(a.value),V(l.value),U(n.value),$(u.value),alert("设置已保存"),x.push("/")}catch(t){console.error("保存设置失败:",t),alert(`保存设置失败: ${t instanceof Error?t.message:"未知错误"}`)}}function j(){L(),a.value="",l.value="",n.value=!1,u.value="sydf-v1-250520",alert("设置已重置")}return(t,e)=>(v(),r("div",te,[e[12]||(e[12]=s("h1",{class:"page-title"},"配置 Key ⚙️",-1)),s("div",se,[e[11]||(e[11]=s("h2",{class:"section-title"},"API 配置",-1)),s("div",ae,[s("label",oe,[w(s("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=i=>n.value=i),class:"form-checkbox"},null,512),[[R,n.value]]),e[4]||(e[4]=J(" 启用自定义 API "))]),e[5]||(e[5]=s("div",{class:"form-hint"},"启用后将使用您自己的 API，否则使用内置 AI 服务",-1))]),s("div",{class:k(["form-group",{"form-disabled":!n.value}])},[e[6]||(e[6]=s("label",{class:"form-label"},"API 密钥",-1)),w(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>a.value=i),class:"form-input",placeholder:"输入您的 API Key",disabled:!n.value},null,8,le),[[B,a.value]]),e[7]||(e[7]=s("div",{class:"form-hint"},"请输入与 OpenAI 格式兼容的 API 密钥",-1))],2),s("div",{class:k(["form-group",{"form-disabled":!n.value}])},[e[8]||(e[8]=s("label",{class:"form-label"},"API 端点",-1)),w(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=i=>l.value=i),class:"form-input",placeholder:"https://api.example.com/v1",disabled:!n.value},null,8,ne),[[B,l.value]]),e[9]||(e[9]=s("div",{class:"form-hint"},"请输入基础API地址，系统会自动添加 /chat/completions 路径",-1))],2),s("div",{class:k(["form-group",{"form-disabled":!n.value}])},[e[10]||(e[10]=s("label",{class:"form-label"},"选择模型",-1)),s("div",ie,[w(s("select",{"onUpdate:modelValue":e[3]||(e[3]=i=>u.value=i),class:"form-select",disabled:!n.value},[(v(!0),r(Q,null,X(h.value,i=>(v(),r("option",{key:i,value:i},T(i),9,de))),128))],8,ue),[[W,u.value]]),s("button",{onClick:z,class:k(["btn-primary fetch-models-button",{loading:f.value}]),disabled:!n.value||!a.value||!l.value||f.value},[f.value?(v(),r("span",ve,"加载中...")):(v(),r("span",ce,"获取模型列表"))],10,re)]),s("div",pe,[c.value?(v(),r("span",me,T(c.value),1)):g.value?(v(),r("span",fe,T(g.value),1)):(v(),r("span",ge,"选择要使用的模型，或从您的API提供商获取可用模型列表"))])],2),s("div",{class:"form-actions"},[s("button",{onClick:D,class:"btn-primary"},"保存设置"),s("button",{onClick:j,class:"btn-secondary"},"重置")])]),e[13]||(e[13]=H('<div class="content-card" data-v-c6ae5ad4><h2 class="section-title" data-v-c6ae5ad4>使用说明</h2><div class="info-content" data-v-c6ae5ad4><p data-v-c6ae5ad4>您可以配置兼容 OpenAI 格式的 API，包括但不限于：</p><ul data-v-c6ae5ad4><li data-v-c6ae5ad4>OpenAI API</li><li data-v-c6ae5ad4>Azure OpenAI</li><li data-v-c6ae5ad4>自托管的开源模型 API</li><li data-v-c6ae5ad4>其他兼容 OpenAI 格式的 API 服务</li></ul><p data-v-c6ae5ad4><strong data-v-c6ae5ad4>注意：</strong> API 密钥将安全地存储在您的浏览器本地，不会发送到我们的服务器。 </p><p data-v-c6ae5ad4><strong data-v-c6ae5ad4>模型获取：</strong> 点击&quot;获取模型列表&quot;按钮将从您配置的API端点获取可用的模型列表。 如果获取失败，将使用默认模型列表。 </p></div></div>',1))]))}}),ye=Z(Ae,[["__scopeId","data-v-c6ae5ad4"]]);export{ye as default};
