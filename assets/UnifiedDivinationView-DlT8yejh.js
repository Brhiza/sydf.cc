import{d as e,i as a,j as n,k as l,l as t,c as i,b as s,m as o,F as u,r as c,n as r,t as p,e as d,_ as v,o as g,p as y,q as m,s as k,v as h,x as C,f as b,y as f,z as w,A as T,h as q,u as x,B as R,C as I,D as _,E as V,G as A,H as L,I as $}from"./index-BIQDZ-YZ.js";import{d as j,D as E}from"./DivinationResult-D75FncXf.js";const D={class:"inspiration-card"},H={class:"inspiration-tabs"},S=["onClick"],U={class:"category-heading"},F={class:"questions-wrapper"},B=["onClick"],M={class:"questions-wrapper"},P={class:"questions-wrapper"},N={class:"questions-wrapper"},z={class:"questions-wrapper"},G={class:"questions-wrapper"},K={class:"questions-wrapper"},O={class:"questions-wrapper"},Q={class:"questions-wrapper"},W={class:"questions-wrapper"},J={class:"questions-wrapper"},X={class:"questions-wrapper"},Y={class:"questions-wrapper"},Z={class:"questions-wrapper"},ee={class:"questions-wrapper"},ae={class:"questions-wrapper"},ne=v(e({__name:"InspirationPanel",props:{spreadType:{}},emits:["select","submit"],setup(e,{emit:v}){const g=e,y=v,m=a(()=>g.spreadType?n(g.spreadType):[]),k=a(()=>{var e;return g.spreadType&&(null==(e=l[g.spreadType])?void 0:e.name)||""}),h=a(()=>{const e=[{id:"ganqing",name:"感情"},{id:"shiye",name:"事业"},{id:"caifu",name:"财富"},{id:"renji",name:"人际"},{id:"rensheng",name:"成长"}];return g.spreadType&&m.value.length>0?[{id:"spread",name:"牌阵"},...e]:e}),C=t(g.spreadType&&n(g.spreadType).length>0?"spread":"ganqing");function b(e){document.querySelectorAll(".questions-wrapper p").forEach(a=>{a.textContent===e&&(a.classList.add("clicked"),setTimeout(()=>{a.classList.remove("clicked")},300))}),y("submit",e)}return(e,a)=>(d(),i("div",D,[a[104]||(a[104]=s("h3",{class:"inspiration-title"},"问题灵感",-1)),s("div",H,[(d(!0),i(u,null,c(h.value,e=>(d(),i("button",{key:e.id,class:r(["tab-btn",{active:C.value===e.id}]),onClick:a=>C.value=e.id},p(e.name),11,S))),128))]),e.spreadType&&m.value.length>0?(d(),i("div",{key:0,id:"spread",class:r(["tab-pane",{active:"spread"===C.value}])},[s("h4",U,p(k.value)+"专属问题",1),s("div",F,[(d(!0),i(u,null,c(m.value,e=>(d(),i("p",{key:e,onClick:a=>b(e)},p(e),9,B))),128))])],2)):o("",!0),s("div",{id:"ganqing",class:r(["tab-pane",{active:"ganqing"===C.value}])},[a[89]||(a[89]=s("h4",{class:"category-heading"},"情感发展",-1)),s("div",M,[s("p",{onClick:a[0]||(a[0]=e=>b("我近期的桃花运怎么样？"))},"我近期的桃花运怎么样？"),s("p",{onClick:a[1]||(a[1]=e=>b("我们目前的感情走向如何？"))},"我们目前的感情走向如何？"),s("p",{onClick:a[2]||(a[2]=e=>b("他/她对我的真实情感是什么？"))}," 他/她对我的真实情感是什么？ "),s("p",{onClick:a[3]||(a[3]=e=>b("我们之间有未来吗？"))},"我们之间有未来吗？"),s("p",{onClick:a[4]||(a[4]=e=>b("如何改善我们目前的关系？"))},"如何改善我们目前的关系？"),s("p",{onClick:a[5]||(a[5]=e=>b("这段感情对我的影响？"))},"这段感情对我的影响？")]),a[90]||(a[90]=s("h4",{class:"category-heading"},"正缘婚姻",-1)),s("div",P,[s("p",{onClick:a[6]||(a[6]=e=>b("我的正缘什么时候出现？"))},"我的正缘什么时候出现？"),s("p",{onClick:a[7]||(a[7]=e=>b("我的另一半是什么样的人？"))},"我的另一半是什么样的人？"),s("p",{onClick:a[8]||(a[8]=e=>b("我何时会结婚？"))},"我何时会结婚？"),s("p",{onClick:a[9]||(a[9]=e=>b("我适合和现在的对象结婚吗？"))}," 我适合和现在的对象结婚吗？ "),s("p",{onClick:a[10]||(a[10]=e=>b("我的婚姻生活会幸福吗？"))},"我的婚姻生活会幸福吗？"),s("p",{onClick:a[11]||(a[11]=e=>b("如何吸引我的正缘桃花？"))},"如何吸引我的正缘桃花？")]),a[91]||(a[91]=s("h4",{class:"category-heading"},"关系难题",-1)),s("div",N,[s("p",{onClick:a[12]||(a[12]=e=>b("我们之间出了什么问题？"))},"我们之间出了什么问题？"),s("p",{onClick:a[13]||(a[13]=e=>b("如何解决现在的感情危机？"))},"如何解决现在的感情危机？"),s("p",{onClick:a[14]||(a[14]=e=>b("我们有机会复合吗？"))},"我们有机会复合吗？"),s("p",{onClick:a[15]||(a[15]=e=>b("我应该放弃这段感情吗？"))},"我应该放弃这段感情吗？"),s("p",{onClick:a[16]||(a[16]=e=>b("我和Ta的缘分有多深？"))},"我和Ta的缘分有多深？"),s("p",{onClick:a[17]||(a[17]=e=>b("我的灵魂伴侣有什么特征？"))},"我的灵魂伴侣有什么特征？")])],2),s("div",{id:"shiye",class:r(["tab-pane",{active:"shiye"===C.value}])},[a[92]||(a[92]=s("h4",{class:"category-heading"},"事业发展",-1)),s("div",z,[s("p",{onClick:a[18]||(a[18]=e=>b("我适合现在的工作/行业吗？"))}," 我适合现在的工作/行业吗？ "),s("p",{onClick:a[19]||(a[19]=e=>b("我的事业什么时候能成功？"))},"我的事业什么时候能成功？"),s("p",{onClick:a[20]||(a[20]=e=>b("我适合跳槽还是继续坚守？"))},"我适合跳槽还是继续坚守？"),s("p",{onClick:a[21]||(a[21]=e=>b("我事业上的贵人会是谁？"))},"我事业上的贵人会是谁？"),s("p",{onClick:a[22]||(a[22]=e=>b("我未来的事业走向怎么样？"))},"我未来的事业走向怎么样？"),s("p",{onClick:a[23]||(a[23]=e=>b("我什么时候能找到满意的工作？"))}," 我什么时候能找到满意的工作？ ")]),a[93]||(a[93]=s("h4",{class:"category-heading"},"职场机遇",-1)),s("div",G,[s("p",{onClick:a[24]||(a[24]=e=>b("我今年有机会升职加薪吗？"))},"我今年有机会升职加薪吗？"),s("p",{onClick:a[25]||(a[25]=e=>b("如何得到领导的赏识和重用？"))}," 如何得到领导的赏识和重用？ "),s("p",{onClick:a[26]||(a[26]=e=>b("我在公司的发展前景如何？"))},"我在公司的发展前景如何？"),s("p",{onClick:a[27]||(a[27]=e=>b("如何改善当前的工作状态？"))},"如何改善当前的工作状态？"),s("p",{onClick:a[28]||(a[28]=e=>b("我最近的职场人际运如何？"))},"我最近的职场人际运如何？")]),a[94]||(a[94]=s("h4",{class:"category-heading"},"创业之路",-1)),s("div",K,[s("p",{onClick:a[29]||(a[29]=e=>b("我适合创业吗？"))},"我适合创业吗？"),s("p",{onClick:a[30]||(a[30]=e=>b("我的创业最佳时机是什么时候？"))}," 我的创业最佳时机是什么时候？ "),s("p",{onClick:a[31]||(a[31]=e=>b("我该和什么样的人合伙？"))},"我该和什么样的人合伙？"),s("p",{onClick:a[32]||(a[32]=e=>b("我的创业项目前景如何？"))},"我的创业项目前景如何？"),s("p",{onClick:a[33]||(a[33]=e=>b("创业过程中需要注意哪些风险？"))}," 创业过程中需要注意哪些风险？ "),s("p",{onClick:a[34]||(a[34]=e=>b("我的创业会成功吗？"))},"我的创业会成功吗？")])],2),s("div",{id:"caifu",class:r(["tab-pane",{active:"caifu"===C.value}])},[a[95]||(a[95]=s("h4",{class:"category-heading"},"财运趋势",-1)),s("div",O,[s("p",{onClick:a[35]||(a[35]=e=>b("我近期的财运怎么样？"))},"我近期的财运怎么样？"),s("p",{onClick:a[36]||(a[36]=e=>b("我这辈子财运的整体趋势？"))},"我这辈子财运的整体趋势？"),s("p",{onClick:a[37]||(a[37]=e=>b("我什么时候能发财？"))},"我什么时候能发财？"),s("p",{onClick:a[38]||(a[38]=e=>b("我适合靠什么方式赚钱？"))},"我适合靠什么方式赚钱？"),s("p",{onClick:a[39]||(a[39]=e=>b("如何有效提升我的财运？"))},"如何有效提升我的财运？"),s("p",{onClick:a[40]||(a[40]=e=>b("我近期会有意外之财吗？"))},"我近期会有意外之财吗？")]),a[96]||(a[96]=s("h4",{class:"category-heading"},"投资理财",-1)),s("div",Q,[s("p",{onClick:a[41]||(a[41]=e=>b("我适合做投资吗？"))},"我适合做投资吗？"),s("p",{onClick:a[42]||(a[42]=e=>b("我应该选择什么样的投资方向？"))}," 我应该选择什么样的投资方向？ "),s("p",{onClick:a[43]||(a[43]=e=>b("这个投资项目能赚钱吗？"))},"这个投资项目能赚钱吗？"),s("p",{onClick:a[44]||(a[44]=e=>b("如何才能守住我的财富？"))},"如何才能守住我的财富？"),s("p",{onClick:a[45]||(a[45]=e=>b("我的投资风险大吗？"))},"我的投资风险大吗？"),s("p",{onClick:a[46]||(a[46]=e=>b("如何更好地管理我的财富？"))},"如何更好地管理我的财富？")]),a[97]||(a[97]=s("h4",{class:"category-heading"},"财务状况",-1)),s("div",W,[s("p",{onClick:a[47]||(a[47]=e=>b("我为什么总是存不住钱？"))},"我为什么总是存不住钱？"),s("p",{onClick:a[48]||(a[48]=e=>b("是什么原因导致我财务紧张？"))}," 是什么原因导致我财务紧张？ "),s("p",{onClick:a[49]||(a[49]=e=>b("我最近会有破财风险吗？"))},"我最近会有破财风险吗？"),s("p",{onClick:a[50]||(a[50]=e=>b("如何避免不必要的财务损失？"))}," 如何避免不必要的财务损失？ "),s("p",{onClick:a[51]||(a[51]=e=>b("我需要注意哪些年份的破财？"))}," 我需要注意哪些年份的破财？ "),s("p",{onClick:a[52]||(a[52]=e=>b("我该如何处理我的债务问题？"))}," 我该如何处理我的债务问题？ ")])],2),s("div",{id:"renji",class:r(["tab-pane",{active:"renji"===C.value}])},[a[98]||(a[98]=s("h4",{class:"category-heading"},"社交模式",-1)),s("div",J,[s("p",{onClick:a[53]||(a[53]=e=>b("我的人际交往模式有何优缺点？"))}," 我的人际交往模式有何优缺点？ "),s("p",{onClick:a[54]||(a[54]=e=>b("如何拓展我的高质量社交圈？"))}," 如何拓展我的高质量社交圈？ "),s("p",{onClick:a[55]||(a[55]=e=>b("我目前的人际关系状态如何？"))}," 我目前的人际关系状态如何？ "),s("p",{onClick:a[56]||(a[56]=e=>b("我会吸引哪些人进入我的生活？"))}," 我会吸引哪些人进入我的生活？ "),s("p",{onClick:a[57]||(a[57]=e=>b("如何获得他人的信任与支持？"))}," 如何获得他人的信任与支持？ "),s("p",{onClick:a[58]||(a[58]=e=>b("如何处理与朋友的矛盾？"))},"如何处理与朋友的矛盾？")]),a[99]||(a[99]=s("h4",{class:"category-heading"},"贵人善缘",-1)),s("div",X,[s("p",{onClick:a[59]||(a[59]=e=>b("什么样的朋友是我的贵人？"))},"什么样的朋友是我的贵人？"),s("p",{onClick:a[60]||(a[60]=e=>b("我应该远离什么样的朋友？"))},"我应该远离什么样的朋友？"),s("p",{onClick:a[61]||(a[61]=e=>b("如何结交更多志同道合的朋友？"))}," 如何结交更多志同道合的朋友？ "),s("p",{onClick:a[62]||(a[62]=e=>b("我该如何维系重要的友谊？"))},"我该如何维系重要的友谊？"),s("p",{onClick:a[63]||(a[63]=e=>b("我该信任我身边的朋友吗？"))},"我该信任我身边的朋友吗？"),s("p",{onClick:a[64]||(a[64]=e=>b("如何获得领导或长辈的赏识？"))}," 如何获得领导或长辈的赏识？ ")]),a[100]||(a[100]=s("h4",{class:"category-heading"},"家庭关系",-1)),s("div",Y,[s("p",{onClick:a[65]||(a[65]=e=>b("我和家人的关系怎么样？"))},"我和家人的关系怎么样？"),s("p",{onClick:a[66]||(a[66]=e=>b("我的家庭对我有什么样的影响？"))}," 我的家庭对我有什么样的影响？ "),s("p",{onClick:a[67]||(a[67]=e=>b("如何改善我与家人的关系？"))},"如何改善我与家人的关系？"),s("p",{onClick:a[68]||(a[68]=e=>b("我该如何处理家庭矛盾？"))},"我该如何处理家庭矛盾？"),s("p",{onClick:a[69]||(a[69]=e=>b("我与家人的缘分有多深？"))},"我与家人的缘分有多深？"),s("p",{onClick:a[70]||(a[70]=e=>b("如何更好地与家人沟通？"))},"如何更好地与家人沟通？")])],2),s("div",{id:"rensheng",class:r(["tab-pane",{active:"rensheng"===C.value}])},[a[101]||(a[101]=s("h4",{class:"category-heading"},"学业规划",-1)),s("div",Z,[s("p",{onClick:a[71]||(a[71]=e=>b("我的学业运势如何？"))},"我的学业运势如何？"),s("p",{onClick:a[72]||(a[72]=e=>b("我适合考研/考公吗？"))},"我适合考研/考公吗？"),s("p",{onClick:a[73]||(a[73]=e=>b("我适合继续深造还是工作？"))},"我适合继续深造还是工作？"),s("p",{onClick:a[74]||(a[74]=e=>b("如何提升我的学习效率？"))},"如何提升我的学习效率？"),s("p",{onClick:a[75]||(a[75]=e=>b("我该选择哪个专业/学校？"))},"我该选择哪个专业/学校？"),s("p",{onClick:a[76]||(a[76]=e=>b("我这次考试能通过吗？"))},"我这次考试能通过吗？")]),a[102]||(a[102]=s("h4",{class:"category-heading"},"个人成长",-1)),s("div",ee,[s("p",{onClick:a[77]||(a[77]=e=>b("我的性格优势和劣势是什么？"))}," 我的性格优势和劣势是什么？ "),s("p",{onClick:a[78]||(a[78]=e=>b("我的人生主要课题是什么？"))},"我的人生主要课题是什么？"),s("p",{onClick:a[79]||(a[79]=e=>b("如何找到我的人生方向？"))},"如何找到我的人生方向？"),s("p",{onClick:a[80]||(a[80]=e=>b("如何克服我性格中的弱点？"))},"如何克服我性格中的弱点？"),s("p",{onClick:a[81]||(a[81]=e=>b("如何有效提升自己的能量状态？"))}," 如何有效提升自己的能量状态？ "),s("p",{onClick:a[82]||(a[82]=e=>b("我的人生转折点在何时？"))},"我的人生转折点在何时？")]),a[103]||(a[103]=s("h4",{class:"category-heading"},"人生机遇",-1)),s("div",ae,[s("p",{onClick:a[83]||(a[83]=e=>b("我未来十年的人生大运怎么样？"))}," 我未来十年的人生大运怎么样？ "),s("p",{onClick:a[84]||(a[84]=e=>b("我该如何实现我的人生目标？"))}," 我该如何实现我的人生目标？ "),s("p",{onClick:a[85]||(a[85]=e=>b("我的人生会有什么重大机遇？"))}," 我的人生会有什么重大机遇？ "),s("p",{onClick:a[86]||(a[86]=e=>b("我应该注意哪些健康问题？"))},"我应该注意哪些健康问题？"),s("p",{onClick:a[87]||(a[87]=e=>b("如何才能活出更精彩的人生？"))}," 如何才能活出更精彩的人生？ "),s("p",{onClick:a[88]||(a[88]=e=>b("未来的人生之路走向如何？"))},"未来的人生之路走向如何？")])],2)]))}}),[["__scopeId","data-v-cca2c5a5"]]),le={class:"spread-bubbles-container"},te={class:"spread-bubbles"},ie=["onClick"],se={class:"bubble-icon"},oe={class:"bubble-text"},ue={key:0,class:"all-spreads-dropdown"},ce={class:"dropdown-content"},re=["onClick"],pe={class:"item-icon"},de={class:"item-content"},ve={class:"item-title"},ge={class:"item-description"},ye={class:"item-meta"},me={class:"item-count"},ke={key:1,class:"positions-detail"},he={class:"positions-grid"},Ce=v(e({__name:"TarotSpreadSelector",props:{modelValue:{default:"single"},showPositions:{type:Boolean,default:!1},maxVisibleSpreads:{default:4}},emits:["update:modelValue","change"],setup(e,{emit:n}){const v=e,h=n,C=t(v.modelValue),b=t(!1),f=t(0),w=t(),T=["single","three","love","career","decision","celtic","chakra","year"],q=a(()=>{if(0===f.value)return v.maxVisibleSpreads;const e=f.value<=480,a=f.value<=768;let n=95,l=75,t=6,i=10;e?(n=75,l=60,t=4,i=8):a&&(n=85,l=65,t=5,i=8);const s=f.value;if(s<n)return 1;if(T.length*n+(T.length-1)*t<=s)return T.length;const o=s-l-t-i;let u=1,c=n;for(let p=1;p<T.length;p++){const e=c+t+n;if(!(e<=o))break;u=p+1,c=e}const r=Math.min(2,T.length);return Math.max(r,u)}),x=a(()=>{const e=q.value,a=T.indexOf(C.value);return e>=T.length?T:a<e?T.slice(0,e):[...T.slice(0,e-1),C.value]}),R=a(()=>q.value<T.length);function I(e){C.value=e,h("update:modelValue",e),h("change",e)}function _(){b.value=!b.value}function V(){b.value=!1}function A(e){return{single:"🔮",three:"🃏",love:"💕",career:"💼",decision:"⚖️",celtic:"✨",chakra:"🧘",year:"📅"}[e]||"🎴"}function L(){if(w.value){const e=w.value.getBoundingClientRect();f.value=e.width}}function $(e){w.value&&!w.value.contains(e.target)&&V()}return g(()=>{setTimeout(()=>{L()},100),window.addEventListener("resize",L),document.addEventListener("click",$)}),y(()=>{window.removeEventListener("resize",L),document.removeEventListener("click",$)}),m(()=>v.modelValue,e=>{e&&e!==C.value&&(C.value=e)}),(e,a)=>(d(),i("div",{ref_key:"selectorRef",ref:w,class:"tarot-spread-selector"},[s("div",le,[s("div",te,[(d(!0),i(u,null,c(x.value,e=>(d(),i("button",{key:e,class:r(["spread-bubble",{active:C.value===e}]),onClick:a=>I(e)},[s("span",se,p(A(e)),1),s("span",oe,p(k(l)[e].name),1)],10,ie))),128)),R.value?(d(),i("button",{key:0,class:"spread-bubble expand-button",onClick:_},[...a[0]||(a[0]=[s("span",{class:"bubble-icon"},"⋯",-1),s("span",{class:"bubble-text"},"全部",-1)])])):o("",!0)])]),b.value?(d(),i("div",ue,[s("div",ce,[(d(),i(u,null,c(T,e=>s("div",{key:e,class:r(["spread-item",{active:C.value===e}]),onClick:a=>function(e){I(e),V()}(e)},[s("div",pe,p(A(e)),1),s("div",de,[s("div",ve,p(k(l)[e].name),1),s("div",ge,p(k(l)[e].description),1)]),s("div",ye,[s("span",me,p(k(l)[e].cardCount)+"张",1)])],10,re)),64))])])):o("",!0),e.showPositions&&C.value?(d(),i("div",ke,[a[1]||(a[1]=s("h4",null,"牌位说明",-1)),s("div",he,[(d(!0),i(u,null,c(k(l)[C.value].positions,(e,a)=>(d(),i("span",{key:a,class:"position-item"},p(a+1)+". "+p(e),1))),128))])])):o("",!0)],512))}}),[["__scopeId","data-v-ad63d20b"]]),be={key:0,src:"/static/ssgw.jpg",alt:"三山国王",class:"card-image"},fe={class:"card-title"},we={class:"card-description"},Te={key:1,class:"tarot-spread-container"},qe={class:"input-container"},xe=["placeholder","disabled"],Re=["disabled"],Ie={key:0},_e={key:1,class:"loading-text"},Ve={key:2,class:"ssgw-process"},Ae={key:0,class:"shaking-animation"},Le={class:"shaking-text"},$e={class:"shaking-visual"},je={class:"sign-container"},Ee={key:1,class:"tossing-section"},De={class:"result-section"},He={key:0,class:"result-section"},Se=["innerHTML"],Ue={key:1,class:"bei-container"},Fe=["src","alt"],Be={key:2,class:"button-wrapper"},Me=["disabled"],Pe=v(e({__name:"DivinationInput",props:{title:{},description:{},placeholder:{default:"请输入您的问题"},buttonText:{default:"询问赛博大师"},loadingText:{default:"AI思考中"},loading:{type:Boolean,default:!1},modelValue:{default:""},examples:{default:()=>[]},showInspiration:{type:Boolean,default:!0},hideAfterSubmit:{type:Boolean,default:!0},divinationType:{default:""}},emits:["update:modelValue","submit","typeChange","clear"],setup(e,{emit:n}){const v=e,y=n,k=h();x();const I=t(v.modelValue),_=t(O()),V=t("single"),A=t(!1),L=t(!1),$=t(""),j=t(0),E=t(!1),D=t(!1),H=t(0),S=t([]),U=t(""),F=t(0),B=t(!1),M=t(""),P=a(()=>"ssgw"===v.divinationType?"可输入您的问题，也可直接求签":v.placeholder),N=a(()=>"ssgw"!==v.divinationType&&!k.path.includes("/divination/ssgw")&&v.showInspiration),z=a(()=>k.path.includes("/divination/tarot")),G=a(()=>{if(z.value){const e=l[V.value];return e?`塔罗牌·${e.name}`:v.title}return v.title}),K=a(()=>{if(z.value){const e=l[V.value];return e?e.description:v.description}return v.description});function O(){const e=k.path;return e.includes("/divination/tarot_single")?"tarot_single":(e.includes("/divination/tarot"),"tarot")}function Q(){I.value="",A.value=!1}function W(){if("ssgw"===v.divinationType||k.path.includes("/ssgw")){const e=I.value.trim()||"心中所想之事";return A.value=!0,y("clear"),void J(e)}I.value.trim()&&!v.loading&&(A.value=!0,y("submit",{question:I.value.trim()}))}function J(e){M.value=e,L.value=!0,$.value="请静心默念，准备摇签...",j.value=0,setTimeout(()=>{$.value="正在摇签中...";const e=setInterval(()=>{j.value++,j.value>=5&&(clearInterval(e),setTimeout(()=>{H.value=Math.floor(61*Math.random())+1,L.value=!1,D.value=!0,F.value=0,B.value=!1,S.value=[],U.value=""},1e3))},400)},2e3)}function X(){if(E.value)return;E.value=!0,S.value=[],U.value="";const e=R();setTimeout(()=>{S.value=[e.bei1,e.bei2];const a=e.result;"圣杯"===a&&(B.value=!0),"圣杯"===a?(U.value="<strong>圣杯</strong> (一平一凸) - 神明同意此签。",setTimeout(()=>{U.value+="<p>正在为您解读签文...</p>",setTimeout(()=>{y("submit",{question:M.value,signNumber:H.value})},2e3)},1e3)):(F.value++,U.value="笑杯"===a?"<strong>笑杯</strong> (两平) - 神明笑而不语，可能问题不明或时机未到。":"<strong>阴杯</strong> (两凸) - 神明不同意此签。",F.value>=3?(U.value+="<p>您已连续三次未能获得圣杯，看来今日不宜再问此事，请改日再来。</p>",E.value=!1):(U.value+="<p>请重新为您摇签...</p>",setTimeout(()=>{D.value=!1,S.value=[],U.value="",J(M.value)},2e3))),E.value=!1},1300)}function Y(e){if(v.loading)return;I.value=e;const a=document.getElementById("userInput");a&&a.focus()}function Z(e){v.loading||e&&e.trim()&&(I.value=e,A.value=!0,y("submit",{question:e}))}function ee(e){V.value=e,y("typeChange",`tarot_${e}`),I.value=""}return m(()=>v.modelValue,e=>{I.value=e}),m(I,e=>{y("update:modelValue",e)}),m(()=>v.divinationType,(e,a)=>{a&&e!==a&&Q()}),m(()=>k.path,()=>{z.value&&(_.value=O()),Q()}),g(()=>{z.value&&y("typeChange",`tarot_${V.value}`)}),(e,a)=>(d(),i(u,null,[s("div",{class:r(["input-card",{loading:e.loading}])},["ssgw"===e.divinationType?(d(),i("img",be)):o("",!0),s("h2",fe,p(G.value),1),s("p",we,p(K.value),1),z.value?(d(),i("div",Te,[b(Ce,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),onChange:ee},null,8,["modelValue"])])):o("",!0),s("div",qe,[f(s("input",{id:"userInput","onUpdate:modelValue":a[1]||(a[1]=e=>I.value=e),type:"text",placeholder:P.value,disabled:e.loading,class:"question-input",onKeyup:T(W,["enter"])},null,40,xe),[[w,I.value]]),a[2]||(a[2]=s("div",{class:"input-focus-border"},null,-1))]),s("div",{class:r(["button-wrapper",{"ai-thinking":e.loading}])},[s("button",{id:"submitButton",disabled:e.loading||"ssgw"!==e.divinationType&&!I.value.trim(),class:"submit-button",onClick:W},[e.loading?(d(),i("span",_e,[q(p(e.loadingText)+" ",1),a[3]||(a[3]=s("span",{class:"loading-dots"},[s("span",{class:"dot"}),s("span",{class:"dot"}),s("span",{class:"dot"})],-1))])):(d(),i("span",Ie,p(e.buttonText),1))],8,Re)],2),"ssgw"===e.divinationType&&(L.value||E.value||D.value)?(d(),i("div",Ve,[L.value?(d(),i("div",Ae,[s("p",Le,p($.value),1),s("div",$e,[s("div",je,[(d(),i(u,null,c(5,e=>s("div",{key:e,class:r(["sign-stick",{active:e<=j.value}])},null,2)),64))])])])):o("",!0),E.value||D.value?(d(),i("div",Ee,[s("div",De,[s("p",null,[a[4]||(a[4]=q(" 求得第 ",-1)),s("strong",null,p(H.value),1),a[5]||(a[5]=q(" 签。 ",-1))]),a[6]||(a[6]=s("p",null,"请投掷圣杯，询问三山国王是否同意此签...",-1))]),U.value?(d(),i("div",He,[s("p",{innerHTML:U.value},null,8,Se)])):o("",!0),S.value.length>0?(d(),i("div",Ue,[(d(!0),i(u,null,c(S.value,(e,a)=>(d(),i("img",{key:a,src:`/static/${e}.png`,alt:e,class:"bei-image"},null,8,Fe))),128))])):o("",!0),!B.value&&F.value<3?(d(),i("div",Be,[s("button",{disabled:E.value,class:"toss-button",onClick:X},p(E.value?"投掷中...":"投掷圣杯"),9,Me)])):o("",!0)])):o("",!0)])):o("",!0)],2),N.value?(d(),C(ne,{key:0,"spread-type":z.value?V.value:null,onSelect:Y,onSubmit:Z},null,8,["spread-type"])):o("",!0)],64))}}),[["__scopeId","data-v-5914186f"]]);function Ne(e){const n=h(),l=x(),i=a(()=>e.divinationType),s=t(""),o=t(!1),u=t(null),c=t(""),r=t(null),p=t(!1),d=t(!1),v=t(!1),g=t(null),y=t(!1),m=t([]),k=t(""),C=t(!1),b=a(()=>null!==u.value),f=a(()=>""!==c.value);function w(e){d.value=!0;const a=V.getRecord(e);a?(s.value=a.question,u.value=a.result,c.value=a.result.aiResponse||"",m.value=[{id:`hist-sys-${a.id}`,role:"system",content:"你是精通周易、梅花易数、奇门遁甲、塔罗牌等术数的AI助手。请根据占卜结果，为用户提供解读。"},{id:`hist-user-${a.id}`,role:"user",content:a.question},{id:`hist-asst-${a.id}`,role:"assistant",content:a.result.aiResponse||""}]):l.push(`/divination/${i.value}`)}return{question:s,isLoading:o,result:u,aiResponse:c,error:r,isAiLoading:p,viewingHistory:d,isCopied:v,isCancelled:y,conversationHistory:m,followUpQuestion:k,isFollowUpLoading:C,hasResult:b,hasAiResponse:f,startDivination:async function(e={}){if(d.value)return;const{signNumber:a,spreadType:n}=e;if(!o.value&&s.value.trim()){o.value=!0,p.value=!0,r.value=null,u.value=null,c.value="",y.value=!1,g.value=new AbortController,m.value=[];try{const e={role:"system",content:"你是精通周易、梅花易数、奇门遁甲、塔罗牌等术数的AI助手。请根据占卜结果，为用户提供解读。"},l={id:`msg-${Date.now()}`,role:"user",content:s.value},d={id:`msg-${Date.now()+1}`,role:"assistant",content:t("")};m.value=[e,l,d],u.value={id:"",type:i.value,data:{},aiResponse:""},o.value=!1,_({type:i.value,question:s.value.trim(),signNumber:a,spreadType:n,signal:g.value.signal},e=>{c.value+=e,"object"==typeof d.content&&"value"in d.content&&(d.content.value+=e)},e=>{r.value=e,"object"==typeof d.content&&"value"in d.content&&(d.content.value=e)},e=>{p.value=!1,u.value&&(u.value.id=e.id,u.value.data=e.data,u.value.aiResponse=c.value)}).then(e=>{u.value&&(u.value.id=e.id,u.value.data=e.data)}).catch(e=>{r.value=e instanceof Error?e.message:"占卜失败，请稍后重试",o.value=!1,p.value=!1})}catch(l){r.value=l instanceof Error?l.message:"占卜失败，请稍后重试",o.value=!1}}},clearResult:function(){u.value=null,c.value="",r.value=null,s.value="",d.value=!1,m.value=[],k.value=""},loadResultFromHistory:w,regenerateAI:async function(){if(!u.value||p.value)return;p.value=!0,r.value=null,c.value="",y.value=!1,g.value=new AbortController;const e={id:`msg-${Date.now()}`,role:"assistant",content:t("")};m.value.push(e);try{const a=await _({type:i.value,question:s.value,signal:g.value.signal},a=>{c.value+=a,"object"==typeof e.content&&"value"in e.content&&(e.content.value+=a)},a=>{r.value=a,"object"==typeof e.content&&"value"in e.content&&(e.content.value=a)},()=>{p.value=!1,u.value&&(u.value.aiResponse=c.value)});a.aiResponse&&"object"==typeof e.content&&"value"in e.content&&(e.content.value=a.aiResponse),u.value&&(u.value.aiResponse=a.aiResponse||"")}catch(a){r.value="重新生成失败，请稍后重试"}},handleHistoryParam:function(){const e=n.query.historyId;e&&w(e)},clearHistoryParam:function(){if(n.query.historyId){const e={...n.query};delete e.historyId,l.replace({path:n.path,query:e})}},shareResult:function(){if(!c.value)return;const e=function(e){if(!e)return"";const a=j.parse(e);return((new DOMParser).parseFromString(a,"text/html").body.textContent||"").replace(/"/g,'"').replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/'/g,"'").replace(/\n{3,}/g,"\n\n").trim()}(c.value);navigator.clipboard.writeText(e).then(()=>{v.value=!0,setTimeout(()=>{v.value=!1},2e3)})},cancelGeneration:function(){g.value&&(g.value.abort(),y.value=!0,p.value=!1)},handleSendFollowUp:function(){if(!k.value.trim()||C.value)return;const e={id:`msg-${Date.now()}`,role:"user",content:k.value.trim()};m.value.push(e);const a={id:`msg-${Date.now()+1}`,role:"assistant",content:t("")};m.value.push(a),k.value="",C.value=!0;const n=`基于以下占卜结果和用户问题，请回答用户的追问：\n\n用户原始问题：${s.value}\n\n占卜结果：${c.value}\n\n用户追问：${e.content}\n\n请直接回答用户的追问，不要重复之前的内容。`;I(n,e=>{c.value+=e,"object"==typeof a.content&&"value"in a.content&&(a.content.value+=e)},e=>{C.value=!1,u.value&&(u.value.aiResponse=e)},e=>{C.value=!1,"object"==typeof a.content&&"value"in a.content&&(a.content.value=e)})}}}const ze={key:1,class:"result-header-actions"},Ge={key:3,class:"ai-actions"},Ke={key:4,class:"content-card error-card"},Oe={class:"content-text"},Qe={key:5,class:"content-card follow-up-card"},We={class:"follow-up-input"},Je=["disabled"],Xe=["disabled"],Ye={key:0},Ze={key:1},ea=v(e({__name:"UnifiedDivinationView",props:{divinationType:{}},setup(e){const n=e,l=h(),u=a(()=>A(n.divinationType)),{question:c,isLoading:r,result:v,aiResponse:y,error:b,isAiLoading:q,hasResult:x,hasAiResponse:R,viewingHistory:I,isCopied:_,isCancelled:V,startDivination:j,clearResult:D,shareResult:H,regenerateAI:S,handleHistoryParam:U,clearHistoryParam:F,cancelGeneration:B,conversationHistory:M,followUpQuestion:P,isFollowUpLoading:N,handleSendFollowUp:z}=Ne(n),G=a(()=>v.value?{data:v.value.data,aiResponse:y.value}:{data:{},aiResponse:""}),K=t("single");function O(e){if(e.startsWith("tarot_")){const a=e.replace("tarot_","");K.value=a}}function Q(e){e.question||c.value,e.question&&(c.value=e.question);const a={};"tarot"===n.divinationType?a.spreadType=K.value:"ssgw"===n.divinationType&&(a.signNumber=e.signNumber),j(a)}function W(){D(),F()}function J(){b.value=null}function X(){S()}return m(()=>n.divinationType,(e,a)=>{!I.value&&a&&e!==a&&(D(),F(),c.value="",P.value="",M.value=[],b.value=null,V.value=!1,window.scrollTo(0,0),requestAnimationFrame(()=>{document.querySelectorAll(".page-container, .sidebar, main, .app-container, .main-wrapper, .content-wrapper, .main-content, .input-card, .inspiration-card, .questions-wrapper, .result-header-actions, .ai-actions, .follow-up-card, .error-card").forEach(e=>{e instanceof HTMLElement&&(e.scrollTop=0,e.scrollLeft=0)}),document.documentElement.scrollTop=0,document.body.scrollTop=0,document.documentElement.scrollLeft=0,document.body.scrollLeft=0,requestAnimationFrame(()=>{window.scrollTo(0,0),document.documentElement.scrollTop=0,document.body.scrollTop=0})}))},{immediate:!1}),m(u,e=>{}),m(()=>l.query.historyId,(e,a)=>{e&&"string"==typeof e?U():a&&!e&&D()},{immediate:!0}),g(()=>{U()}),(e,a)=>{var n,t,v,g,y;return d(),i("div",{class:"page-container",key:e.divinationType},[k(x)||k(r)?o("",!0):(d(),C(Pe,{key:0,modelValue:k(c),"onUpdate:modelValue":a[0]||(a[0]=e=>L(c)?c.value=e:null),title:(null==(n=u.value)?void 0:n.title)||"",description:(null==(t=u.value)?void 0:t.description)||"","button-text":(null==(v=u.value)?void 0:v.buttonText)||"开始占卜",loading:k(r),placeholder:(null==(g=u.value)?void 0:g.placeholder)||"",examples:(null==(y=u.value)?void 0:y.examples)||[],"divination-type":e.divinationType,"hide-after-submit":!1,onSubmit:Q,onTypeChange:O,onClear:k(D)},null,8,["modelValue","title","description","button-text","loading","placeholder","examples","divination-type","onClear"])),k(x)&&!k(l).query.historyId?(d(),i("div",ze,[s("button",{class:"btn-secondary",onClick:W},"← 返回"),k(R)&&!k(q)?(d(),i("button",{key:0,class:"btn-secondary",onClick:a[1]||(a[1]=(...e)=>k(H)&&k(H)(...e))},p(k(_)?"已复制!":"分享"),1)):o("",!0)])):o("",!0),k(x)?(d(),C(E,{key:2,type:e.divinationType,result:G.value,"is-ai-loading":k(q)||k(N),error:k(b),question:k(c),"conversation-history":k(M),"is-follow-up-loading":k(N),onRetry:X},null,8,["type","result","is-ai-loading","error","question","conversation-history","is-follow-up-loading"])):o("",!0),k(x)?(d(),i("div",Ge,[k(q)?(d(),i("button",{key:0,class:"btn-secondary",onClick:a[2]||(a[2]=(...e)=>k(B)&&k(B)(...e))},"取消生成")):o("",!0),k(q)||!k(b)&&!k(V)?o("",!0):(d(),i("button",{key:1,class:"btn-primary",onClick:X}," 重新生成 "))])):o("",!0),k(b)&&!k(x)?(d(),i("div",Ke,[s("p",Oe,p(k(b)),1),s("div",{class:"form-actions"},[s("button",{class:"btn-primary",onClick:J},"重试")])])):o("",!0),k(R)&&!k(q)?(d(),i("div",Qe,[s("div",We,[f(s("textarea",{"onUpdate:modelValue":a[3]||(a[3]=e=>L(P)?P.value=e:null),placeholder:"对AI的解读进行追问...",disabled:k(N),onKeydown:a[4]||(a[4]=T($((...e)=>k(z)&&k(z)(...e),["prevent"]),["enter"]))},null,40,Je),[[w,k(P)]]),s("button",{disabled:k(N),onClick:a[5]||(a[5]=(...e)=>k(z)&&k(z)(...e))},[k(N)?(d(),i("span",Ze,"发送中...")):(d(),i("span",Ye,"发送"))],8,Xe)])])):o("",!0)])}}}),[["__scopeId","data-v-344727c7"]]);export{ea as default};
