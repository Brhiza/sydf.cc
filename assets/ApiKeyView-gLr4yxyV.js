import{J as q,f as p,d as F,e as r,w as T,i as J,c as d,a as s,b as R,m as k,k as G,K as W,n as E,v as B,L as H,F as Q,r as X,t as O,u as Y,o as v,_ as Z}from"./index-DHImxpqG.js";function ee(){const o=q(),w=p(()=>o.settings.customApiKey),A=p(()=>o.settings.customApiEndpoint),y=p(()=>o.settings.useCustomApi),h=p(()=>o.settings.selectedModel),M=p(()=>o.settings.availableModels),S=p(()=>o.isLoadingModels),P=p(()=>o.error);function _(a){o.updateSettings({customApiKey:a})}function x(a){o.updateSettings({customApiEndpoint:a})}function K(a){o.updateSettings({useCustomApi:a})}function U(a){o.updateSettings({selectedModel:a})}async function $(a,i){return o.fetchAvailableModels(a||o.settings.customApiEndpoint,i||o.settings.customApiKey)}function V(){o.resetSettings()}return{customApiKey:w,customApiEndpoint:A,useCustomApi:y,selectedModel:h,availableModels:M,isLoadingModels:S,error:P,updateCustomApiKey:_,updateCustomApiEndpoint:x,updateUseCustomApi:K,updateSelectedModel:U,fetchAvailableModels:$,resetSettings:V}}const te={class:"api-key-view"},se={class:"api-key-container"},le={class:"form-section"},ae={class:"form-group"},oe={class:"form-label"},ie=["disabled"],ne=["disabled"],ue={class:"model-selection-wrapper"},re=["disabled"],de=["value"],ve=["disabled"],ce={key:0},pe={key:1},be={class:"form-hint"},me={key:0,class:"error-text"},fe={key:1,class:"debug-text"},ge={key:2},Ae=F({__name:"ApiKeyView",setup(o){const w=Y(),{customApiKey:A,customApiEndpoint:y,useCustomApi:h,selectedModel:M,availableModels:S,isLoadingModels:P,error:_,updateCustomApiKey:x,updateCustomApiEndpoint:K,updateUseCustomApi:U,updateSelectedModel:$,resetSettings:V}=ee(),a=r(A.value||""),i=r(y.value||""),n=r(h.value),u=r(M.value||""),I=r([...S.value]),b=r(P.value),c=r(_.value),m=r(null);T([A,y,h,M,S,P,_],([e,t,,l,f,g,C])=>{(a.value===""||a.value===(A.value||""))&&(a.value=e||""),(i.value===""||i.value===(y.value||""))&&(i.value=t||""),(u.value===""||u.value===(M.value||""))&&(u.value=l||""),I.value=[...f],b.value=g,c.value=C},{immediate:!0}),T(h,e=>{n.value===!1&&e===!0&&(n.value=e)},{immediate:!0}),J(()=>{console.log("ApiKeyView 已加载",{apiKey:a.value?"已设置":"未设置",apiEndpoint:i.value,useCustomApi:n.value,selectedModel:u.value,availableModels:I.value})});async function N(e,t){if(!e||!t)return["gpt-3.5-turbo","gpt-4","gpt-4-turbo"];try{let l;e.includes("/v1/chat/completions")?l=`${e.split("/v1/chat/completions")[0]}/v1/models`:e.includes("/v1")?l=`${e.split("/v1")[0]}/v1/models`:l=e.endsWith("/")?`${e}v1/models`:`${e}/v1/models`,console.log("获取模型列表的URL:",l);const f=await fetch(l,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!f.ok)throw new Error(`获取模型列表失败: ${f.status} ${f.statusText}`);const g=await f.json();if(!g.data||!Array.isArray(g.data))return console.warn("API响应格式不符合预期:",g),["sydf-v1-250520","gpt-3.5-turbo","gpt-4","gpt-4-turbo"];const C=g.data.map(L=>L.id).sort();return C.length===0?["sydf-v1-250520","gpt-3.5-turbo","gpt-4","gpt-4-turbo"]:C}catch(l){throw console.error("获取模型列表失败:",l),l}}async function z(){if(!a.value||!i.value){c.value="请先填写API密钥和端点";return}c.value=null,m.value=null,b.value=!0;try{console.log("正在获取模型列表..."),m.value=`正在从 ${i.value} 获取模型列表...`;const e=await N(i.value,a.value);console.log("获取到的模型列表:",e),e&&e.length>0?(I.value=e,m.value=`成功获取到 ${e.length} 个模型`,!e.includes(u.value)&&e.length>0&&(u.value=e[0])):(c.value="未找到可用模型，使用默认模型列表",I.value=["sydf-v1-250520","gpt-3.5-turbo","gpt-4","gpt-4-turbo"])}catch(e){console.error("获取模型列表失败:",e),c.value=e instanceof Error?e.message:"获取模型列表失败",m.value=`错误详情: ${JSON.stringify(e)}`}finally{b.value=!1}}function D(){try{x(a.value),K(i.value),U(n.value),$(u.value),alert("设置已保存"),w.push("/")}catch(e){console.error("保存设置失败:",e),alert(`保存设置失败: ${e instanceof Error?e.message:"未知错误"}`)}}function j(){V(),a.value="",i.value="",n.value=!1,u.value="sydf-v1-250520",alert("设置已重置")}return(e,t)=>(v(),d("div",te,[t[12]||(t[12]=s("h1",{class:"page-title"},"API 配置",-1)),s("div",se,[s("div",le,[s("div",ae,[s("label",oe,[k(s("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l),class:"form-checkbox"},null,512),[[W,n.value]]),t[4]||(t[4]=G(" 启用自定义 API "))]),t[5]||(t[5]=s("div",{class:"form-hint"},"启用后将使用您自己的 API，否则使用内置 AI 服务",-1))]),s("div",{class:E(["form-group",{"form-disabled":!n.value}])},[t[6]||(t[6]=s("label",{class:"form-label"},"API 密钥",-1)),k(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=l=>a.value=l),class:"form-input",placeholder:"输入您的 API Key",disabled:!n.value},null,8,ie),[[B,a.value]]),t[7]||(t[7]=s("div",{class:"form-hint"},"请输入与 OpenAI 格式兼容的 API 密钥",-1))],2),s("div",{class:E(["form-group",{"form-disabled":!n.value}])},[t[8]||(t[8]=s("label",{class:"form-label"},"API 端点",-1)),k(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=l=>i.value=l),class:"form-input",placeholder:"https://api.example.com/v1/chat/completions",disabled:!n.value},null,8,ne),[[B,i.value]]),t[9]||(t[9]=s("div",{class:"form-hint"},"请输入与 OpenAI 格式兼容的 API 端点",-1))],2),s("div",{class:E(["form-group",{"form-disabled":!n.value}])},[t[10]||(t[10]=s("label",{class:"form-label"},"选择模型",-1)),s("div",ue,[k(s("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>u.value=l),class:"form-select",disabled:!n.value},[(v(!0),d(Q,null,X(I.value,l=>(v(),d("option",{key:l,value:l},O(l),9,de))),128))],8,re),[[H,u.value]]),s("button",{onClick:z,class:E(["fetch-models-button",{loading:b.value}]),disabled:!n.value||!a.value||!i.value||b.value},[b.value?(v(),d("span",ce,"加载中...")):(v(),d("span",pe,"获取模型列表"))],10,ve)]),s("div",be,[c.value?(v(),d("span",me,O(c.value),1)):m.value?(v(),d("span",fe,O(m.value),1)):(v(),d("span",ge,"选择要使用的模型，或从您的API提供商获取可用模型列表"))])],2),s("div",{class:"form-actions"},[s("button",{onClick:D,class:"primary-button"},"保存设置"),s("button",{onClick:j,class:"secondary-button"},"重置")])]),t[11]||(t[11]=R('<div class="info-section" data-v-240bebc5><h2 class="info-title" data-v-240bebc5>使用说明</h2><div class="info-content" data-v-240bebc5><p data-v-240bebc5>您可以配置兼容 OpenAI 格式的 API，包括但不限于：</p><ul data-v-240bebc5><li data-v-240bebc5>OpenAI API</li><li data-v-240bebc5>Azure OpenAI</li><li data-v-240bebc5>自托管的开源模型 API</li><li data-v-240bebc5>其他兼容 OpenAI 格式的 API 服务</li></ul><p data-v-240bebc5><strong data-v-240bebc5>注意：</strong> API 密钥将安全地存储在您的浏览器本地，不会发送到我们的服务器。 </p><p data-v-240bebc5><strong data-v-240bebc5>模型获取：</strong> 点击&quot;获取模型列表&quot;按钮将从您配置的API端点获取可用的模型列表。 如果获取失败，将使用默认模型列表。 </p></div></div>',1))])]))}}),he=Z(Ae,[["__scopeId","data-v-240bebc5"]]);export{he as default};
