import{d as a}from"./markdown-CaxBdgEJ.js";import{d as e,h as s,r as n,m as t,c as l,b as i,f as r,e as o,L as d,x as c,t as u,n as p,M as m,l as g,E as v,p as y,g as h,F as f,k,u as x,N as w}from"./vendor-cAEEXcX9.js";import{_ as b,L as A}from"./index-CqUvQr7Y.js";const _={class:"markdown-content streaming-markdown-content"},$=["innerHTML"],T=["innerHTML"],I=b(e({__name:"StreamingMarkdown",props:{content:{},isComplete:{type:Boolean,default:!1}},setup(e){const d=e,c=s(()=>"string"==typeof d.content?d.content:d.content.value),u=n(""),p=n(""),m=n(!1);a.setOptions({breaks:!0,gfm:!0});const g=["think","thinking","reason","analyze","reflect"],v={think:"查看AI的思考过程",thinking:"查看AI的详细思考",reason:"查看AI的推理过程",analyze:"查看AI的分析过程",reflect:"查看AI的反思过程"},y={think:"AI正在思考...",thinking:"AI正在详细思考...",reason:"AI正在推理...",analyze:"AI正在分析...",reflect:"AI正在反思..."};return t([c,()=>d.isComplete],async([e,s],[n,t])=>{let l="",i="",r=!1;const o=g.map(a=>`<${a}>|</${a}>`).join("|"),d=e.split(new RegExp(`(${o})`,"g"));let c="";for(const u of d){const e=u.match(/^<(\w+)>$/),n=u.match(/^<\/(\w+)>$/);if(e&&g.includes(e[1]))r=!0,c=e[1],i="";else if(n&&g.includes(n[1])){if(r&&c===n[1]){const e=await a.parse(i);l+=s?`<details class="thinking-${c}"><summary>${v[c]}</summary><div class="thinking-content">${e}</div></details>`:`<details open class="thinking-${c}"><summary>${y[c]}</summary><div class="thinking-content">${e}</div></details>`,r=!1,c=""}else if(!r){i=l,l="";const e=await a.parse(i),s=n[1];l+=`<details class="thinking-${s}"><summary>${v[s]||"查看AI的思考过程"}</summary><div class="thinking-content">${e}</div></details>`,i=""}}else u&&(r?i+=u:l+=await a.parse(u))}r?(u.value=l,p.value=await a.parse(i),m.value=!0):(u.value=l,p.value="",m.value=!1)},{immediate:!0}),(a,e)=>(o(),l("div",_,[i("div",{innerHTML:u.value},null,8,$),m.value?(o(),l("div",{key:0,class:"thinking-bubble",innerHTML:p.value},null,8,T)):r("",!0)]))}}),[["__scopeId","data-v-e289a1d9"]]);function H(a){return{formatSolarTime:s(()=>{const e=a.value.timestamp;if(!e){if("timeInfo"in a.value&&a.value.timeInfo&&"object"==typeof a.value.timeInfo&&"solar"in a.value.timeInfo){const e=a.value.timeInfo.solar;if(e)return`${e.year}年${e.month}月${e.day}日${e.hour}时${e.minute}分`}return""}const s=new Date(e);return`${s.getFullYear()}年${s.getMonth()+1}月${s.getDate()}日${s.getHours()}时${s.getMinutes()}分`}),formatGanZhi:s(()=>{if(!a.value.ganzhi)return"";const{year:e,month:s,day:n,hour:t}=a.value.ganzhi;return`${e}年 ${s}月 ${n}日 ${t}时`})}}function C(a){return{reversedYaosDetail:s(()=>a.value.yaosDetail?[...a.value.yaosDetail].reverse():[])}}const z={class:"result-header"},L={key:0,class:"info-line"},Y={class:"info-value"},N={key:1,class:"info-line"},j={class:"info-value"},G=b(e({__name:"ResultHeader",props:{solarTime:{},ganzhiTime:{}},setup:a=>(e,s)=>(o(),l("div",z,[a.solarTime?(o(),l("div",L,[s[0]||(s[0]=i("span",{class:"info-label"},"公历时间：",-1)),i("span",Y,u(a.solarTime),1)])):r("",!0),a.ganzhiTime?(o(),l("div",N,[s[1]||(s[1]=i("span",{class:"info-label"},"干支：",-1)),i("span",j,u(a.ganzhiTime),1)])):r("",!0),c(e.$slots,"default",{},void 0)]))}),[["__scopeId","data-v-6322c7c2"]]),D={key:0,class:"yang-line"},S={key:1,class:"yin-line"},B=b(e({__name:"YaoSymbol",props:{yaoType:{},isMain:{type:Boolean,default:!0}},setup:a=>(e,s)=>(o(),l("div",{class:p(["yao-symbol",{"main-yao":a.isMain,"changed-yao":!a.isMain}])},["阳"===a.yaoType?(o(),l("div",D)):"阴"===a.yaoType?(o(),l("div",S,[...s[0]||(s[0]=[i("div",{class:"yin-segment"},null,-1),i("div",{class:"yin-gap"},null,-1),i("div",{class:"yin-segment"},null,-1)])])):r("",!0)],2))}),[["__scopeId","data-v-c5effd2c"]]),M={class:"base-result-layout"},R=b(e({__name:"BaseResultLayout",setup:a=>(a,e)=>(o(),l("div",M,[c(a.$slots,"default",{},void 0)]))}),[["__scopeId","data-v-bb8ae905"]]),F={class:"hexagram-info"},E={class:"hexagram-line"},Z={class:"hexagram-value"},q={class:"hexagram-line"},P={class:"hexagram-value"},U={key:0,class:"hexagram-line"},V={class:"hexagram-value"},O={key:1,class:"hexagram-line"},Q={class:"hexagram-value"},W={key:2,class:"hexagram-line"},J={class:"hexagram-value"},K={class:"paipan-section"},X={class:"hexagram-container"},aa={class:"main-hexagram"},ea={class:"six-god"},sa={class:"change-mark"},na={key:0},ta={class:"yao-info"},la={class:"void-mark"},ia={class:"world-response"},ra={class:"changed-hexagram"},oa={class:"yao-info"},da=b(e({__name:"LiuyaoResult",props:{data:{}},setup(a){const e=a,{formatSolarTime:s,formatGanZhi:n}=H(m(e,"data")),{reversedYaosDetail:t}=C(m(e,"data"));return(e,d)=>(o(),g(R,null,{default:v(()=>[y(G,{"solar-time":x(s),"ganzhi-time":x(n)},{default:v(()=>[i("div",F,[i("div",E,[d[0]||(d[0]=i("span",{class:"hexagram-label"},"主卦：",-1)),i("span",Z,[h(u(a.data.originalName)+" ",1),a.data.palace?.name?(o(),l(f,{key:0},[h("（"+u(a.data.palace.name)+"宫）",1)],64)):r("",!0)])]),i("div",q,[d[1]||(d[1]=i("span",{class:"hexagram-label"},"变卦：",-1)),i("span",P,u(a.data.changedName),1)]),a.data.voidBranches&&a.data.voidBranches.length>0?(o(),l("div",U,[d[2]||(d[2]=i("span",{class:"hexagram-label"},"旬空：",-1)),i("span",V,u(a.data.voidBranches.join("、")),1)])):r("",!0),a.data.interName?(o(),l("div",O,[d[3]||(d[3]=i("span",{class:"hexagram-label"},"互卦：",-1)),i("span",Q,u(a.data.interName),1)])):r("",!0),a.data.changingYaos&&a.data.changingYaos.length>0?(o(),l("div",W,[d[4]||(d[4]=i("span",{class:"hexagram-label"},"动爻：",-1)),i("span",J,[(o(!0),l(f,null,k(a.data.changingYaos,(e,s)=>(o(),l("span",{key:e.position,class:"changing-item"},"第"+u(e.position)+"爻（"+u(e.type)+"）"+u(s<a.data.changingYaos.length-1?"、":""),1))),128))])])):r("",!0)])]),_:1},8,["solar-time","ganzhi-time"]),i("div",K,[i("div",X,[i("div",aa,[(o(!0),l(f,null,k(x(t),(a,e)=>(o(),l("div",{key:e,class:"yao-line"},["sixGod"in a?(o(),l(f,{key:0},[i("span",ea,u(a.sixGod),1),y(B,{"yao-type":a.yaoType,"is-main":!0},null,8,["yao-type"]),i("span",sa,[a.isChanging?(o(),l("span",na,u(6===a.rawValue?"×":"●"),1)):r("",!0)]),i("span",ta,u(a.sixRelative)+u(a.najiaDizhi)+u(a.wuxing),1),i("span",la,u(a.isVoid?"空":""),1),i("span",ia,u(a.isWorld?"世":a.isResponse?"应":""),1)],64)):r("",!0)]))),128))]),i("div",ra,[(o(!0),l(f,null,k(x(t),(a,e)=>(o(),l("div",{key:e,class:"yao-line"},[y(B,{"yao-type":a.isChanging?x(A).getChangedYaoType(a.yaoType):a.yaoType,"is-main":!1},null,8,["yao-type"]),i("span",oa,["sixGod"in a?(o(),l(f,{key:0},[h(u(x(A).getChangedYaoInfo(a)),1)],64)):r("",!0)])]))),128))])])])]),_:1}))}}),[["__scopeId","data-v-716a0edd"]]),ca={class:"hexagram-info"},ua={class:"hexagram-line"},pa={class:"hexagram-value"},ma={class:"hexagram-line"},ga={class:"hexagram-value"},va={key:0,class:"hexagram-line"},ya={class:"hexagram-value"},ha={key:1,class:"hexagram-line"},fa={class:"hexagram-value"},ka={key:2,class:"hexagram-line"},xa={class:"hexagram-value"},wa={class:"paipan-section"},ba={class:"hexagram-container"},Aa={class:"main-hexagram"},_a={class:"yao-position"},$a={class:"change-mark"},Ta={key:0},Ia={class:"trigram-info"},Ha={key:0,class:"inter-hexagram"},Ca={class:"inter-trigram-info"},za={class:"changed-hexagram"},La={class:"changed-trigram-info"},Ya={key:0,class:"calculation-section"},Na={class:"calculation-details"},ja=b(e({__name:"MeihuaResult",props:{data:{}},setup(a){const e=n(!1),s=a,{formatSolarTime:t,formatGanZhi:d}=H(m(s,"data")),{reversedYaosDetail:c}=C(m(s,"data")),p=a=>{if(!s.data.interHexagram)return"阳";const e=s.data.yaosDetail;if(!e||e.length<6)return"阳";const n=[2,3,4,3,4,5][a-1]-1;return e[n]?.yaoType||"阳"};return(n,m)=>(o(),g(R,null,{default:v(()=>[y(G,{"solar-time":x(t),"ganzhi-time":x(d)},{default:v(()=>[i("div",ca,[i("div",ua,[m[0]||(m[0]=i("span",{class:"hexagram-label"},"主卦：",-1)),i("span",pa,[h(u(a.data.originalName)+" ",1),a.data.mainHexagram?.upper&&a.data.mainHexagram?.lower?(o(),l(f,{key:0},[h(" （"+u(a.data.mainHexagram.upper)+"-"+u(a.data.mainHexagram.lower)+"） ",1)],64)):r("",!0)])]),i("div",ma,[m[1]||(m[1]=i("span",{class:"hexagram-label"},"变卦：",-1)),i("span",ga,[h(u(a.data.changedName)+" ",1),a.data.changedHexagram?.upper&&a.data.changedHexagram?.lower?(o(),l(f,{key:0},[h(" （"+u(a.data.changedHexagram.upper)+"-"+u(a.data.changedHexagram.lower)+"） ",1)],64)):r("",!0)])]),a.data.interName?(o(),l("div",va,[m[2]||(m[2]=i("span",{class:"hexagram-label"},"互卦：",-1)),i("span",ya,[h(u(a.data.interName)+" ",1),a.data.interHexagram?.upper&&a.data.interHexagram?.lower?(o(),l(f,{key:0},[h(" （"+u(a.data.interHexagram.upper)+"-"+u(a.data.interHexagram.lower)+"） ",1)],64)):r("",!0)])])):r("",!0),a.data.movingYao?(o(),l("div",ha,[m[3]||(m[3]=i("span",{class:"hexagram-label"},"动爻：",-1)),i("span",fa,u(a.data.movingYao.yaoName)+"（"+u(a.data.movingYao.description)+"）",1)])):r("",!0),a.data.tiGua&&a.data.yongGua&&a.data.analysis?(o(),l("div",ka,[m[4]||(m[4]=i("span",{class:"hexagram-label"},"体用：",-1)),i("span",xa,u(a.data.tiGua.name)+u(a.data.tiGua.element)+" (体) - "+u(a.data.yongGua.name)+u(a.data.yongGua.element)+" (用)（"+u(a.data.analysis.tiYongRelation)+"） ",1)])):r("",!0)])]),_:1},8,["solar-time","ganzhi-time"]),i("div",wa,[i("div",ba,[i("div",Aa,[(o(!0),l(f,null,k(x(c),(a,e)=>{return o(),l("div",{key:e,class:"yao-line"},[i("span",_a,u((s=a.position,["初","二","三","四","五","上"][s-1]||"未知")),1),y(B,{"yao-type":a.yaoType,"is-main":!0},null,8,["yao-type"]),i("span",$a,[a.isChanging?(o(),l("span",Ta,"●")):r("",!0)]),i("span",Ia,["tiYong"in a?(o(),l(f,{key:0},[h(u(a.tiYong),1)],64)):r("",!0)])]);var s}),128))]),a.data.interName?(o(),l("div",Ha,[(o(!0),l(f,null,k(x(c),(a,e)=>{return o(),l("div",{key:e,class:"yao-line"},[y(B,{"yao-type":p(a.position),"is-main":!1},null,8,["yao-type"]),i("span",Ca,u((n=a.position,s.data.interHexagram?n<=3?s.data.interHexagram.lower:s.data.interHexagram.upper:"")),1)]);var n}),128))])):r("",!0),i("div",za,[(o(!0),l(f,null,k(x(c),(a,e)=>{return o(),l("div",{key:e,class:"yao-line"},[y(B,{"yao-type":a.isChanging?x(A).getChangedYaoType(a.yaoType):a.yaoType,"is-main":!1},null,8,["yao-type"]),i("span",La,u((n=a.position,s.data.changedHexagram?n<=3?s.data.changedHexagram.lower:s.data.changedHexagram.upper:"")),1)]);var n}),128))])])]),a.data.calculation&&e.value?(o(),l("div",Ya,[m[6]||(m[6]=i("div",{class:"calculation-title"},"起卦数据",-1)),i("div",Na,[i("span",null,"年支"+u(a.data.calculation.yearZhi)+"("+u(a.data.calculation.yearZhiIndex)+")",1),i("span",null,"月"+u(a.data.calculation.month),1),i("span",null,"日"+u(a.data.calculation.day),1),i("span",null,"时支"+u(a.data.calculation.timeZhi)+"("+u(a.data.calculation.timeZhiIndex)+")",1),m[5]||(m[5]=i("span",null,"→",-1)),i("span",null,"上卦"+u(a.data.calculation.upperTrigramIndex),1),i("span",null,"下卦"+u(a.data.calculation.lowerTrigramIndex),1),i("span",null,"动爻"+u(a.data.calculation.movingYaoIndex),1)])])):r("",!0)]),_:1}))}}),[["__scopeId","data-v-8e7be647"]]);function Ga(a){return a?a.formatted?a.formatted:`${a.year}年 ${a.month}月 ${a.day}日 ${a.hour}时`:""}function Da(a,e){if(!a&&!e)return"";if(e){return new Date(e).toLocaleString("zh-CN")}if(a){return`${a.year||""}年${a.month||""}月${a.day||""}日 ${a.hour||""}时${a.minute||""}分`}return""}function Sa(a){if(!a)return"";return new Date(a).toLocaleString("zh-CN")}const Ba={class:"qimen-result"},Ma={class:"basic-info"},Ra={class:"info-line"},Fa={class:"info-value"},Ea={class:"info-line"},Za={class:"info-value"},qa={class:"info-line"},Pa={class:"info-value"},Ua={class:"info-line"},Va={class:"info-value"},Oa={class:"paipan-section"},Qa={class:"jiugong-container"},Wa={class:"jiugong-grid"},Ja={class:"gong-header"},Ka={class:"gong-name"},Xa={class:"gong-direction"},ae={class:"gong-content"},ee={class:"tian-pan"},se={class:"star"},ne={class:"stem"},te={key:0,class:"ren-pan"},le={class:"door"},ie={class:"di-pan"},re={class:"stem"},oe={key:1,class:"shen-pan"},de={class:"god"},ce={key:2,class:"zhong-gong"},ue=b(e({__name:"QimenResult",props:{data:{}},setup(a){const e=a,n=s(()=>{if(!e.data.jiuGongGe)return[];const a=e.data.jiuGongGe;return[3,8,1,2,4,6,7,0,5].map(e=>a[e]).filter(Boolean)});function t(a){return["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right"][a]||""}return(e,s)=>(o(),l("div",Ba,[i("div",Ma,[i("div",Ra,[s[0]||(s[0]=i("span",{class:"info-label"},"起卦时间：",-1)),i("span",Fa,u(x(Da)(a.data.timeInfo)),1)]),i("div",Ea,[s[1]||(s[1]=i("span",{class:"info-label"},"干支信息：",-1)),i("span",Za,u(x(Ga)(a.data.ganzhi)),1)]),i("div",qa,[s[2]||(s[2]=i("span",{class:"info-label"},"遁甲局数：",-1)),i("span",Pa,u(a.data.isYangDun?"阳遁":"阴遁")+u(a.data.juShu)+"局",1)]),i("div",Ua,[s[3]||(s[3]=i("span",{class:"info-label"},"值符值使：",-1)),i("span",Va,u(a.data.zhiFu)+" "+u(a.data.zhiShi),1)])]),i("div",Oa,[i("div",Qa,[i("div",Wa,[(o(!0),l(f,null,k(n.value,(a,e)=>(o(),l("div",{key:e,class:p(["gong-cell",t(e)])},[i("div",Ja,[i("span",Ka,u(a.name),1),i("span",Xa,u(a.direction),1)]),i("div",ae,[i("div",ee,[i("span",se,u(a.tianPan.star),1),i("span",ne,u(a.tianPan.stem),1)]),a.name.includes("中五宫")?r("",!0):(o(),l("div",te,[i("span",le,u(a.renPan.door),1)])),i("div",ie,[i("span",re,u(a.diPan.stem),1)]),a.name.includes("中五宫")?r("",!0):(o(),l("div",oe,[i("span",de,u(a.shenPan.god),1)])),a.name.includes("中五宫")?(o(),l("div",ce,[...s[4]||(s[4]=[i("span",{class:"zhong-text"},"中宫",-1)])])):r("",!0)])],2))),128))])])])]))}}),[["__scopeId","data-v-b32312d7"]]),pe={key:0,class:"ssgw-info"},me={class:"info-item"},ge={class:"value"},ve={class:"info-item"},ye={class:"value"},he={class:"info-item poem"},fe={class:"poem-content"},ke={key:0,class:"info-item story"},xe={class:"story-content"},we={key:1,class:"details-grid"},be={class:"detail-key"},Ae={class:"detail-value"},_e=b(e({__name:"SsgwResult",props:{data:{}},setup:a=>(e,s)=>a.data?(o(),l("div",pe,[i("div",me,[s[0]||(s[0]=i("span",{class:"label"},"签号：",-1)),i("span",ge,"第"+u(a.data.number)+"签",1)]),i("div",ve,[s[1]||(s[1]=i("span",{class:"label"},"签名：",-1)),i("span",ye,u(a.data.title),1)]),i("div",he,[i("div",fe,u(a.data.poem),1)]),a.data.story?(o(),l("div",ke,[s[2]||(s[2]=i("span",{class:"label"},"签文故事：",-1)),i("div",xe,u(a.data.story),1)])):r("",!0),a.data.details?(o(),l("div",we,[(o(!0),l(f,null,k(a.data.details,(a,e)=>(o(),l("div",{key:e,class:"detail-item"},[i("div",be,u(e),1),i("div",Ae,u(a),1)]))),128))])):r("",!0)])):r("",!0)}),[["__scopeId","data-v-327106ee"]]),$e={class:"tarot-result"},Te={key:0,class:"spread-header"},Ie={class:"spread-title"},He={class:"spread-info"},Ce={class:"card-image"},ze=["src","alt"],Le={class:"card-position"},Ye={key:0,class:"card-reversed"},Ne={class:"card-info"},je={class:"card-name"},Ge={class:"card-keywords"},De={key:1,class:"spread-explanation"},Se={class:"explanation-grid"},Be={class:"position-number"},Me={class:"position-name"},Re={class:"card-summary"},Fe=b(e({__name:"TarotResult",props:{cards:{},type:{},spreadType:{},spreadName:{},timestamp:{},showExplanation:{type:Boolean}},setup(a){const e=a,n=s(()=>{const a=e.cards.length;switch(e.spreadType){case"single":return"layout-single";case"three":return"layout-three";case"love":return"layout-love";case"career":return"layout-career";case"decision":return"layout-decision";case"celtic":return"layout-celtic";case"chakra":return"layout-chakra";case"year":return"layout-year";case"mindBodySpirit":return"layout-mind-body-spirit";case"horseshoe":return"layout-horseshoe";default:return 1===a?"layout-single":3===a?"layout-three":a<=6?"layout-grid":a<=10?"layout-complex":"layout-large-complex"}});function t(a){return"celtic"===e.spreadType?`celtic-position-${a}`:""}function d(a){switch(e.spreadType){case"celtic":return[{gridArea:"2 / 2"},{gridArea:"2 / 2",transform:"rotate(90deg)",zIndex:2},{gridArea:"3 / 2"},{gridArea:"1 / 2"},{gridArea:"2 / 1"},{gridArea:"2 / 3"},{gridArea:"1 / 4"},{gridArea:"2 / 4"},{gridArea:"3 / 4"},{gridArea:"4 / 4"}][a]||{};case"love":return[{gridArea:"2 / 2"},{gridArea:"2 / 3"},{gridArea:"1 / 2 / 1 / 4"},{gridArea:"3 / 1"},{gridArea:"3 / 4"}][a]||{};case"decision":return[{gridArea:"2 / 2"},{gridArea:"1 / 1"},{gridArea:"3 / 1"},{gridArea:"1 / 3"},{gridArea:"3 / 3"},{gridArea:"4 / 2"}][a]||{};case"chakra":return{order:7-a};case"horseshoe":return[{gridArea:"3 / 1"},{gridArea:"2 / 1"},{gridArea:"1 / 1"},{gridArea:"1 / 2"},{gridArea:"1 / 3"},{gridArea:"2 / 3"},{gridArea:"3 / 3"}][a]||{};default:return{}}}function c(a){a.target.src="/static/tarot/card-back.jpg"}return(e,s)=>(o(),l("div",$e,[a.spreadName?(o(),l("div",Te,[i("h3",Ie,u(a.spreadName),1),i("p",He,u(a.cards.length)+"张牌 · "+u(a.timestamp?x(Sa)(a.timestamp):""),1)])):r("",!0),i("div",{class:p(["cards-layout",n.value])},[(o(!0),l(f,null,k(a.cards,(a,e)=>(o(),l("div",{key:e,class:p(["tarot-card",t(e)]),style:w(d(e))},[i("div",Ce,[i("img",{src:`/static/tarot/${a.id}.jpg`,alt:a.name,class:p({reversed:a.reversed}),onError:c},null,42,ze),i("div",Le,u(a.position),1),a.reversed?(o(),l("div",Ye,"逆位")):r("",!0)]),i("div",Ne,[i("h4",je,u(a.name),1),i("p",Ge,u(a.keywords),1)])],6))),128))],2),a.showExplanation&&a.cards.length>1?(o(),l("div",De,[s[0]||(s[0]=i("h4",null,"牌阵解读说明",-1)),i("div",Se,[(o(!0),l(f,null,k(a.cards,(a,e)=>(o(),l("div",{key:e,class:"explanation-item"},[i("span",Be,u(e+1),1),i("span",Me,u(a.position),1),i("span",Re,u(a.name)+u(a.reversed?"(逆位)":""),1)]))),128))])])):r("",!0)]))}}),[["__scopeId","data-v-7ed0fd81"]]),Ee={class:"content-card"},Ze={class:"result-header"},qe={class:"section-title"},Pe={key:0,class:"result-content"},Ue={key:1,class:"ai-content"},Ve={class:"ai-header"},Oe={class:"ai-title"},Qe={class:"ai-response-content"},We={key:0,class:"conversation-history"},Je={key:0,class:"loading-dots"},Ke={key:1,class:"markdown-container"},Xe={key:2,class:"copy-button-wrapper"},as=["title","disabled","onClick"],es={key:0,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ss={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ns={key:0,class:"disclaimer"},ts={key:2,class:"error-state"},ls={class:"error-content"},is={class:"error-line-2"},rs={class:"error-line-3"},os={class:"result-actions"},ds=b(e({__name:"DivinationResult",props:{type:{},result:{},title:{default:""},isAiLoading:{type:Boolean,default:!1},error:{default:null},question:{default:""},conversationHistory:{default:()=>[]},isFollowUpLoading:{type:Boolean,default:!1}},emits:["retry"],setup(a,{emit:e}){const t=a,{copy:m,copied:v}=function(){const a=n(!1),e=n(null),s=s=>{const n=document.createElement("textarea");n.value=s,n.style.position="fixed",n.style.top="-9999px",n.style.left="-9999px",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy")?(a.value=!0,e.value=null,setTimeout(()=>{a.value=!1},2e3)):e.value=new Error("Fallback copy: document.execCommand failed")}catch(t){e.value=t}document.body.removeChild(n)};return{copy:n=>{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(n).then(()=>{a.value=!0,e.value=null,setTimeout(()=>{a.value=!1},2e3)}).catch(a=>{e.value=a,s(n)}):s(n)},copied:d(a),error:d(e)}}(),h=n(null),w=s(()=>t.conversationHistory.filter(a=>"assistant"===a.role)),b=s(()=>w.value.length>0?w.value[w.value.length-1]:null);const A=s(()=>{const a=t.conversationHistory.filter(a=>"assistant"===a.role),e=a[a.length-1];return(t.isAiLoading||t.isFollowUpLoading)&&e&&!x(e.content)?"AI正在思考...":"AI深度解读"}),_=s(()=>{if(t.title)return t.title;const{type:a,result:e}=t;if("tarot"===a||"tarot_single"===a){const a=e.data,s=a.spreadName;if(s)return`塔罗牌·${s}结果`;const n=a.cards?.length||0;return 1===n?"塔罗牌·单牌指引结果":3===n?"塔罗牌·时间流牌阵结果":"塔罗牌占卜结果"}const s={liuyao:"六爻占卜结果",meihua:"梅花易数结果",qimen:"奇门遁甲结果",ssgw:"三山国王灵签结果"};return a in s?s[a]:"占卜结果"}),$=s(()=>"liuyao"===t.type),T=s(()=>"meihua"===t.type),H=s(()=>"qimen"===t.type),C=s(()=>["tarot","tarot_single"].includes(t.type)),z=s(()=>"ssgw"===t.type),L=s(()=>C.value?t.result.data:null),Y=s(()=>$.value?t.result.data:null),N=s(()=>T.value?t.result.data:null),j=s(()=>H.value?t.result.data:null),G=s(()=>z.value?t.result.data:null),D=s(()=>C.value?t.type:null);return(e,s)=>(o(),l("div",Ee,[i("div",Ze,[i("h2",qe,u(_.value),1)]),a.result.data?(o(),l("div",Pe,[$.value&&Y.value?(o(),g(x(da),{key:0,data:Y.value},null,8,["data"])):r("",!0),T.value&&N.value?(o(),g(x(ja),{key:1,data:N.value},null,8,["data"])):r("",!0),H.value&&j.value?(o(),g(x(ue),{key:2,data:j.value},null,8,["data"])):r("",!0),C.value&&L.value&&D.value?(o(),g(x(Fe),{key:3,cards:L.value.cards||[],type:D.value,"spread-type":L.value.spreadType,"spread-name":L.value.spreadName,timestamp:L.value.timestamp,"show-explanation":!0},null,8,["cards","type","spread-type","spread-name","timestamp"])):r("",!0),z.value&&G.value?(o(),g(x(_e),{key:4,data:G.value},null,8,["data"])):r("",!0)])):r("",!0),a.conversationHistory.length>0||a.isAiLoading?(o(),l("div",Ue,[i("div",Ve,[i("h3",Oe,u(A.value),1)]),i("div",Qe,[a.conversationHistory.length>0?(o(),l("div",We,[(o(!0),l(f,null,k(a.conversationHistory.filter(a=>"system"!==a.role),(e,n)=>(o(),l("div",{key:e.id||n,class:p(["chat-message",`message-${e.role}`])},["assistant"!==e.role||x(e.content)||!a.isAiLoading&&!a.isFollowUpLoading?(o(),l("div",Ke,[y(I,{content:e.content,"is-complete":!(a.isAiLoading||a.isFollowUpLoading)},null,8,["content","is-complete"])])):(o(),l("div",Je,[...s[1]||(s[1]=[i("span",null,null,-1),i("span",null,null,-1),i("span",null,null,-1)])])),"assistant"===e.role&&x(e.content)?(o(),l("div",Xe,[i("button",{class:"copy-button",title:h.value===e.id?"已复制":"复制",disabled:e.id===b.value?.id&&(a.isAiLoading||a.isFollowUpLoading),onClick:a=>function(a,e){const s=e.currentTarget.closest(".chat-message");if(!s)return;const n=s.querySelector(".markdown-container");if(!n)return;const t=n.cloneNode(!0);t.querySelectorAll("details").forEach(a=>a.remove());const l=(t.textContent||"").trim();m(l);const i=watch(v,e=>{e&&(h.value=a.id||null,setTimeout(()=>{h.value=null},2e3),i())})}(e,a)},[h.value===e.id?(o(),l("svg",es,[...s[2]||(s[2]=[i("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(o(),l("svg",ss,[...s[3]||(s[3]=[i("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"},null,-1),i("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"},null,-1)])]))],8,as)])):r("",!0)],2))),128))])):r("",!0)]),a.conversationHistory.length>0&&!a.error?(o(),l("div",ns,[...s[4]||(s[4]=[i("div",{class:"disclaimer-content"},[i("div",{class:"disclaimer-icon"},"⚠️"),i("div",{class:"disclaimer-text"}," 请注意：本次占卜仅为根据您提供的有限信息进行的推演，旨在提供一种思考和决策的辅助视角，而非绝对的未来预测。请结合您的实际情况，理性参考，自主决策。命运终究掌握在自己手中。 ")],-1)])])):r("",!0)])):r("",!0),a.error?(o(),l("div",ts,[i("div",ls,[s[5]||(s[5]=i("div",{class:"error-line-1"},"哈哈，AI开小差咯",-1)),i("div",is,u(a.error),1),i("div",rs,[c(e.$slots,"error-actions",{},()=>[i("button",{class:"retry-button",onClick:s[0]||(s[0]=a=>e.$emit("retry"))},"重新生成解读")])])])])):r("",!0),i("div",os,[c(e.$slots,"actions",{},void 0)])]))}}),[["__scopeId","data-v-818d3b1f"]]);export{ds as D};
