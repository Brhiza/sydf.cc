<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é“¾æ¥æå–å™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 50px;
            text-align: left;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input {
            width: 80%;
            padding: 10px;
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <h1>é“¾æ¥æå–å™¨</h1>

    <label for="textInput">åŸæ–‡ï¼š</label>
    <input type="text" id="textInput" placeholder="ç›´æ¥ç²˜è´´æ–‡æœ¬" autofocus oninput="autoExtract()">

    <br>

    <label for="linkInput">é“¾æ¥ï¼š</label>
    <input type="text" id="linkInput" placeholder="æå–çš„ç½‘é¡µé“¾æ¥">

    <button onclick="copyText('linkInput')">å¤åˆ¶</button>

    <br>

    <label for="textInput">æ ‡é¢˜ï¼š</label>
    <input type="text" id="textOutput" placeholder="æå–çš„æ–‡å­—">

    <button onclick="copyText('textOutput')">å¤åˆ¶</button>

    <script>
        function autoExtract() {
            var textInput = document.getElementById("textInput").value;
            var linkInput = document.getElementById("linkInput");
            var textOutput = document.getElementById("textOutput");

            // é‡ç½®è¾“å…¥æ¡†
            linkInput.value = "";
            textOutput.value = "";

            // 1. æå–ç½‘é¡µé“¾æ¥
            var extractedLink = "";
            // ä¼˜å…ˆåŒ¹é…ç‰¹å®šå·²çŸ¥æ ¼å¼ï¼Œç¡®ä¿é“¾æ¥å®Œæ•´æ€§
            // å°çº¢ä¹¦é“¾æ¥åˆ°ä¸­æ–‡é€—å·æˆ–ç©ºæ ¼å‰
            // æŠ–éŸ³å’Œå¿«æ‰‹é“¾æ¥åˆ°ç©ºæ ¼å‰
            var specificLinkMatch = textInput.match(/https?:\/\/(v\.douyin\.com\/[^\s]+|v\.kuaishou\.com\/[^\s]+|xhslink\.com\/[^\sï¼Œ]+)/);

            if (specificLinkMatch) {
                extractedLink = specificLinkMatch[0];
            } else {
                // Fallback for other generic links, stopping at space or Chinese comma
                var genericLinkMatch = textInput.match(/https?:\/\/[^\sï¼Œ]+/);
                if (genericLinkMatch) {
                    extractedLink = genericLinkMatch[0];
                }
            }
            linkInput.value = extractedLink || "æœªæ‰¾åˆ°ç½‘é¡µé“¾æ¥";

            // 2. æå–ç‰¹å®šæ–‡å­— (æ ‡é¢˜)
            var extractedText = "æœªæ‰¾åˆ°ç‰¹å®šæ–‡å­—";

            // å°è¯•æ ¼å¼1 (æŠ–éŸ³)
            var douyinMatch = textInput.match(/ã€[^ã€‘]+ã€‘([^#]+)#/);
            if (douyinMatch && douyinMatch[1]) {
                extractedText = douyinMatch[1].trim();
            } else {
                // å°è¯•æ ¼å¼2 (å¿«æ‰‹) - æ ‡é¢˜åœ¨é“¾æ¥ä¹‹å
                if (extractedLink && textInput.indexOf(extractedLink) !== -1) {
                    const linkEndIndex = textInput.indexOf(extractedLink) + extractedLink.length;
                    const textAfterLink = textInput.substring(linkEndIndex);
                    var kuaishouMatch = textAfterLink.match(/^\s*([^â€œ]+)â€œ/);
                    if (kuaishouMatch && kuaishouMatch[1]) {
                        extractedText = kuaishouMatch[1].trim();
                    } else {
                        // å°è¯•æ ¼å¼3 (å°çº¢ä¹¦) - æ ‡é¢˜åœ¨é“¾æ¥ä¹‹å‰
                        // Regex for Xiaohongshu title:
                        // ^(.*?)                                - Capture group 1: title part (non-greedy)
                        // (?:ğŸ˜†\s*[A-Za-z0-9]+\s*ğŸ˜†)?          - Optional non-capturing group for emoji/code
                        // \s*https?:\/\/xhslink\.com\/[^\sï¼Œ]+  - Matches the Xiaohongshu link (until space or Chinese comma)
                        var xiaohongshuTitleMatch = textInput.match(/^(.*?)(?:ğŸ˜†\s*[A-Za-z0-9]+\s*ğŸ˜†)?\s*https?:\/\/xhslink\.com\/[^\sï¼Œ]+/);
                        if (xiaohongshuTitleMatch && xiaohongshuTitleMatch[1]) {
                            let title = xiaohongshuTitleMatch[1].trim();
                            title = title.replace(/^\d+\s*/, ''); // å»é™¤å¼€å¤´çš„æ•°å­—å’Œç©ºæ ¼
                            if (title) { // å¦‚æœæ ‡é¢˜åœ¨å»é™¤æ•°å­—åä¸ä¸ºç©ºï¼Œåˆ™è®¾ç½®
                                extractedText = title;
                            }
                        }
                    }
                }
            }

            textOutput.value = extractedText;

            // è‡ªåŠ¨å¤åˆ¶ç½‘é¡µé“¾æ¥çš„æå–ç»“æœ (å¦‚æœæå–åˆ°)
            if (extractedLink) {
                copyText('linkInput');
            }

            // å°†ç„¦ç‚¹è®¾ç½®å›è¾“å…¥æ–‡æœ¬æ¡†
            document.getElementById("textInput").focus();
        }

        function copyText(inputId) {
            var inputElement = document.getElementById(inputId);
            inputElement.select();
            document.execCommand("copy");
        }
    </script>
</body>
</html>
